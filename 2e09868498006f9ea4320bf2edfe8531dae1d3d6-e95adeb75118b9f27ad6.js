/*! For license information please see 2e09868498006f9ea4320bf2edfe8531dae1d3d6-e95adeb75118b9f27ad6.js.LICENSE.txt */
(self.webpackChunkbonsai_web=self.webpackChunkbonsai_web||[]).push([[918],{8483:function(e,t,n){"use strict";n.d(t,{V:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(t,n,r,a,o,s){(0,i.Z)(this,e),this.source=t,this.pointerX=n,this.pointerY=r,this.meshUnderPointer=a,this.sourceEvent=o,this.additionalData=s}return(0,r.Z)(e,null,[{key:"CreateNew",value:function(t,n,i){var r=t.getScene();return new e(t,r.pointerX,r.pointerY,r.meshUnderPointer||t,n,i)}},{key:"CreateNewFromSprite",value:function(t,n,i,r){return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer,i,r)}},{key:"CreateNewFromScene",value:function(t,n){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,n)}},{key:"CreateNewFromPrimitive",value:function(t,n,i,r){return new e(t,n.x,n.y,null,i,r)}}]),e}()},2845:function(e,t,n){"use strict";n.d(t,{l:function(){return o},o:function(){return s}});var i=n(5671),r=n(3144),a=n(7818),o=function(){function e(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7?arguments[7]:void 0;(0,i.Z)(this,e),this._isAlreadyOwned=!1,t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=r,this._instanced=l,this._divisor=c||1,n instanceof a.h?(this._data=null,this._buffer=n):(this._data=n,this._buffer=null),this.byteStride=u?o:o*Float32Array.BYTES_PER_ELEMENT,s||this.create()}return(0,r.Z)(e,[{key:"createVertexBuffer",value:function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6?arguments[6]:void 0,l=a?t:t*Float32Array.BYTES_PER_ELEMENT,u=i?a?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new s(this._engine,this,e,this._updatable,!0,u,void 0===r?this._instanced:r,l,n,void 0,void 0,!0,this._divisor||o)}},{key:"isUpdatable",value:function(){return this._updatable}},{key:"getData",value:function(){return this._data}},{key:"getBuffer",value:function(){return this._buffer}},{key:"getStrideSize",value:function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))}},{key:"_rebuild",value:function(){this._buffer=null,this.create(this._data)}},{key:"update",value:function(e){this.create(e)}},{key:"updateDirectly",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,i?t:t*Float32Array.BYTES_PER_ELEMENT,n?n*this.byteStride:void 0),this._data=0===t&&void 0===n?e:null)}},{key:"_increaseReferences",value:function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}},{key:"dispose",value:function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)}}]),e}(),s=function(){function e(t,n,r,a,s,l,u,c,h,f){var d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],v=arguments.length>11&&void 0!==arguments[11]&&arguments[11],p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,_=arguments.length>13&&void 0!==arguments[13]&&arguments[13];if((0,i.Z)(this,e),n instanceof o?(this._buffer=n,this._ownsBuffer=_):(this._buffer=new o(t,n,a,l,s,u,v),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=r,null==f){var g=this.getData();this.type=e.FLOAT,g instanceof Int8Array?this.type=e.BYTE:g instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:g instanceof Int16Array?this.type=e.SHORT:g instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:g instanceof Int32Array?this.type=e.INT:g instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=f;var m=e.GetTypeByteLength(this.type);v?(this._size=h||(l?l/m:e.DeduceStride(r)),this.byteStride=l||this._buffer.byteStride||this._size*m,this.byteOffset=c||0):(this._size=h||l||e.DeduceStride(r),this.byteStride=l?l*m:this._buffer.byteStride||this._size*m,this.byteOffset=(c||0)*m),this.normalized=d,this._instanced=void 0!==u&&u,this._instanceDivisor=u?p:0,this._computeHashCode()}return(0,r.Z)(e,[{key:"instanceDivisor",get:function(){return this._instanceDivisor},set:function(e){var t=0!=e;this._instanceDivisor=e,t!==this._instanced&&(this._instanced=t,this._computeHashCode())}},{key:"_computeHashCode",value:function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}},{key:"_rebuild",value:function(){this._buffer&&this._buffer._rebuild()}},{key:"getKind",value:function(){return this._kind}},{key:"isUpdatable",value:function(){return this._buffer.isUpdatable()}},{key:"getData",value:function(){return this._buffer.getData()}},{key:"getFloatData",value:function(t,n){var i=this.getData();if(!i)return null;var r=this.getSize()*e.GetTypeByteLength(this.type),a=t*this.getSize();if(this.type!==e.FLOAT||this.byteStride!==r){var o=new Float32Array(a);return this.forEach(a,(function(e,t){return o[t]=e})),o}if(!(i instanceof Array||i instanceof Float32Array)||0!==this.byteOffset||i.length!==a){if(i instanceof Array){var s=this.byteOffset/4;return i.slice(s,s+a)}if(i instanceof ArrayBuffer)return new Float32Array(i,this.byteOffset,a);var l=i.byteOffset+this.byteOffset;if(n){var u=new Float32Array(a),c=new Float32Array(i.buffer,l,a);return u.set(c),u}var h=l%4;return h&&(l=Math.max(0,l-h)),new Float32Array(i.buffer,l,a)}return n?i.slice():i}},{key:"getBuffer",value:function(){return this._buffer.getBuffer()}},{key:"getStrideSize",value:function(){return this.byteStride/e.GetTypeByteLength(this.type)}},{key:"getOffset",value:function(){return this.byteOffset/e.GetTypeByteLength(this.type)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t?this._size*e.GetTypeByteLength(this.type):this._size}},{key:"getIsInstanced",value:function(){return this._instanced}},{key:"getInstanceDivisor",value:function(){return this._instanceDivisor}},{key:"create",value:function(e){this._buffer.create(e)}},{key:"update",value:function(e){this._buffer.update(e)}},{key:"updateDirectly",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(e,t,void 0,n)}},{key:"dispose",value:function(){this._ownsBuffer&&this._buffer.dispose()}},{key:"forEach",value:function(t,n){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,n)}}],[{key:"DeduceStride",value:function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}},{key:"GetTypeByteLength",value:function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '".concat(t,"'"))}}},{key:"ForEach",value:function(t,n,i,r,a,o,s,l){if(t instanceof Array)for(var u=n/4,c=i/4,h=0;h<o;h+=r){for(var f=0;f<r;f++)l(t[u+f],h+f);u+=c}else for(var d=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),v=e.GetTypeByteLength(a),p=0;p<o;p+=r){for(var _=n,g=0;g<r;g++){l(e._GetFloatValue(d,a,_,s),p+g),_+=v}n+=i}}},{key:"_GetFloatValue",value:function(t,n,i,r){switch(n){case e.BYTE:var a=t.getInt8(i);return r&&(a=Math.max(a/127,-1)),a;case e.UNSIGNED_BYTE:var o=t.getUint8(i);return r&&(o/=255),o;case e.SHORT:var s=t.getInt16(i,!0);return r&&(s=Math.max(s/32767,-1)),s;case e.UNSIGNED_SHORT:var l=t.getUint16(i,!0);return r&&(l/=65535),l;case e.INT:return t.getInt32(i,!0);case e.UNSIGNED_INT:return t.getUint32(i,!0);case e.FLOAT:return t.getFloat32(i,!0);default:throw new Error("Invalid component type ".concat(n))}}}]),e}();s._Counter=0,s.BYTE=5120,s.UNSIGNED_BYTE=5121,s.SHORT=5122,s.UNSIGNED_SHORT=5123,s.INT=5124,s.UNSIGNED_INT=5125,s.FLOAT=5126,s.PositionKind="position",s.NormalKind="normal",s.TangentKind="tangent",s.UVKind="uv",s.UV2Kind="uv2",s.UV3Kind="uv3",s.UV4Kind="uv4",s.UV5Kind="uv5",s.UV6Kind="uv6",s.ColorKind="color",s.ColorInstanceKind="instanceColor",s.MatricesIndicesKind="matricesIndices",s.MatricesWeightsKind="matricesWeights",s.MatricesIndicesExtraKind="matricesIndicesExtra",s.MatricesWeightsExtraKind="matricesWeightsExtra"},7818:function(e,t,n){"use strict";n.d(t,{h:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=e._Counter++}return(0,r.Z)(e,[{key:"underlyingResource",get:function(){return null}}]),e}();a._Counter=0},7337:function(e,t,n){"use strict";n.d(t,{V:function(){return M}});var i=n(5671),r=n(3144),a=n(7326),o=n(1752),s=n(136),l=n(6215),u=n(1120),c=n(9477),h=n(9336),f=n(5934),d=n(8517),v=n(4174),p=n(6900),_=n(1396),g=n(2328),m=n(1704),y=n(5230),A=n(628),E=n(2465);function b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,u.Z)(e);if(t){var r=(0,u.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,l.Z)(this,n)}}var M=function(e){(0,s.Z)(n,e);var t=S(n);function n(e,r,o){var s,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return(0,i.Z)(this,n),(s=t.call(this,e,o))._position=p.P.Zero(),s._upVector=p.P.Up(),s._orthoLeft=null,s._orthoRight=null,s._orthoBottom=null,s._orthoTop=null,s.fov=.8,s.projectionPlaneTilt=0,s.minZ=1,s.maxZ=1e4,s.inertia=.9,s._mode=n.PERSPECTIVE_CAMERA,s.isIntermediate=!1,s.viewport=new A.l(0,0,1,1),s.layerMask=268435455,s.fovMode=n.FOVMODE_VERTICAL_FIXED,s.cameraRigMode=n.RIG_MODE_NONE,s.customRenderTargets=new Array,s.outputRenderTarget=null,s.onViewMatrixChangedObservable=new v.y$,s.onProjectionMatrixChangedObservable=new v.y$,s.onAfterCheckInputsObservable=new v.y$,s.onRestoreStateObservable=new v.y$,s.isRigCamera=!1,s._rigCameras=new Array,s._webvrViewMatrix=p.y3.Identity(),s._skipRendering=!1,s._projectionMatrix=new p.y3,s._postProcesses=new Array,s._activeMeshes=new f.t(256),s._globalPosition=p.P.Zero(),s._computedViewMatrix=p.y3.Identity(),s._doNotComputeProjectionMatrix=!1,s._transformMatrix=p.y3.Zero(),s._refreshFrustumPlanes=!0,s._absoluteRotation=p._f.Identity(),s._isCamera=!0,s._isLeftCamera=!1,s._isRightCamera=!1,s.getScene().addCamera((0,a.Z)(s)),l&&!s.getScene().activeCamera&&(s.getScene().activeCamera=(0,a.Z)(s)),s.position=r,s.renderPassId=s.getScene().getEngine().createRenderPassId("Camera ".concat(e)),s}return(0,r.Z)(n,[{key:"position",get:function(){return this._position},set:function(e){this._position=e}},{key:"upVector",get:function(){return this._upVector},set:function(e){this._upVector=e}},{key:"screenArea",get:function(){var e=0,t=0;if(this.mode===n.PERSPECTIVE_CAMERA)this.fovMode===n.FOVMODE_VERTICAL_FIXED?(t=2*this.minZ*Math.tan(this.fov/2),e=this.getEngine().getAspectRatio(this)*t):t=(e=2*this.minZ*Math.tan(this.fov/2))/this.getEngine().getAspectRatio(this);else{var i,r,a,o,s=this.getEngine().getRenderWidth()/2,l=this.getEngine().getRenderHeight()/2;e=(null!==(i=this.orthoRight)&&void 0!==i?i:s)-(null!==(r=this.orthoLeft)&&void 0!==r?r:-s),t=(null!==(a=this.orthoTop)&&void 0!==a?a:l)-(null!==(o=this.orthoBottom)&&void 0!==o?o:-l)}return e*t}},{key:"orthoLeft",get:function(){return this._orthoLeft},set:function(e){this._orthoLeft=e;var t,n=b(this._rigCameras);try{for(n.s();!(t=n.n()).done;){t.value.orthoLeft=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"orthoRight",get:function(){return this._orthoRight},set:function(e){this._orthoRight=e;var t,n=b(this._rigCameras);try{for(n.s();!(t=n.n()).done;){t.value.orthoRight=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"orthoBottom",get:function(){return this._orthoBottom},set:function(e){this._orthoBottom=e;var t,n=b(this._rigCameras);try{for(n.s();!(t=n.n()).done;){t.value.orthoBottom=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"orthoTop",get:function(){return this._orthoTop},set:function(e){this._orthoTop=e;var t,n=b(this._rigCameras);try{for(n.s();!(t=n.n()).done;){t.value.orthoTop=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"mode",get:function(){return this._mode},set:function(e){this._mode=e;var t,n=b(this._rigCameras);try{for(n.s();!(t=n.n()).done;){t.value.mode=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"storeState",value:function(){return this._stateStored=!0,this._storedFov=this.fov,this}},{key:"_restoreStateValues",value:function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}},{key:"restoreState",value:function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}},{key:"getClassName",value:function(){return"Camera"}},{key:"toString",value:function(e){var t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(var n=0;n<this.animations.length;n++)t+=", animation[0]: "+this.animations[n].toString(e);return t}},{key:"applyVerticalCorrection",value:function(){var e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x}},{key:"globalPosition",get:function(){return this._globalPosition}},{key:"getActiveMeshes",value:function(){return this._activeMeshes}},{key:"isActiveMesh",value:function(e){return-1!==this._activeMeshes.indexOf(e)}},{key:"isReady",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e){var t,i=b(this._postProcesses);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(r&&!r.isReady())return!1}}catch(a){i.e(a)}finally{i.f()}}return(0,o.Z)((0,u.Z)(n.prototype),"isReady",this).call(this,e)}},{key:"_initCache",value:function(){(0,o.Z)((0,u.Z)(n.prototype),"_initCache",this).call(this),this._cache.position=new p.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new p.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}},{key:"_updateCache",value:function(e){e||(0,o.Z)((0,u.Z)(n.prototype),"_updateCache",this).call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}},{key:"_isSynchronized",value:function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}},{key:"_isSynchronizedViewMatrix",value:function(){return!!(0,o.Z)((0,u.Z)(n.prototype),"_isSynchronized",this).call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}},{key:"_isSynchronizedProjectionMatrix",value:function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var t=this.getEngine();return e=this.mode===n.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight()}},{key:"attachControl",value:function(e,t){}},{key:"detachControl",value:function(e){}},{key:"update",value:function(){this._checkInputs(),this.cameraRigMode!==n.RIG_MODE_NONE&&this._updateRigCameras()}},{key:"_checkInputs",value:function(){this.onAfterCheckInputsObservable.notifyObservers(this)}},{key:"rigCameras",get:function(){return this._rigCameras}},{key:"rigPostProcess",get:function(){return this._rigPostProcess}},{key:"_getFirstPostProcess",value:function(){for(var e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null}},{key:"_cascadePostProcessesToRigCams",value:function(){var e=this._getFirstPostProcess();e&&e.markTextureDirty();for(var t=0,n=this._rigCameras.length;t<n;t++){var i=this._rigCameras[t],r=i._rigPostProcess;if(r)"pass"===r.getEffectName()&&(i.isIntermediate=0===this._postProcesses.length),i._postProcesses=this._postProcesses.slice(0).concat(r),r.markTextureDirty();else i._postProcesses=this._postProcesses.slice(0)}}},{key:"attachPostProcess",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(g.Y.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))}},{key:"detachPostProcess",value:function(e){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}},{key:"getWorldMatrix",value:function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}},{key:"_getViewMatrix",value:function(){return p.y3.Identity()}},{key:"getViewMatrix",value:function(e){return!e&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}},{key:"freezeProjectionMatrix",value:function(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)}},{key:"unfreezeProjectionMatrix",value:function(){this._doNotComputeProjectionMatrix=!1}},{key:"getProjectionMatrix",value:function(e){if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var t=this.getEngine(),i=this.getScene();if(this.mode===n.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=t.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1);var r,a=t.useReverseDepthBuffer;r=i.useRightHandedSystem?p.y3.PerspectiveFovRHToRef:p.y3.PerspectiveFovLHToRef,r(this.fov,t.getAspectRatio(this),a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===n.FOVMODE_VERTICAL_FIXED,t.isNDCHalfZRange,this.projectionPlaneTilt,t.useReverseDepthBuffer)}else{var o,s,l,u,c,h,f,d,v=t.getRenderWidth()/2,_=t.getRenderHeight()/2;if(i.useRightHandedSystem)p.y3.OrthoOffCenterRHToRef(null!==(o=this.orthoLeft)&&void 0!==o?o:-v,null!==(s=this.orthoRight)&&void 0!==s?s:v,null!==(l=this.orthoBottom)&&void 0!==l?l:-_,null!==(u=this.orthoTop)&&void 0!==u?u:_,this.minZ,this.maxZ,this._projectionMatrix,t.isNDCHalfZRange);else p.y3.OrthoOffCenterLHToRef(null!==(c=this.orthoLeft)&&void 0!==c?c:-v,null!==(h=this.orthoRight)&&void 0!==h?h:v,null!==(f=this.orthoBottom)&&void 0!==f?f:-_,null!==(d=this.orthoTop)&&void 0!==d?d:_,this.minZ,this.maxZ,this._projectionMatrix,t.isNDCHalfZRange);this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}},{key:"getTransformationMatrix",value:function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}},{key:"_updateFrustumPlanes",value:function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?E.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=E.i.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}},{key:"isInFrustum",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),t&&this.rigCameras.length>0){var n=!1;return this.rigCameras.forEach((function(t){t._updateFrustumPlanes(),n=n||e.isInFrustum(t._frustumPlanes)})),n}return e.isInFrustum(this._frustumPlanes)}},{key:"isCompletelyInFrustum",value:function(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)}},{key:"getForwardRay",value:function(){throw(0,y.S)("Ray")}},{key:"getForwardRayToRef",value:function(e){throw(0,y.S)("Ray")}},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var i=this._rigCameras.pop();i&&i.dispose()}if(this._parentContainer){var r=this._parentContainer.cameras.indexOf(this);r>-1&&this._parentContainer.cameras.splice(r,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==n.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else for(var a=this._postProcesses.length;--a>=0;){var s=this._postProcesses[a];s&&s.dispose(this)}for(var l=this.customRenderTargets.length;--l>=0;)this.customRenderTargets[l].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),(0,o.Z)((0,u.Z)(n.prototype),"dispose",this).call(this,e,t)}},{key:"isLeftCamera",get:function(){return this._isLeftCamera}},{key:"isRightCamera",get:function(){return this._isRightCamera}},{key:"leftCamera",get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]}},{key:"rightCamera",get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]}},{key:"getLeftTarget",value:function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}},{key:"getRightTarget",value:function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}},{key:"setCameraRigMode",value:function(e,t){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){var i=this._rigCameras.pop();i&&i.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=t.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=d.w1.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==n.RIG_MODE_NONE){var r=this.createRigCamera(this.name+"_L",0);r&&(r._isLeftCamera=!0);var a=this.createRigCamera(this.name+"_R",1);a&&(a._isRightCamera=!0),r&&a&&(this._rigCameras.push(r),this._rigCameras.push(a))}this._setRigMode(t),this._cascadePostProcessesToRigCams(),this.update()}}},{key:"_setRigMode",value:function(e){}},{key:"_getVRProjectionMatrix",value:function(){return p.y3.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}},{key:"_updateCameraRotationMatrix",value:function(){}},{key:"_updateWebVRCameraRotationMatrix",value:function(){}},{key:"_getWebVRProjectionMatrix",value:function(){return p.y3.Identity()}},{key:"_getWebVRViewMatrix",value:function(){return p.y3.Identity()}},{key:"setCameraRigParameter",value:function(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=d.w1.ToRadians(t/.0637))}},{key:"createRigCamera",value:function(e,t){return null}},{key:"_updateRigCameras",value:function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===n.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}},{key:"_setupInputs",value:function(){}},{key:"serialize",value:function(){var e=h.p4.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),h.p4.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}},{key:"clone",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=h.p4.Clone(n.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return i.name=e,i.parent=t,this.onClonedObservable.notifyObservers(i),i}},{key:"getDirection",value:function(e){var t=p.P.Zero();return this.getDirectionToRef(e,t),t}},{key:"absoluteRotation",get:function(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}},{key:"getDirectionToRef",value:function(e,t){p.P.TransformNormalToRef(e,this.getWorldMatrix(),t)}},{key:"computeWorldMatrix",value:function(){return this.getWorldMatrix()}}],[{key:"GetConstructorFromName",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=_.N.Construct(e,t,i,{interaxial_distance:r,isStereoscopicSideBySide:a});return o||function(){return n._CreateDefaultParsedCamera(t,i)}}},{key:"Parse",value:function(e,t){var i=e.type,r=n.GetConstructorFromName(i,e.name,t,e.interaxial_distance,e.isStereoscopicSideBySide),a=h.p4.Parse(r,e,t);if(void 0!==e.parentId&&(a._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(a._waitingParentInstanceIndex=e.parentInstanceIndex),a.inputs&&(a.inputs.parse(e),a._setupInputs()),e.upVector&&(a.upVector=p.P.FromArray(e.upVector)),a.setPosition&&(a.position.copyFromFloats(0,0,0),a.setPosition(p.P.FromArray(e.position))),e.target&&a.setTarget&&a.setTarget(p.P.FromArray(e.target)),e.cameraRigMode){var o=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};a.setCameraRigMode(e.cameraRigMode,o)}if(e.animations){for(var s=0;s<e.animations.length;s++){var l=e.animations[s],u=(0,m.q)("BABYLON.Animation");u&&a.animations.push(u.Parse(l))}_.N.ParseAnimationRanges(a,e,t)}return e.autoAnimate&&t.beginAnimation(a,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&a.setEnabled(e.isEnabled),a}}]),n}(_.N);M._CreateDefaultParsedCamera=function(e,t){throw(0,y.S)("UniversalCamera")},M.PERSPECTIVE_CAMERA=0,M.ORTHOGRAPHIC_CAMERA=1,M.FOVMODE_VERTICAL_FIXED=0,M.FOVMODE_HORIZONTAL_FIXED=1,M.RIG_MODE_NONE=0,M.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,M.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,M.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,M.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,M.RIG_MODE_STEREOSCOPIC_INTERLACED=14,M.RIG_MODE_VR=20,M.RIG_MODE_WEBVR=21,M.RIG_MODE_CUSTOM=22,M.ForceAttachControlToAlwaysPreventDefault=!1,(0,c.gn)([(0,h.hd)("position")],M.prototype,"_position",void 0),(0,c.gn)([(0,h.hd)("upVector")],M.prototype,"_upVector",void 0),(0,c.gn)([(0,h.qC)()],M.prototype,"orthoLeft",null),(0,c.gn)([(0,h.qC)()],M.prototype,"orthoRight",null),(0,c.gn)([(0,h.qC)()],M.prototype,"orthoBottom",null),(0,c.gn)([(0,h.qC)()],M.prototype,"orthoTop",null),(0,c.gn)([(0,h.qC)()],M.prototype,"fov",void 0),(0,c.gn)([(0,h.qC)()],M.prototype,"projectionPlaneTilt",void 0),(0,c.gn)([(0,h.qC)()],M.prototype,"minZ",void 0),(0,c.gn)([(0,h.qC)()],M.prototype,"maxZ",void 0),(0,c.gn)([(0,h.qC)()],M.prototype,"inertia",void 0),(0,c.gn)([(0,h.qC)()],M.prototype,"mode",null),(0,c.gn)([(0,h.qC)()],M.prototype,"layerMask",void 0),(0,c.gn)([(0,h.qC)()],M.prototype,"fovMode",void 0),(0,c.gn)([(0,h.qC)()],M.prototype,"cameraRigMode",void 0),(0,c.gn)([(0,h.qC)()],M.prototype,"interaxialDistance",void 0),(0,c.gn)([(0,h.qC)()],M.prototype,"isStereoscopicSideBySide",void 0)},3541:function(e,t,n){"use strict";n.d(t,{p:function(){return s}});var i=n(5671),r=n(3144),a=n(6900),o=n(2845),s=function(){function e(){(0,i.Z)(this,e),this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}return(0,r.Z)(e,[{key:"getNormal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(o.o.NormalKind))return null;var n,i=this.pickedMesh.getIndices();if(!i)return null;if(t){var r=this.pickedMesh.getVerticesData(o.o.NormalKind),s=a.P.FromArray(r,3*i[3*this.faceId]),l=a.P.FromArray(r,3*i[3*this.faceId+1]),u=a.P.FromArray(r,3*i[3*this.faceId+2]);s=s.scale(this.bu),l=l.scale(this.bv),u=u.scale(1-this.bu-this.bv),n=new a.P(s.x+l.x+u.x,s.y+l.y+u.y,s.z+l.z+u.z)}else{var c=this.pickedMesh.getVerticesData(o.o.PositionKind),h=a.P.FromArray(c,3*i[3*this.faceId]),f=a.P.FromArray(c,3*i[3*this.faceId+1]),d=a.P.FromArray(c,3*i[3*this.faceId+2]),v=h.subtract(f),p=d.subtract(f);n=a.P.Cross(v,p)}if(e){var _=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(a.jp.Matrix[0].copyFrom(_),(_=a.jp.Matrix[0]).setTranslationFromFloats(0,0,0),_.invert(),_.transposeToRef(a.jp.Matrix[1]),_=a.jp.Matrix[1]),n=a.P.TransformNormal(n,_)}return n.normalize(),n}},{key:"getTextureCoordinates",value:function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(o.o.UVKind))return null;var e=this.pickedMesh.getIndices();if(!e)return null;var t=this.pickedMesh.getVerticesData(o.o.UVKind);if(!t)return null;var n=a.FM.FromArray(t,2*e[3*this.faceId]),i=a.FM.FromArray(t,2*e[3*this.faceId+1]),r=a.FM.FromArray(t,2*e[3*this.faceId+2]);return n=n.scale(this.bu),i=i.scale(this.bv),r=r.scale(1-this.bu-this.bv),new a.FM(n.x+i.x+r.x,n.y+i.y+r.y)}}]),e}()},6176:function(e,t,n){"use strict";n.d(t,{e:function(){return a}});var i=n(3144),r=n(5671),a=(0,i.Z)((function e(){(0,r.Z)(this,e)}));a.UseOpenGLOrientationForUV=!1},9115:function(e,t,n){"use strict";n.d(t,{j:function(){return v}});var i=n(5671),r=n(3144),a=n(8134),o=n(6900),s=n(3681),l=function(){function e(t,n,r){(0,i.Z)(this,e),this.vectors=a.B.BuildArray(8,o.P.Zero),this.center=o.P.Zero(),this.centerWorld=o.P.Zero(),this.extendSize=o.P.Zero(),this.extendSizeWorld=o.P.Zero(),this.directions=a.B.BuildArray(3,o.P.Zero),this.vectorsWorld=a.B.BuildArray(8,o.P.Zero),this.minimumWorld=o.P.Zero(),this.maximumWorld=o.P.Zero(),this.minimum=o.P.Zero(),this.maximum=o.P.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(t,n,r)}return(0,r.Z)(e,[{key:"reConstruct",value:function(e,t,n){var i=e.x,r=e.y,a=e.z,s=t.x,l=t.y,u=t.z,c=this.vectors;this.minimum.copyFromFloats(i,r,a),this.maximum.copyFromFloats(s,l,u),c[0].copyFromFloats(i,r,a),c[1].copyFromFloats(s,l,u),c[2].copyFromFloats(s,r,a),c[3].copyFromFloats(i,l,a),c[4].copyFromFloats(i,r,u),c[5].copyFromFloats(s,l,a),c[6].copyFromFloats(i,l,u),c[7].copyFromFloats(s,r,u),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=n||o.y3.IdentityReadOnly,this._update(this._worldMatrix)}},{key:"scale",value:function(t){var n=e._TmpVector3,i=this.maximum.subtractToRef(this.minimum,n[0]),r=i.length();i.normalizeFromLength(r);var a=r*t,o=i.scaleInPlace(.5*a),s=this.center.subtractToRef(o,n[1]),l=this.center.addToRef(o,n[2]);return this.reConstruct(s,l,this._worldMatrix),this}},{key:"getWorldMatrix",value:function(){return this._worldMatrix}},{key:"_update",value:function(e){var t=this.minimumWorld,n=this.maximumWorld,i=this.directions,r=this.vectorsWorld,a=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),n.copyFrom(this.maximum);for(var s=0;s<8;++s)r[s].copyFrom(a[s]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),n.setAll(-Number.MAX_VALUE);for(var l=0;l<8;++l){var u=r[l];o.P.TransformCoordinatesToRef(a[l],e,u),t.minimizeInPlace(u),n.maximizeInPlace(u)}n.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),n.addToRef(t,this.centerWorld).scaleInPlace(.5)}o.P.FromArrayToRef(e.m,0,i[0]),o.P.FromArrayToRef(e.m,4,i[1]),o.P.FromArrayToRef(e.m,8,i[2]),this._worldMatrix=e}},{key:"isInFrustum",value:function(t){return e.IsInFrustum(this.vectorsWorld,t)}},{key:"isCompletelyInFrustum",value:function(t){return e.IsCompletelyInFrustum(this.vectorsWorld,t)}},{key:"intersectsPoint",value:function(e){var t=this.minimumWorld,n=this.maximumWorld,i=t.x,r=t.y,a=t.z,o=n.x,l=n.y,u=n.z,c=e.x,h=e.y,f=e.z,d=-s.kn;return!(o-c<d||d>c-i)&&(!(l-h<d||d>h-r)&&!(u-f<d||d>f-a))}},{key:"intersectsSphere",value:function(t){return e.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)}},{key:"intersectsMinMax",value:function(e,t){var n=this.minimumWorld,i=this.maximumWorld,r=n.x,a=n.y,o=n.z,s=i.x,l=i.y,u=i.z,c=e.x,h=e.y,f=e.z,d=t.x,v=t.y,p=t.z;return!(s<c||r>d)&&(!(l<h||a>v)&&!(u<f||o>p))}},{key:"dispose",value:function(){var e,t;null===(e=this._drawWrapperFront)||void 0===e||e.dispose(),null===(t=this._drawWrapperBack)||void 0===t||t.dispose()}}],[{key:"Intersects",value:function(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)}},{key:"IntersectsSphere",value:function(t,n,i,r){var a=e._TmpVector3[0];return o.P.ClampToRef(i,t,n,a),o.P.DistanceSquared(i,a)<=r*r}},{key:"IsCompletelyInFrustum",value:function(e,t){for(var n=0;n<6;++n)for(var i=t[n],r=0;r<8;++r)if(i.dotCoordinate(e[r])<0)return!1;return!0}},{key:"IsInFrustum",value:function(e,t){for(var n=0;n<6;++n){for(var i=!0,r=t[n],a=0;a<8;++a)if(r.dotCoordinate(e[a])>=0){i=!1;break}if(i)return!1}return!0}}]),e}();l._TmpVector3=a.B.BuildArray(3,o.P.Zero);var u=function(){function e(t,n,r){(0,i.Z)(this,e),this.center=o.P.Zero(),this.centerWorld=o.P.Zero(),this.minimum=o.P.Zero(),this.maximum=o.P.Zero(),this.reConstruct(t,n,r)}return(0,r.Z)(e,[{key:"reConstruct",value:function(e,t,n){this.minimum.copyFrom(e),this.maximum.copyFrom(t);var i=o.P.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*i,this._update(n||o.y3.IdentityReadOnly)}},{key:"scale",value:function(t){var n=this.radius*t,i=e._TmpVector3,r=i[0].setAll(n),a=this.center.subtractToRef(r,i[1]),o=this.center.addToRef(r,i[2]);return this.reConstruct(a,o,this._worldMatrix),this}},{key:"getWorldMatrix",value:function(){return this._worldMatrix}},{key:"_update",value:function(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{o.P.TransformCoordinatesToRef(this.center,t,this.centerWorld);var n=e._TmpVector3[0];o.P.TransformNormalFromFloatsToRef(1,1,1,t,n),this.radiusWorld=Math.max(Math.abs(n.x),Math.abs(n.y),Math.abs(n.z))*this.radius}}},{key:"isInFrustum",value:function(e){for(var t=this.centerWorld,n=this.radiusWorld,i=0;i<6;i++)if(e[i].dotCoordinate(t)<=-n)return!1;return!0}},{key:"isCenterInFrustum",value:function(e){for(var t=this.centerWorld,n=0;n<6;n++)if(e[n].dotCoordinate(t)<0)return!1;return!0}},{key:"intersectsPoint",value:function(e){var t=o.P.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)}}],[{key:"Intersects",value:function(e,t){var n=o.P.DistanceSquared(e.centerWorld,t.centerWorld),i=e.radiusWorld+t.radiusWorld;return!(i*i<n)}},{key:"CreateFromCenterAndRadius",value:function(t,n,i){this._TmpVector3[0].copyFrom(t),this._TmpVector3[1].copyFromFloats(0,0,n),this._TmpVector3[2].copyFrom(t),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);var r=new e(this._TmpVector3[0],this._TmpVector3[2]);return r._worldMatrix=i||o.y3.Identity(),r}}]),e}();u._TmpVector3=a.B.BuildArray(3,o.P.Zero);var c={min:0,max:0},h={min:0,max:0},f=function(e,t,n){var i=o.P.Dot(t.centerWorld,e),r=Math.abs(o.P.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(o.P.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(o.P.Dot(t.directions[2],e))*t.extendSize.z;n.min=i-r,n.max=i+r},d=function(e,t,n){return f(e,t,c),f(e,n,h),!(c.min>h.max||h.min>c.max)},v=function(){function e(t,n,r){(0,i.Z)(this,e),this._isLocked=!1,this.boundingBox=new l(t,n,r),this.boundingSphere=new u(t,n,r)}return(0,r.Z)(e,[{key:"reConstruct",value:function(e,t,n){this.boundingBox.reConstruct(e,t,n),this.boundingSphere.reConstruct(e,t,n)}},{key:"minimum",get:function(){return this.boundingBox.minimum}},{key:"maximum",get:function(){return this.boundingBox.maximum}},{key:"isLocked",get:function(){return this._isLocked},set:function(e){this._isLocked=e}},{key:"update",value:function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}},{key:"centerOn",value:function(t,n){var i=e._TmpVector3[0].copyFrom(t).subtractInPlace(n),r=e._TmpVector3[1].copyFrom(t).addInPlace(n);return this.boundingBox.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this}},{key:"encapsulate",value:function(e){var t=o.P.Minimize(this.minimum,e),n=o.P.Maximize(this.maximum,e);return this.reConstruct(t,n,this.boundingBox.getWorldMatrix()),this}},{key:"encapsulateBoundingInfo",value:function(e){return this.encapsulate(e.boundingBox.centerWorld.subtract(e.boundingBox.extendSizeWorld)),this.encapsulate(e.boundingBox.centerWorld.add(e.boundingBox.extendSizeWorld)),this}},{key:"scale",value:function(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}},{key:"isInFrustum",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2===t||3===t;if(n&&this.boundingSphere.isCenterInFrustum(e))return!0;if(!this.boundingSphere.isInFrustum(e))return!1;var i=1===t||3===t;return!!i||this.boundingBox.isInFrustum(e)}},{key:"diagonalLength",get:function(){var t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,e._TmpVector3[0]).length()}},{key:"isCompletelyInFrustum",value:function(e){return this.boundingBox.isCompletelyInFrustum(e)}},{key:"_checkCollision",value:function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}},{key:"intersectsPoint",value:function(e){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e))}},{key:"intersects",value:function(e,t){if(!u.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!l.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;var n=this.boundingBox,i=e.boundingBox;return!!d(n.directions[0],n,i)&&(!!d(n.directions[1],n,i)&&(!!d(n.directions[2],n,i)&&(!!d(i.directions[0],n,i)&&(!!d(i.directions[1],n,i)&&(!!d(i.directions[2],n,i)&&(!!d(o.P.Cross(n.directions[0],i.directions[0]),n,i)&&(!!d(o.P.Cross(n.directions[0],i.directions[1]),n,i)&&(!!d(o.P.Cross(n.directions[0],i.directions[2]),n,i)&&(!!d(o.P.Cross(n.directions[1],i.directions[0]),n,i)&&(!!d(o.P.Cross(n.directions[1],i.directions[1]),n,i)&&(!!d(o.P.Cross(n.directions[1],i.directions[2]),n,i)&&(!!d(o.P.Cross(n.directions[2],i.directions[0]),n,i)&&(!!d(o.P.Cross(n.directions[2],i.directions[1]),n,i)&&!!d(o.P.Cross(n.directions[2],i.directions[2]),n,i))))))))))))))}}]),e}();v._TmpVector3=a.B.BuildArray(2,o.P.Zero)},9776:function(e,t,n){"use strict";n.d(t,{L:function(){return L}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this.children=[]}return(0,r.Z)(e,[{key:"isValid",value:function(e){return!0}},{key:"process",value:function(e,t){var n="";if(this.line){var i=this.line,r=t.processor;if(r){if(r.lineProcessor&&(i=r.lineProcessor(i,t.isFragment,t.processingContext)),r.attributeProcessor&&this.line.startsWith("attribute"))i=r.attributeProcessor(this.line,e,t.processingContext);else if(r.varyingProcessor&&this.line.startsWith("varying"))i=r.varyingProcessor(this.line,t.isFragment,e,t.processingContext);else if(r.uniformProcessor&&r.uniformRegexp&&r.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(i=r.uniformProcessor(this.line,t.isFragment,e,t.processingContext));else if(r.uniformBufferProcessor&&r.uniformBufferRegexp&&r.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(i=r.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(r.textureProcessor&&r.textureRegexp&&r.textureRegexp.test(this.line))i=r.textureProcessor(this.line,t.isFragment,e,t.processingContext);else if((r.uniformProcessor||r.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?r.uniformProcessor&&(i=r.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):r.uniformBufferProcessor&&(i=r.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,r.endOfUniformBufferProcessor&&(i=r.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}n+=i+"\r\n"}return this.children.forEach((function(i){n+=i.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),n}}]),e}();function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var l=function(){function e(){(0,i.Z)(this,e),this._lines=[]}return(0,r.Z)(e,[{key:"currentLine",get:function(){return this._lines[this.lineIndex]}},{key:"canRead",get:function(){return this.lineIndex<this._lines.length-1}},{key:"lines",set:function(e){this._lines.length=0;var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if("#"!==i[0])if(i.trim().startsWith("//"))this._lines.push(i);else for(var r=i.split(";"),a=0;a<r.length;a++){var s=r[a];(s=s.trim())&&this._lines.push(s+(a!==r.length-1?";":""))}else this._lines.push(i)}}catch(l){n.e(l)}finally{n.f()}}}]),e}(),u=n(136),c=n(6215),h=n(1120);function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}var d=function(e){(0,u.Z)(n,e);var t=f(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"process",value:function(e,t){for(var n=0;n<this.children.length;n++){var i=this.children[n];if(i.isValid(e))return i.process(e,t)}return""}}]),n}(a);function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}var p=function(e){(0,u.Z)(n,e);var t=v(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"isValid",value:function(e){return this.testExpression.isTrue(e)}}]),n}(a);function _(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var m=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"isTrue",value:function(e){return!0}}],[{key:"postfixToInfix",value:function(t){var n,i=[],r=_(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(void 0===e._OperatorPriority[a])i.push(a);else{var o=i[i.length-1],s=i[i.length-2];i.length-=2,i.push("(".concat(s).concat(a).concat(o,")"))}}}catch(l){r.e(l)}finally{r.f()}return i[i.length-1]}},{key:"infixToPostfix",value:function(t){for(var n=[],i=-1,r=function(){""!==(u=u.trim())&&(n.push(u),u="")},a=function(t){i<e._Stack.length-1&&(e._Stack[++i]=t)},o=function(){return e._Stack[i]},s=function(){return-1===i?"!!INVALID EXPRESSION!!":e._Stack[i--]},l=0,u="";l<t.length;){var c=t.charAt(l),h=l<t.length-1?t.substr(l,2):"";if("("===c)u="",a(c);else if(")"===c){for(r();-1!==i&&"("!==o();)n.push(s());s()}else if(e._OperatorPriority[h]>1){for(r();-1!==i&&e._OperatorPriority[o()]>=e._OperatorPriority[h];)n.push(s());a(h),l++}else u+=c;l++}for(r();-1!==i;)"("===o()?s():n.push(s());return n}}]),e}();function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}m._OperatorPriority={")":0,"(":1,"||":2,"&&":3},m._Stack=["","","","","","","","","","","","","","","","","","","",""];var A=function(e){(0,u.Z)(n,e);var t=y(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,i.Z)(this,n),(r=t.call(this)).define=e,r.not=a,r}return(0,r.Z)(n,[{key:"isTrue",value:function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t}}]),n}(m);function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}var b=function(e){(0,u.Z)(n,e);var t=E(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"isTrue",value:function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}}]),n}(m);function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}var S=function(e){(0,u.Z)(n,e);var t=T(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"isTrue",value:function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}}]),n}(m);function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}var I=function(e){(0,u.Z)(n,e);var t=M(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this)).define=e,o.operand=r,o.testValue=a,o}return(0,r.Z)(n,[{key:"isTrue",value:function(e){var t=e[this.define];void 0===t&&(t=this.define);var n=!1,i=parseInt(t),r=parseInt(this.testValue);switch(this.operand){case">":n=i>r;break;case"<":n=i<r;break;case"<=":n=i<=r;break;case">=":n=i>=r;break;case"==":n=i===r}return n}}]),n}(m),P=n(5230),C=n(2223);function x(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var R=/defined\s*?\((.+?)\)/g,k=/defined\s*?\[(.+?)\]/g,O=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,L=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"Initialize",value:function(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}},{key:"Process",value:function(e,t,n,i){var r,a=this;null!==(r=t.processor)&&void 0!==r&&r.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e));var r=a._ProcessShaderConversion(e,t,i);n(r)}))}},{key:"PreProcess",value:function(e,t,n,i){var r,a=this;null!==(r=t.processor)&&void 0!==r&&r.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e));var r=a._ApplyPreProcessing(e,t,i);n(r)}))}},{key:"Finalize",value:function(e,t,n){return n.processor&&n.processor.finalizeShaders?n.processor.finalizeShaders(e,t,n.processingContext):{vertexCode:e,fragmentCode:t}}},{key:"_ProcessPrecision",value:function(e,t){var n;if(null!==(n=t.processor)&&void 0!==n&&n.noPrecision)return e;var i=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float")),e}},{key:"_ExtractOperation",value:function(e){var t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new A(t[1].trim(),"!"===e[0]);for(var n="",i=0,r=0,a=["==",">=","<=","<",">"];r<a.length&&(n=a[r],!((i=e.indexOf(n))>-1));r++);if(-1===i)return new A(e);var o=e.substring(0,i).trim(),s=e.substring(i+n.length).trim();return new I(o,n,s)}},{key:"_BuildSubExpression",value:function(e){e=e.replace(R,"defined[$1]");var t,n=[],i=x(m.infixToPostfix(e));try{for(i.s();!(t=i.n()).done;){var r=t.value;if("||"!==r&&"&&"!==r)n.push(r);else if(n.length>=2){var a=n[n.length-1],o=n[n.length-2];n.length-=2;var s="&&"==r?new S:new b;"string"==typeof a&&(a=a.replace(k,"defined($1)")),"string"==typeof o&&(o=o.replace(k,"defined($1)")),s.leftOperand="string"==typeof o?this._ExtractOperation(o):o,s.rightOperand="string"==typeof a?this._ExtractOperation(a):a,n.push(s)}}}catch(u){i.e(u)}finally{i.f()}var l=n[n.length-1];return"string"==typeof l&&(l=l.replace(k,"defined($1)")),"string"==typeof l?this._ExtractOperation(l):l}},{key:"_BuildExpression",value:function(e,t){var n=new p,i=e.substring(0,t),r=e.substring(t);return r=r.substring(0,(r.indexOf("//")+1||r.length+1)-1).trim(),n.testExpression="#ifdef"===i?new A(r):"#ifndef"===i?new A(r,!0):this._BuildSubExpression(r),n}},{key:"_MoveCursorWithinIf",value:function(e,t,n){for(var i=e.currentLine;this._MoveCursor(e,n);){var r=(i=e.currentLine).substring(0,5).toLowerCase();if("#else"===r){var o=new a;return t.children.push(o),void this._MoveCursor(e,o)}if("#elif"===r){var s=this._BuildExpression(i,5);t.children.push(s),n=s}}}},{key:"_MoveCursor",value:function(e,t){for(;e.canRead;){e.lineIndex++;var n=e.currentLine,i=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(n);if(i&&i.length){switch(i[0]){case"#ifdef":var r=new d;t.children.push(r);var o=this._BuildExpression(n,6);r.children.push(o),this._MoveCursorWithinIf(e,r,o);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":var s=new d;t.children.push(s);var l=this._BuildExpression(n,7);s.children.push(l),this._MoveCursorWithinIf(e,s,l);break;case"#if":var u=new d,c=this._BuildExpression(n,3);t.children.push(u),u.children.push(c),this._MoveCursorWithinIf(e,u,c)}}else{var h=new a;if(h.line=n,t.children.push(h),"#"===n[0]&&"d"===n[1]){var f=n.replace(";","").split(" ");h.additionalDefineKey=f[1],3===f.length&&(h.additionalDefineValue=f[2])}}}return!1}},{key:"_EvaluatePreProcessors",value:function(e,t,n){var i=new a,r=new l;return r.lineIndex=-1,r.lines=e.split("\n"),this._MoveCursor(r,i),i.process(t,n)}},{key:"_PreparePreProcessors",value:function(e,t){var n,i,r={},a=x(e.defines);try{for(a.s();!(i=a.n()).done;){var o=i.value.replace("#define","").replace(";","").trim().split(" ");r[o[0]]=o.length>1?o[1]:""}}catch(s){a.e(s)}finally{a.f()}return(null===(n=e.processor)||void 0===n?void 0:n.shaderLanguage)===C.x.GLSL&&(r.GL_ES="true"),r.__VERSION__=e.version,r[e.platformName]="true",t._getGlobalDefines(r),r}},{key:"_ProcessShaderConversion",value:function(e,t,n){var i=this._ProcessPrecision(e,t);if(!t.processor)return i;if(t.processor.shaderLanguage===C.x.GLSL&&-1!==i.indexOf("#version 3"))return i.replace("#version 300 es","");var r=t.defines,a=this._PreparePreProcessors(t,n);return t.processor.preProcessor&&(i=t.processor.preProcessor(i,r,t.isFragment,t.processingContext)),i=this._EvaluatePreProcessors(i,a,t),t.processor.postProcessor&&(i=t.processor.postProcessor(i,r,t.isFragment,t.processingContext,n)),n._features.needShaderCodeInlining&&(i=n.inlineShaderCode(i)),i}},{key:"_ApplyPreProcessing",value:function(e,t,n){var i,r,a=e,o=t.defines,s=this._PreparePreProcessors(t,n);return null!==(i=t.processor)&&void 0!==i&&i.preProcessor&&(a=t.processor.preProcessor(a,o,t.isFragment,t.processingContext)),a=this._EvaluatePreProcessors(a,s,t),null!==(r=t.processor)&&void 0!==r&&r.postProcessor&&(a=t.processor.postProcessor(a,o,t.isFragment,t.processingContext,n)),n._features.needShaderCodeInlining&&(a=n.inlineShaderCode(a)),a}},{key:"_ProcessIncludes",value:function(t,n,i){for(var r=this,a=O.exec(t),o=new String(t),s=!1,l=function(){var l=a[1];if(-1!==l.indexOf("__decl__")&&(l=l.replace(/__decl__/,""),n.supportsUniformBuffers&&(l=(l=l.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),l+="Declaration"),!n.includesShadersStore[l]){var u=n.shadersRepository+"ShadersInclude/"+l+".fx";return e._FileToolsLoadFile(u,(function(e){n.includesShadersStore[l]=e,r._ProcessIncludes(o,n,i)})),{v:void 0}}var c=n.includesShadersStore[l];if(a[2])for(var h=a[3].split(","),f=0;f<h.length;f+=2){var d=new RegExp(h[f],"g"),v=h[f+1];c=c.replace(d,v)}if(a[4]){var p=a[5];if(-1!==p.indexOf("..")){var _=p.split(".."),g=parseInt(_[0]),m=parseInt(_[1]),y=c.slice(0);c="",isNaN(m)&&(m=n.indexParameters[_[1]]);for(var A=g;A<m;A++)n.supportsUniformBuffers||(y=y.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),c+=y.replace(/\{X\}/g,A.toString())+"\n"}else n.supportsUniformBuffers||(c=c.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),c=c.replace(/\{X\}/g,p)}o=o.replace(a[0],c),s=s||c.indexOf("#include<")>=0||c.indexOf("#include <")>=0,a=O.exec(t)};null!=a;){var u=l();if("object"==typeof u)return u.v}s?this._ProcessIncludes(o.toString(),n,i):i(o)}},{key:"_FileToolsLoadFile",value:function(e,t,n,i,r,a){throw(0,P.S)("FileTools")}}]),e}()},938:function(e,t,n){"use strict";n.d(t,{C:function(){return o}});var i=n(5671),r=n(3144),a=n(2223),o=function(){function e(){(0,i.Z)(this,e),this.shaderLanguage=a.x.GLSL}return(0,r.Z)(e,[{key:"attributeProcessor",value:function(e){return e.replace("attribute","in")}},{key:"varyingProcessor",value:function(e,t){return e.replace("varying",t?"in":"out")}},{key:"postProcessor",value:function(e,t,n){var i=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),n)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(i?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e}}]),e}()},6431:function(e,t,n){"use strict";n.d(t,{B:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;if((0,i.Z)(this,e),this._MSAARenderBuffer=null,this._context=n,!t&&!(t=n.createTexture()))throw new Error("Unable to create webGL texture");this.set(t)}return(0,r.Z)(e,[{key:"underlyingResource",get:function(){return this._webGLTexture}},{key:"setUsage",value:function(){}},{key:"set",value:function(e){this._webGLTexture=e}},{key:"reset",value:function(){this._webGLTexture=null,this._MSAARenderBuffer=null}},{key:"release",value:function(){this._MSAARenderBuffer&&(this._context.deleteRenderbuffer(this._MSAARenderBuffer),this._MSAARenderBuffer=null),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}]),e}()},8099:function(e,t,n){"use strict";n.d(t,{y:function(){return l}});var i=n(5671),r=n(3144);function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var s=["Int2","Int","Int3","Int4","Vector2","Vector3","Vector4","Float2","Float","Float3","Float4","Quaternion","Color3","Color4","DirectColor4"],l=function(){function e(){var t=this;(0,i.Z)(this,e),this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null;var n=[],r=function(){n.length=0,Array.prototype.push.apply(n,arguments),n[0]=this._uniforms[n[0]]},a=function(e){var i=s.includes(e.substring(3))&&"FloatN";if(i){var a=t["_cache".concat(i)];return function(){var t=this.engine[e];r.apply(this,arguments),a.apply(this,arguments)&&(t.apply(this.engine,n)||(this._valueCache[arguments[0]]=null))}}return function(){var t=this.engine[e];r.apply(this,arguments),void 0!==arguments[1]&&(this._valueCache[arguments[0]]=null,t.apply(this.engine,n))}};["Int?","IntArray?","Array?","Float?","Matrices","Matrix3x3","Matrix2x2"].forEach((function(e){var n="set".concat(e);t[n]||(n.endsWith("?")?["",2,3,4].forEach((function(e){t[n.slice(0,-1)+e]=t[n.slice(0,-1)+e]||a(n.slice(0,-1)+e).bind(t)})):t[n]=t[n]||a(n).bind(t))}))}return(0,r.Z)(e,[{key:"isAsync",get:function(){return this.isParallelCompiled}},{key:"isReady",get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))}},{key:"_handlesSpectorRebuildCallback",value:function(e){e&&this.program&&e(this.program)}},{key:"_fillEffectInformation",value:function(e,t,n,i,r,o,s,l){var u,c=this.engine;if(c.supportsUniformBuffers)for(var h in t)e.bindUniformBlock(h,t[h]);for(this.engine.getUniforms(this,n).forEach((function(e,t){i[n[t]]=e})),this._uniforms=i,u=0;u<r.length;u++){null==e.getUniform(r[u])&&(r.splice(u,1),u--)}r.forEach((function(e,t){o[e]=t}));var f,d=a(c.getAttributes(this,s));try{for(d.s();!(f=d.n()).done;){var v=f.value;l.push(v)}}catch(p){d.e(p)}finally{d.f()}}},{key:"dispose",value:function(){this._uniforms={}}},{key:"_cacheMatrix",value:function(e,t){var n=this._valueCache[e],i=t.updateFlag;return(void 0===n||n!==i)&&(this._valueCache[e]=i,!0)}},{key:"_cacheFloatN",value:function(e,t,n,i,r){var a=this._valueCache[arguments[0]];if(!a||a.length!==arguments.length-1)return a=Array.prototype.slice.call(arguments,1),this._valueCache[arguments[0]]=a,!0;for(var o=!1,s=0;s<a.length;++s)a[s]!==arguments[s+1]&&(a[s]=arguments[s+1],o=!0);return o}},{key:"_cacheFloat2",value:function(e,t,n){return this._cacheFloatN(e,t,n)}},{key:"_cacheFloat3",value:function(e,t,n,i){return this._cacheFloatN(e,t,n,i)}},{key:"_cacheFloat4",value:function(e,t,n,i,r){return this._cacheFloatN(e,t,n,i,r)}},{key:"setMatrix",value:function(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null))}},{key:"setVector2",value:function(e,t){this.setFloat2(e,t.x,t.y)}},{key:"setVector3",value:function(e,t){this.setFloat3(e,t.x,t.y,t.z)}},{key:"setVector4",value:function(e,t){this.setFloat4(e,t.x,t.y,t.z,t.w)}},{key:"setQuaternion",value:function(e,t){this.setFloat4(e,t.x,t.y,t.z,t.w)}},{key:"setColor3",value:function(e,t){this.setFloat3(e,t.r,t.g,t.b)}},{key:"setColor4",value:function(e,t,n){this.setFloat4(e,t.r,t.g,t.b,n)}},{key:"setDirectColor4",value:function(e,t){this.setFloat4(e,t.r,t.g,t.b,t.a)}},{key:"_getVertexShaderCode",value:function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}},{key:"_getFragmentShaderCode",value:function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}]),e}()},970:function(e,t,n){"use strict";n.d(t,{f:function(){return o}});var i=n(5671),r=n(3144),a=n(2223),o=function(){function e(){(0,i.Z)(this,e),this.shaderLanguage=a.x.GLSL}return(0,r.Z)(e,[{key:"postProcessor",value:function(e,t,n,i,r){if(!r.getCaps().drawBuffersExtension){e=e.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")}return e}}]),e}()},2977:function(e,t,n){"use strict";n.d(t,{D:function(){return P}});var i=n(5671),r=n(3144),a=n(7326),o=n(1752),s=n(136),l=n(6215),u=n(1120),c=n(4174),h=n(1889),f=n(5092),d=n(4198),v=n(5230),p=n(4796),_=n(2786),g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;(0,i.Z)(this,e),this._enabled=!0,this._rollingFrameTime=new m(t)}return(0,r.Z)(e,[{key:"sampleFrame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.F.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){var t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}}},{key:"averageFrameTime",get:function(){return this._rollingFrameTime.average}},{key:"averageFrameTimeVariance",get:function(){return this._rollingFrameTime.variance}},{key:"instantaneousFrameTime",get:function(){return this._rollingFrameTime.history(0)}},{key:"averageFPS",get:function(){return 1e3/this._rollingFrameTime.average}},{key:"instantaneousFPS",get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e}},{key:"isSaturated",get:function(){return this._rollingFrameTime.isSaturated()}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this._lastFrameTimeMs=null}},{key:"isEnabled",get:function(){return this._enabled}},{key:"reset",value:function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}]),e}(),m=function(){function e(t){(0,i.Z)(this,e),this._samples=new Array(t),this.reset()}return(0,r.Z)(e,[{key:"add",value:function(e){var t;if(this.isSaturated()){var n=this._samples[this._pos];t=n-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(n-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length}},{key:"history",value:function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]}},{key:"isSaturated",value:function(){return this._sampleCount>=this._samples.length}},{key:"reset",value:function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}},{key:"_wrapPosition",value:function(e){var t=this._samples.length;return(e%t+t)%t}}]),e}(),y=n(2864),A=n(2628),E=n(2328),b=n(6431);function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;switch(e){case 3:var r=(ArrayBuffer,new Int8Array(t));return i&&r.set(new Int8Array(i)),r;case 0:var a=(ArrayBuffer,new Uint8Array(t));return i&&a.set(new Uint8Array(i)),a;case 4:var o=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(n?t/2:t);return i&&o.set(new Int16Array(i)),o;case 5:case 8:case 9:case 10:case 2:var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(n?t/2:t);return i&&s.set(new Uint16Array(i)),s;case 6:var l=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(n?t/4:t);return i&&l.set(new Int32Array(i)),l;case 7:case 11:case 12:case 13:case 14:case 15:var u=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(n?t/4:t);return i&&u.set(new Uint32Array(i)),u;case 1:var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(n?t/4:t);return i&&c.set(new Float32Array(i)),c}var h=(ArrayBuffer,new Uint8Array(t));return i&&h.set(new Uint8Array(i)),h}function S(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,u.Z)(e);if(t){var r=(0,u.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,l.Z)(this,n)}}p.B.prototype.setAlphaConstants=function(e,t,n,i){this._alphaState.setAlphaBlendConstants(e,t,n,i)},p.B.prototype.setAlphaMode=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}},p.B.prototype.getAlphaMode=function(){return this._alphaMode},p.B.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=e}},p.B.prototype.getAlphaEquation=function(){return this._alphaEquation},p.B.prototype._readTexturePixelsSync=function(e,t,n){var i,r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,f=this._gl;if(!f)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var d=f.createFramebuffer();if(!d)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=d}(f.bindFramebuffer(f.FRAMEBUFFER,this._dummyFramebuffer),a>-1)?f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_CUBE_MAP_POSITIVE_X+a,null===(i=e._hardwareTexture)||void 0===i?void 0:i.underlyingResource,o):f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,null===(r=e._hardwareTexture)||void 0===r?void 0:r.underlyingResource,o);var v=void 0!==e.type?this._getWebGLTextureType(e.type):f.UNSIGNED_BYTE;if(u)s||(s=T(e.type,4*t*n));else if(v===f.UNSIGNED_BYTE)s||(s=new Uint8Array(4*t*n)),v=f.UNSIGNED_BYTE;else s||(s=new Float32Array(4*t*n)),v=f.FLOAT;return l&&this.flushFramebuffer(),f.readPixels(c,h,t,n,f.RGBA,v,s),f.bindFramebuffer(f.FRAMEBUFFER,this._currentFramebuffer),s},p.B.prototype._readTexturePixels=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(e,t,n,i,r,a,o,s,l,u))},p.B.prototype.updateDynamicIndexBuffer=function(e,t){var n;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),n=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},p.B.prototype.updateDynamicVertexBuffer=function(e,t,n,i){this.bindArrayBuffer(e),void 0===n&&(n=0);var r=t.byteLength||t.length;void 0===i||i>=r&&0===n?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(n,n+i)):(t=t instanceof ArrayBuffer?new Uint8Array(t,n,i):new Uint8Array(t.buffer,t.byteOffset+n,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()};var P=function(e){(0,s.Z)(n,e);var t=I(n);function n(e,r,o){var s,u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if((0,i.Z)(this,n),(s=t.call(this,e,r,o,u)).enableOfflineSupport=!1,s.disableManifestCheck=!1,s.disableContextMenu=!0,s.scenes=new Array,s._virtualScenes=new Array,s.onNewSceneAddedObservable=new c.y$,s.postProcesses=new Array,s.isPointerLock=!1,s.onResizeObservable=new c.y$,s.onCanvasBlurObservable=new c.y$,s.onCanvasFocusObservable=new c.y$,s.onCanvasPointerOutObservable=new c.y$,s.onBeginFrameObservable=new c.y$,s.customAnimationFrameRequester=null,s.onEndFrameObservable=new c.y$,s.onBeforeShaderCompilationObservable=new c.y$,s.onAfterShaderCompilationObservable=new c.y$,s._deterministicLockstep=!1,s._lockstepMaxSteps=4,s._timeStep=1/60,s._fps=60,s._deltaTime=0,s._drawCalls=new y.z,s.canvasTabIndex=1,s.disablePerformanceMonitorInBackground=!1,s._performanceMonitor=new g,s._compatibilityMode=!0,s.currentRenderPassId=0,s._renderPassNames=["main"],n.Instances.push((0,a.Z)(s)),!e)return(0,l.Z)(s);if(s._features.supportRenderPasses=!0,o=s._creationOptions,e.getContext){var h=e;if(s._sharedInit(h,!!o.doNotHandleTouchAction,o.audioEngine),(0,f.CG)()){var d=document;s._onFullscreenChange=function(){void 0!==d.fullscreen?s.isFullscreen=d.fullscreen:void 0!==d.mozFullScreen?s.isFullscreen=d.mozFullScreen:void 0!==d.webkitIsFullScreen?s.isFullscreen=d.webkitIsFullScreen:void 0!==d.msIsFullScreen&&(s.isFullscreen=d.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&h&&n._RequestPointerlock(h)},document.addEventListener("fullscreenchange",s._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",s._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",s._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",s._onFullscreenChange,!1),s._onPointerLockChange=function(){s.isPointerLock=d.mozPointerLockElement===h||d.webkitPointerLockElement===h||d.msPointerLockElement===h||d.pointerLockElement===h},document.addEventListener("pointerlockchange",s._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",s._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",s._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",s._onPointerLockChange,!1),!n.audioEngine&&o.audioEngine&&n.AudioEngineFactory&&(n.audioEngine=n.AudioEngineFactory(s.getRenderingCanvas(),s.getAudioContext(),s.getAudioDestination()))}s._connectVREvents(),s.enableOfflineSupport=void 0!==n.OfflineProviderFactory,s._deterministicLockstep=!!o.deterministicLockstep,s._lockstepMaxSteps=o.lockstepMaxSteps||0,s._timeStep=o.timeStep||1/60}return s._prepareVRComponent(),o.autoEnableWebVR&&s.initWebVR(),s}return(0,r.Z)(n,[{key:"_createImageBitmapFromSource",value:function(e,t){var n=this;return new Promise((function(i,r){var a=new Image;a.onload=function(){a.decode().then((function(){n.createImageBitmap(a,t).then((function(e){i(e)}))}))},a.onerror=function(){r("Error loading image ".concat(a.src))},a.src=e}))}},{key:"createImageBitmap",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return createImageBitmap(e,t)}))},{key:"resizeImageBitmap",value:function(e,t,n){var i=this.createCanvas(t,n).getContext("2d");if(!i)throw new Error("Unable to get 2d context for resizeImageBitmap");return i.drawImage(e,0,0),i.getImageData(0,0,t,n).data}},{key:"_supportsHardwareTextureRescaling",get:function(){return!!n._RescalePostProcessFactory}},{key:"performanceMonitor",get:function(){return this._performanceMonitor}},{key:"compatibilityMode",get:function(){return this._compatibilityMode},set:function(e){this._compatibilityMode=!0}},{key:"getInputElement",value:function(){return this._renderingCanvas}},{key:"_sharedInit",value:function(e,t,i){var r=this;if((0,o.Z)((0,u.Z)(n.prototype),"_sharedInit",this).call(this,e,t,i),this._onCanvasFocus=function(){r.onCanvasFocusObservable.notifyObservers(r)},this._onCanvasBlur=function(){r.onCanvasBlurObservable.notifyObservers(r)},this._onCanvasContextMenu=function(e){r.disableContextMenu&&e.preventDefault()},e.addEventListener("focus",this._onCanvasFocus),e.addEventListener("blur",this._onCanvasBlur),e.addEventListener("contextmenu",this._onCanvasContextMenu),this._onBlur=function(){r.disablePerformanceMonitorInBackground&&r._performanceMonitor.disable(),r._windowIsBackground=!0},this._onFocus=function(){r.disablePerformanceMonitorInBackground&&r._performanceMonitor.enable(),r._windowIsBackground=!1},this._onCanvasPointerOut=function(t){document.elementFromPoint(t.clientX,t.clientY)!==e&&r.onCanvasPointerOutObservable.notifyObservers(t)},(0,f.CG)()){var a=this.getHostWindow();a&&(a.addEventListener("blur",this._onBlur),a.addEventListener("focus",this._onFocus))}e.addEventListener("pointerout",this._onCanvasPointerOut),t||this._disableTouchAction(),!n.audioEngine&&i&&n.AudioEngineFactory&&(n.audioEngine=n.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination()))}},{key:"getAspectRatio",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.viewport;return this.getRenderWidth(t)*n.width/(this.getRenderHeight(t)*n.height)}},{key:"getScreenAspectRatio",value:function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)}},{key:"getRenderingCanvasClientRect",value:function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null}},{key:"getInputElementClientRect",value:function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null}},{key:"isDeterministicLockStep",value:function(){return this._deterministicLockstep}},{key:"getLockstepMaxSteps",value:function(){return this._lockstepMaxSteps}},{key:"getTimeStep",value:function(){return 1e3*this._timeStep}},{key:"generateMipMapsForCubemap",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.generateMipMaps){var n=this._gl;this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,e,!0),n.generateMipmap(n.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null)}}},{key:"getDepthWrite",value:function(){return this._depthCullingState.depthMask}},{key:"setDepthWrite",value:function(e){this._depthCullingState.depthMask=e}},{key:"getStencilBuffer",value:function(){return this._stencilState.stencilTest}},{key:"setStencilBuffer",value:function(e){this._stencilState.stencilTest=e}},{key:"getStencilMask",value:function(){return this._stencilState.stencilMask}},{key:"setStencilMask",value:function(e){this._stencilState.stencilMask=e}},{key:"getStencilFunction",value:function(){return this._stencilState.stencilFunc}},{key:"getStencilFunctionReference",value:function(){return this._stencilState.stencilFuncRef}},{key:"getStencilFunctionMask",value:function(){return this._stencilState.stencilFuncMask}},{key:"setStencilFunction",value:function(e){this._stencilState.stencilFunc=e}},{key:"setStencilFunctionReference",value:function(e){this._stencilState.stencilFuncRef=e}},{key:"setStencilFunctionMask",value:function(e){this._stencilState.stencilFuncMask=e}},{key:"getStencilOperationFail",value:function(){return this._stencilState.stencilOpStencilFail}},{key:"getStencilOperationDepthFail",value:function(){return this._stencilState.stencilOpDepthFail}},{key:"getStencilOperationPass",value:function(){return this._stencilState.stencilOpStencilDepthPass}},{key:"setStencilOperationFail",value:function(e){this._stencilState.stencilOpStencilFail=e}},{key:"setStencilOperationDepthFail",value:function(e){this._stencilState.stencilOpDepthFail=e}},{key:"setStencilOperationPass",value:function(e){this._stencilState.stencilOpStencilDepthPass=e}},{key:"setDitheringState",value:function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}},{key:"setRasterizerState",value:function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}},{key:"getDepthFunction",value:function(){return this._depthCullingState.depthFunc}},{key:"setDepthFunction",value:function(e){this._depthCullingState.depthFunc=e}},{key:"setDepthFunctionToGreater",value:function(){this.setDepthFunction(516)}},{key:"setDepthFunctionToGreaterOrEqual",value:function(){this.setDepthFunction(518)}},{key:"setDepthFunctionToLess",value:function(){this.setDepthFunction(513)}},{key:"setDepthFunctionToLessOrEqual",value:function(){this.setDepthFunction(515)}},{key:"cacheStencilState",value:function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()}},{key:"restoreStencilState",value:function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)}},{key:"setDirectViewport",value:function(e,t,n,i){var r=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,n,i),r}},{key:"scissorClear",value:function(e,t,n,i,r){this.enableScissor(e,t,n,i),this.clear(r,!0,!0,!0),this.disableScissor()}},{key:"enableScissor",value:function(e,t,n,i){var r=this._gl;r.enable(r.SCISSOR_TEST),r.scissor(e,t,n,i)}},{key:"disableScissor",value:function(){var e=this._gl;e.disable(e.SCISSOR_TEST)}},{key:"_reportDrawCall",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._drawCalls.addCount(e,!1)}},{key:"initWebVR",value:function(){throw(0,v.S)("WebVRCamera")}},{key:"_prepareVRComponent",value:function(){}},{key:"_connectVREvents",value:function(e,t){}},{key:"_submitVRFrame",value:function(){}},{key:"disableVR",value:function(){}},{key:"isVRPresenting",value:function(){return!1}},{key:"_requestVRFrame",value:function(){}},{key:"_loadFileAsync",value:function(e,t,n){var i=this;return new Promise((function(r,a){i._loadFile(e,(function(e){r(e)}),void 0,t,n,(function(e,t){a(t)}))}))}},{key:"getVertexShaderSource",value:function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null}},{key:"getFragmentShaderSource",value:function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null}},{key:"setDepthStencilTexture",value:function(e,t,n,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),n&&n.depthStencilTexture?this._setTexture(e,n,!1,!0,i):this._setTexture(e,null,void 0,void 0,i))}},{key:"setTextureFromPostProcess",value:function(e,t,n){var i,r,a=null;t&&(t._textures.data[t._currentRenderTextureInd]?a=t._textures.data[t._currentRenderTextureInd]:t._forcedOutputTexture&&(a=t._forcedOutputTexture)),this._bindTexture(e,null!==(i=null===(r=a)||void 0===r?void 0:r.texture)&&void 0!==i?i:null,n)}},{key:"setTextureFromPostProcessOutput",value:function(e,t,n){var i,r;this._bindTexture(e,null!==(i=null==t||null===(r=t._outputTexture)||void 0===r?void 0:r.texture)&&void 0!==i?i:null,n)}},{key:"_rebuildBuffers",value:function(){var e,t=S(this.scenes);try{for(t.s();!(e=t.n()).done;){var i=e.value;i.resetCachedMaterial(),i._rebuildGeometries(),i._rebuildTextures()}}catch(l){t.e(l)}finally{t.f()}var r,a=S(this._virtualScenes);try{for(a.s();!(r=a.n()).done;){var s=r.value;s.resetCachedMaterial(),s._rebuildGeometries(),s._rebuildTextures()}}catch(l){a.e(l)}finally{a.f()}(0,o.Z)((0,u.Z)(n.prototype),"_rebuildBuffers",this).call(this)}},{key:"_renderFrame",value:function(){for(var e=0;e<this._activeRenderLoops.length;e++){(0,this._activeRenderLoops[e])()}}},{key:"_renderLoop",value:function(){if(!this._contextWasLost){var e=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1}},{key:"_renderViews",value:function(){return!1}},{key:"switchFullscreen",value:function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)}},{key:"enterFullscreen",value:function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&n._RequestFullscreen(this._renderingCanvas))}},{key:"exitFullscreen",value:function(){this.isFullscreen&&n._ExitFullscreen()}},{key:"enterPointerlock",value:function(){this._renderingCanvas&&n._RequestPointerlock(this._renderingCanvas)}},{key:"exitPointerlock",value:function(){n._ExitPointerlock()}},{key:"beginFrame",value:function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),(0,o.Z)((0,u.Z)(n.prototype),"beginFrame",this).call(this)}},{key:"endFrame",value:function(){(0,o.Z)((0,u.Z)(n.prototype),"endFrame",this).call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isVRPresenting()||(0,o.Z)((0,u.Z)(n.prototype),"resize",this).call(this,e)}},{key:"setSize",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(!(0,o.Z)((0,u.Z)(n.prototype),"setSize",this).call(this,e,t,i))return!1;if(this.scenes){for(var r=0;r<this.scenes.length;r++)for(var a=this.scenes[r],s=0;s<a.cameras.length;s++){var l=a.cameras[s];l._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}},{key:"_deletePipelineContext",value:function(e){var t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),(0,o.Z)((0,u.Z)(n.prototype),"_deletePipelineContext",this).call(this,e)}},{key:"createShaderProgram",value:function(e,t,i,r,a){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;a=a||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var l=(0,o.Z)((0,u.Z)(n.prototype),"createShaderProgram",this).call(this,e,t,i,r,a,s);return this.onAfterShaderCompilationObservable.notifyObservers(this),l}},{key:"_createShaderProgram",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=i.createProgram();if(e.program=a,!a)throw new Error("Unable to create program");if(i.attachShader(a,t),i.attachShader(a,n),this.webGLVersion>1&&r){var o=this.createTransformFeedback();this.bindTransformFeedback(o),this.setTranformFeedbackVaryings(a,r),e.transformFeedback=o}return i.linkProgram(a),this.webGLVersion>1&&r&&this.bindTransformFeedback(null),e.context=i,e.vertexShader=t,e.fragmentShader=n,e.isParallelCompiled||this._finalizePipelineContext(e),a}},{key:"_releaseTexture",value:function(e){(0,o.Z)((0,u.Z)(n.prototype),"_releaseTexture",this).call(this,e)}},{key:"_releaseRenderTargetWrapper",value:function(e){(0,o.Z)((0,u.Z)(n.prototype),"_releaseRenderTargetWrapper",this).call(this,e),this.scenes.forEach((function(t){t.postProcesses.forEach((function(t){t._outputTexture===e&&(t._outputTexture=null)})),t.cameras.forEach((function(t){t._postProcesses.forEach((function(t){t&&t._outputTexture===e&&(t._outputTexture=null)}))}))}))}},{key:"getRenderPassNames",value:function(){return this._renderPassNames}},{key:"getCurrentRenderPassName",value:function(){return this._renderPassNames[this.currentRenderPassId]}},{key:"createRenderPassId",value:function(e){var t=++n._RenderPassIdCounter;return this._renderPassNames[t]=null!=e?e:"NONAME",t}},{key:"releaseRenderPassId",value:function(e){this._renderPassNames[e]=void 0;for(var t=0;t<this.scenes.length;++t)for(var n=this.scenes[t],i=0;i<n.meshes.length;++i){var r=n.meshes[i];if(r.subMeshes)for(var a=0;a<r.subMeshes.length;++a){r.subMeshes[a]._removeDrawWrapper(e)}}}},{key:"_rescaleTexture",value:function(e,t,i,r,a){var o=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var s=this.createRenderTargetTexture({width:t.width,height:t.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&n._RescalePostProcessFactory&&(this._rescalePostProcess=n._RescalePostProcessFactory(this)),this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled((function(){o._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};var n=i;n||(n=o.scenes[o.scenes.length-1]),n.postProcessManager.directRender([o._rescalePostProcess],s,!0),o._bindTextureDirectly(o._gl.TEXTURE_2D,t,!0),o._gl.copyTexImage2D(o._gl.TEXTURE_2D,0,r,0,0,t.width,t.height,0),o.unBindFramebuffer(s),s.dispose(),a&&a()}))}},{key:"getFps",value:function(){return this._fps}},{key:"getDeltaTime",value:function(){return this._deltaTime}},{key:"_measureFps",value:function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}},{key:"wrapWebGLTexture",value:function(e){var t=new b.B(e,this._gl),n=new h.l(this,h.S.Unknown,!0);return n._hardwareTexture=t,n.isReady=!0,n}},{key:"_uploadImageToTexture",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=this._gl,a=this._getWebGLTextureType(e.type),o=this._getInternalFormat(e.format),s=this._getRGBABufferInternalSizedFormat(e.type,o),l=e.isCube?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D;this._bindTextureDirectly(l,e,!0),this._unpackFlipY(e.invertY);var u=r.TEXTURE_2D;e.isCube&&(u=r.TEXTURE_CUBE_MAP_POSITIVE_X+n),r.texImage2D(u,i,s,o,a,t),this._bindTextureDirectly(l,null,!0)}},{key:"updateTextureComparisonFunction",value:function(e,t){if(1!==this.webGLVersion){var n=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,t),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}else E.Y.Error("WebGL 1 does not support texture comparison.")}},{key:"createInstancesBuffer",value:function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var n=new A.M(t);return n.capacity=e,this.bindArrayBuffer(n),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),n.references=1,n}},{key:"deleteInstancesBuffer",value:function(e){this._gl.deleteBuffer(e)}},{key:"_clientWaitAsync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=this._gl;return new Promise((function(r,a){!function o(){var s=i.clientWaitSync(e,t,0);s!=i.WAIT_FAILED?s!=i.TIMEOUT_EXPIRED?r():setTimeout(o,n):a()}()}))}},{key:"_readPixelsAsync",value:function(e,t,n,i,r,a,o){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var s=this._gl,l=s.createBuffer();s.bindBuffer(s.PIXEL_PACK_BUFFER,l),s.bufferData(s.PIXEL_PACK_BUFFER,o.byteLength,s.STREAM_READ),s.readPixels(e,t,n,i,r,a,0),s.bindBuffer(s.PIXEL_PACK_BUFFER,null);var u=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);return u?(s.flush(),this._clientWaitAsync(u,0,10).then((function(){return s.deleteSync(u),s.bindBuffer(s.PIXEL_PACK_BUFFER,l),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,o),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),s.deleteBuffer(l),o}))):null}},{key:"dispose",value:function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();1===n.Instances.length&&n.audioEngine&&(n.audioEngine.dispose(),n.audioEngine=null),this.disableVR(),(0,f.CG)()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._renderingCanvas.removeEventListener("contextmenu",this._onCanvasContextMenu)),(0,f.n5)()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),(0,o.Z)((0,u.Z)(n.prototype),"dispose",this).call(this);var e=n.Instances.indexOf(this);e>=0&&n.Instances.splice(e,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}},{key:"_disableTouchAction",value:function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none",this._renderingCanvas.style.webkitTapHighlightColor="transparent")}},{key:"displayLoadingUI",value:function(){if((0,f.CG)()){var e=this.loadingScreen;e&&e.displayLoadingUI()}}},{key:"hideLoadingUI",value:function(){if((0,f.CG)()){var e=this._loadingScreen;e&&e.hideLoadingUI()}}},{key:"loadingScreen",get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=n.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e}},{key:"loadingUIText",set:function(e){this.loadingScreen.loadingUIText=e}},{key:"loadingUIBackgroundColor",set:function(e){this.loadingScreen.loadingUIBackgroundColor=e}},{key:"createVideoElement",value:function(e){return document.createElement("video")}},{key:"getFontOffset",value:function(e){var t=document.createElement("span");t.innerHTML="Hg",t.setAttribute("style","font: ".concat(e," !important"));var n=document.createElement("div");n.style.display="inline-block",n.style.width="1px",n.style.height="0px",n.style.verticalAlign="bottom";var i=document.createElement("div");i.style.whiteSpace="nowrap",i.appendChild(t),i.appendChild(n),document.body.appendChild(i);var r=0,a=0;try{a=n.getBoundingClientRect().top-t.getBoundingClientRect().top,n.style.verticalAlign="baseline",r=n.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(i)}return{ascent:r,height:a,descent:a-r}}}],[{key:"NpmPackage",get:function(){return p.B.NpmPackage}},{key:"Version",get:function(){return p.B.Version}},{key:"Instances",get:function(){return d.l.Instances}},{key:"LastCreatedEngine",get:function(){return d.l.LastCreatedEngine}},{key:"LastCreatedScene",get:function(){return d.l.LastCreatedScene}},{key:"MarkAllMaterialsAsDirty",value:function(e,t){for(var i=0;i<n.Instances.length;i++)for(var r=n.Instances[i],a=0;a<r.scenes.length;a++)r.scenes[a].markAllMaterialsAsDirty(e,t)}},{key:"DefaultLoadingScreenFactory",value:function(e){throw(0,v.S)("LoadingScreen")}},{key:"_RequestPointerlock",value:function(e){e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&(e.requestPointerLock(),e.focus())}},{key:"_ExitPointerlock",value:function(){var e=document;document.exitPointerLock=document.exitPointerLock||e.msExitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()}},{key:"_RequestFullscreen",value:function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)}},{key:"_ExitFullscreen",value:function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()}}]),n}(p.B);P.ALPHA_DISABLE=0,P.ALPHA_ADD=1,P.ALPHA_COMBINE=2,P.ALPHA_SUBTRACT=3,P.ALPHA_MULTIPLY=4,P.ALPHA_MAXIMIZED=5,P.ALPHA_ONEONE=6,P.ALPHA_PREMULTIPLIED=7,P.ALPHA_PREMULTIPLIED_PORTERDUFF=8,P.ALPHA_INTERPOLATE=9,P.ALPHA_SCREENMODE=10,P.DELAYLOADSTATE_NONE=0,P.DELAYLOADSTATE_LOADED=1,P.DELAYLOADSTATE_LOADING=2,P.DELAYLOADSTATE_NOTLOADED=4,P.NEVER=512,P.ALWAYS=519,P.LESS=513,P.EQUAL=514,P.LEQUAL=515,P.GREATER=516,P.GEQUAL=518,P.NOTEQUAL=517,P.KEEP=7680,P.REPLACE=7681,P.INCR=7682,P.DECR=7683,P.INVERT=5386,P.INCR_WRAP=34055,P.DECR_WRAP=34056,P.TEXTURE_CLAMP_ADDRESSMODE=0,P.TEXTURE_WRAP_ADDRESSMODE=1,P.TEXTURE_MIRROR_ADDRESSMODE=2,P.TEXTUREFORMAT_ALPHA=0,P.TEXTUREFORMAT_LUMINANCE=1,P.TEXTUREFORMAT_LUMINANCE_ALPHA=2,P.TEXTUREFORMAT_RGB=4,P.TEXTUREFORMAT_RGBA=5,P.TEXTUREFORMAT_RED=6,P.TEXTUREFORMAT_R=6,P.TEXTUREFORMAT_RG=7,P.TEXTUREFORMAT_RED_INTEGER=8,P.TEXTUREFORMAT_R_INTEGER=8,P.TEXTUREFORMAT_RG_INTEGER=9,P.TEXTUREFORMAT_RGB_INTEGER=10,P.TEXTUREFORMAT_RGBA_INTEGER=11,P.TEXTURETYPE_UNSIGNED_BYTE=0,P.TEXTURETYPE_UNSIGNED_INT=0,P.TEXTURETYPE_FLOAT=1,P.TEXTURETYPE_HALF_FLOAT=2,P.TEXTURETYPE_BYTE=3,P.TEXTURETYPE_SHORT=4,P.TEXTURETYPE_UNSIGNED_SHORT=5,P.TEXTURETYPE_INT=6,P.TEXTURETYPE_UNSIGNED_INTEGER=7,P.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,P.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,P.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,P.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,P.TEXTURETYPE_UNSIGNED_INT_24_8=12,P.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,P.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,P.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,P.TEXTURE_NEAREST_SAMPLINGMODE=1,P.TEXTURE_BILINEAR_SAMPLINGMODE=2,P.TEXTURE_TRILINEAR_SAMPLINGMODE=3,P.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,P.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,P.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,P.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,P.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,P.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,P.TEXTURE_NEAREST_LINEAR=7,P.TEXTURE_NEAREST_NEAREST=1,P.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,P.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,P.TEXTURE_LINEAR_LINEAR=2,P.TEXTURE_LINEAR_NEAREST=12,P.TEXTURE_EXPLICIT_MODE=0,P.TEXTURE_SPHERICAL_MODE=1,P.TEXTURE_PLANAR_MODE=2,P.TEXTURE_CUBIC_MODE=3,P.TEXTURE_PROJECTION_MODE=4,P.TEXTURE_SKYBOX_MODE=5,P.TEXTURE_INVCUBIC_MODE=6,P.TEXTURE_EQUIRECTANGULAR_MODE=7,P.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,P.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,P.SCALEMODE_FLOOR=1,P.SCALEMODE_NEAREST=2,P.SCALEMODE_CEILING=3,P._RescalePostProcessFactory=null,P._RenderPassIdCounter=0},4198:function(e,t,n){"use strict";n.d(t,{l:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"LastCreatedEngine",get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}},{key:"LastCreatedScene",get:function(){return this._LastCreatedScene}}]),e}();a.Instances=new Array,a._LastCreatedScene=null,a.UseFallbackTexture=!0,a.FallbackTexture=""},6196:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"SetMatrixPrecision",value:function(t){if(e.MatrixTrackPrecisionChange=!1,t&&!e.MatrixUse64Bits&&e.MatrixTrackedMatrices)for(var n=0;n<e.MatrixTrackedMatrices.length;++n){var i=e.MatrixTrackedMatrices[n],r=i._m;i._m=new Array(16);for(var a=0;a<16;++a)i._m[a]=r[a]}e.MatrixUse64Bits=t,e.MatrixCurrentType=e.MatrixUse64Bits?Array:Float32Array,e.MatrixTrackedMatrices=null}}]),e}();a.MatrixUse64Bits=!1,a.MatrixTrackPrecisionChange=!0,a.MatrixCurrentType=Float32Array,a.MatrixTrackedMatrices=[]},8084:function(e,t,n){"use strict";n.d(t,{v:function(){return o}});var i=n(5671),r=n(3144),a=n(2223),o=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"GetShadersRepository",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.x.GLSL;return t===a.x.GLSL?e.ShadersRepository:e.ShadersRepositoryWGSL}},{key:"GetShadersStore",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.x.GLSL;return t===a.x.GLSL?e.ShadersStore:e.ShadersStoreWGSL}},{key:"GetIncludesShadersStore",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.x.GLSL;return t===a.x.GLSL?e.IncludesShadersStore:e.IncludesShadersStoreWGSL}}]),e}();o.ShadersRepository="src/Shaders/",o.ShadersStore={},o.IncludesShadersStore={},o.ShadersRepositoryWGSL="src/ShadersWGSL/",o.ShadersStoreWGSL={},o.IncludesShadersStoreWGSL={}},1187:function(e,t,n){"use strict";n.d(t,{G:function(){return o}});var i,r=n(3144),a=n(5671);!function(e){e[e.PointerMove=0]="PointerMove",e[e.PointerDown=1]="PointerDown",e[e.PointerUp=2]="PointerUp"}(i||(i={}));var o=(0,r.Z)((function e(){(0,a.Z)(this,e)}));o.DOM_DELTA_PIXEL=0,o.DOM_DELTA_LINE=1,o.DOM_DELTA_PAGE=2},3531:function(e,t,n){"use strict";n.d(t,{NG:function(){return c},OG:function(){return u},WZ:function(){return h}});var i=n(136),r=n(6215),a=n(1120),o=n(3144),s=n(5671);function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,a.Z)(e);if(t){var o=(0,a.Z)(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return(0,r.Z)(this,n)}}var u=(0,o.Z)((function e(){(0,s.Z)(this,e)}));u.KEYDOWN=1,u.KEYUP=2;var c=(0,o.Z)((function e(t,n){(0,s.Z)(this,e),this.type=t,this.event=n})),h=function(e){(0,i.Z)(n,e);var t=l(n);function n(e,i){var r;return(0,s.Z)(this,n),(r=t.call(this,e,i)).type=e,r.event=i,r.skipOnKeyboardObservable=!1,r}return(0,o.Z)(n,[{key:"skipOnPointerObservable",get:function(){return this.skipOnKeyboardObservable},set:function(e){this.skipOnKeyboardObservable=e}}]),n}(c)},3365:function(e,t,n){"use strict";n.d(t,{FV:function(){return f},R5:function(){return d},kD:function(){return c}});var i=n(136),r=n(6215),a=n(1120),o=n(3144),s=n(5671),l=n(6900);function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,a.Z)(e);if(t){var o=(0,a.Z)(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return(0,r.Z)(this,n)}}var c=(0,o.Z)((function e(){(0,s.Z)(this,e)}));c.POINTERDOWN=1,c.POINTERUP=2,c.POINTERMOVE=4,c.POINTERWHEEL=8,c.POINTERPICK=16,c.POINTERTAP=32,c.POINTERDOUBLETAP=64;var h=(0,o.Z)((function e(t,n){(0,s.Z)(this,e),this.type=t,this.event=n})),f=function(e){(0,i.Z)(n,e);var t=u(n);function n(e,i,r,a){var o;return(0,s.Z)(this,n),(o=t.call(this,e,i)).ray=null,o.originalPickingInfo=null,o.skipOnPointerObservable=!1,o.localPosition=new l.FM(r,a),o}return(0,o.Z)(n)}(h),d=function(e){(0,i.Z)(n,e);var t=u(n);function n(e,i,r){var a;return(0,s.Z)(this,n),(a=t.call(this,e,i)).pickInfo=r,a}return(0,o.Z)(n)}(h)},8983:function(e,t,n){"use strict";n.d(t,{$:function(){return U}});var i=n(5671),r=n(3144),a=n(3365),o=function(){function e(){(0,i.Z)(this,e),this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return(0,r.Z)(e,null,[{key:"HasTriggers",get:function(){for(var t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t))return!0;return!1}},{key:"HasPickTriggers",get:function(){for(var t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t)){var n=parseInt(t);if(n>=1&&n<=7)return!0}return!1}},{key:"HasSpecificTrigger",value:function(t){for(var n in e.Triggers){if(Object.prototype.hasOwnProperty.call(e.Triggers,n))if(parseInt(n)===t)return!0}return!1}}]),e}();o.Triggers={};var s,l,u,c,h,f,d,v=n(3541),p=n(6900),_=n(8483),g=n(3531);!function(e){e[e.Generic=0]="Generic",e[e.Keyboard=1]="Keyboard",e[e.Mouse=2]="Mouse",e[e.Touch=3]="Touch",e[e.DualShock=4]="DualShock",e[e.Xbox=5]="Xbox",e[e.Switch=6]="Switch",e[e.DualSense=7]="DualSense"}(s||(s={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.Move=12]="Move"}(l||(l={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.DeltaHorizontal=10]="DeltaHorizontal",e[e.DeltaVertical=11]="DeltaVertical"}(u||(u={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(c||(c={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Create=8]="Create",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(h||(h={})),function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.LT=6]="LT",e[e.RT=7]="RT",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.LStickXAxis=17]="LStickXAxis",e[e.LStickYAxis=18]="LStickYAxis",e[e.RStickXAxis=19]="RStickXAxis",e[e.RStickYAxis=20]="RStickYAxis"}(f||(f={})),function(e){e[e.B=0]="B",e[e.A=1]="A",e[e.Y=2]="Y",e[e.X=3]="X",e[e.L=4]="L",e[e.R=5]="R",e[e.ZL=6]="ZL",e[e.ZR=7]="ZR",e[e.Minus=8]="Minus",e[e.Plus=9]="Plus",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.Capture=17]="Capture",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(d||(d={}));var m=n(4174),y=n(1187),A=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"CreateDeviceEvent",value:function(e,t,n,i,r,a){switch(e){case s.Keyboard:return this._CreateKeyboardEvent(n,i,r,a);case s.Mouse:if(n===l.MouseWheelX||n===l.MouseWheelY||n===l.MouseWheelZ)return this._CreateWheelEvent(e,t,n,i,r,a);case s.Touch:return this._CreatePointerEvent(e,t,n,i,r,a);default:throw"Unable to generate event for device ".concat(s[e])}}},{key:"_CreatePointerEvent",value:function(e,t,n,i,r,a){var o=this._CreateMouseEvent(e,t,n,i,r,a);return e===s.Mouse?(o.deviceType=s.Mouse,o.pointerId=1,o.pointerType="mouse"):(o.deviceType=s.Touch,o.pointerId=t,o.pointerType="touch"),n===l.Move?o.type="pointermove":n>=l.LeftClick&&n<=l.RightClick&&(o.type=1===i?"pointerdown":"pointerup",o.button=n-2),o}},{key:"_CreateWheelEvent",value:function(e,t,n,i,r,a){var o=this._CreateMouseEvent(e,t,n,i,r,a);switch(o.type="wheel",o.deltaMode=y.G.DOM_DELTA_PIXEL,o.deltaX=0,o.deltaY=0,o.deltaZ=0,n){case l.MouseWheelX:o.deltaX=i;break;case l.MouseWheelY:o.deltaY=i;break;case l.MouseWheelZ:o.deltaZ=i}return o}},{key:"_CreateMouseEvent",value:function(e,t,n,i,r,a){var o=this._CreateEvent(a),s=r.pollInput(e,t,l.Horizontal),c=r.pollInput(e,t,l.Vertical);return a?(o.movementX=0,o.movementY=0,o.offsetX=o.movementX-a.getBoundingClientRect().x,o.offsetY=o.movementY-a.getBoundingClientRect().y):(o.movementX=r.pollInput(e,t,u.DeltaHorizontal),o.movementY=r.pollInput(e,t,u.DeltaVertical),o.offsetX=0,o.offsetY=0),this._CheckNonCharacterKeys(o,r),o.clientX=s,o.clientY=c,o.x=s,o.y=c,o.deviceType=e,o.deviceSlot=t,o.inputIndex=n,o}},{key:"_CreateKeyboardEvent",value:function(e,t,n,i){var r=this._CreateEvent(i);return this._CheckNonCharacterKeys(r,n),r.deviceType=s.Keyboard,r.deviceSlot=0,r.inputIndex=e,r.type=1===t?"keydown":"keyup",r.key=String.fromCharCode(e),r.keyCode=e,r}},{key:"_CheckNonCharacterKeys",value:function(e,t){var n=t.isDeviceAvailable(s.Keyboard),i=n&&1===t.pollInput(s.Keyboard,0,18),r=n&&1===t.pollInput(s.Keyboard,0,17),a=n&&(1===t.pollInput(s.Keyboard,0,91)||1===t.pollInput(s.Keyboard,0,92)||1===t.pollInput(s.Keyboard,0,93)),o=n&&1===t.pollInput(s.Keyboard,0,16);e.altKey=i,e.ctrlKey=r,e.metaKey=a,e.shiftKey=o}},{key:"_CreateEvent",value:function(e){var t={preventDefault:function(){}};return t.target=e,t}}]),e}(),E=function(){function e(t,n,r){var a=this;(0,i.Z)(this,e),this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(t,n,(function(e,t,n,i){var o=A.CreateDeviceEvent(e,t,n,i,a);r(e,t,o)})):this._createDummyNativeInput()}return(0,r.Z)(e,[{key:"pollInput",value:function(e,t,n){return this._nativeInput.pollInput(e,t,n)}},{key:"isDeviceAvailable",value:function(e){return e===s.Mouse||e===s.Touch}},{key:"dispose",value:function(){this._nativeInput.dispose()}},{key:"_createDummyNativeInput",value:function(){return{pollInput:function(){return 0},isDeviceAvailable:function(){return!1},dispose:function(){}}}}]),e}(),b=n(5092),T=n(8517);function S(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var I=Object.keys(l).length/2,P=function(){function e(t,n,r,a){var o=this;(0,i.Z)(this,e),this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=T.w1.IsSafari(),this._usingMacOS=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=function(e){},this._keyboardUpEvent=function(e){},this._keyboardBlurEvent=function(e){},this._pointerMoveEvent=function(e){},this._pointerDownEvent=function(e){},this._pointerUpEvent=function(e){},this._pointerCancelEvent=function(e){},this._pointerWheelEvent=function(e){},this._pointerBlurEvent=function(e){},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=b.MZ.IsNavigatorAvailable()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=function(e){},this._gamepadDisconnectedEvent=function(e){},this._eventPrefix=T.w1.GetPointerPrefix(t),this._engine=t,this._onDeviceConnected=n,this._onDeviceDisconnected=r,this._onInputChanged=a,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=function(){o._enableEvents()})}return(0,r.Z)(e,[{key:"pollInput",value:function(e,t,n){var i=this._inputs[e][t];if(!i)throw"Unable to find device ".concat(s[e]);e>=s.DualShock&&e<=s.DualSense&&this._updateDevice(e,t,n);var r=i[n];if(void 0===r)throw"Unable to find input ".concat(n," for device ").concat(s[e]," in slot ").concat(t);return n===l.Move&&T.w1.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),r}},{key:"isDeviceAvailable",value:function(e){return void 0!==this._inputs[e]}},{key:"dispose",value:function(){this._onDeviceConnected=function(){},this._onDeviceDisconnected=function(){},this._onInputChanged=function(){},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}},{key:"_enableEvents",value:function(){var e=null==this?void 0:this._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs){var t,n=S(this._inputs);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i)for(var r in i){var a=i[+r];if(a)for(var o=0;o<a.length;o++)a[o]=0}}}catch(s){n.e(s)}finally{n.f()}}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}},{key:"_disableEvents",value:function(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}},{key:"_checkForConnectedDevices",value:function(){if(navigator.getGamepads){var e,t=S(navigator.getGamepads());try{for(t.s();!(e=t.n()).done;){var n=e.value;n&&this._addGamePad(n)}}catch(i){t.e(i)}finally{t.f()}}"function"==typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(s.Mouse,0,0,0)}},{key:"_addGamePad",value:function(e){var t=this._getGamepadDeviceType(e.id),n=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,n,e.buttons.length+e.axes.length),this._gamepads[n]=t}},{key:"_addPointerDevice",value:function(e,t,n,i){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,I);var r=this._inputs[e][t];r[0]=n,r[1]=i}},{key:"_registerDevice",value:function(e,t,n){if(void 0===t)throw"Unable to register device ".concat(s[e]," to undefined slot.");if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){var i=new Array(n);i.fill(0),this._inputs[e][t]=i,this._onDeviceConnected(e,t)}}},{key:"_unregisterDevice",value:function(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))}},{key:"_handleKeyActions",value:function(){var e=this;this._keyboardDownEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(s.Keyboard,0,255));var n=e._inputs[s.Keyboard][0];if(n){n[t.keyCode]=1;var i=t;i.inputIndex=t.keyCode,e._usingMacOS&&t.metaKey&&"Meta"!==t.key&&(e._metaKeys.includes(t.keyCode)||e._metaKeys.push(t.keyCode)),e._onInputChanged(s.Keyboard,0,i)}},this._keyboardUpEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(s.Keyboard,0,255));var n=e._inputs[s.Keyboard][0];if(n){n[t.keyCode]=0;var i=t;if(i.inputIndex=t.keyCode,e._usingMacOS&&"Meta"===t.key&&e._metaKeys.length>0){var r,a=S(e._metaKeys);try{for(a.s();!(r=a.n()).done;){var o=r.value,l=A.CreateDeviceEvent(s.Keyboard,0,o,0,e,e._elementToAttachTo);n[o]=0,e._onInputChanged(s.Keyboard,0,l)}}catch(u){a.e(u)}finally{a.f()}e._metaKeys.splice(0,e._metaKeys.length)}e._onInputChanged(s.Keyboard,0,i)}},this._keyboardBlurEvent=function(){if(e._keyboardActive){for(var t=e._inputs[s.Keyboard][0],n=0;n<t.length;n++)if(0!==t[n]){t[n]=0;var i=A.CreateDeviceEvent(s.Keyboard,0,n,0,e,e._elementToAttachTo);e._onInputChanged(s.Keyboard,0,i)}e._usingMacOS&&e._metaKeys.splice(0,e._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}},{key:"_handlePointerActions",value:function(){var e=this;this._maxTouchPoints=b.MZ.IsNavigatorAvailable()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(var t=0;t<this._maxTouchPoints;t++)this._activeTouchIds[t]=-1;this._pointerMoveEvent=function(t){var n=e._getPointerType(t),i=n===s.Mouse?0:e._activeTouchIds.indexOf(t.pointerId);e._inputs[n]||(e._inputs[n]={}),e._inputs[n][i]||e._addPointerDevice(n,i,t.clientX,t.clientY);var r=e._inputs[n][i];if(r){var a=t;a.inputIndex=l.Move,void 0===t.movementX&&(t.movementX=t.mozMovementX||t.webkitMovementX||t.msMovementX||t.clientX-r[l.Horizontal]),void 0===t.movementY&&(t.movementY=t.mozMovementY||t.webkitMovementY||t.msMovementY||t.clientY-r[l.Vertical]),r[l.Horizontal]=t.clientX,r[l.Vertical]=t.clientY,e._onInputChanged(n,i,a),e._usingSafari||-1===t.button||(a.inputIndex=t.button+2,r[t.button+2]=r[t.button+2]?0:1,e._onInputChanged(n,i,a))}},this._pointerDownEvent=function(t){var n=e._getPointerType(t),i=n===s.Mouse?0:t.pointerId;if(n===s.Touch){var r=e._activeTouchIds.indexOf(-1);if(!(r>=0))return void T.w1.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(e._maxTouchPoints));i=r,e._activeTouchIds[r]=t.pointerId}e._inputs[n]||(e._inputs[n]={}),e._inputs[n][i]?n===s.Touch&&e._onDeviceConnected(n,i):e._addPointerDevice(n,i,t.clientX,t.clientY);var a=e._inputs[n][i];if(a){var o=a[l.Horizontal],u=a[l.Vertical];if(n===s.Mouse){if(-1===e._mouseId&&(void 0===t.pointerId?e._mouseId=e._isUsingFirefox?0:1:e._mouseId=t.pointerId),!document.pointerLockElement)try{e._elementToAttachTo.setPointerCapture(e._mouseId)}catch(h){}}else if(t.pointerId&&!document.pointerLockElement)try{e._elementToAttachTo.setPointerCapture(t.pointerId)}catch(h){}a[l.Horizontal]=t.clientX,a[l.Vertical]=t.clientY,a[t.button+2]=1;var c=t;c.inputIndex=t.button+2,e._onInputChanged(n,i,c),o===t.clientX&&u===t.clientY||(c.inputIndex=l.Move,void 0===t.movementX&&(t.movementX=t.mozMovementX||t.webkitMovementX||t.msMovementX||t.clientX-a[l.Horizontal]),void 0===t.movementY&&(t.movementY=t.mozMovementY||t.webkitMovementY||t.msMovementY||t.clientY-a[l.Vertical]),e._onInputChanged(n,i,c))}},this._pointerUpEvent=function(t){var n,i=e._getPointerType(t),r=i===s.Mouse?0:e._activeTouchIds.indexOf(t.pointerId);if(i===s.Touch){if(-1===r)return;e._activeTouchIds[r]=-1}var a=null===(n=e._inputs[i])||void 0===n?void 0:n[r];if(a&&0!==a[t.button+2]){var o,u,c,h,f=a[l.Horizontal],d=a[l.Vertical];a[l.Horizontal]=t.clientX,a[l.Vertical]=t.clientY,a[t.button+2]=0;var v=t;f===t.clientX&&d===t.clientY||(v.inputIndex=l.Move,void 0===t.movementX&&(t.movementX=t.mozMovementX||t.webkitMovementX||t.msMovementX||t.clientX-a[l.Horizontal]),void 0===t.movementY&&(t.movementY=t.mozMovementY||t.webkitMovementY||t.msMovementY||t.clientY-a[l.Vertical]),e._onInputChanged(i,r,v)),v.inputIndex=t.button+2,i===s.Mouse&&e._mouseId>=0&&null!==(o=(u=e._elementToAttachTo).hasPointerCapture)&&void 0!==o&&o.call(u,e._mouseId)?e._elementToAttachTo.releasePointerCapture(e._mouseId):t.pointerId&&null!==(c=(h=e._elementToAttachTo).hasPointerCapture)&&void 0!==c&&c.call(h,t.pointerId)&&e._elementToAttachTo.releasePointerCapture(t.pointerId),e._onInputChanged(i,r,v),i===s.Touch&&e._onDeviceDisconnected(i,r)}},this._pointerCancelEvent=function(t){if("mouse"===t.pointerType){var n,i,r=e._inputs[s.Mouse][0];e._mouseId>=0&&null!==(n=(i=e._elementToAttachTo).hasPointerCapture)&&void 0!==n&&n.call(i,e._mouseId)&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var a=l.LeftClick;a<=l.BrowserForward;a++)if(1===r[a]){r[a]=0;var o=A.CreateDeviceEvent(s.Mouse,0,a,0,e,e._elementToAttachTo);e._onInputChanged(s.Mouse,0,o)}}else{var u,c,h=e._activeTouchIds.indexOf(t.pointerId);null!==(u=(c=e._elementToAttachTo).hasPointerCapture)&&void 0!==u&&u.call(c,t.pointerId)&&e._elementToAttachTo.releasePointerCapture(t.pointerId),e._inputs[s.Touch][h][l.LeftClick]=0;var f=A.CreateDeviceEvent(s.Touch,h,l.LeftClick,0,e,e._elementToAttachTo);e._onInputChanged(s.Touch,h,f),e._activeTouchIds[h]=-1,e._onDeviceDisconnected(s.Touch,h)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";var n=!1,i=function(){};try{var r=Object.defineProperty({},"passive",{get:function(){n=!0}});this._elementToAttachTo.addEventListener("test",i,r),this._elementToAttachTo.removeEventListener("test",i,r)}catch(a){}this._pointerBlurEvent=function(){if(e.isDeviceAvailable(s.Mouse)){var t,n,i=e._inputs[s.Mouse][0];e._mouseId>=0&&null!==(t=(n=e._elementToAttachTo).hasPointerCapture)&&void 0!==t&&t.call(n,e._mouseId)&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var r=l.LeftClick;r<=l.BrowserForward;r++)if(1===i[r]){i[r]=0;var a=A.CreateDeviceEvent(s.Mouse,0,r,0,e,e._elementToAttachTo);e._onInputChanged(s.Mouse,0,a)}}if(e.isDeviceAvailable(s.Touch))for(var o=e._inputs[s.Touch],u=0;u<e._activeTouchIds.length;u++){var c,h,f,d=e._activeTouchIds[u];if(null!==(c=(h=e._elementToAttachTo).hasPointerCapture)&&void 0!==c&&c.call(h,d)&&e._elementToAttachTo.releasePointerCapture(d),-1!==d&&1===(null===(f=o[u])||void 0===f?void 0:f[l.LeftClick])){o[u][l.LeftClick]=0;var v=A.CreateDeviceEvent(s.Touch,u,l.LeftClick,0,e,e._elementToAttachTo);e._onInputChanged(s.Touch,u,v),e._activeTouchIds[u]=-1,e._onDeviceDisconnected(s.Touch,u)}}},this._pointerWheelEvent=function(t){var n=s.Mouse;e._inputs[n]||(e._inputs[n]=[]),e._inputs[n][0]||(e._pointerActive=!0,e._registerDevice(n,0,I));var i=e._inputs[n][0];if(i){i[l.MouseWheelX]=t.deltaX||0,i[l.MouseWheelY]=t.deltaY||t.wheelDelta||0,i[l.MouseWheelZ]=t.deltaZ||0;var r=t;0!==i[l.MouseWheelX]&&(r.inputIndex=l.MouseWheelX,e._onInputChanged(n,0,r)),0!==i[l.MouseWheelY]&&(r.inputIndex=l.MouseWheelY,e._onInputChanged(n,0,r)),0!==i[l.MouseWheelZ]&&(r.inputIndex=l.MouseWheelZ,e._onInputChanged(n,0,r))}},this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!n&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((function(){if(e.isDeviceAvailable(s.Mouse)){var t=e._inputs[s.Mouse][0];t[l.MouseWheelX]=0,t[l.MouseWheelY]=0,t[l.MouseWheelZ]=0}}))}},{key:"_handleGamepadActions",value:function(){var e=this;this._gamepadConnectedEvent=function(t){e._addGamePad(t.gamepad)},this._gamepadDisconnectedEvent=function(t){if(e._gamepads){var n=e._getGamepadDeviceType(t.gamepad.id),i=t.gamepad.index;e._unregisterDevice(n,i),delete e._gamepads[i]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}},{key:"_updateDevice",value:function(e,t,n){var i=navigator.getGamepads()[t];if(i&&e===this._gamepads[t]){var r=this._inputs[e][t];n>=i.buttons.length?r[n]=i.axes[n-i.buttons.length].valueOf():r[n]=i.buttons[n].value}}},{key:"_getGamepadDeviceType",value:function(e){return-1!==e.indexOf("054c")?-1!==e.indexOf("0ce6")?s.DualSense:s.DualShock:-1!==e.indexOf("Xbox One")||-1!==e.search("Xbox 360")||-1!==e.search("xinput")?s.Xbox:-1!==e.indexOf("057e")?s.Switch:s.Generic}},{key:"_getPointerType",value:function(e){var t=s.Mouse;return("touch"===e.pointerType||"pen"===e.pointerType||e.touches)&&(t=s.Touch),t}}]),e}(),C=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,i.Z)(this,e),this.deviceType=n,this.deviceSlot=r,this.onInputChangedObservable=new m.y$,this._deviceInputSystem=t}return(0,r.Z)(e,[{key:"getInput",value:function(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)}}]),e}();function x(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var R=function(){function e(t){var n=this;(0,i.Z)(this,e),this._registeredManagers=new Array,this._refCount=0,this.registerManager=function(e){for(var t=0;t<n._devices.length;t++){var i=n._devices[t];for(var r in i){var a=+r;e._addDevice(new C(n._deviceInputSystem,t,a))}}n._registeredManagers.push(e)},this.unregisterManager=function(e){var t=n._registeredManagers.indexOf(e);t>-1&&n._registeredManagers.splice(t,1)};var r=Object.keys(s).length/2;this._devices=new Array(r);var a=function(e,t){n._devices[e]||(n._devices[e]=new Array),n._devices[e][t]||(n._devices[e][t]=t);var i,r=x(n._registeredManagers);try{for(r.s();!(i=r.n()).done;){var a=i.value,o=new C(n._deviceInputSystem,e,t);a._addDevice(o)}}catch(s){r.e(s)}finally{r.f()}},o=function(e,t){var i;null!==(i=n._devices[e])&&void 0!==i&&i[t]&&delete n._devices[e][t];var r,a=x(n._registeredManagers);try{for(a.s();!(r=a.n()).done;){r.value._removeDevice(e,t)}}catch(o){a.e(o)}finally{a.f()}},l=function(e,t,i){if(i){var r,a=x(n._registeredManagers);try{for(a.s();!(r=a.n()).done;){r.value._onInputChanged(e,t,i)}}catch(o){a.e(o)}finally{a.f()}}};"undefined"!=typeof _native?this._deviceInputSystem=new E(a,o,l):this._deviceInputSystem=new P(t,a,o,l)}return(0,r.Z)(e,[{key:"dispose",value:function(){this._deviceInputSystem.dispose()}}]),e}();function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var L=function(){function e(t){var n=this;(0,i.Z)(this,e);var r=Object.keys(s).length/2;this._devices=new Array(r),this._firstDevice=new Array(r),this._engine=t,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new R(t)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new m.y$((function(e){var t,i=k(n._devices);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(r){var a,o=k(r);try{for(o.s();!(a=o.n()).done;){var s=a.value;s&&n.onDeviceConnectedObservable.notifyObserver(e,s)}}catch(l){o.e(l)}finally{o.f()}}}}catch(l){i.e(l)}finally{i.f()}})),this.onDeviceDisconnectedObservable=new m.y$,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=t.onDisposeObservable.add((function(){n.dispose()}))}return(0,r.Z)(e,[{key:"getDeviceSource",value:function(e,t){if(void 0===t){if(void 0===this._firstDevice[e])return null;t=this._firstDevice[e]}return this._devices[e]&&void 0!==this._devices[e][t]?this._devices[e][t]:null}},{key:"getDeviceSources",value:function(e){return this._devices[e]?this._devices[e].filter((function(e){return!!e})):[]}},{key:"dispose",value:function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)}},{key:"_addDevice",value:function(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)}},{key:"_removeDevice",value:function(e,t){var n,i,r=null===(n=this._devices[e])||void 0===n?void 0:n[t];this.onDeviceDisconnectedObservable.notifyObservers(r),null!==(i=this._devices[e])&&void 0!==i&&i[t]&&delete this._devices[e][t],this._updateFirstDevices(e)}},{key:"_onInputChanged",value:function(e,t,n){var i,r;null===(i=this._devices[e])||void 0===i||null===(r=i[t])||void 0===r||r.onInputChangedObservable.notifyObservers(n)}},{key:"_updateFirstDevices",value:function(e){switch(e){case s.Keyboard:case s.Mouse:this._firstDevice[e]=0;break;case s.Touch:case s.DualSense:case s.DualShock:case s.Xbox:case s.Switch:case s.Generic:delete this._firstDevice[e];var t=this._devices[e];if(t)for(var n=0;n<t.length;n++)if(t[n]){this._firstDevice[e]=n;break}}}}]),e}(),F=n(4198);function N(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var B=function(){function e(){(0,i.Z)(this,e),this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return(0,r.Z)(e,[{key:"singleClick",get:function(){return this._singleClick},set:function(e){this._singleClick=e}},{key:"doubleClick",get:function(){return this._doubleClick},set:function(e){this._doubleClick=e}},{key:"hasSwiped",get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e}},{key:"ignore",get:function(){return this._ignore},set:function(e){this._ignore=e}}]),e}(),U=function(){function e(t){(0,i.Z)(this,e),this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new p.FM(0,0),this._previousStartingPointerPosition=new p.FM(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._deviceSourceManager=null,this._scene=t||F.l.LastCreatedScene,this._scene}return(0,r.Z)(e,[{key:"meshUnderPointer",get:function(){return this._pointerOverMesh}},{key:"getMeshUnderPointerByPointerId",value:function(e){return this._meshUnderPointerId[e]||null}},{key:"unTranslatedPointer",get:function(){return new p.FM(this._unTranslatedPointerX,this._unTranslatedPointerY)}},{key:"pointerX",get:function(){return this._pointerX},set:function(e){this._pointerX=e}},{key:"pointerY",get:function(){return this._pointerY},set:function(e){this._pointerY=e}},{key:"_updatePointerPosition",value:function(e){var t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}},{key:"_processPointerMove",value:function(e,t){var n=this._scene,i=n.getEngine(),r=i.getInputElement();r&&(r.tabIndex=i.canvasTabIndex,n.doNotHandleCursors||(r.style.cursor=n.defaultCursor));var o=!!(e&&e.hit&&e.pickedMesh);if(o){if(n.setPointerOverMesh(e.pickedMesh,t.pointerId,e),!n.doNotHandleCursors&&r&&this._pointerOverMesh){var s=this._pointerOverMesh._getActionManagerForTrigger();s&&s.hasPointerTriggers&&(r.style.cursor=s.hoverCursor||n.hoverCursor)}}else n.setPointerOverMesh(null,t.pointerId,e);var u,c=N(n._pointerMoveStage);try{for(c.s();!(u=c.n()).done;){e=u.value.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,o,r)}}catch(d){c.e(d)}finally{c.f()}if(e){var h=t.inputIndex>=l.MouseWheelX&&t.inputIndex<=l.MouseWheelZ?a.kD.POINTERWHEEL:a.kD.POINTERMOVE;if(n.onPointerMove&&n.onPointerMove(t,e,h),n.onPointerObservable.hasObservers()){var f=new a.R5(h,t,e);this._setRayOnPointerInfo(f),n.onPointerObservable.notifyObservers(f,h)}}}},{key:"_setRayOnPointerInfo",value:function(e){var t=this._scene;e.pickInfo&&!e.pickInfo._pickingUnavailable&&(e.pickInfo.ray||(e.pickInfo.ray=t.createPickingRay(e.event.offsetX,e.event.offsetY,p.y3.Identity(),t.activeCamera)))}},{key:"_checkPrePointerObservable",value:function(e,t,n){var i=this._scene,r=new a.FV(n,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(r.originalPickingInfo=e,r.ray=e.ray,e.originMesh&&(r.nearInteractionPickingInfo=e)),i.onPrePointerObservable.notifyObservers(r,n),!!r.skipOnPointerObservable}},{key:"simulatePointerMove",value:function(e,t){var n=new PointerEvent("pointermove",t);n.inputIndex=l.Move,this._checkPrePointerObservable(e,n,a.kD.POINTERMOVE)||this._processPointerMove(e,n)}},{key:"simulatePointerDown",value:function(e,t){var n=new PointerEvent("pointerdown",t);n.inputIndex=n.button+2,this._checkPrePointerObservable(e,n,a.kD.POINTERDOWN)||this._processPointerDown(e,n)}},{key:"_processPointerDown",value:function(t,n){var i=this,r=this._scene;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var o=t.pickedMesh._getActionManagerForTrigger();if(o){if(o.hasPickTriggers)switch(o.processTrigger(5,_.V.CreateNew(t.pickedMesh,n)),n.button){case 0:o.processTrigger(2,_.V.CreateNew(t.pickedMesh,n));break;case 1:o.processTrigger(4,_.V.CreateNew(t.pickedMesh,n));break;case 2:o.processTrigger(3,_.V.CreateNew(t.pickedMesh,n))}o.hasSpecificTrigger(8)&&window.setTimeout((function(){var t=r.pick(i._unTranslatedPointerX,i._unTranslatedPointerY,(function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===i._pickedDownMesh}),!1,r.cameraToUseForPointers);t&&t.hit&&t.pickedMesh&&o&&0!==i._totalPointersPressed&&Date.now()-i._startingPointerTime>e.LongPressDelay&&!i._isPointerSwiping()&&(i._startingPointerTime=0,o.processTrigger(8,_.V.CreateNew(t.pickedMesh,n)))}),e.LongPressDelay)}}else{var s,l=N(r._pointerDownStage);try{for(l.s();!(s=l.n()).done;){t=s.value.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,n,!1)}}catch(h){l.e(h)}finally{l.f()}}if(t){var u=a.kD.POINTERDOWN;if(r.onPointerDown&&r.onPointerDown(n,t,u),r.onPointerObservable.hasObservers()){var c=new a.R5(u,n,t);this._setRayOnPointerInfo(c),r.onPointerObservable.notifyObservers(c,u)}}}},{key:"_isPointerSwiping",value:function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>e.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>e.DragMovementThreshold}},{key:"simulatePointerUp",value:function(e,t,n){var i=new PointerEvent("pointerup",t);i.inputIndex=l.Move;var r=new B;n?r.doubleClick=!0:r.singleClick=!0,this._checkPrePointerObservable(e,i,a.kD.POINTERUP)||this._processPointerUp(e,i,r)}},{key:"_processPointerUp",value:function(e,t,n){var i=this._scene;if(e&&e.hit&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(i.onPointerPick&&i.onPointerPick(t,e),n.singleClick&&!n.ignore&&i.onPointerObservable.hasObservers())){var r=a.kD.POINTERPICK,o=new a.R5(r,t,e);this._setRayOnPointerInfo(o),i.onPointerObservable.notifyObservers(o,r)}var s=e.pickedMesh._getActionManagerForTrigger();if(s&&!n.ignore){s.processTrigger(7,_.V.CreateNew(e.pickedMesh,t,e)),!n.hasSwiped&&n.singleClick&&s.processTrigger(1,_.V.CreateNew(e.pickedMesh,t,e));var l=e.pickedMesh._getActionManagerForTrigger(6);n.doubleClick&&l&&l.processTrigger(6,_.V.CreateNew(e.pickedMesh,t,e))}}else if(!n.ignore){var u,c=N(i._pointerUpStage);try{for(c.s();!(u=c.n()).done;){e=u.value.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,n.doubleClick)}}catch(p){c.e(p)}finally{c.f()}}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var h=this._pickedDownMesh._getActionManagerForTrigger(16);h&&h.processTrigger(16,_.V.CreateNew(this._pickedDownMesh,t))}var f=0;if(i.onPointerObservable.hasObservers()){if(!n.ignore&&!n.hasSwiped&&(n.singleClick&&i.onPointerObservable.hasSpecificMask(a.kD.POINTERTAP)?f=a.kD.POINTERTAP:n.doubleClick&&i.onPointerObservable.hasSpecificMask(a.kD.POINTERDOUBLETAP)&&(f=a.kD.POINTERDOUBLETAP),f)){var d=new a.R5(f,t,e);this._setRayOnPointerInfo(d),i.onPointerObservable.notifyObservers(d,f)}if(!n.ignore){f=a.kD.POINTERUP;var v=new a.R5(f,t,e);this._setRayOnPointerInfo(v),i.onPointerObservable.notifyObservers(v,f)}}i.onPointerUp&&!n.ignore&&i.onPointerUp(t,e,f)}},{key:"isPointerCaptured",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[e]}},{key:"attachControl",value:function(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=this._scene,h=c.getEngine();u||(u=h.getInputElement()),this._alreadyAttached&&this.detachControl(),u&&(this._alreadyAttachedTo=u),this._deviceSourceManager=new L(h),this._initActionManager=function(e){if(!t._meshPickProceed){var n=c.skipPointerUpPicking?null:c.pick(t._unTranslatedPointerX,t._unTranslatedPointerY,c.pointerUpPredicate,!1,c.cameraToUseForPointers);t._currentPickResult=n,n&&(e=n.hit&&n.pickedMesh?n.pickedMesh._getActionManagerForTrigger():null),t._meshPickProceed=!0}return e},this._delayedSimpleClick=function(n,i,r){(Date.now()-t._previousStartingPointerTime>e.DoubleClickDelay&&!t._doubleClickOccured||n!==t._previousButtonPressed)&&(t._doubleClickOccured=!1,i.singleClick=!0,i.ignore=!1,r(i,t._currentPickResult))},this._initClickEvent=function(n,i,r,s){var l=new B;t._currentPickResult=null;var u=null,c=n.hasSpecificMask(a.kD.POINTERPICK)||i.hasSpecificMask(a.kD.POINTERPICK)||n.hasSpecificMask(a.kD.POINTERTAP)||i.hasSpecificMask(a.kD.POINTERTAP)||n.hasSpecificMask(a.kD.POINTERDOUBLETAP)||i.hasSpecificMask(a.kD.POINTERDOUBLETAP);!c&&o&&(u=t._initActionManager(u,l))&&(c=u.hasPickTriggers);var h=!1;if(c){var f=r.button;if(l.hasSwiped=t._isPointerSwiping(),!l.hasSwiped){var d=!e.ExclusiveDoubleClickMode;d||(d=!n.hasSpecificMask(a.kD.POINTERDOUBLETAP)&&!i.hasSpecificMask(a.kD.POINTERDOUBLETAP))&&!o.HasSpecificTrigger(6)&&(u=t._initActionManager(u,l))&&(d=!u.hasSpecificTrigger(6)),d?(Date.now()-t._previousStartingPointerTime>e.DoubleClickDelay||f!==t._previousButtonPressed)&&(l.singleClick=!0,s(l,t._currentPickResult),h=!0):(t._previousDelayedSimpleClickTimeout=t._delayedSimpleClickTimeout,t._delayedSimpleClickTimeout=window.setTimeout(t._delayedSimpleClick.bind(t,f,l,s),e.DoubleClickDelay));var v=n.hasSpecificMask(a.kD.POINTERDOUBLETAP)||i.hasSpecificMask(a.kD.POINTERDOUBLETAP);!v&&o.HasSpecificTrigger(6)&&(u=t._initActionManager(u,l))&&(v=u.hasSpecificTrigger(6)),v&&(f===t._previousButtonPressed&&Date.now()-t._previousStartingPointerTime<e.DoubleClickDelay&&!t._doubleClickOccured?(l.hasSwiped||t._isPointerSwiping()?(t._doubleClickOccured=!1,t._previousStartingPointerTime=t._startingPointerTime,t._previousStartingPointerPosition.x=t._startingPointerPosition.x,t._previousStartingPointerPosition.y=t._startingPointerPosition.y,t._previousButtonPressed=f,e.ExclusiveDoubleClickMode?(t._previousDelayedSimpleClickTimeout&&clearTimeout(t._previousDelayedSimpleClickTimeout),t._previousDelayedSimpleClickTimeout=t._delayedSimpleClickTimeout,s(l,t._previousPickResult)):s(l,t._currentPickResult)):(t._previousStartingPointerTime=0,t._doubleClickOccured=!0,l.doubleClick=!0,l.ignore=!1,e.ExclusiveDoubleClickMode&&t._previousDelayedSimpleClickTimeout&&clearTimeout(t._previousDelayedSimpleClickTimeout),t._previousDelayedSimpleClickTimeout=t._delayedSimpleClickTimeout,s(l,t._currentPickResult)),h=!0):(t._doubleClickOccured=!1,t._previousStartingPointerTime=t._startingPointerTime,t._previousStartingPointerPosition.x=t._startingPointerPosition.x,t._previousStartingPointerPosition.y=t._startingPointerPosition.y,t._previousButtonPressed=f))}}h||s(l,t._currentPickResult)},this._onPointerMove=function(e){if(void 0===e.pointerId&&(e.pointerId=0),t._updatePointerPosition(e),!t._checkPrePointerObservable(null,e,e.inputIndex>=l.MouseWheelX&&e.inputIndex<=l.MouseWheelZ?a.kD.POINTERWHEEL:a.kD.POINTERMOVE)&&(c.cameraToUseForPointers||c.activeCamera))if(c.skipPointerMovePicking)t._processPointerMove(new v.p,e);else{c.pointerMovePredicate||(c.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||c.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!c.cameraToUseForPointers||0!=(c.cameraToUseForPointers.layerMask&e.layerMask))});var n=c.pick(t._unTranslatedPointerX,t._unTranslatedPointerY,c.pointerMovePredicate,!1,c.cameraToUseForPointers,c.pointerMoveTrianglePredicate);t._processPointerMove(n,e)}},this._onPointerDown=function(e){var n;(t._totalPointersPressed++,t._pickedDownMesh=null,t._meshPickProceed=!1,void 0===e.pointerId&&(e.pointerId=0),t._updatePointerPosition(e),c.preventDefaultOnPointerDown&&u&&(e.preventDefault(),u.focus()),t._startingPointerPosition.x=t._pointerX,t._startingPointerPosition.y=t._pointerY,t._startingPointerTime=Date.now(),t._checkPrePointerObservable(null,e,a.kD.POINTERDOWN))||(c.cameraToUseForPointers||c.activeCamera)&&(t._pointerCaptures[e.pointerId]=!0,c.pointerDownPredicate||(c.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!c.cameraToUseForPointers||0!=(c.cameraToUseForPointers.layerMask&e.layerMask))}),t._pickedDownMesh=null,n=c.skipPointerDownPicking?new v.p:c.pick(t._unTranslatedPointerX,t._unTranslatedPointerY,c.pointerDownPredicate,!1,c.cameraToUseForPointers),t._processPointerDown(n,e))},this._onPointerUp=function(e){0!==t._totalPointersPressed&&(t._totalPointersPressed--,t._pickedUpMesh=null,t._meshPickProceed=!1,void 0===e.pointerId&&(e.pointerId=0),t._updatePointerPosition(e),c.preventDefaultOnPointerUp&&u&&(e.preventDefault(),u.focus()),t._initClickEvent(c.onPrePointerObservable,c.onPointerObservable,e,(function(n,i){if(c.onPrePointerObservable.hasObservers()&&!n.ignore){if(!n.hasSwiped){if(n.singleClick&&c.onPrePointerObservable.hasSpecificMask(a.kD.POINTERTAP)&&t._checkPrePointerObservable(null,e,a.kD.POINTERTAP))return;if(n.doubleClick&&c.onPrePointerObservable.hasSpecificMask(a.kD.POINTERDOUBLETAP)&&t._checkPrePointerObservable(null,e,a.kD.POINTERDOUBLETAP))return}if(t._checkPrePointerObservable(null,e,a.kD.POINTERUP))return}t._pointerCaptures[e.pointerId]=!1,(c.cameraToUseForPointers||c.activeCamera)&&(c.pointerUpPredicate||(c.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!c.cameraToUseForPointers||0!=(c.cameraToUseForPointers.layerMask&e.layerMask))}),!t._meshPickProceed&&(o&&o.HasTriggers||c.onPointerObservable.hasObservers())&&t._initActionManager(null,n),i||(i=t._currentPickResult),t._processPointerUp(i,e,n),t._previousPickResult=t._currentPickResult)})))},this._onKeyDown=function(e){var t=g.OG.KEYDOWN;if(c.onPreKeyboardObservable.hasObservers()){var n=new g.WZ(t,e);if(c.onPreKeyboardObservable.notifyObservers(n,t),n.skipOnKeyboardObservable)return}if(c.onKeyboardObservable.hasObservers()){var i=new g.NG(t,e);c.onKeyboardObservable.notifyObservers(i,t)}c.actionManager&&c.actionManager.processTrigger(14,_.V.CreateNewFromScene(c,e))},this._onKeyUp=function(e){var t=g.OG.KEYUP;if(c.onPreKeyboardObservable.hasObservers()){var n=new g.WZ(t,e);if(c.onPreKeyboardObservable.notifyObservers(n,t),n.skipOnKeyboardObservable)return}if(c.onKeyboardObservable.hasObservers()){var i=new g.NG(t,e);c.onKeyboardObservable.notifyObservers(i,t)}c.actionManager&&c.actionManager.processTrigger(15,_.V.CreateNewFromScene(c,e))},this._deviceSourceManager.onDeviceConnectedObservable.add((function(e){e.deviceType===s.Mouse?e.onInputChangedObservable.add((function(a){a.inputIndex===l.LeftClick||a.inputIndex===l.MiddleClick||a.inputIndex===l.RightClick||a.inputIndex===l.BrowserBack||a.inputIndex===l.BrowserForward?i&&1===e.getInput(a.inputIndex)?t._onPointerDown(a):n&&0===e.getInput(a.inputIndex)&&t._onPointerUp(a):r&&(a.inputIndex===l.Move?t._onPointerMove(a):a.inputIndex!==l.MouseWheelX&&a.inputIndex!==l.MouseWheelY&&a.inputIndex!==l.MouseWheelZ||t._onPointerMove(a))})):e.deviceType===s.Touch?e.onInputChangedObservable.add((function(a){a.inputIndex===l.LeftClick&&(i&&1===e.getInput(a.inputIndex)?t._onPointerDown(a):n&&0===e.getInput(a.inputIndex)&&t._onPointerUp(a)),r&&a.inputIndex===l.Move&&t._onPointerMove(a)})):e.deviceType===s.Keyboard&&e.onInputChangedObservable.add((function(e){"keydown"===e.type?t._onKeyDown(e):"keyup"===e.type&&t._onKeyUp(e)}))})),this._alreadyAttached=!0}},{key:"detachControl",value:function(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}},{key:"setPointerOverMesh",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(this._meshUnderPointerId[t]!==e){var i,r=this._meshUnderPointerId[t];r&&(i=r._getActionManagerForTrigger(10))&&i.processTrigger(10,_.V.CreateNew(r,void 0,{pointerId:t})),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,(i=e._getActionManagerForTrigger(9))&&i.processTrigger(9,_.V.CreateNew(e,void 0,{pointerId:t,pickResult:n}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null)}}},{key:"getPointerOverMesh",value:function(){return this._pointerOverMesh}},{key:"_invalidateMesh",value:function(e){for(var t in this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null),this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]}}]),e}();U.DragMovementThreshold=10,U.LongPressDelay=500,U.DoubleClickDelay=300,U.ExclusiveDoubleClickMode=!1},1221:function(e,t,n){"use strict";n.d(t,{m:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"CompareLightsPriority",value:function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority}}]),e}();a.FALLOFF_DEFAULT=0,a.FALLOFF_PHYSICAL=1,a.FALLOFF_GLTF=2,a.FALLOFF_STANDARD=3,a.LIGHTMAP_DEFAULT=0,a.LIGHTMAP_SPECULAR=1,a.LIGHTMAP_SHADOWSONLY=2,a.INTENSITYMODE_AUTOMATIC=0,a.INTENSITYMODE_LUMINOUSPOWER=1,a.INTENSITYMODE_LUMINOUSINTENSITY=2,a.INTENSITYMODE_ILLUMINANCE=3,a.INTENSITYMODE_LUMINANCE=4,a.LIGHTTYPEID_POINTLIGHT=0,a.LIGHTTYPEID_DIRECTIONALLIGHT=1,a.LIGHTTYPEID_SPOTLIGHT=2,a.LIGHTTYPEID_HEMISPHERICLIGHT=3},6639:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"ForceFullSceneLoadingForIncremental",get:function(){return e._ForceFullSceneLoadingForIncremental},set:function(t){e._ForceFullSceneLoadingForIncremental=t}},{key:"ShowLoadingScreen",get:function(){return e._ShowLoadingScreen},set:function(t){e._ShowLoadingScreen=t}},{key:"loggingLevel",get:function(){return e._LoggingLevel},set:function(t){e._LoggingLevel=t}},{key:"CleanBoneMatrixWeights",get:function(){return e._CleanBoneMatrixWeights},set:function(t){e._CleanBoneMatrixWeights=t}}]),e}();a._ForceFullSceneLoadingForIncremental=!1,a._ShowLoadingScreen=!0,a._CleanBoneMatrixWeights=!1,a._LoggingLevel=0},1889:function(e,t,n){"use strict";n.d(t,{l:function(){return f},S:function(){return i}});var i,r=n(5671),a=n(3144),o=n(136),s=n(6215),l=n(1120),u=n(4174),c=function(){function e(){(0,r.Z)(this,e),this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}return(0,a.Z)(e,[{key:"wrapU",get:function(){return this._cachedWrapU},set:function(e){this._cachedWrapU=e}},{key:"wrapV",get:function(){return this._cachedWrapV},set:function(e){this._cachedWrapV=e}},{key:"wrapR",get:function(){return this._cachedWrapR},set:function(e){this._cachedWrapR=e}},{key:"anisotropicFilteringLevel",get:function(){return this._cachedAnisotropicFilteringLevel},set:function(e){this._cachedAnisotropicFilteringLevel=e}},{key:"comparisonFunction",get:function(){return this._comparisonFunction},set:function(e){this._comparisonFunction=e}},{key:"useMipMaps",get:function(){return this._useMipMaps},set:function(e){this._useMipMaps=e}},{key:"setParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=n,this._cachedAnisotropicFilteringLevel=i,this.samplingMode=r,this._comparisonFunction=a,this}},{key:"compareSampler",value:function(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}}]),e}();function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,l.Z)(e);if(t){var r=(0,l.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,s.Z)(this,n)}}!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.DepthStencil=12]="DepthStencil",e[e.CubeRawRGBD=13]="CubeRawRGBD",e[e.Depth=14]="Depth"}(i||(i={}));var f=function(e){(0,o.Z)(n,e);var t=h(n);function n(e,a){var o,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,r.Z)(this,n),(o=t.call(this)).isReady=!1,o.isCube=!1,o.is3D=!1,o.is2DArray=!1,o.isMultiview=!1,o.url="",o.generateMipMaps=!1,o.samples=0,o.type=-1,o.format=-1,o.onLoadedObservable=new u.y$,o.onErrorObservable=new u.y$,o.onRebuildCallback=null,o.width=0,o.height=0,o.depth=0,o.baseWidth=0,o.baseHeight=0,o.baseDepth=0,o.invertY=!1,o._invertVScale=!1,o._associatedChannel=-1,o._source=i.Unknown,o._buffer=null,o._bufferView=null,o._bufferViewArray=null,o._bufferViewArrayArray=null,o._size=0,o._extension="",o._files=null,o._workingCanvas=null,o._workingContext=null,o._cachedCoordinatesMode=null,o._isDisabled=!1,o._compression=null,o._sphericalPolynomial=null,o._sphericalPolynomialPromise=null,o._sphericalPolynomialComputed=!1,o._lodGenerationScale=0,o._lodGenerationOffset=0,o._useSRGBBuffer=!1,o._lodTextureHigh=null,o._lodTextureMid=null,o._lodTextureLow=null,o._isRGBD=!1,o._linearSpecularLOD=!1,o._irradianceTexture=null,o._hardwareTexture=null,o._maxLodLevel=null,o._references=1,o._gammaSpace=null,o._engine=e,o._source=a,o._uniqueId=n._Counter++,s||(o._hardwareTexture=e._createHardwareTexture()),o}return(0,a.Z)(n,[{key:"useMipMaps",get:function(){return this.generateMipMaps},set:function(e){this.generateMipMaps=e}},{key:"uniqueId",get:function(){return this._uniqueId}},{key:"getEngine",value:function(){return this._engine}},{key:"source",get:function(){return this._source}},{key:"incrementReferences",value:function(){this._references++}},{key:"updateSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,e,t,n),this.width=e,this.height=t,this.depth=n,this.baseWidth=e,this.baseHeight=t,this.baseDepth=n,this._size=e*t*n}},{key:"_rebuild",value:function(){var e,t=this;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){var n=this.onRebuildCallback(this),r=function(e){e._swapAndDie(t,!1),t.isReady=n.isReady};n.isAsync?n.proxy.then(r):r(n.proxy)}else{var a;switch(this.source){case i.Temp:break;case i.Url:return void(a=this._engine.createTexture(null!==(e=this._originalUrl)&&void 0!==e?e:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){a._swapAndDie(t,!1),t.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case i.Raw:(a=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer))._swapAndDie(this,!1),this.isReady=!0;break;case i.Raw3D:(a=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case i.Raw2DArray:(a=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case i.Dynamic:(a=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case i.Cube:return void(a=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){a._swapAndDie(t,!1),t.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer));case i.CubeRaw:(a=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this,!1),this.isReady=!0;break;case i.CubeRawRGBD:return;case i.CubePrefiltered:return void((a=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(e){e&&e._swapAndDie(t,!1),t.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}}}},{key:"_swapAndDie",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(t=this._hardwareTexture)||void 0===t||t.setUsage(e._source,this.generateMipMaps,this.isCube,this.width,this.height),e._hardwareTexture=this._hardwareTexture,n&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var i=this._engine.getLoadedTexturesCache(),r=i.indexOf(this);-1!==r&&i.splice(r,1),-1===(r=i.indexOf(e))&&i.push(e)}},{key:"dispose",value:function(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null)}}]),n}(c);f._Counter=0},8618:function(e,t,n){"use strict";n.d(t,{q:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,i.Z)(this,e),this.effect=null,this.defines=null,this.drawContext=t.createDrawContext(),n&&(this.materialContext=t.createMaterialContext())}return(0,r.Z)(e,[{key:"setEffect",value:function(e,t){var n,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(this.effect=e,void 0!==t&&(this.defines=t),i)&&(null===(n=this.drawContext)||void 0===n||n.reset())}},{key:"dispose",value:function(){var e;null===(e=this.drawContext)||void 0===e||e.dispose()}}],[{key:"IsWrapper",value:function(e){return void 0===e.getPipelineContext}},{key:"GetEffect",value:function(e){return void 0===e.getPipelineContext?e.effect:e}}]),e}()},8977:function(e,t,n){"use strict";n.d(t,{Q:function(){return v}});var i=n(885),r=n(5671),a=n(3144),o=n(4174),s=n(5092),l=n(2328),u=n(9776),c=n(8084),h=n(2223);function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var v=function(){function e(t,n,i){var a=this,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,_=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,g=arguments.length>9?arguments[9]:void 0,m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:h.x.GLSL;(0,r.Z)(this,e),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new o.y$,this.onErrorObservable=new o.y$,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._wasPreviouslyUsingInstances=null,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=t,this._key=m;var A,E,b=void 0,T=null;if(n.attributes){var S,M,I,P=n;if(this._engine=i,this._attributesNames=P.attributes,this._uniformsNames=P.uniformsNames.concat(P.samplers),this._samplerList=P.samplers.slice(),this.defines=P.defines,this.onError=P.onError,this.onCompiled=P.onCompiled,this._fallbacks=P.fallbacks,this._indexParameters=P.indexParameters,this._transformFeedbackVaryings=P.transformFeedbackVaryings||null,this._multiTarget=!!P.multiTarget,this._shaderLanguage=null!==(S=P.shaderLanguage)&&void 0!==S?S:h.x.GLSL,P.uniformBuffersNames){this._uniformBuffersNamesList=P.uniformBuffersNames.slice();for(var C=0;C<P.uniformBuffersNames.length;C++)this._uniformBuffersNames[P.uniformBuffersNames[C]]=C}T=null!==(M=P.processFinalCode)&&void 0!==M?M:null,b=null!==(I=P.processCodeAfterIncludes)&&void 0!==I?I:void 0}else this._engine=f,this.defines=null==d?"":d,this._uniformsNames=i.concat(l),this._samplerList=l?l.slice():[],this._attributesNames=n,this._uniformBuffersNamesList=[],this._shaderLanguage=y,this.onError=_,this.onCompiled=p,this._indexParameters=g,this._fallbacks=v;this._attributeLocationByName={},this.uniqueId=e._UniqueIdSeed++;var x=(0,s.CG)()?this._engine.getHostDocument():null;t.vertexSource?A="source:"+t.vertexSource:t.vertexElement?(A=x?x.getElementById(t.vertexElement):null)||(A=t.vertexElement):A=t.vertex||t,t.fragmentSource?E="source:"+t.fragmentSource:t.fragmentElement?(E=x?x.getElementById(t.fragmentElement):null)||(E=t.fragmentElement):E=t.fragment||t,this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);var D={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:c.v.GetShadersRepository(this._shaderLanguage),includesShadersStore:c.v.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:b},R=[void 0,void 0],k=function(){if(R[0]&&R[1]){D.isFragment=!0;var e=R[0],n=R[1];u.L.Process(n,D,(function(n){T&&(n=T("fragment",n));var i=u.L.Finalize(e,n,D);a._useFinalCode(i.vertexCode,i.fragmentCode,t)}),a._engine)}};this._loadShader(A,"Vertex","",(function(e){u.L.Initialize(D),u.L.Process(e,D,(function(t){a._rawVertexSourceCode=e,T&&(t=T("vertex",t)),R[0]=t,k()}),a._engine)})),this._loadShader(E,"Fragment","Pixel",(function(e){a._rawFragmentSourceCode=e,R[1]=e,k()}));var O=function(e){return function(){if(this._pipelineContext){var t=this._pipelineContext[e];t.apply(this._pipelineContext,arguments)}return this}};["Int?","IntArray?","Array?","Color?","Vector?","Float?","Matrices","Matrix","Matrix3x3","Matrix2x2","Quaternion","DirectColor4"].forEach((function(e){var t="set".concat(e);t.endsWith("?")?["",2,3,4].forEach((function(e){a[t.slice(0,-1)+e]=a[t.slice(0,-1)+e]||O(t.slice(0,-1)+e).bind(a)})):a[t]=a[t]||O(t).bind(a)}))}return(0,a.Z)(e,[{key:"onBindObservable",get:function(){return this._onBindObservable||(this._onBindObservable=new o.y$),this._onBindObservable}},{key:"_useFinalCode",value:function(e,t,n){if(n){var i=n.vertexElement||n.vertex||n.spectorName||n,r=n.fragmentElement||n.fragment||n.spectorName||n;this._vertexSourceCode=(this._shaderLanguage===h.x.WGSL?"//":"")+"#define SHADER_NAME vertex:"+i+"\n"+e,this._fragmentSourceCode=(this._shaderLanguage===h.x.WGSL?"//":"")+"#define SHADER_NAME fragment:"+r+"\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()}},{key:"key",get:function(){return this._key}},{key:"isReady",value:function(){try{return this._isReadyInternal()}catch(e){return!1}}},{key:"_isReadyInternal",value:function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady}},{key:"getEngine",value:function(){return this._engine}},{key:"getPipelineContext",value:function(){return this._pipelineContext}},{key:"getAttributesNames",value:function(){return this._attributesNames}},{key:"getAttributeLocation",value:function(e){return this._attributes[e]}},{key:"getAttributeLocationByName",value:function(e){return this._attributeLocationByName[e]}},{key:"getAttributesCount",value:function(){return this._attributes.length}},{key:"getUniformIndex",value:function(e){return this._uniformsNames.indexOf(e)}},{key:"getUniform",value:function(e){return this._uniforms[e]}},{key:"getSamplers",value:function(){return this._samplerList}},{key:"getUniformNames",value:function(){return this._uniformsNames}},{key:"getUniformBuffersNames",value:function(){return this._uniformBuffersNamesList}},{key:"getIndexParameters",value:function(){return this._indexParameters}},{key:"getCompilationError",value:function(){return this._compilationError}},{key:"allFallbacksProcessed",value:function(){return this._allFallbacksProcessed}},{key:"executeWhenCompiled",value:function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add((function(t){e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){t._checkIsReady(null)}),16))}},{key:"_checkIsReady",value:function(e){var t=this;try{if(this._isReadyInternal())return}catch(n){return void this._processCompilationErrors(n,e)}this._isDisposed||setTimeout((function(){t._checkIsReady(e)}),16)}},{key:"_loadShader",value:function(e,t,n,i){if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return void i((0,s.v)(e));if("source:"!==e.substr(0,7))if("base64:"!==e.substr(0,7)){var r,a=c.v.GetShadersStore(this._shaderLanguage);if(a[e+t+"Shader"])i(a[e+t+"Shader"]);else if(n&&a[e+n+"Shader"])i(a[e+n+"Shader"]);else r="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:c.v.GetShadersRepository(this._shaderLanguage)+e,this._engine._loadFile(r+"."+t.toLowerCase()+".fx",i)}else{i(window.atob(e.substr(7)))}else i(e.substr(7))}},{key:"vertexSourceCode",get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(e=null===(t=this._pipelineContext)||void 0===t?void 0:t._getVertexShaderCode())&&void 0!==e?e:this._vertexSourceCode}},{key:"fragmentSourceCode",get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(e=null===(t=this._pipelineContext)||void 0===t?void 0:t._getFragmentShaderCode())&&void 0!==e?e:this._fragmentSourceCode}},{key:"rawVertexSourceCode",get:function(){return this._rawVertexSourceCode}},{key:"rawFragmentSourceCode",get:function(){return this._rawFragmentSourceCode}},{key:"_rebuildProgram",value:function(e,t,n,i){var r=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){i&&i(t)},this.onCompiled=function(){var e=r.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);r._pipelineContext._handlesSpectorRebuildCallback(n)},this._fallbacks=null,this._prepareEffect()}},{key:"_prepareEffect",value:function(){var e=this,t=this._attributesNames,n=this.defines,i=this._pipelineContext;this._isReady=!1;try{var r=this._engine;this._pipelineContext=r.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;var a=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?r._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,a,null,this._transformFeedbackVaryings,this._key):r._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,a,n,this._transformFeedbackVaryings,this._key),r._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(e._attributes=[],e._pipelineContext._fillEffectInformation(e,e._uniformBuffersNames,e._uniformsNames,e._uniforms,e._samplerList,e._samplers,t,e._attributes),t)for(var n=0;n<t.length;n++){var a=t[n];e._attributeLocationByName[a]=e._attributes[n]}r.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),i&&e.getEngine()._deletePipelineContext(i)})),this._pipelineContext.isAsync&&this._checkIsReady(i)}catch(o){this._processCompilationErrors(o,i)}}},{key:"_getShaderCodeAndErrorLine",value:function(e,t,n){var i=n?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,r=null;if(t&&e){var a=t.match(i);if(a&&2===a.length){var o=parseInt(a[1]),s=e.split("\n",-1);s.length>=o&&(r="Offending line [".concat(o,"] in ").concat(n?"fragment":"vertex"," code: ").concat(s[o-1]))}}return[e,r]}},{key:"_processCompilationErrors",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=t.message;var a=this._attributesNames,o=this._fallbacks;if(l.Y.Error("Unable to compile effect:"),l.Y.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),l.Y.Error("Attributes: "+a.map((function(e){return" "+e}))),l.Y.Error("Defines:\r\n"+this.defines),e.LogShaderCodeOnCompilationError){var s,u,c=null,h=null,f=null;if(null!==(s=this._pipelineContext)&&void 0!==s&&s._getVertexShaderCode()){var d=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),v=(0,i.Z)(d,2);f=v[0],c=v[1],f&&(l.Y.Error("Vertex code:"),l.Y.Error(f))}if(null!==(u=this._pipelineContext)&&void 0!==u&&u._getFragmentShaderCode()){var p,_=this._getShaderCodeAndErrorLine(null===(p=this._pipelineContext)||void 0===p?void 0:p._getFragmentShaderCode(),this._compilationError,!0),g=(0,i.Z)(_,2);f=g[0],h=g[1],f&&(l.Y.Error("Fragment code:"),l.Y.Error(f))}c&&l.Y.Error(c),h&&l.Y.Error(h)}l.Y.Error("Error: "+this._compilationError);var m=function(){n.onError&&n.onError(n,n._compilationError),n.onErrorObservable.notifyObservers(n)};r&&(this._pipelineContext=r,this._isReady=!0,m()),o?(this._pipelineContext=null,o.hasMoreFallbacks?(this._allFallbacksProcessed=!1,l.Y.Error("Trying next fallback."),this.defines=o.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,m(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,r||m())}},{key:"isSupported",get:function(){return""===this._compilationError}},{key:"_bindTexture",value:function(e,t){this._engine._bindTexture(this._samplers[e],t,e)}},{key:"setTexture",value:function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}},{key:"setDepthStencilTexture",value:function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)}},{key:"setTextureArray",value:function(e,t){var n=e+"Ex";if(-1===this._samplerList.indexOf(n+"0")){for(var i=this._samplerList.indexOf(e),r=1;r<t.length;r++){var a=n+(r-1).toString();this._samplerList.splice(i+r,0,a)}var o,s=0,l=f(this._samplerList);try{for(l.s();!(o=l.n()).done;){var u=o.value;this._samplers[u]=s,s+=1}}catch(c){l.e(c)}finally{l.f()}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}},{key:"setTextureFromPostProcess",value:function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)}},{key:"setTextureFromPostProcessOutput",value:function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)}},{key:"bindUniformBuffer",value:function(t,n){var i=this._uniformBuffersNames[n];void 0===i||e._BaseCache[i]===t&&this._engine._features.useUBOBindingCache||(e._BaseCache[i]=t,this._engine.bindUniformBufferBase(t,i,n))}},{key:"bindUniformBlock",value:function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}},{key:"setFloatArray",value:function(e,t){return this._pipelineContext.setArray(e,t),this}},{key:"setFloatArray2",value:function(e,t){return this._pipelineContext.setArray2(e,t),this}},{key:"setFloatArray3",value:function(e,t){return this._pipelineContext.setArray3(e,t),this}},{key:"setFloatArray4",value:function(e,t){return this._pipelineContext.setArray4(e,t),this}},{key:"setBool",value:function(e,t){return this._pipelineContext.setInt(e,t?1:0),this}},{key:"dispose",value:function(){var e;null===(e=this._pipelineContext)||void 0===e||e.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0}}],[{key:"ShadersRepository",get:function(){return c.v.ShadersRepository},set:function(e){c.v.ShadersRepository=e}},{key:"RegisterShader",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.x.GLSL;t&&(c.v.GetShadersStore(i)["".concat(e,"PixelShader")]=t),n&&(c.v.GetShadersStore(i)["".concat(e,"VertexShader")]=n)}},{key:"ResetCache",value:function(){e._BaseCache={}}}]),e}();v.LogShaderCodeOnCompilationError=!0,v._UniqueIdSeed=0,v._BaseCache={},v.ShadersStore=c.v.ShadersStore,v.IncludesShadersStore=c.v.IncludesShadersStore},7823:function(e,t,n){"use strict";n.d(t,{$:function(){return h}});var i=n(3144),r=n(5671),a=n(9477),o=n(9336),s=n(4174),l=n(8517),u=n(7046),c=(n(4771),function(){function e(){(0,r.Z)(this,e),this._dirty=!0,this._tempColor=new u.HE(0,0,0,0),this._globalCurve=new u.HE(0,0,0,0),this._highlightsCurve=new u.HE(0,0,0,0),this._midtonesCurve=new u.HE(0,0,0,0),this._shadowsCurve=new u.HE(0,0,0,0),this._positiveCurve=new u.HE(0,0,0,0),this._negativeCurve=new u.HE(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return(0,i.Z)(e,[{key:"globalHue",get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0}},{key:"globalDensity",get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0}},{key:"globalSaturation",get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0}},{key:"globalExposure",get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0}},{key:"highlightsHue",get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0}},{key:"highlightsDensity",get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0}},{key:"highlightsSaturation",get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0}},{key:"highlightsExposure",get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0}},{key:"midtonesHue",get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0}},{key:"midtonesDensity",get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0}},{key:"midtonesSaturation",get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0}},{key:"midtonesExposure",get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0}},{key:"shadowsHue",get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0}},{key:"shadowsDensity",get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0}},{key:"shadowsSaturation",get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0}},{key:"shadowsExposure",get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0}},{key:"getClassName",value:function(){return"ColorCurves"}},{key:"_getColorGradingDataToRef",value:function(t,n,i,r,a){null!=t&&(t=e._Clamp(t,0,360),n=e._Clamp(n,-100,100),i=e._Clamp(i,-100,100),r=e._Clamp(r,-100,100),n=e._ApplyColorGradingSliderNonlinear(n),n*=.5,r=e._ApplyColorGradingSliderNonlinear(r),n<0&&(n*=-1,t=(t+180)%360),e._FromHSBToRef(t,n,50+.25*r,a),a.scaleToRef(2,a),a.a=1+.01*i)}},{key:"clone",value:function(){return o.p4.Clone((function(){return new e}),this)}},{key:"serialize",value:function(){return o.p4.Serialize(this)}}],[{key:"Bind",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(n,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(i,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(r,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))}},{key:"PrepareUniforms",value:function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}},{key:"_ApplyColorGradingSliderNonlinear",value:function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100}},{key:"_FromHSBToRef",value:function(t,n,i,r){var a=e._Clamp(t,0,360),o=e._Clamp(n/100,0,1),s=e._Clamp(i/100,0,1);if(0===o)r.r=s,r.g=s,r.b=s;else{a/=60;var l=Math.floor(a),u=a-l,c=s*(1-o),h=s*(1-o*u),f=s*(1-o*(1-u));switch(l){case 0:r.r=s,r.g=f,r.b=c;break;case 1:r.r=h,r.g=s,r.b=c;break;case 2:r.r=c,r.g=s,r.b=f;break;case 3:r.r=c,r.g=h,r.b=s;break;case 4:r.r=f,r.g=c,r.b=s;break;default:r.r=s,r.g=c,r.b=h}}r.a=1}},{key:"_Clamp",value:function(e,t,n){return Math.min(Math.max(e,t),n)}},{key:"Parse",value:function(t){return o.p4.Parse((function(){return new e}),t,null,null)}}]),e}());(0,a.gn)([(0,o.qC)()],c.prototype,"_globalHue",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_globalDensity",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_globalSaturation",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_globalExposure",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_highlightsHue",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_highlightsDensity",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_highlightsSaturation",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_highlightsExposure",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_midtonesHue",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_midtonesDensity",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_midtonesSaturation",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_midtonesExposure",void 0),o.p4._ColorCurvesParser=c.Parse;var h=function(){function e(){(0,r.Z)(this,e),this.colorCurves=new c,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new u.HE(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new s.y$}return(0,i.Z)(e,[{key:"colorCurvesEnabled",get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())}},{key:"colorGradingTexture",get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())}},{key:"colorGradingEnabled",get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())}},{key:"colorGradingWithGreenDepth",get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())}},{key:"colorGradingBGR",get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())}},{key:"exposure",get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())}},{key:"toneMappingEnabled",get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())}},{key:"toneMappingType",get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())}},{key:"contrast",get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())}},{key:"vignetteBlendMode",get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())}},{key:"vignetteEnabled",get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())}},{key:"ditheringEnabled",get:function(){return this._ditheringEnabled},set:function(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._updateParameters())}},{key:"ditheringIntensity",get:function(){return this._ditheringIntensity},set:function(e){this._ditheringIntensity!==e&&(this._ditheringIntensity=e,this._updateParameters())}},{key:"skipFinalColorClamp",get:function(){return this._skipFinalColorClamp},set:function(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())}},{key:"applyByPostProcess",get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())}},{key:"isEnabled",get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())}},{key:"_updateParameters",value:function(){this.onUpdateParameters.notifyObservers(this)}},{key:"getClassName",value:function(){return"ImageProcessingConfiguration"}},{key:"prepareDefines",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n!==this.applyByPostProcess||!this._isEnabled)return t.VIGNETTE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.DITHER=!1,t.IMAGEPROCESSING=!1,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,t.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType===e.TONEMAPPING_ACES)t.TONEMAPPING_ACES=!0;else t.TONEMAPPING_ACES=!1;t.CONTRAST=1!==this.contrast,t.EXPOSURE=1!==this.exposure,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.DITHER=this._ditheringEnabled,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,t.IMAGEPROCESSING=t.VIGNETTE||t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING||t.DITHER}},{key:"isReady",value:function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}},{key:"bind",value:function(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&c.Bind(this.colorCurves,e),this._vignetteEnabled||this._ditheringEnabled){var n=1/e.getEngine().getRenderWidth(),i=1/e.getEngine().getRenderHeight();if(e.setFloat2("vInverseScreenSize",n,i),this._ditheringEnabled&&e.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){var r=null!=t?t:i/n,a=Math.tan(.5*this.vignetteCameraFov),o=a*r,s=Math.sqrt(o*a);o=l.w1.Mix(o,s,this.vignetteStretch),a=l.w1.Mix(a,s,this.vignetteStretch),e.setFloat4("vignetteSettings1",o,a,-o*this.vignetteCentreX,-a*this.vignetteCentreY);var u=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,u)}}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);var h=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(h-1)/h,.5/h,h,this.colorGradingTexture.level)}}},{key:"clone",value:function(){return o.p4.Clone((function(){return new e}),this)}},{key:"serialize",value:function(){return o.p4.Serialize(this)}}],[{key:"PrepareUniforms",value:function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),(t.VIGNETTE||t.DITHER)&&e.push("vInverseScreenSize"),t.VIGNETTE&&(e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&c.PrepareUniforms(e),t.DITHER&&e.push("ditherIntensity")}},{key:"PrepareSamplers",value:function(e,t){t.COLORGRADING&&e.push("txColorTransform")}},{key:"Parse",value:function(t){return o.p4.Parse((function(){return new e}),t,null,null)}},{key:"VIGNETTEMODE_MULTIPLY",get:function(){return this._VIGNETTEMODE_MULTIPLY}},{key:"VIGNETTEMODE_OPAQUE",get:function(){return this._VIGNETTEMODE_OPAQUE}}]),e}();h.TONEMAPPING_STANDARD=0,h.TONEMAPPING_ACES=1,h._VIGNETTEMODE_MULTIPLY=0,h._VIGNETTEMODE_OPAQUE=1,(0,a.gn)([(0,o.N$)()],h.prototype,"colorCurves",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_colorCurvesEnabled",void 0),(0,a.gn)([(0,o.oU)("colorGradingTexture")],h.prototype,"_colorGradingTexture",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_colorGradingEnabled",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_colorGradingWithGreenDepth",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_colorGradingBGR",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_exposure",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_toneMappingEnabled",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_toneMappingType",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_contrast",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"vignetteStretch",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"vignetteCentreX",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"vignetteCentreY",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"vignetteWeight",void 0),(0,a.gn)([(0,o.XX)()],h.prototype,"vignetteColor",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"vignetteCameraFov",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_vignetteBlendMode",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_vignetteEnabled",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_ditheringEnabled",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_ditheringIntensity",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_skipFinalColorClamp",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_applyByPostProcess",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_isEnabled",void 0),o.p4._ImageProcessingConfigurationParser=h.Parse},6556:function(e,t,n){"use strict";n.d(t,{F:function(){return b}});var i=n(4942),r=n(5671),a=n(3144),o=n(9477),s=n(9336),l=n(8517),u=n(4174),c=n(4198),h=n(65),f=n(1952),d=n(2328),v=n(3683),p=n(114),_=n(8618),g=function(){function e(){(0,r.Z)(this,e),this.reset()}return(0,a.Z)(e,[{key:"reset",value:function(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}},{key:"func",get:function(){return this._func},set:function(e){this._func=e}},{key:"funcRef",get:function(){return this._funcRef},set:function(e){this._funcRef=e}},{key:"funcMask",get:function(){return this._funcMask},set:function(e){this._funcMask=e}},{key:"opStencilFail",get:function(){return this._opStencilFail},set:function(e){this._opStencilFail=e}},{key:"opDepthFail",get:function(){return this._opDepthFail},set:function(e){this._opDepthFail=e}},{key:"opStencilDepthPass",get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass=e}},{key:"mask",get:function(){return this._mask},set:function(e){this._mask=e}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"getClassName",value:function(){return"MaterialStencilState"}},{key:"copyTo",value:function(e){s.p4.Clone((function(){return e}),this)}},{key:"serialize",value:function(){return s.p4.Serialize(this)}},{key:"parse",value:function(e,t,n){var i=this;s.p4.Parse((function(){return i}),e,t,n)}}]),e}();(0,o.gn)([(0,s.qC)()],g.prototype,"func",null),(0,o.gn)([(0,s.qC)()],g.prototype,"funcRef",null),(0,o.gn)([(0,s.qC)()],g.prototype,"funcMask",null),(0,o.gn)([(0,s.qC)()],g.prototype,"opStencilFail",null),(0,o.gn)([(0,s.qC)()],g.prototype,"opDepthFail",null),(0,o.gn)([(0,s.qC)()],g.prototype,"opStencilDepthPass",null),(0,o.gn)([(0,s.qC)()],g.prototype,"mask",null),(0,o.gn)([(0,s.qC)()],g.prototype,"enabled",null);var m=n(4071);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var b=function(){function e(t,n,i){(0,r.Z)(this,e),this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new u.y$,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new g,this._useUBO=!1,this._fillMode=e.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=function(){},this._callbackPluginEventIsReadyForSubMesh=function(){},this._callbackPluginEventPrepareDefines=function(){},this._callbackPluginEventPrepareDefinesBeforeAttributes=function(){},this._callbackPluginEventHardBindForSubMesh=function(){},this._callbackPluginEventBindForSubMesh=function(){},this._callbackPluginEventHasRenderTargetTextures=function(){},this._callbackPluginEventFillRenderTargetTextures=function(){},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=t;var a=n||c.l.LastCreatedScene;a&&(this._scene=a,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=t||l.w1.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new _.q(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._scene.useRightHandedSystem?this.sideOrientation=e.ClockWiseSideOrientation:this.sideOrientation=e.CounterClockWiseSideOrientation,this._uniformBuffer=new f.M(this._scene.getEngine(),void 0,void 0,t),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),e.OnEventObservable.notifyObservers(this,m.S.Created))}return(0,a.Z)(e,[{key:"canRenderToMRT",get:function(){return!1}},{key:"alpha",get:function(){return this._alpha},set:function(t){if(this._alpha!==t){var n=this._alpha;this._alpha=t,1!==n&&1!==t||this.markAsDirty(e.MiscDirtyFlag)}}},{key:"backFaceCulling",get:function(){return this._backFaceCulling},set:function(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(e.TextureDirtyFlag))}},{key:"cullBackFaces",get:function(){return this._cullBackFaces},set:function(t){this._cullBackFaces!==t&&(this._cullBackFaces=t,this.markAsDirty(e.TextureDirtyFlag))}},{key:"hasRenderTargetTextures",get:function(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}},{key:"onDispose",set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}},{key:"onBindObservable",get:function(){return this._onBindObservable||(this._onBindObservable=new u.y$),this._onBindObservable}},{key:"onBind",set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}},{key:"onUnBindObservable",get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new u.y$),this._onUnBindObservable}},{key:"onEffectCreatedObservable",get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new u.y$),this._onEffectCreatedObservable}},{key:"alphaMode",get:function(){return this._alphaMode},set:function(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(e.TextureDirtyFlag))}},{key:"needDepthPrePass",get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}},{key:"isPrePassCapable",get:function(){return!1}},{key:"fogEnabled",get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(e.MiscDirtyFlag))}},{key:"wireframe",get:function(){switch(this._fillMode){case e.WireFrameFillMode:case e.LineListDrawMode:case e.LineLoopDrawMode:case e.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(t){this.fillMode=t?e.WireFrameFillMode:e.TriangleFillMode}},{key:"pointsCloud",get:function(){switch(this._fillMode){case e.PointFillMode:case e.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(t){this.fillMode=t?e.PointFillMode:e.TriangleFillMode}},{key:"fillMode",get:function(){return this._fillMode},set:function(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(e.MiscDirtyFlag))}},{key:"_getDrawWrapper",value:function(){return this._drawWrapper}},{key:"_setDrawWrapper",value:function(e){this._drawWrapper=e}},{key:"toString",value:function(e){return"Name: "+this.name}},{key:"getClassName",value:function(){return"Material"}},{key:"isFrozen",get:function(){return this.checkReadyOnlyOnce}},{key:"freeze",value:function(){this.markDirty(),this.checkReadyOnlyOnce=!0}},{key:"unfreeze",value:function(){this.markDirty(),this.checkReadyOnlyOnce=!1}},{key:"isReady",value:function(e,t){return!0}},{key:"isReadyForSubMesh",value:function(e,t,n){var i=t.materialDefines;return!!i&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=i,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}},{key:"getEffect",value:function(){return this._drawWrapper.effect}},{key:"getScene",value:function(){return this._scene}},{key:"transparencyMode",get:function(){return this._transparencyMode},set:function(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===e.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}},{key:"_disableAlphaBlending",get:function(){return this._transparencyMode===e.MATERIAL_OPAQUE||this._transparencyMode===e.MATERIAL_ALPHATEST}},{key:"needAlphaBlending",value:function(){return!this._disableAlphaBlending&&this.alpha<1}},{key:"needAlphaBlendingForMesh",value:function(e){return!(this._disableAlphaBlending&&e.visibility>=1)&&(this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha)}},{key:"needAlphaTesting",value:function(){return!!this._forceAlphaTest}},{key:"_shouldTurnAlphaTestOn",value:function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}},{key:"getAlphaTestTexture",value:function(){return null}},{key:"markDirty",value:function(){var e,t=A(this.getScene().meshes);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.subMeshes){var i,r=A(n.subMeshes);try{for(r.s();!(i=r.n()).done;){var a=i.value;a.getMaterial()===this&&(a.effect&&(a.effect._wasPreviouslyReady=!1,a.effect._wasPreviouslyUsingInstances=null))}}catch(o){r.e(o)}finally{r.f()}}}}catch(o){t.e(o)}finally{t.f()}}},{key:"_preBind",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this._scene.getEngine(),r=null==n?this.sideOrientation:n,a=r===e.ClockWiseSideOrientation;return i.enableEffect(t||this._getDrawWrapper()),i.setState(this.backFaceCulling,this.zOffset,!1,a,this.cullBackFaces,this.stencil,this.zOffsetUnits),a}},{key:"bind",value:function(e,t){}},{key:"buildUniformLayout",value:function(){var e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(m.S.PrepareUniformBuffer,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}},{key:"bindForSubMesh",value:function(e,t,n){n.effect&&(this._eventInfo.subMesh=n,this._callbackPluginEventBindForSubMesh(this._eventInfo))}},{key:"bindOnlyWorldMatrix",value:function(e){}},{key:"bindView",value:function(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())}},{key:"bindViewProjection",value:function(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))}},{key:"bindEyePosition",value:function(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)}},{key:"_afterBind",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,p.G.BindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){var n=this._scene.getEngine();this._cachedDepthWriteState=n.getDepthWrite(),n.setDepthWrite(!1)}if(this.disableColorWrite){var i=this._scene.getEngine();this._cachedColorWriteState=i.getColorWrite(),i.setColorWrite(!1)}if(0!==this.depthFunction){var r=this._scene.getEngine();this._cachedDepthFunctionState=r.getDepthFunction()||0,r.setDepthFunction(this.depthFunction)}}},{key:"unbind",value:function(){(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction)&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState);this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState);this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}},{key:"getAnimatables",value:function(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(m.S.GetAnimatables,this._eventInfo),this._eventInfo.animatables}},{key:"getActiveTextures",value:function(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(m.S.GetActiveTextures,this._eventInfo),this._eventInfo.activeTextures}},{key:"hasTexture",value:function(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(m.S.HasTexture,this._eventInfo),this._eventInfo.hasTexture}},{key:"clone",value:function(e){return null}},{key:"getBindedMeshes",value:function(){var e=this;if(this.meshMap){var t=new Array;for(var n in this.meshMap){var i=this.meshMap[n];i&&t.push(i)}return t}return this._scene.meshes.filter((function(t){return t.material===e}))}},{key:"forceCompilation",value:function(e,t,n,r){var a=this,o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({clipPlane:!1,useInstances:!1},n),s=this.getScene(),l=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;!function n(){if(a._scene&&a._scene.getEngine()){var i=s.clipPlane;if(o.clipPlane&&(s.clipPlane=new v.J(0,0,0,1)),a._storeEffectOnSubMeshes){var u=!0,c=null;if(e.subMeshes){var f=new h.P(0,0,0,0,0,e,void 0,!1,!1);f.materialDefines&&(f.materialDefines._renderId=-1),a.isReadyForSubMesh(e,f,o.useInstances)||(f.effect&&f.effect.getCompilationError()&&f.effect.allFallbacksProcessed()?c=f.effect.getCompilationError():(u=!1,setTimeout(n,16)))}u&&(a.allowShaderHotSwapping=l,c&&r&&r(c),t&&t(a))}else a.isReady()?(a.allowShaderHotSwapping=l,t&&t(a)):setTimeout(n,16);o.clipPlane&&(s.clipPlane=i)}}()}},{key:"forceCompilationAsync",value:function(e,t){var n=this;return new Promise((function(i,r){n.forceCompilation(e,(function(){i()}),t,(function(e){r(e)}))}))}},{key:"markAsDirty",value:function(t){this.getScene().blockMaterialDirtyMechanism||(e._DirtyCallbackArray.length=0,t&e.TextureDirtyFlag&&e._DirtyCallbackArray.push(e._TextureDirtyCallBack),t&e.LightDirtyFlag&&e._DirtyCallbackArray.push(e._LightsDirtyCallBack),t&e.FresnelDirtyFlag&&e._DirtyCallbackArray.push(e._FresnelDirtyCallBack),t&e.AttributesDirtyFlag&&e._DirtyCallbackArray.push(e._AttributeDirtyCallBack),t&e.MiscDirtyFlag&&e._DirtyCallbackArray.push(e._MiscDirtyCallBack),t&e.PrePassDirtyFlag&&e._DirtyCallbackArray.push(e._PrePassDirtyCallBack),e._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(e._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}},{key:"resetDrawCache",value:function(){var e,t=A(this.getScene().meshes);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.subMeshes){var i,r=A(n.subMeshes);try{for(r.s();!(i=r.n()).done;){var a=i.value;a.getMaterial()===this&&a.resetDrawCache()}}catch(o){r.e(o)}finally{r.f()}}}}catch(o){t.e(o)}finally{t.f()}}},{key:"_markAllSubMeshesAsDirty",value:function(e){if(!this.getScene().blockMaterialDirtyMechanism){var t,n=A(this.getScene().meshes);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.subMeshes){var r,a=A(i.subMeshes);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.getMaterial(!1)===this){var s,l=A(o._drawWrappers);try{for(l.s();!(s=l.n()).done;){var u=s.value;u&&u.defines&&u.defines.markAllAsDirty&&(this._materialContext===u.materialContext&&e(u.defines))}}catch(c){l.e(c)}finally{l.f()}}}}catch(c){a.e(c)}finally{a.f()}}}}catch(c){n.e(c)}finally{n.f()}}}},{key:"_markScenePrePassDirty",value:function(){if(!this.getScene().blockMaterialDirtyMechanism){var e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}}},{key:"_markAllSubMeshesAsAllDirty",value:function(){this._markAllSubMeshesAsDirty(e._AllDirtyCallBack)}},{key:"_markAllSubMeshesAsImageProcessingDirty",value:function(){this._markAllSubMeshesAsDirty(e._ImageProcessingDirtyCallBack)}},{key:"_markAllSubMeshesAsTexturesDirty",value:function(){this._markAllSubMeshesAsDirty(e._TextureDirtyCallBack)}},{key:"_markAllSubMeshesAsFresnelDirty",value:function(){this._markAllSubMeshesAsDirty(e._FresnelDirtyCallBack)}},{key:"_markAllSubMeshesAsFresnelAndMiscDirty",value:function(){this._markAllSubMeshesAsDirty(e._FresnelAndMiscDirtyCallBack)}},{key:"_markAllSubMeshesAsLightsDirty",value:function(){this._markAllSubMeshesAsDirty(e._LightsDirtyCallBack)}},{key:"_markAllSubMeshesAsAttributesDirty",value:function(){this._markAllSubMeshesAsDirty(e._AttributeDirtyCallBack)}},{key:"_markAllSubMeshesAsMiscDirty",value:function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)}},{key:"_markAllSubMeshesAsPrePassDirty",value:function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)}},{key:"_markAllSubMeshesAsTexturesAndMiscDirty",value:function(){this._markAllSubMeshesAsDirty(e._TextureAndMiscDirtyCallBack)}},{key:"setPrePassRenderer",value:function(e){return!1}},{key:"dispose",value:function(e,t,n){var i=this.getScene();if(i.stopAnimation(this),i.freeProcessedMaterials(),i.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(m.S.Disposed,this._eventInfo),this._parentContainer){var r=this._parentContainer.materials.indexOf(this);r>-1&&this._parentContainer.materials.splice(r,1),this._parentContainer=null}if(!0!==n)if(this.meshMap)for(var a in this.meshMap){var o=this.meshMap[a];o&&(o.material=null,this.releaseVertexArrayObject(o,e))}else{var s,l=A(i.meshes);try{for(l.s();!(s=l.n()).done;){var u=s.value;u.material!==this||u.sourceMesh||(u.material=null,this.releaseVertexArrayObject(u,e))}}catch(c){l.e(c)}finally{l.f()}}this._uniformBuffer.dispose(),e&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()}},{key:"releaseVertexArrayObject",value:function(e,t){if(e.geometry){var n=e.geometry;if(this._storeEffectOnSubMeshes){var i,r=A(e.subMeshes);try{for(r.s();!(i=r.n()).done;){var a=i.value;n._releaseVertexArrayObject(a.effect),t&&a.effect&&a.effect.dispose()}}catch(o){r.e(o)}finally{r.f()}}else n._releaseVertexArrayObject(this._drawWrapper.effect)}}},{key:"serialize",value:function(){var e=s.p4.Serialize(this);return e.stencil=this.stencil.serialize(),e.uniqueId=this.uniqueId,e}}],[{key:"Parse",value:function(e,t,n){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return d.Y.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";var i=l.w1.Instantiate(e.customType).Parse(e,t,n);return i._loadedUniqueId=e.uniqueId,i}}]),e}();b.TriangleFillMode=0,b.WireFrameFillMode=1,b.PointFillMode=2,b.PointListDrawMode=3,b.LineListDrawMode=4,b.LineLoopDrawMode=5,b.LineStripDrawMode=6,b.TriangleStripDrawMode=7,b.TriangleFanDrawMode=8,b.ClockWiseSideOrientation=0,b.CounterClockWiseSideOrientation=1,b.TextureDirtyFlag=1,b.LightDirtyFlag=2,b.FresnelDirtyFlag=4,b.AttributesDirtyFlag=8,b.MiscDirtyFlag=16,b.PrePassDirtyFlag=32,b.AllDirtyFlag=63,b.MATERIAL_OPAQUE=0,b.MATERIAL_ALPHATEST=1,b.MATERIAL_ALPHABLEND=2,b.MATERIAL_ALPHATESTANDBLEND=3,b.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,b.MATERIAL_NORMALBLENDMETHOD_RNM=1,b.OnEventObservable=new u.y$,b._AllDirtyCallBack=function(e){return e.markAllAsDirty()},b._ImageProcessingDirtyCallBack=function(e){return e.markAsImageProcessingDirty()},b._TextureDirtyCallBack=function(e){return e.markAsTexturesDirty()},b._FresnelDirtyCallBack=function(e){return e.markAsFresnelDirty()},b._MiscDirtyCallBack=function(e){return e.markAsMiscDirty()},b._PrePassDirtyCallBack=function(e){return e.markAsPrePassDirty()},b._LightsDirtyCallBack=function(e){return e.markAsLightDirty()},b._AttributeDirtyCallBack=function(e){return e.markAsAttributesDirty()},b._FresnelAndMiscDirtyCallBack=function(e){b._FresnelDirtyCallBack(e),b._MiscDirtyCallBack(e)},b._TextureAndMiscDirtyCallBack=function(e){b._TextureDirtyCallBack(e),b._MiscDirtyCallBack(e)},b._DirtyCallbackArray=[],b._RunDirtyCallBacks=function(e){var t,n=A(b._DirtyCallbackArray);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(i){n.e(i)}finally{n.f()}},(0,o.gn)([(0,s.qC)()],b.prototype,"id",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"uniqueId",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"name",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"metadata",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"checkReadyOnEveryCall",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"checkReadyOnlyOnce",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"state",void 0),(0,o.gn)([(0,s.qC)("alpha")],b.prototype,"_alpha",void 0),(0,o.gn)([(0,s.qC)("backFaceCulling")],b.prototype,"_backFaceCulling",void 0),(0,o.gn)([(0,s.qC)("cullBackFaces")],b.prototype,"_cullBackFaces",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"sideOrientation",void 0),(0,o.gn)([(0,s.qC)("alphaMode")],b.prototype,"_alphaMode",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"_needDepthPrePass",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"disableDepthWrite",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"disableColorWrite",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"forceDepthWrite",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"depthFunction",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"separateCullingPass",void 0),(0,o.gn)([(0,s.qC)("fogEnabled")],b.prototype,"_fogEnabled",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"pointSize",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"zOffset",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"zOffsetUnits",void 0),(0,o.gn)([(0,s.qC)()],b.prototype,"pointsCloud",null),(0,o.gn)([(0,s.qC)()],b.prototype,"fillMode",null),(0,o.gn)([(0,s.qC)()],b.prototype,"transparencyMode",null)},4771:function(e,t,n){"use strict";n.d(t,{H:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(t){if((0,i.Z)(this,e),this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=t,t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&this._setDefaultValue(n)}return(0,r.Z)(e,[{key:"isDirty",get:function(){return this._isDirty}},{key:"markAsProcessed",value:function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}},{key:"markAsUnprocessed",value:function(){this._isDirty=!0}},{key:"markAllAsDirty",value:function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}},{key:"markAsImageProcessingDirty",value:function(){this._areImageProcessingDirty=!0,this._isDirty=!0}},{key:"markAsLightDirty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0}},{key:"markAsAttributesDirty",value:function(){this._areAttributesDirty=!0,this._isDirty=!0}},{key:"markAsTexturesDirty",value:function(){this._areTexturesDirty=!0,this._isDirty=!0}},{key:"markAsFresnelDirty",value:function(){this._areFresnelDirty=!0,this._isDirty=!0}},{key:"markAsMiscDirty",value:function(){this._areMiscDirty=!0,this._isDirty=!0}},{key:"markAsPrePassDirty",value:function(){this._arePrePassDirty=!0,this._isDirty=!0}},{key:"rebuild",value:function(){this._keys.length=0;for(var e=0,t=Object.keys(this);e<t.length;e++){var n=t[e];"_"!==n[0]&&this._keys.push(n)}if(this._externalProperties)for(var i in this._externalProperties)-1===this._keys.indexOf(i)&&this._keys.push(i)}},{key:"isEqual",value:function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var n=this._keys[t];if(this[n]!==e[n])return!1}return!0}},{key:"cloneTo",value:function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var n=this._keys[t];e[n]=this[n]}}},{key:"reset",value:function(){var e=this;this._keys.forEach((function(t){return e._setDefaultValue(t)}))}},{key:"_setDefaultValue",value:function(e){var t,n,i,r,a,o=null!==(t=null===(n=this._externalProperties)||void 0===n||null===(i=n[e])||void 0===i?void 0:i.type)&&void 0!==t?t:typeof this[e],s=null===(r=this._externalProperties)||void 0===r||null===(a=r[e])||void 0===a?void 0:a.default;switch(o){case"number":this[e]=null!=s?s:0;break;case"string":this[e]=null!=s?s:"";break;default:this[e]=null!=s&&s}}},{key:"toString",value:function(){for(var e="",t=0;t<this._keys.length;t++){var n=this._keys[t],i=this[n];switch(typeof i){case"number":case"string":e+="#define "+n+" "+i+"\n";break;default:i&&(e+="#define "+n+"\n")}}return e}}]),e}()},114:function(e,t,n){"use strict";n.d(t,{G:function(){return p}});var i=n(5671),r=n(3144),a=n(2328),o=n(7337),s=n(8911),l=n(4198),u=n(2845),c=n(1221),h=n(7046),f=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"BindClipPlane",value:function(e,t){if(t.clipPlane){var n=t.clipPlane;e.setFloat4("vClipPlane",n.normal.x,n.normal.y,n.normal.z,n.d)}if(t.clipPlane2){var i=t.clipPlane2;e.setFloat4("vClipPlane2",i.normal.x,i.normal.y,i.normal.z,i.d)}if(t.clipPlane3){var r=t.clipPlane3;e.setFloat4("vClipPlane3",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane4){var a=t.clipPlane4;e.setFloat4("vClipPlane4",a.normal.x,a.normal.y,a.normal.z,a.d)}if(t.clipPlane5){var o=t.clipPlane5;e.setFloat4("vClipPlane5",o.normal.x,o.normal.y,o.normal.z,o.d)}if(t.clipPlane6){var s=t.clipPlane6;e.setFloat4("vClipPlane6",s.normal.x,s.normal.y,s.normal.z,s.d)}}}]),e}();function d(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var p=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"BindSceneUniformBuffer",value:function(e,t){t.bindToEffect(e,"Scene")}},{key:"PrepareDefinesForMergedUV",value:function(e,t,n){t._needUVs=!0,t[n]=!0,e.optimizeUVAllocation&&e.getTextureMatrix().isIdentityAs3x2()?(t[n+"DIRECTUV"]=e.coordinatesIndex+1,t["MAINUV"+(e.coordinatesIndex+1)]=!0):t[n+"DIRECTUV"]=0}},{key:"BindTextureMatrix",value:function(e,t,n){var i=e.getTextureMatrix();t.updateMatrix(n+"Matrix",i)}},{key:"GetFogState",value:function(e,t){return t.fogEnabled&&e.applyFog&&t.fogMode!==s.x.FOGMODE_NONE}},{key:"PrepareDefinesForMisc",value:function(e,t,n,i,r,a,o){o._areMiscDirty&&(o.LOGARITHMICDEPTH=n,o.POINTSIZE=i,o.FOG=r&&this.GetFogState(e,t),o.NONUNIFORMSCALING=e.nonUniformScaling,o.ALPHATEST=a)}},{key:"PrepareDefinesForFrameBoundValues",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=!1,s=!1,l=!1,u=!1,c=!1,h=!1,f=!1;s=null==r?void 0!==e.clipPlane&&null!==e.clipPlane:r,l=null==r?void 0!==e.clipPlane2&&null!==e.clipPlane2:r,u=null==r?void 0!==e.clipPlane3&&null!==e.clipPlane3:r,c=null==r?void 0!==e.clipPlane4&&null!==e.clipPlane4:r,h=null==r?void 0!==e.clipPlane5&&null!==e.clipPlane5:r,f=null==r?void 0!==e.clipPlane6&&null!==e.clipPlane6:r,n.CLIPPLANE!==s&&(n.CLIPPLANE=s,o=!0),n.CLIPPLANE2!==l&&(n.CLIPPLANE2=l,o=!0),n.CLIPPLANE3!==u&&(n.CLIPPLANE3=u,o=!0),n.CLIPPLANE4!==c&&(n.CLIPPLANE4=c,o=!0),n.CLIPPLANE5!==h&&(n.CLIPPLANE5=h,o=!0),n.CLIPPLANE6!==f&&(n.CLIPPLANE6=f,o=!0),n.DEPTHPREPASS!==!t.getColorWrite()&&(n.DEPTHPREPASS=!n.DEPTHPREPASS,o=!0),n.INSTANCES!==i&&(n.INSTANCES=i,o=!0),n.INSTANCESCOLOR&&!n.INSTANCES&&(n.INSTANCESCOLOR=!1,o=!0),n.THIN_INSTANCES!==a&&(n.THIN_INSTANCES=a,o=!0),o&&n.markAsUnprocessed()}},{key:"PrepareDefinesForBones",value:function(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;var n=void 0!==t.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&n)t.BONETEXTURE=!0;else{t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!n&&void 0;var i=e.getScene().prePassRenderer;if(i&&i.enabled){var r=-1===i.excludedSkinnedMesh.indexOf(e);t.BONES_VELOCITY_ENABLED=r}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0}},{key:"PrepareDefinesForMorphTargets",value:function(e,t){var n=e.morphTargetManager;n?(t.MORPHTARGETS_UV=n.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=n.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=n.supportsNormals&&t.NORMAL,t.MORPHTARGETS=n.numInfluencers>0,t.NUM_MORPH_INFLUENCERS=n.numInfluencers,t.MORPHTARGETS_TEXTURE=n.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}},{key:"PrepareDefinesForBakedVertexAnimation",value:function(e,t){var n=e.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!(!n||!n.isEnabled)}},{key:"PrepareDefinesForAttributes",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent(u.o.NormalKind),t._needNormals&&e.isVerticesDataPresent(u.o.TangentKind)&&(t.TANGENT=!0);for(var s=1;s<=6;++s)t["UV"+s]=!!t._needUVs&&e.isVerticesDataPresent("uv".concat(1===s?"":s));if(n){var l=e.useVertexColors&&e.isVerticesDataPresent(u.o.ColorKind);t.VERTEXCOLOR=l,t.VERTEXALPHA=e.hasVertexAlpha&&l&&a}return e.isVerticesDataPresent(u.o.ColorInstanceKind)&&(e.hasInstances||e.hasThinInstances)&&(t.INSTANCESCOLOR=!0),i&&this.PrepareDefinesForBones(e,t),r&&this.PrepareDefinesForMorphTargets(e,t),o&&this.PrepareDefinesForBakedVertexAnimation(e,t),!0}},{key:"PrepareDefinesForMultiview",value:function(e,t){if(e.activeCamera){var n=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=n&&t.markAsUnprocessed()}}},{key:"PrepareDefinesForOIT",value:function(e,t,n){var i=t.ORDER_INDEPENDENT_TRANSPARENCY,r=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&n,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,i===t.ORDER_INDEPENDENT_TRANSPARENCY&&r===t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||t.markAsUnprocessed()}},{key:"PrepareDefinesForPrePass",value:function(e,t,n){var i=t.PREPASS;if(t._arePrePassDirty){var r=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&n){t.PREPASS=!0,t.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount;for(var a=0;a<r.length;a++){var o=e.prePassRenderer.getIndex(r[a].type);-1!==o?(t[r[a].define]=!0,t[r[a].index]=o):t[r[a].define]=!1}}else{t.PREPASS=!1;for(var s=0;s<r.length;s++)t[r[s].define]=!1}t.PREPASS!=i&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}}},{key:"PrepareDefinesForLight",value:function(e,t,n,i,r,a,o){switch(o.needNormals=!0,void 0===r["LIGHT"+i]&&(o.needRebuild=!0),r["LIGHT"+i]=!0,r["SPOTLIGHT"+i]=!1,r["HEMILIGHT"+i]=!1,r["POINTLIGHT"+i]=!1,r["DIRLIGHT"+i]=!1,n.prepareLightSpecificDefines(r,i),r["LIGHT_FALLOFF_PHYSICAL"+i]=!1,r["LIGHT_FALLOFF_GLTF"+i]=!1,r["LIGHT_FALLOFF_STANDARD"+i]=!1,n.falloffType){case c.m.FALLOFF_GLTF:r["LIGHT_FALLOFF_GLTF"+i]=!0;break;case c.m.FALLOFF_PHYSICAL:r["LIGHT_FALLOFF_PHYSICAL"+i]=!0;break;case c.m.FALLOFF_STANDARD:r["LIGHT_FALLOFF_STANDARD"+i]=!0}if(a&&!n.specular.equalsFloats(0,0,0)&&(o.specularEnabled=!0),r["SHADOW"+i]=!1,r["SHADOWCSM"+i]=!1,r["SHADOWCSMDEBUG"+i]=!1,r["SHADOWCSMNUM_CASCADES"+i]=!1,r["SHADOWCSMUSESHADOWMAXZ"+i]=!1,r["SHADOWCSMNOBLEND"+i]=!1,r["SHADOWCSM_RIGHTHANDED"+i]=!1,r["SHADOWPCF"+i]=!1,r["SHADOWPCSS"+i]=!1,r["SHADOWPOISSON"+i]=!1,r["SHADOWESM"+i]=!1,r["SHADOWCLOSEESM"+i]=!1,r["SHADOWCUBE"+i]=!1,r["SHADOWLOWQUALITY"+i]=!1,r["SHADOWMEDIUMQUALITY"+i]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&n.shadowEnabled){var s=n.getShadowGenerator();if(s){var l=s.getShadowMap();l&&l.renderList&&l.renderList.length>0&&(o.shadowEnabled=!0,s.prepareDefines(r,i))}}n.lightmapMode!=c.m.LIGHTMAP_DEFAULT?(o.lightmapMode=!0,r["LIGHTMAPEXCLUDED"+i]=!0,r["LIGHTMAPNOSPECULAR"+i]=n.lightmapMode==c.m.LIGHTMAP_SHADOWSONLY):(r["LIGHTMAPEXCLUDED"+i]=!1,r["LIGHTMAPNOSPECULAR"+i]=!1)}},{key:"PrepareDefinesForLights",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!n._areLightsDirty)return n._needNormals;var o=0,s={needNormals:n._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!a){var l,u=d(t.lightSources);try{for(u.s();!(l=u.n()).done;){var c=l.value;if(this.PrepareDefinesForLight(e,t,c,o,n,i,s),++o===r)break}}catch(v){u.e(v)}finally{u.f()}}n.SPECULARTERM=s.specularEnabled,n.SHADOWS=s.shadowEnabled;for(var h=o;h<r;h++)void 0!==n["LIGHT"+h]&&(n["LIGHT"+h]=!1,n["HEMILIGHT"+h]=!1,n["POINTLIGHT"+h]=!1,n["DIRLIGHT"+h]=!1,n["SPOTLIGHT"+h]=!1,n["SHADOW"+h]=!1,n["SHADOWCSM"+h]=!1,n["SHADOWCSMDEBUG"+h]=!1,n["SHADOWCSMNUM_CASCADES"+h]=!1,n["SHADOWCSMUSESHADOWMAXZ"+h]=!1,n["SHADOWCSMNOBLEND"+h]=!1,n["SHADOWCSM_RIGHTHANDED"+h]=!1,n["SHADOWPCF"+h]=!1,n["SHADOWPCSS"+h]=!1,n["SHADOWPOISSON"+h]=!1,n["SHADOWESM"+h]=!1,n["SHADOWCLOSEESM"+h]=!1,n["SHADOWCUBE"+h]=!1,n["SHADOWLOWQUALITY"+h]=!1,n["SHADOWMEDIUMQUALITY"+h]=!1);var f=e.getEngine().getCaps();return void 0===n.SHADOWFLOAT&&(s.needRebuild=!0),n.SHADOWFLOAT=s.shadowEnabled&&(f.textureFloatRender&&f.textureFloatLinearFiltering||f.textureHalfFloatRender&&f.textureHalfFloatLinearFiltering),n.LIGHTMAPEXCLUDED=s.lightmapMode,s.needRebuild&&n.rebuild(),s.needNormals}},{key:"PrepareUniformsAndSamplersForLight",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];r&&r.push("Light"+e),a||(t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),n.push("shadowSampler"+e),n.push("depthSampler"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),i&&(n.push("projectionLightSampler"+e),t.push("textureProjectionMatrix"+e)))}},{key:"PrepareUniformsAndSamplersList",value:function(e,t,n){var i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,a=null;if(e.uniformsNames){var o=e;i=o.uniformsNames,a=o.uniformBuffersNames,t=o.samplers,n=o.defines,r=o.maxSimultaneousLights||0}else i=e,t||(t=[]);for(var s=0;s<r&&n["LIGHT"+s];s++)this.PrepareUniformsAndSamplersForLight(s,i,t,n["PROJECTEDLIGHTTEXTURE"+s],a);n.NUM_MORPH_INFLUENCERS&&i.push("morphTargetInfluences"),n.BAKED_VERTEX_ANIMATION_TEXTURE&&(i.push("bakedVertexAnimationSettings"),i.push("bakedVertexAnimationTextureSizeInverted"),i.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))}},{key:"HandleFallbacksForShadows",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=0,a=0;a<n&&e["LIGHT"+a];a++)a>0&&(r=i+a,t.addFallback(r,"LIGHT"+a)),e.SHADOWS||(e["SHADOW"+a]&&t.addFallback(i,"SHADOW"+a),e["SHADOWPCF"+a]&&t.addFallback(i,"SHADOWPCF"+a),e["SHADOWPCSS"+a]&&t.addFallback(i,"SHADOWPCSS"+a),e["SHADOWPOISSON"+a]&&t.addFallback(i,"SHADOWPOISSON"+a),e["SHADOWESM"+a]&&t.addFallback(i,"SHADOWESM"+a),e["SHADOWCLOSEESM"+a]&&t.addFallback(i,"SHADOWCLOSEESM"+a));return r++}},{key:"PrepareAttributesForMorphTargetsInfluencers",value:function(e,t,n){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=n,this.PrepareAttributesForMorphTargets(e,t,this._TmpMorphInfluencers)}},{key:"PrepareAttributesForMorphTargets",value:function(e,t,n){var i=n.NUM_MORPH_INFLUENCERS;if(i>0&&l.l.LastCreatedEngine){var r=l.l.LastCreatedEngine.getCaps().maxVertexAttribs,o=t.morphTargetManager;if(null!=o&&o.isUsingTextureForTargets)return;for(var s=o&&o.supportsNormals&&n.NORMAL,c=o&&o.supportsTangents&&n.TANGENT,h=o&&o.supportsUVs&&n.UV1,f=0;f<i;f++)e.push(u.o.PositionKind+f),s&&e.push(u.o.NormalKind+f),c&&e.push(u.o.TangentKind+f),h&&e.push(u.o.UVKind+"_"+f),e.length>r&&a.Y.Error("Cannot add more vertex attributes for mesh "+t.name)}}},{key:"PrepareAttributesForBakedVertexAnimation",value:function(e,t,n){n.BAKED_VERTEX_ANIMATION_TEXTURE&&n.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")}},{key:"PrepareAttributesForBones",value:function(e,t,n,i){n.NUM_BONE_INFLUENCERS>0&&(i.addCPUSkinningFallback(0,t),e.push(u.o.MatricesIndicesKind),e.push(u.o.MatricesWeightsKind),n.NUM_BONE_INFLUENCERS>4&&(e.push(u.o.MatricesIndicesExtraKind),e.push(u.o.MatricesWeightsExtraKind)))}},{key:"PrepareAttributesForInstances",value:function(e,t){(t.INSTANCES||t.THIN_INSTANCES)&&this.PushAttributesForInstances(e,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&e.push(u.o.ColorInstanceKind)}},{key:"PushAttributesForInstances",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),t&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))}},{key:"BindLightProperties",value:function(e,t,n){e.transferToEffect(t,n+"")}},{key:"BindLight",value:function(e,t,n,i,r){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];e._bindLight(t,n,i,r,a)}},{key:"BindLights",value:function(e,t,n,i){for(var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,a=Math.min(t.lightSources.length,r),o=0;o<a;o++){var s=t.lightSources[o];this.BindLight(s,o,e,n,"boolean"==typeof i?i:i.SPECULARTERM,t.receiveShadows)}}},{key:"BindFogParameters",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.fogEnabled&&t.applyFog&&e.fogMode!==s.x.FOGMODE_NONE&&(n.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),i?(e.fogColor.toLinearSpaceToRef(this._TempFogColor),n.setColor3("vFogColor",this._TempFogColor)):n.setColor3("vFogColor",e.fogColor))}},{key:"BindBonesParameters",value:function(t,n,i){if(n&&t&&(t.computeBonesUsingShaders&&n._bonesComputationForcedToCPU&&(t.computeBonesUsingShaders=!1),t.useBones&&t.computeBonesUsingShaders&&t.skeleton)){var r=t.skeleton;if(r.isUsingTextureForMatrices&&n.getUniformIndex("boneTextureWidth")>-1){var a=r.getTransformMatrixTexture(t);n.setTexture("boneSampler",a),n.setFloat("boneTextureWidth",4*(r.bones.length+1))}else{var o=r.getTransformMatrices(t);o&&(n.setMatrices("mBones",o),i&&t.getScene().prePassRenderer&&t.getScene().prePassRenderer.getIndex(2)&&(i.previousBones[t.uniqueId]||(i.previousBones[t.uniqueId]=o.slice()),n.setMatrices("mPreviousBones",i.previousBones[t.uniqueId]),e._CopyBonesTransformationMatrices(o,i.previousBones[t.uniqueId])))}}}},{key:"_CopyBonesTransformationMatrices",value:function(e,t){return t.set(e),t}},{key:"BindMorphTargetParameters",value:function(e,t){var n=e.morphTargetManager;e&&n&&t.setFloatArray("morphTargetInfluences",n.influences)}},{key:"BindLogDepth",value:function(e,t,n){if(!e||e.LOGARITHMICDEPTH){var i=n.activeCamera;i.mode===o.V.ORTHOGRAPHIC_CAMERA&&a.Y.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(i.maxZ+1)/Math.LN2))}}},{key:"BindClipPlane",value:function(e,t){f.BindClipPlane(e,t)}}]),e}();p._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},p._TempFogColor=h.Wo.Black()},4071:function(e,t,n){"use strict";var i;n.d(t,{S:function(){return i}}),function(e){e[e.Created=1]="Created",e[e.Disposed=2]="Disposed",e[e.GetDefineNames=4]="GetDefineNames",e[e.PrepareUniformBuffer=8]="PrepareUniformBuffer",e[e.IsReadyForSubMesh=16]="IsReadyForSubMesh",e[e.PrepareDefines=32]="PrepareDefines",e[e.BindForSubMesh=64]="BindForSubMesh",e[e.PrepareEffect=128]="PrepareEffect",e[e.GetAnimatables=256]="GetAnimatables",e[e.GetActiveTextures=512]="GetActiveTextures",e[e.HasTexture=1024]="HasTexture",e[e.FillRenderTargetTextures=2048]="FillRenderTargetTextures",e[e.HasRenderTargetTextures=4096]="HasRenderTargetTextures",e[e.HardBindForSubMesh=8192]="HardBindForSubMesh"}(i||(i={}))},2402:function(e,t,n){"use strict";n.d(t,{G:function(){return p}});var i=n(2982),r=n(5671),a=n(3144),o=n(7326),s=n(1752),l=n(136),u=n(6215),c=n(1120),h=n(6556),f=n(7032),d=n(1704);function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,c.Z)(e);if(t){var r=(0,c.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,u.Z)(this,n)}}var p=function(e){(0,l.Z)(n,e);var t=v(n);function n(e,i){var a;return(0,r.Z)(this,n),(a=t.call(this,e,i,!0))._waitingSubMaterialsUniqueIds=[],a.getScene().multiMaterials.push((0,o.Z)(a)),a.subMaterials=new Array,a._storeEffectOnSubMeshes=!0,a}return(0,a.Z)(n,[{key:"subMaterials",get:function(){return this._subMaterials},set:function(e){this._subMaterials=e,this._hookArray(e)}},{key:"getChildren",value:function(){return this.subMaterials}},{key:"_hookArray",value:function(e){var t=this,n=e.push;e.push=function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];var o=n.apply(e,r);return t._markAllSubMeshesAsTexturesDirty(),o};var i=e.splice;e.splice=function(n,r){var a=i.apply(e,[n,r]);return t._markAllSubMeshesAsTexturesDirty(),a}}},{key:"getSubMaterial",value:function(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]}},{key:"getActiveTextures",value:function(){var e;return(e=(0,s.Z)((0,c.Z)(n.prototype),"getActiveTextures",this).call(this)).concat.apply(e,(0,i.Z)(this.subMaterials.map((function(e){return e?e.getActiveTextures():[]}))))}},{key:"hasTexture",value:function(e){if((0,s.Z)((0,c.Z)(n.prototype),"hasTexture",this).call(this,e))return!0;for(var t=0;t<this.subMaterials.length;t++){var i;if(null!==(i=this.subMaterials[t])&&void 0!==i&&i.hasTexture(e))return!0}return!1}},{key:"getClassName",value:function(){return"MultiMaterial"}},{key:"isReadyForSubMesh",value:function(e,t,n){for(var i=0;i<this.subMaterials.length;i++){var r=this.subMaterials[i];if(r){if(r._storeEffectOnSubMeshes){if(!r.isReadyForSubMesh(e,t,n))return!1;continue}if(!r.isReady(e))return!1}}return!0}},{key:"clone",value:function(e,t){for(var i=new n(e,this.getScene()),r=0;r<this.subMaterials.length;r++){var a=null,o=this.subMaterials[r];a=t&&o?o.clone(e+"-"+o.name):this.subMaterials[r],i.subMaterials.push(a)}return i}},{key:"serialize",value:function(){var e={};e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,f.$&&(e.tags=f.$.GetTags(this)),e.materialsUniqueIds=[],e.materials=[];for(var t=0;t<this.subMaterials.length;t++){var n=this.subMaterials[t];n?(e.materialsUniqueIds.push(n.uniqueId),e.materials.push(n.id)):(e.materialsUniqueIds.push(null),e.materials.push(null))}return e}},{key:"dispose",value:function(e,t,i){var r=this.getScene();if(r){if(i)for(var a=0;a<this.subMaterials.length;a++){var o=this.subMaterials[a];o&&o.dispose(e,t)}var l=r.multiMaterials.indexOf(this);l>=0&&r.multiMaterials.splice(l,1),(0,s.Z)((0,c.Z)(n.prototype),"dispose",this).call(this,e,t)}}}],[{key:"ParseMultiMaterial",value:function(e,t){var i=new n(e.name,t);return i.id=e.id,i._loadedUniqueId=e.uniqueId,f.$&&f.$.AddTagsTo(i,e.tags),e.materialsUniqueIds?i._waitingSubMaterialsUniqueIds=e.materialsUniqueIds:e.materials.forEach((function(e){return i.subMaterials.push(t.getLastMaterialById(e))})),i}}]),n}(h.F);(0,d.H)("BABYLON.MultiMaterial",p)},2223:function(e,t,n){"use strict";var i;n.d(t,{x:function(){return i}}),function(e){e[e.GLSL=0]="GLSL",e[e.WGSL=1]="WGSL"}(i||(i={}))},1952:function(e,t,n){"use strict";n.d(t,{M:function(){return u}});var i=n(5671),r=n(3144),a=n(2328),o=n(8517),s=n(4796),l=n(2628);s.B.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");var n=new l.M(t);return this.bindUniformBuffer(n),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},s.B.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");var n=new l.M(t);return this.bindUniformBuffer(n),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},s.B.prototype.updateUniformBuffer=function(e,t,n,i){this.bindUniformBuffer(e),void 0===n&&(n=0),void 0===i?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,n,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,n,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(n,n+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(n,n+i)),this.bindUniformBuffer(null)},s.B.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},s.B.prototype.bindUniformBufferBase=function(e,t,n){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},s.B.prototype.bindUniformBlock=function(e,t,n){var i=e.program,r=this._gl.getUniformBlockIndex(i,t);4294967295!==r&&this._gl.uniformBlockBinding(i,r,n)};var u=function(){function e(t,n,r,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,i.Z)(this,e),this._valueCache={},this._engine=t,this._noUBO=!t.supportsUniformBuffers||o,this._dynamic=r,this._name=null!=a?a:"no-name",this._data=n||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform)}return(0,r.Z)(e,[{key:"useUbo",get:function(){return!this._noUBO}},{key:"isSync",get:function(){return!this._needSync}},{key:"isDynamic",value:function(){return void 0!==this._dynamic}},{key:"getData",value:function(){return this._bufferData}},{key:"getBuffer",value:function(){return this._buffer}},{key:"_fillAlignment",value:function(e){var t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){var n=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var i=this._uniformLocationPointer-n,r=0;r<i;r++)this._data.push(0)}}},{key:"addUniform",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[e]){var i;if(n>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:n},16==t)t*=n;else{var r=4-t,a=r*n;t=t*n+a}i=[];for(var o=0;o<t;o++)i.push(0)}else{if(t instanceof Array)t=(i=t).length;else{i=[];for(var s=0;s<t;s++)i.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(var l=0;l<t;l++)this._data.push(i[l]);this._needSync=!0}}},{key:"addMatrix",value:function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))}},{key:"addFloat2",value:function(e,t,n){var i=[t,n];this.addUniform(e,i)}},{key:"addFloat3",value:function(e,t,n,i){var r=[t,n,i];this.addUniform(e,r)}},{key:"addColor3",value:function(e,t){var n=[t.r,t.g,t.b];this.addUniform(e,n)}},{key:"addColor4",value:function(e,t,n){var i=[t.r,t.g,t.b,n];this.addUniform(e,i)}},{key:"addVector3",value:function(e,t){var n=[t.x,t.y,t.z];this.addUniform(e,n)}},{key:"addMatrix3x3",value:function(e){this.addUniform(e,12)}},{key:"addMatrix2x2",value:function(e){this.addUniform(e,8)}},{key:"create",value:function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}},{key:"_rebuild",value:function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}},{key:"_numBuffers",get:function(){return this._buffers.length}},{key:"_indexBuffer",get:function(){return this._bufferIndex}},{key:"name",get:function(){return this._name}},{key:"_buffersEqual",value:function(e,t){for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}},{key:"_copyBuffer",value:function(e,t){for(var n=0;n<e.length;++n)t[n]=e[n]}},{key:"update",value:function(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(e._UpdatedUbosInFrame[this._name]||(e._UpdatedUbosInFrame[this._name]=0),e._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}},{key:"_createNewBuffer",value:function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}},{key:"_checkNewFrame",value:function(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}},{key:"updateUniform",value:function(e,t,n){this._checkNewFrame();var i=this._uniformLocations[e];if(void 0===i){if(this._buffer)return void a.Y.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,n),i=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(var r=0;r<n;r++)this._bufferData[i+r]=t[r];else{for(var s=!1,l=0;l<n;l++)(16===n&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[i+l]!==o.w1.FloatRound(t[l]))&&(s=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[i+l]=t[l]);this._needSync=this._needSync||s}}},{key:"updateUniformArray",value:function(e,t,n){this._checkNewFrame();var i=this._uniformLocations[e];if(void 0!==i){this._buffer||this.create();var r=this._uniformArraySizes[e];if(this._dynamic)for(var s=0;s<n;s++)this._bufferData[i+s]=t[s];else{for(var l=!1,u=0,c=0,h=0;h<n;h++)if(this._bufferData[i+4*c+u]!==o.w1.FloatRound(t[h])&&(l=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[i+4*c+u]=t[h]),++u===r.strideSize){for(;u<4;u++)this._bufferData[i+4*c+u]=0;u=0,c++}this._needSync=this._needSync||l}}else a.Y.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform.")}},{key:"_cacheMatrix",value:function(e,t){this._checkNewFrame();var n=this._valueCache[e],i=t.updateFlag;return(void 0===n||n!==i)&&(this._valueCache[e]=i,!0)}},{key:"_updateMatrix3x3ForUniform",value:function(t,n){for(var i=0;i<3;i++)e._TempBuffer[4*i]=n[3*i],e._TempBuffer[4*i+1]=n[3*i+1],e._TempBuffer[4*i+2]=n[3*i+2],e._TempBuffer[4*i+3]=0;this.updateUniform(t,e._TempBuffer,12)}},{key:"_updateMatrix3x3ForEffect",value:function(e,t){this._currentEffect.setMatrix3x3(e,t)}},{key:"_updateMatrix2x2ForEffect",value:function(e,t){this._currentEffect.setMatrix2x2(e,t)}},{key:"_updateMatrix2x2ForUniform",value:function(t,n){for(var i=0;i<2;i++)e._TempBuffer[4*i]=n[2*i],e._TempBuffer[4*i+1]=n[2*i+1],e._TempBuffer[4*i+2]=0,e._TempBuffer[4*i+3]=0;this.updateUniform(t,e._TempBuffer,8)}},{key:"_updateFloatForEffect",value:function(e,t){this._currentEffect.setFloat(e,t)}},{key:"_updateFloatForUniform",value:function(t,n){e._TempBuffer[0]=n,this.updateUniform(t,e._TempBuffer,1)}},{key:"_updateFloat2ForEffect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(e+i,t,n)}},{key:"_updateFloat2ForUniform",value:function(t,n,i){e._TempBuffer[0]=n,e._TempBuffer[1]=i,this.updateUniform(t,e._TempBuffer,2)}},{key:"_updateFloat3ForEffect",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(e+r,t,n,i)}},{key:"_updateFloat3ForUniform",value:function(t,n,i,r){e._TempBuffer[0]=n,e._TempBuffer[1]=i,e._TempBuffer[2]=r,this.updateUniform(t,e._TempBuffer,3)}},{key:"_updateFloat4ForEffect",value:function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(e+a,t,n,i,r)}},{key:"_updateFloat4ForUniform",value:function(t,n,i,r,a){e._TempBuffer[0]=n,e._TempBuffer[1]=i,e._TempBuffer[2]=r,e._TempBuffer[3]=a,this.updateUniform(t,e._TempBuffer,4)}},{key:"_updateFloatArrayForEffect",value:function(e,t){this._currentEffect.setFloatArray(e,t)}},{key:"_updateFloatArrayForUniform",value:function(e,t){this.updateUniformArray(e,t,t.length)}},{key:"_updateArrayForEffect",value:function(e,t){this._currentEffect.setArray(e,t)}},{key:"_updateArrayForUniform",value:function(e,t){this.updateUniformArray(e,t,t.length)}},{key:"_updateIntArrayForEffect",value:function(e,t){this._currentEffect.setIntArray(e,t)}},{key:"_updateIntArrayForUniform",value:function(t,n){e._TempBufferInt32View.set(n),this.updateUniformArray(t,e._TempBuffer,n.length)}},{key:"_updateMatrixForEffect",value:function(e,t){this._currentEffect.setMatrix(e,t)}},{key:"_updateMatrixForUniform",value:function(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.toArray(),16)}},{key:"_updateMatricesForEffect",value:function(e,t){this._currentEffect.setMatrices(e,t)}},{key:"_updateMatricesForUniform",value:function(e,t){this.updateUniform(e,t,t.length)}},{key:"_updateVector3ForEffect",value:function(e,t){this._currentEffect.setVector3(e,t)}},{key:"_updateVector3ForUniform",value:function(t,n){e._TempBuffer[0]=n.x,e._TempBuffer[1]=n.y,e._TempBuffer[2]=n.z,this.updateUniform(t,e._TempBuffer,3)}},{key:"_updateVector4ForEffect",value:function(e,t){this._currentEffect.setVector4(e,t)}},{key:"_updateVector4ForUniform",value:function(t,n){e._TempBuffer[0]=n.x,e._TempBuffer[1]=n.y,e._TempBuffer[2]=n.z,e._TempBuffer[3]=n.w,this.updateUniform(t,e._TempBuffer,4)}},{key:"_updateColor3ForEffect",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(e+n,t)}},{key:"_updateColor3ForUniform",value:function(t,n){e._TempBuffer[0]=n.r,e._TempBuffer[1]=n.g,e._TempBuffer[2]=n.b,this.updateUniform(t,e._TempBuffer,3)}},{key:"_updateColor4ForEffect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(e+i,t,n)}},{key:"_updateDirectColor4ForEffect",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(e+n,t)}},{key:"_updateColor4ForUniform",value:function(t,n,i){e._TempBuffer[0]=n.r,e._TempBuffer[1]=n.g,e._TempBuffer[2]=n.b,e._TempBuffer[3]=i,this.updateUniform(t,e._TempBuffer,4)}},{key:"_updateDirectColor4ForUniform",value:function(t,n){e._TempBuffer[0]=n.r,e._TempBuffer[1]=n.g,e._TempBuffer[2]=n.b,e._TempBuffer[3]=n.a,this.updateUniform(t,e._TempBuffer,4)}},{key:"_updateIntForEffect",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(e+n,t)}},{key:"_updateIntForUniform",value:function(t,n){e._TempBufferInt32View[0]=n,this.updateUniform(t,e._TempBuffer,1)}},{key:"_updateInt2ForEffect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(e+i,t,n)}},{key:"_updateInt2ForUniform",value:function(t,n,i){e._TempBufferInt32View[0]=n,e._TempBufferInt32View[1]=i,this.updateUniform(t,e._TempBuffer,2)}},{key:"_updateInt3ForEffect",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(e+r,t,n,i)}},{key:"_updateInt3ForUniform",value:function(t,n,i,r){e._TempBufferInt32View[0]=n,e._TempBufferInt32View[1]=i,e._TempBufferInt32View[2]=r,this.updateUniform(t,e._TempBuffer,3)}},{key:"_updateInt4ForEffect",value:function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(e+a,t,n,i,r)}},{key:"_updateInt4ForUniform",value:function(t,n,i,r,a){e._TempBufferInt32View[0]=n,e._TempBufferInt32View[1]=i,e._TempBufferInt32View[2]=r,e._TempBufferInt32View[3]=a,this.updateUniform(t,e._TempBuffer,4)}},{key:"setTexture",value:function(e,t){this._currentEffect.setTexture(e,t)}},{key:"updateUniformDirectly",value:function(e,t){this.updateUniform(e,t,t.length),this.update()}},{key:"bindToEffect",value:function(e,t){this._currentEffect=e,this._currentEffectName=t}},{key:"bindUniformBuffer",value:function(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}},{key:"unbindEffect",value:function(){this._currentEffect=void 0,this._currentEffectName=void 0}},{key:"setDataBuffer",value:function(e){if(!this._buffers)return this._buffer===e;for(var t=0;t<this._buffers.length;++t){if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}},{key:"dispose",value:function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(var n=0;n<this._buffers.length;++n){var i=this._buffers[n][0];this._engine._releaseBuffer(i)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}}]),e}();u._UpdatedUbosInFrame={},u._MAX_UNIFORM_SIZE=256,u._TempBuffer=new Float32Array(u._MAX_UNIFORM_SIZE),u._TempBufferInt32View=new Uint32Array(u._TempBuffer.buffer)},7702:function(e,t,n){"use strict";n.d(t,{RD:function(){return l},T:function(){return i}});var i,r=n(3144),a=n(5671),o=n(6900);!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD",e[e.BONE=2]="BONE"}(i||(i={}));var s,l=(0,r.Z)((function e(){(0,a.Z)(this,e)}));l.X=new o.P(1,0,0),l.Y=new o.P(0,1,0),l.Z=new o.P(0,0,1),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(s||(s={}))},7046:function(e,t,n){"use strict";n.d(t,{HE:function(){return c},Wo:function(){return u},zZ:function(){return h}});var i=n(5671),r=n(3144),a=n(5602),o=n(3681),s=n(8134),l=n(1704),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,i.Z)(this,e),this.r=t,this.g=n,this.b=r}return(0,r.Z)(e,[{key:"toString",value:function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}},{key:"getClassName",value:function(){return"Color3"}},{key:"getHashCode",value:function(){var e=255*this.r|0;return e=397*(e=397*e^(255*this.g|0))^(255*this.b|0)}},{key:"toArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this}},{key:"fromArray",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.FromArrayToRef(t,n,this),this}},{key:"toColor4",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new c(this.r,this.g,this.b,e)}},{key:"asArray",value:function(){return[this.r,this.g,this.b]}},{key:"toLuminance",value:function(){return.3*this.r+.59*this.g+.11*this.b}},{key:"multiply",value:function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)}},{key:"multiplyToRef",value:function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this}},{key:"equals",value:function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b}},{key:"equalsFloats",value:function(e,t,n){return this.r===e&&this.g===t&&this.b===n}},{key:"scale",value:function(t){return new e(this.r*t,this.g*t,this.b*t)}},{key:"scaleInPlace",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"scaleToRef",value:function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this}},{key:"scaleAndAddToRef",value:function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this}},{key:"clampToRef",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;return n.r=a.R.Clamp(this.r,e,t),n.g=a.R.Clamp(this.g,e,t),n.b=a.R.Clamp(this.b,e,t),this}},{key:"add",value:function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)}},{key:"addToRef",value:function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this}},{key:"subtract",value:function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)}},{key:"subtractToRef",value:function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this}},{key:"clone",value:function(){return new e(this.r,this.g,this.b)}},{key:"copyFrom",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copyFromFloats",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"set",value:function(e,t,n){return this.copyFromFloats(e,t,n)}},{key:"toHexString",value:function(){var e=Math.round(255*this.r),t=Math.round(255*this.g),n=Math.round(255*this.b);return"#"+a.R.ToHex(e)+a.R.ToHex(t)+a.R.ToHex(n)}},{key:"toLinearSpace",value:function(){var t=new e;return this.toLinearSpaceToRef(t),t}},{key:"toHSV",value:function(){var t=new e;return this.toHSVToRef(t),t}},{key:"toHSVToRef",value:function(e){var t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),a=Math.min(t,n,i),o=0,s=0,l=r,u=r-a;0!==r&&(s=u/r),r!=a&&(r==t?(o=(n-i)/u,n<i&&(o+=6)):r==n?o=(i-t)/u+2:r==i&&(o=(t-n)/u+4),o*=60),e.r=o,e.g=s,e.b=l}},{key:"toLinearSpaceToRef",value:function(e){return e.r=Math.pow(this.r,o.Nn),e.g=Math.pow(this.g,o.Nn),e.b=Math.pow(this.b,o.Nn),this}},{key:"toGammaSpace",value:function(){var t=new e;return this.toGammaSpaceToRef(t),t}},{key:"toGammaSpaceToRef",value:function(e){return e.r=Math.pow(this.r,o.zp),e.g=Math.pow(this.g,o.zp),e.b=Math.pow(this.b,o.zp),this}}],[{key:"HSVtoRGBToRef",value:function(e,t,n,i){var r=n*t,a=e/60,o=r*(1-Math.abs(a%2-1)),s=0,l=0,u=0;a>=0&&a<=1?(s=r,l=o):a>=1&&a<=2?(s=o,l=r):a>=2&&a<=3?(l=r,u=o):a>=3&&a<=4?(l=o,u=r):a>=4&&a<=5?(s=o,u=r):a>=5&&a<=6&&(s=r,u=o);var c=n-r;i.set(s+c,l+c,u+c)}},{key:"FromHSV",value:function(t,n,i){var r=new e(0,0,0);return e.HSVtoRGBToRef(t,n,i,r),r}},{key:"FromHexString",value:function(t){if("#"!==t.substring(0,1)||7!==t.length)return new e(0,0,0);var n=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16);return e.FromInts(n,i,r)}},{key:"FromArray",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new e(t[n],t[n+1],t[n+2])}},{key:"FromArrayToRef",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;n.r=e[t],n.g=e[t+1],n.b=e[t+2]}},{key:"FromInts",value:function(t,n,i){return new e(t/255,n/255,i/255)}},{key:"Lerp",value:function(t,n,i){var r=new e(0,0,0);return e.LerpToRef(t,n,i,r),r}},{key:"LerpToRef",value:function(e,t,n,i){i.r=e.r+(t.r-e.r)*n,i.g=e.g+(t.g-e.g)*n,i.b=e.b+(t.b-e.b)*n}},{key:"Hermite",value:function(t,n,i,r,a){var o=a*a,s=a*o,l=2*s-3*o+1,u=-2*s+3*o,c=s-2*o+a,h=s-o;return new e(t.r*l+i.r*u+n.r*c+r.r*h,t.g*l+i.g*u+n.g*c+r.g*h,t.b*l+i.b*u+n.b*c+r.b*h)}},{key:"Hermite1stDerivative",value:function(t,n,i,r,a){var o=e.Black();return this.Hermite1stDerivativeToRef(t,n,i,r,a,o),o}},{key:"Hermite1stDerivativeToRef",value:function(e,t,n,i,r,a){var o=r*r;a.r=6*(o-r)*e.r+(3*o-4*r+1)*t.r+6*(-o+r)*n.r+(3*o-2*r)*i.r,a.g=6*(o-r)*e.g+(3*o-4*r+1)*t.g+6*(-o+r)*n.g+(3*o-2*r)*i.g,a.b=6*(o-r)*e.b+(3*o-4*r+1)*t.b+6*(-o+r)*n.b+(3*o-2*r)*i.b}},{key:"Red",value:function(){return new e(1,0,0)}},{key:"Green",value:function(){return new e(0,1,0)}},{key:"Blue",value:function(){return new e(0,0,1)}},{key:"Black",value:function(){return new e(0,0,0)}},{key:"BlackReadOnly",get:function(){return e._BlackReadOnly}},{key:"White",value:function(){return new e(1,1,1)}},{key:"Purple",value:function(){return new e(.5,0,.5)}},{key:"Magenta",value:function(){return new e(1,0,1)}},{key:"Yellow",value:function(){return new e(1,1,0)}},{key:"Gray",value:function(){return new e(.5,.5,.5)}},{key:"Teal",value:function(){return new e(0,1,1)}},{key:"Random",value:function(){return new e(Math.random(),Math.random(),Math.random())}}]),e}();u._BlackReadOnly=u.Black();var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,i.Z)(this,e),this.r=t,this.g=n,this.b=r,this.a=a}return(0,r.Z)(e,[{key:"addInPlace",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}},{key:"asArray",value:function(){return[this.r,this.g,this.b,this.a]}},{key:"toArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this}},{key:"fromArray",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.FromArrayToRef(t,n,this),this}},{key:"equals",value:function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}},{key:"add",value:function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}},{key:"subtract",value:function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}},{key:"subtractToRef",value:function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this}},{key:"scale",value:function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)}},{key:"scaleInPlace",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}},{key:"scaleToRef",value:function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this}},{key:"scaleAndAddToRef",value:function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this}},{key:"clampToRef",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;return n.r=a.R.Clamp(this.r,e,t),n.g=a.R.Clamp(this.g,e,t),n.b=a.R.Clamp(this.b,e,t),n.a=a.R.Clamp(this.a,e,t),this}},{key:"multiply",value:function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}},{key:"multiplyToRef",value:function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t}},{key:"toString",value:function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}},{key:"getClassName",value:function(){return"Color4"}},{key:"getHashCode",value:function(){var e=255*this.r|0;return e=397*(e=397*(e=397*e^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)}},{key:"clone",value:function(){return new e(this.r,this.g,this.b,this.a)}},{key:"copyFrom",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}},{key:"copyFromFloats",value:function(e,t,n,i){return this.r=e,this.g=t,this.b=n,this.a=i,this}},{key:"set",value:function(e,t,n,i){return this.copyFromFloats(e,t,n,i)}},{key:"toHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Math.round(255*this.r),n=Math.round(255*this.g),i=Math.round(255*this.b);if(e)return"#"+a.R.ToHex(t)+a.R.ToHex(n)+a.R.ToHex(i);var r=Math.round(255*this.a);return"#"+a.R.ToHex(t)+a.R.ToHex(n)+a.R.ToHex(i)+a.R.ToHex(r)}},{key:"toLinearSpace",value:function(){var t=new e;return this.toLinearSpaceToRef(t),t}},{key:"toLinearSpaceToRef",value:function(e){return e.r=Math.pow(this.r,o.Nn),e.g=Math.pow(this.g,o.Nn),e.b=Math.pow(this.b,o.Nn),e.a=this.a,this}},{key:"toGammaSpace",value:function(){var t=new e;return this.toGammaSpaceToRef(t),t}},{key:"toGammaSpaceToRef",value:function(e){return e.r=Math.pow(this.r,o.zp),e.g=Math.pow(this.g,o.zp),e.b=Math.pow(this.b,o.zp),e.a=this.a,this}}],[{key:"FromHexString",value:function(t){if("#"!==t.substring(0,1)||9!==t.length&&7!==t.length)return new e(0,0,0,0);var n=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16),a=9===t.length?parseInt(t.substring(7,9),16):255;return e.FromInts(n,i,r,a)}},{key:"Lerp",value:function(t,n,i){var r=new e(0,0,0,0);return e.LerpToRef(t,n,i,r),r}},{key:"LerpToRef",value:function(e,t,n,i){i.r=e.r+(t.r-e.r)*n,i.g=e.g+(t.g-e.g)*n,i.b=e.b+(t.b-e.b)*n,i.a=e.a+(t.a-e.a)*n}},{key:"Hermite",value:function(t,n,i,r,a){var o=a*a,s=a*o,l=2*s-3*o+1,u=-2*s+3*o,c=s-2*o+a,h=s-o;return new e(t.r*l+i.r*u+n.r*c+r.r*h,t.g*l+i.g*u+n.g*c+r.g*h,t.b*l+i.b*u+n.b*c+r.b*h,t.a*l+i.a*u+n.a*c+r.a*h)}},{key:"Hermite1stDerivative",value:function(t,n,i,r,a){var o=new e;return this.Hermite1stDerivativeToRef(t,n,i,r,a,o),o}},{key:"Hermite1stDerivativeToRef",value:function(e,t,n,i,r,a){var o=r*r;a.r=6*(o-r)*e.r+(3*o-4*r+1)*t.r+6*(-o+r)*n.r+(3*o-2*r)*i.r,a.g=6*(o-r)*e.g+(3*o-4*r+1)*t.g+6*(-o+r)*n.g+(3*o-2*r)*i.g,a.b=6*(o-r)*e.b+(3*o-4*r+1)*t.b+6*(-o+r)*n.b+(3*o-2*r)*i.b,a.a=6*(o-r)*e.a+(3*o-4*r+1)*t.a+6*(-o+r)*n.a+(3*o-2*r)*i.a}},{key:"FromColor3",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new e(t.r,t.g,t.b,n)}},{key:"FromArray",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new e(t[n],t[n+1],t[n+2],t[n+3])}},{key:"FromArrayToRef",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;n.r=e[t],n.g=e[t+1],n.b=e[t+2],n.a=e[t+3]}},{key:"FromInts",value:function(t,n,i,r){return new e(t/255,n/255,i/255,r/255)}},{key:"CheckColors4",value:function(e,t){if(e.length===3*t){for(var n=[],i=0;i<e.length;i+=3){var r=i/3*4;n[r]=e[i],n[r+1]=e[i+1],n[r+2]=e[i+2],n[r+3]=1}return n}return e}}]),e}(),h=(0,r.Z)((function e(){(0,i.Z)(this,e)}));h.Color3=s.B.BuildArray(3,u.Black),h.Color4=s.B.BuildArray(3,(function(){return new c(0,0,0,0)})),(0,l.H)("BABYLON.Color3",u),(0,l.H)("BABYLON.Color4",c)},3681:function(e,t,n){"use strict";n.d(t,{Nn:function(){return r},kn:function(){return a},zp:function(){return i}});var i=1/2.2,r=2.2,a=(Math.sqrt(5),.001)},2465:function(e,t,n){"use strict";n.d(t,{i:function(){return o}});var i=n(5671),r=n(3144),a=n(3683),o=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"GetPlanes",value:function(t){for(var n=[],i=0;i<6;i++)n.push(new a.J(0,0,0,0));return e.GetPlanesToRef(t,n),n}},{key:"GetNearPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]+n[2],t.normal.y=n[7]+n[6],t.normal.z=n[11]+n[10],t.d=n[15]+n[14],t.normalize()}},{key:"GetFarPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]-n[2],t.normal.y=n[7]-n[6],t.normal.z=n[11]-n[10],t.d=n[15]-n[14],t.normalize()}},{key:"GetLeftPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]+n[0],t.normal.y=n[7]+n[4],t.normal.z=n[11]+n[8],t.d=n[15]+n[12],t.normalize()}},{key:"GetRightPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]-n[0],t.normal.y=n[7]-n[4],t.normal.z=n[11]-n[8],t.d=n[15]-n[12],t.normalize()}},{key:"GetTopPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]-n[1],t.normal.y=n[7]-n[5],t.normal.z=n[11]-n[9],t.d=n[15]-n[13],t.normalize()}},{key:"GetBottomPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]+n[1],t.normal.y=n[7]+n[5],t.normal.z=n[11]+n[9],t.d=n[15]+n[13],t.normalize()}},{key:"GetPlanesToRef",value:function(t,n){e.GetNearPlaneToRef(t,n[0]),e.GetFarPlaneToRef(t,n[1]),e.GetLeftPlaneToRef(t,n[2]),e.GetRightPlaneToRef(t,n[3]),e.GetTopPlaneToRef(t,n[4]),e.GetBottomPlaneToRef(t,n[5])}}]),e}()},7721:function(e,t,n){"use strict";n.d(t,{k:function(){return c},y:function(){return u}});var i=n(5671),r=n(3144),a=n(9477),o=n(6900),s=n(9336),l=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"extractMinAndMaxIndexed",value:function(e,t,n,i,r,a){for(var o=n;o<n+i;o++){var s=3*t[o],l=e[s],u=e[s+1],c=e[s+2];r.minimizeInPlaceFromFloats(l,u,c),a.maximizeInPlaceFromFloats(l,u,c)}}},{key:"extractMinAndMax",value:function(e,t,n,i,r,a){for(var o=t,s=t*i;o<t+n;o++,s+=i){var l=e[s],u=e[s+1],c=e[s+2];r.minimizeInPlaceFromFloats(l,u,c),a.maximizeInPlaceFromFloats(l,u,c)}}}]),e}();function u(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return l.extractMinAndMaxIndexed(e,t,n,i,a,s),r&&(a.x-=a.x*r.x+r.y,a.y-=a.y*r.x+r.y,a.z-=a.z*r.x+r.y,s.x+=s.x*r.x+r.y,s.y+=s.y*r.x+r.y,s.z+=s.z*r.x+r.y),{minimum:a,maximum:s}}function c(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4?arguments[4]:void 0,a=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return r||(r=3),l.extractMinAndMax(e,t,n,r,a,s),i&&(a.x-=a.x*i.x+i.y,a.y-=a.y*i.x+i.y,a.z-=a.z*i.x+i.y,s.x+=s.x*i.x+i.y,s.y+=s.y*i.x+i.y,s.z+=s.z*i.x+i.y),{minimum:a,maximum:s}}(0,a.gn)([s.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0],r=t[1];return!Array.isArray(i)&&!Array.isArray(r)}))],l,"extractMinAndMaxIndexed",null),(0,a.gn)([s.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];return!Array.isArray(i)}))],l,"extractMinAndMax",null)},3683:function(e,t,n){"use strict";n.d(t,{J:function(){return o}});var i=n(5671),r=n(3144),a=n(6900),o=function(){function e(t,n,r,o){(0,i.Z)(this,e),this.normal=new a.P(t,n,r),this.d=o}return(0,r.Z)(e,[{key:"asArray",value:function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}},{key:"clone",value:function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)}},{key:"getClassName",value:function(){return"Plane"}},{key:"getHashCode",value:function(){var e=this.normal.getHashCode();return e=397*e^(0|this.d)}},{key:"normalize",value:function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}},{key:"transform",value:function(t){var n=e._TmpMatrix;t.invertToRef(n);var i=n.m,r=this.normal.x,a=this.normal.y,o=this.normal.z,s=this.d;return new e(r*i[0]+a*i[1]+o*i[2]+s*i[3],r*i[4]+a*i[5]+o*i[6]+s*i[7],r*i[8]+a*i[9]+o*i[10]+s*i[11],r*i[12]+a*i[13]+o*i[14]+s*i[15])}},{key:"dotCoordinate",value:function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}},{key:"copyFromPoints",value:function(e,t,n){var i,r=t.x-e.x,a=t.y-e.y,o=t.z-e.z,s=n.x-e.x,l=n.y-e.y,u=n.z-e.z,c=a*u-o*l,h=o*s-r*u,f=r*l-a*s,d=Math.sqrt(c*c+h*h+f*f);return i=0!==d?1/d:0,this.normal.x=c*i,this.normal.y=h*i,this.normal.z=f*i,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}},{key:"isFrontFacingTo",value:function(e,t){return a.P.Dot(this.normal,e)<=t}},{key:"signedDistanceTo",value:function(e){return a.P.Dot(e,this.normal)+this.d}}],[{key:"FromArray",value:function(t){return new e(t[0],t[1],t[2],t[3])}},{key:"FromPoints",value:function(t,n,i){var r=new e(0,0,0,0);return r.copyFromPoints(t,n,i),r}},{key:"FromPositionAndNormal",value:function(t,n){var i=new e(0,0,0,0);return n.normalize(),i.normal=n,i.d=-(n.x*t.x+n.y*t.y+n.z*t.z),i}},{key:"SignedDistanceToPlaneFromPositionAndNormal",value:function(e,t,n){var i=-(t.x*e.x+t.y*e.y+t.z*e.z);return a.P.Dot(n,t)+i}}]),e}();o._TmpMatrix=a.y3.Identity()},5602:function(e,t,n){"use strict";n.d(t,{R:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"WithinEpsilon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(e-t)<=n}},{key:"ToHex",value:function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()}},{key:"Sign",value:function(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1}},{key:"Clamp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(t,e))}},{key:"Log2",value:function(e){return Math.log(e)*Math.LOG2E}},{key:"ILog2",value:function(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;var t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t}},{key:"Repeat",value:function(e,t){return e-Math.floor(e/t)*t}},{key:"Normalize",value:function(e,t,n){return(e-t)/(n-t)}},{key:"Denormalize",value:function(e,t,n){return e*(n-t)+t}},{key:"DeltaAngle",value:function(t,n){var i=e.Repeat(n-t,360);return i>180&&(i-=360),i}},{key:"PingPong",value:function(t,n){var i=e.Repeat(t,2*n);return n-Math.abs(i-n)}},{key:"SmoothStep",value:function(t,n,i){var r=e.Clamp(i);return n*(r=-2*r*r*r+3*r*r)+t*(1-r)}},{key:"MoveTowards",value:function(t,n,i){return Math.abs(n-t)<=i?n:t+e.Sign(n-t)*i}},{key:"MoveTowardsAngle",value:function(t,n,i){var r=e.DeltaAngle(t,n),a=0;return-i<r&&r<i?a=n:(n=t+r,a=e.MoveTowards(t,n,i)),a}},{key:"Lerp",value:function(e,t,n){return e+(t-e)*n}},{key:"LerpAngle",value:function(t,n,i){var r=e.Repeat(n-t,360);return r>180&&(r-=360),t+r*e.Clamp(i)}},{key:"InverseLerp",value:function(t,n,i){return t!=n?e.Clamp((i-t)/(n-t)):0}},{key:"Hermite",value:function(e,t,n,i,r){var a=r*r,o=r*a;return e*(2*o-3*a+1)+n*(-2*o+3*a)+t*(o-2*a+r)+i*(o-a)}},{key:"Hermite1stDerivative",value:function(e,t,n,i,r){var a=r*r;return 6*(a-r)*e+(3*a-4*r+1)*t+6*(-a+r)*n+(3*a-2*r)*i}},{key:"RandomRange",value:function(e,t){return e===t?e:Math.random()*(t-e)+e}},{key:"RangeToPercent",value:function(e,t,n){return(e-t)/(n-t)}},{key:"PercentToRange",value:function(e,t,n){return(n-t)*e+t}},{key:"NormalizeRadians",value:function(t){return t-=e.TwoPi*Math.floor((t+Math.PI)/e.TwoPi)}},{key:"HCF",value:function(t,n){var i=t%n;return 0===i?n:e.HCF(n,i)}}]),e}();a.TwoPi=2*Math.PI},628:function(e,t,n){"use strict";n.d(t,{l:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(t,n,r,a){(0,i.Z)(this,e),this.x=t,this.y=n,this.width=r,this.height=a}return(0,r.Z)(e,[{key:"toGlobal",value:function(t,n){return new e(this.x*t,this.y*n,this.width*t,this.height*n)}},{key:"toGlobalToRef",value:function(e,t,n){return n.x=this.x*e,n.y=this.y*t,n.width=this.width*e,n.height=this.height*t,this}},{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}}]),e}()},2628:function(e,t,n){"use strict";n.d(t,{M:function(){return u}});var i=n(5671),r=n(3144),a=n(136),o=n(6215),s=n(1120);function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,s.Z)(e);if(t){var r=(0,s.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,o.Z)(this,n)}}var u=function(e){(0,a.Z)(n,e);var t=l(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this))._buffer=e,r}return(0,r.Z)(n,[{key:"underlyingResource",get:function(){return this._buffer}}]),n}(n(7818).h)},9370:function(e,t,n){"use strict";n.d(t,{x:function(){return k}});var i=n(7326),r=n(1752),a=n(136),o=n(6215),s=n(1120),l=n(3144),u=n(5671),c=n(4174),h=n(8911),f=n(6900),d=n(2977),v=n(2845),p=n(4527),_=n(2668),g=n(3541),m=n(9115),y=n(1952),A=(0,l.Z)((function e(){(0,u.Z)(this,e),this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new f.P(0,0,0),this._diffPositionForCollisions=new f.P(0,0,0),this._collisionResponse=!0})),E=n(5230),b=n(7721),T=n(7046),S=n(3681),M=n(7702),I=n(1704);function P(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,s.Z)(e);if(t){var r=(0,s.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,o.Z)(this,n)}}var D=(0,l.Z)((function e(){(0,u.Z)(this,e),this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=f.P.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1})),R=(0,l.Z)((function e(){(0,u.Z)(this,e),this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new D,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._meshCollisionData=new A,this._enableDistantPicking=!1})),k=function(e){(0,a.Z)(n,e);var t=x(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch((0,u.Z)(this,n),(r=t.call(this,e,a,!1))._internalAbstractMeshDataInfo=new R,r._waitingMaterialId=null,r.cullingStrategy=n.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,r.onCollideObservable=new c.y$,r.onCollisionPositionChangeObservable=new c.y$,r.onMaterialChangedObservable=new c.y$,r.definedFacingForward=!0,r._occlusionQuery=null,r._renderingGroup=null,r.alphaIndex=Number.MAX_VALUE,r.isVisible=!0,r.isPickable=!0,r.isNearPickable=!1,r.isNearGrabbable=!1,r.showSubMeshesBoundingBox=!1,r.isBlocker=!1,r.enablePointerMoveEvents=!1,r.outlineColor=T.Wo.Red(),r.outlineWidth=.02,r.overlayColor=T.Wo.Red(),r.overlayAlpha=.5,r.useOctreeForRenderingSelection=!0,r.useOctreeForPicking=!0,r.useOctreeForCollisions=!0,r.alwaysSelectAsActiveMesh=!1,r.doNotSyncBoundingInfo=!1,r.actionManager=null,r.ellipsoid=new f.P(.5,1,.5),r.ellipsoidOffset=new f.P(0,0,0),r.edgesWidth=1,r.edgesColor=new T.HE(1,0,0,1),r._edgesRenderer=null,r._masterMesh=null,r._boundingInfo=null,r._boundingInfoIsDirty=!0,r._renderId=0,r._intersectionsInProgress=new Array,r._unIndexed=!1,r._lightSources=new Array,r._waitingData={lods:null,actions:null,freezeWorldMatrix:null},r._bonesTransformMatrices=null,r._transformMatrixTexture=null,r.onRebuildObservable=new c.y$,r._onCollisionPositionChange=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.subtractToRef(r._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,r._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),r._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>d.D.CollisionsEpsilon&&r.position.addInPlace(r._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),n&&r.onCollideObservable.notifyObservers(n),r.onCollisionPositionChangeObservable.notifyObservers(r.position)},(a=r.getScene()).addMesh((0,i.Z)(r)),r._resyncLightSources(),r._uniformBuffer=new y.M(r.getScene().getEngine(),void 0,void 0,e,!r.getScene().getEngine().isWebGPU),r._buildUniformLayout(),a.performancePriority){case h.a.Aggressive:r.doNotSyncBoundingInfo=!0;case h.a.Intermediate:r.alwaysSelectAsActiveMesh=!0,r.isPickable=!1}return r}return(0,l.Z)(n,[{key:"facetNb",get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb}},{key:"partitioningSubdivisions",get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e}},{key:"partitioningBBoxRatio",get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e}},{key:"mustDepthSortFacets",get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e}},{key:"facetDepthSortFrom",get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e}},{key:"collisionRetryCount",get:function(){return this._internalAbstractMeshDataInfo._collisionRetryCount},set:function(e){this._internalAbstractMeshDataInfo._collisionRetryCount=e}},{key:"isFacetDataEnabled",get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}},{key:"morphTargetManager",get:function(){return this._internalAbstractMeshDataInfo._morphTargetManager},set:function(e){this._internalAbstractMeshDataInfo._morphTargetManager!==e&&(this._internalAbstractMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())}},{key:"bakedVertexAnimationManager",get:function(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager},set:function(e){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==e&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=e,this._markSubMeshesAsAttributesDirty())}},{key:"_syncGeometryWithMorphTargetManager",value:function(){}},{key:"_updateNonUniformScalingState",value:function(e){return!!(0,r.Z)((0,s.Z)(n.prototype),"_updateNonUniformScalingState",this).call(this,e)&&(this._markSubMeshesAsMiscDirty(),!0)}},{key:"onCollide",set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)}},{key:"onCollisionPositionChange",set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)}},{key:"visibility",get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(e){if(this._internalAbstractMeshDataInfo._visibility!==e){var t=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=e,(1===t&&1!==e||1!==t&&1===e)&&this._markSubMeshesAsMiscDirty()}}},{key:"renderingGroupId",get:function(){return this._internalAbstractMeshDataInfo._renderingGroupId},set:function(e){this._internalAbstractMeshDataInfo._renderingGroupId=e}},{key:"material",get:function(){return this._internalAbstractMeshDataInfo._material},set:function(e){this._internalAbstractMeshDataInfo._material!==e&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))}},{key:"getMaterialForRenderPass",value:function(e){var t;return null===(t=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===t?void 0:t[e]}},{key:"setMaterialForRenderPass",value:function(e,t){this.resetDrawCache(e),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[e]=t}},{key:"receiveShadows",get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())}},{key:"hasVertexAlpha",get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}},{key:"useVertexColors",get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())}},{key:"computeBonesUsingShaders",get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}},{key:"numBoneInfluencers",get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())}},{key:"applyFog",get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())}},{key:"enableDistantPicking",get:function(){return this._internalAbstractMeshDataInfo._enableDistantPicking},set:function(e){this._internalAbstractMeshDataInfo._enableDistantPicking=e}},{key:"layerMask",get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())}},{key:"collisionMask",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(e)?-1:e}},{key:"collisionResponse",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=e}},{key:"collisionGroup",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(e)?-1:e}},{key:"surroundingMeshes",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=e}},{key:"lightSources",get:function(){return this._lightSources}},{key:"_positions",get:function(){return null}},{key:"skeleton",get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(e){var t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}},{key:"_buildUniformLayout",value:function(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}},{key:"transferToEffect",value:function(e){var t=this._uniformBuffer;t.updateMatrix("world",e),t.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),t.update()}},{key:"getMeshUniformBuffer",value:function(){return this._uniformBuffer}},{key:"getClassName",value:function(){return"AbstractMesh"}},{key:"toString",value:function(e){var t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var n=this._internalAbstractMeshDataInfo._skeleton;return n&&(t+=", skeleton: "+n.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t}},{key:"_getEffectiveParent",value:function(){return this._masterMesh&&this.billboardMode!==_.Y.BILLBOARDMODE_NONE?this._masterMesh:(0,r.Z)((0,s.Z)(n.prototype),"_getEffectiveParent",this).call(this)}},{key:"_getActionManagerForTrigger",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}},{key:"_rebuild",value:function(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes){var e,t=P(this.subMeshes);try{for(t.s();!(e=t.n()).done;){var n=e.value;n._rebuild()}}catch(i){t.e(i)}finally{t.f()}}}},{key:"_resyncLightSources",value:function(){this._lightSources.length=0;var e,t=P(this.getScene().lights);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isEnabled()&&(n.canAffectMesh(this)&&this._lightSources.push(n))}}catch(i){t.e(i)}finally{t.f()}this._markSubMeshesAsLightDirty()}},{key:"_resyncLightSource",value:function(e){var t=e.isEnabled()&&e.canAffectMesh(this),n=this._lightSources.indexOf(e),i=!1;if(-1===n){if(!t)return;this._lightSources.push(e)}else{if(t)return;i=!0,this._lightSources.splice(n,1)}this._markSubMeshesAsLightDirty(i)}},{key:"_unBindEffect",value:function(){var e,t=P(this.subMeshes);try{for(t.s();!(e=t.n()).done;){e.value.setEffect(null)}}catch(n){t.e(n)}finally{t.f()}}},{key:"_removeLightSource",value:function(e,t){var n=this._lightSources.indexOf(e);-1!==n&&(this._lightSources.splice(n,1),this._markSubMeshesAsLightDirty(t))}},{key:"_markSubMeshesAsDirty",value:function(e){if(this.subMeshes){var t,n=P(this.subMeshes);try{for(n.s();!(t=n.n()).done;)for(var i=t.value,r=0;r<i._drawWrappers.length;++r){var a=i._drawWrappers[r];a&&a.defines&&a.defines.markAllAsDirty&&e(a.defines)}}catch(o){n.e(o)}finally{n.f()}}}},{key:"_markSubMeshesAsLightDirty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((function(t){return t.markAsLightDirty(e)}))}},{key:"_markSubMeshesAsAttributesDirty",value:function(){this._markSubMeshesAsDirty((function(e){return e.markAsAttributesDirty()}))}},{key:"_markSubMeshesAsMiscDirty",value:function(){this._markSubMeshesAsDirty((function(e){return e.markAsMiscDirty()}))}},{key:"markAsDirty",value:function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}},{key:"resetDrawCache",value:function(e){if(this.subMeshes){var t,n=P(this.subMeshes);try{for(n.s();!(t=n.n()).done;){t.value.resetDrawCache(e)}}catch(i){n.e(i)}finally{n.f()}}}},{key:"isBlocked",get:function(){return!1}},{key:"getLOD",value:function(e){return this}},{key:"getTotalVertices",value:function(){return 0}},{key:"getTotalIndices",value:function(){return 0}},{key:"getIndices",value:function(){return null}},{key:"getVerticesData",value:function(e){return null}},{key:"setVerticesData",value:function(e,t,n,i){return this}},{key:"updateVerticesData",value:function(e,t,n,i){return this}},{key:"setIndices",value:function(e,t){return this}},{key:"isVerticesDataPresent",value:function(e){return!1}},{key:"getBoundingInfo",value:function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}},{key:"setBoundingInfo",value:function(e){return this._boundingInfo=e,this}},{key:"hasBoundingInfo",get:function(){return null!==this._boundingInfo}},{key:"buildBoundingInfo",value:function(e,t,n){return this._boundingInfo=new m.j(e,t,n),this._boundingInfo}},{key:"normalizeToUnitCube",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;return(0,r.Z)((0,s.Z)(n.prototype),"normalizeToUnitCube",this).call(this,e,t,i)}},{key:"useBones",get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(v.o.MatricesIndicesKind)&&this.isVerticesDataPresent(v.o.MatricesWeightsKind)}},{key:"_preActivate",value:function(){}},{key:"_preActivateForIntermediateRendering",value:function(e){}},{key:"_activate",value:function(e,t){return this._renderId=e,!0}},{key:"_postActivate",value:function(){}},{key:"_freeze",value:function(){}},{key:"_unFreeze",value:function(){}},{key:"getWorldMatrix",value:function(){return this._masterMesh&&this.billboardMode===_.Y.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():(0,r.Z)((0,s.Z)(n.prototype),"getWorldMatrix",this).call(this)}},{key:"_getWorldMatrixDeterminant",value:function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():(0,r.Z)((0,s.Z)(n.prototype),"_getWorldMatrixDeterminant",this).call(this)}},{key:"isAnInstance",get:function(){return!1}},{key:"hasInstances",get:function(){return!1}},{key:"hasThinInstances",get:function(){return!1}},{key:"movePOV",value:function(e,t,n){return this.position.addInPlace(this.calcMovePOV(e,t,n)),this}},{key:"calcMovePOV",value:function(e,t,n){var i=new f.y3;(this.rotationQuaternion?this.rotationQuaternion:f._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(i);var r=f.P.Zero(),a=this.definedFacingForward?-1:1;return f.P.TransformCoordinatesFromFloatsToRef(e*a,t,n*a,i,r),r}},{key:"rotatePOV",value:function(e,t,n){return this.rotation.addInPlace(this.calcRotatePOV(e,t,n)),this}},{key:"calcRotatePOV",value:function(e,t,n){var i=this.definedFacingForward?1:-1;return new f.P(e*i,t,n*i)}},{key:"refreshBoundingInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(e,t),null),this}},{key:"_refreshBoundingInfo",value:function(e,t){if(e){var n=(0,b.k)(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new m.j(n.minimum,n.maximum)}if(this.subMeshes)for(var i=0;i<this.subMeshes.length;i++)this.subMeshes[i].refreshBoundingInfo(e);this._updateBoundingInfo()}},{key:"_getData",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.o.PositionKind;if((i=null!==(e=i)&&void 0!==e?e:this.getVerticesData(r).slice())&&n&&this.morphTargetManager)for(var a=0,o=0,s=0;s<i.length;s++){for(var l=0;l<this.morphTargetManager.numTargets;l++){var u=this.morphTargetManager.getTarget(l),c=u.influence;if(c>0){var h=u.getPositions();h&&(i[s]+=(h[s]-i[s])*c)}}if(a++,r===v.o.PositionKind&&this._positions&&3===a){a=0;var d=3*o;this._positions[o++].copyFromFloats(i[d],i[d+1],i[d+2])}}if(i&&t&&this.skeleton){var p=this.getVerticesData(v.o.MatricesIndicesKind),_=this.getVerticesData(v.o.MatricesWeightsKind);if(_&&p)for(var g=this.numBoneInfluencers>4,m=g?this.getVerticesData(v.o.MatricesIndicesExtraKind):null,y=g?this.getVerticesData(v.o.MatricesWeightsExtraKind):null,A=this.skeleton.getTransformMatrices(this),E=f.jp.Vector3[0],b=f.jp.Matrix[0],T=f.jp.Matrix[1],S=0,M=0;M<i.length;M+=3,S+=4){b.reset();var I=void 0,P=void 0;for(I=0;I<4;I++)(P=_[S+I])>0&&(f.y3.FromFloat32ArrayToRefScaled(A,Math.floor(16*p[S+I]),P,T),b.addToSelf(T));if(g)for(I=0;I<4;I++)(P=y[S+I])>0&&(f.y3.FromFloat32ArrayToRefScaled(A,Math.floor(16*m[S+I]),P,T),b.addToSelf(T));r===v.o.NormalKind?f.P.TransformNormalFromFloatsToRef(i[M],i[M+1],i[M+2],b,E):f.P.TransformCoordinatesFromFloatsToRef(i[M],i[M+1],i[M+2],b,E),E.toArray(i,M),r===v.o.PositionKind&&this._positions&&this._positions[M/3].copyFrom(E)}}return i}},{key:"getNormalsData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData(e,t,null,v.o.NormalKind)}},{key:"getPositionData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;return this._getData(e,t,n,v.o.PositionKind)}},{key:"_getPositionData",value:function(e,t){var n=this.getVerticesData(v.o.PositionKind);if(this._internalAbstractMeshDataInfo._positions&&(this._internalAbstractMeshDataInfo._positions=null),n&&(e&&this.skeleton||t&&this.morphTargetManager)){if(n=n.slice(),this._generatePointsArray(),this._positions){var i=this._positions;this._internalAbstractMeshDataInfo._positions=new Array(i.length);for(var r=0;r<i.length;r++){var a;this._internalAbstractMeshDataInfo._positions[r]=(null===(a=i[r])||void 0===a?void 0:a.clone())||new f.P}}return this.getPositionData(e,t,n)}return n}},{key:"_updateBoundingInfo",value:function(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new m.j(f.P.Zero(),f.P.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}},{key:"_updateSubMeshesBoundingInfo",value:function(e){if(!this.subMeshes)return this;for(var t=this.subMeshes.length,n=0;n<t;n++){var i=this.subMeshes[n];(t>1||!i.IsGlobal)&&i.updateBoundingInfo(e)}return this}},{key:"_afterComputeWorldMatrix",value:function(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}},{key:"isInFrustum",value:function(e){return this.getBoundingInfo().isInFrustum(e,this.cullingStrategy)}},{key:"isCompletelyInFrustum",value:function(e){return this.getBoundingInfo().isCompletelyInFrustum(e)}},{key:"intersectsMesh",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,i=this.getBoundingInfo(),r=e.getBoundingInfo();if(i.intersects(r,t))return!0;if(n){var a,o=P(this.getChildMeshes());try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.intersectsMesh(e,t,!0))return!0}}catch(l){o.e(l)}finally{o.f()}}return!1}},{key:"intersectsPoint",value:function(e){return this.getBoundingInfo().intersectsPoint(e)}},{key:"checkCollisions",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=e}},{key:"collider",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}},{key:"moveWithCollisions",value:function(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);var t=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=t.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,e,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}},{key:"_collideForSubMesh",value:function(e,t,n){var i;if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var r=e.verticesStart,a=e.verticesStart+e.verticesCount,o=r;o<a;o++)e._lastColliderWorldVertices.push(f.P.TransformCoordinates(this._positions[o],t))}return n._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this,this._shouldConvertRHS(),7===(null===(i=e.getMaterial())||void 0===i?void 0:i.fillMode)),this}},{key:"_processCollisionsForSubMeshes",value:function(e,t){for(var n=this._scene.getCollidingSubMeshCandidates(this,e),i=n.length,r=0;r<i;r++){var a=n.data[r];i>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}return this}},{key:"_shouldConvertRHS",value:function(){return!1}},{key:"_checkCollision",value:function(e){if(!this.getBoundingInfo()._checkCollision(e))return this;var t=f.jp.Matrix[0],n=f.jp.Matrix[1];return f.y3.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,n),this._processCollisionsForSubMeshes(e,n),this}},{key:"_generatePointsArray",value:function(){return!1}},{key:"intersects",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=new g.p,s="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,l=this.getBoundingInfo();if(!this.subMeshes)return o;if(!(a||e.intersectsSphere(l.boundingSphere,s)&&e.intersectsBox(l.boundingBox,s)))return o;if(i)return o.hit=!a,o.pickedMesh=a?null:this,o.distance=a?0:f.P.Distance(e.origin,l.boundingSphere.center),o.subMeshId=0,o;if(!this._generatePointsArray())return o;for(var u=null,c=this._scene.getIntersectingSubMeshCandidates(this,e),h=c.length,d=!1,v=0;v<h;v++){var p=c.data[v],_=p.getMaterial();if(_&&(7==_.fillMode||0==_.fillMode||1==_.fillMode||2==_.fillMode||4==_.fillMode)){d=!0;break}}if(!d)return o.hit=!0,o.pickedMesh=this,o.distance=f.P.Distance(e.origin,l.boundingSphere.center),o.subMeshId=-1,o;for(var m=0;m<h;m++){var y=c.data[m];if(!(h>1)||y.canIntersects(e)){var A=y.intersects(e,this._positions,this.getIndices(),t,n);if(A&&(t||!u||A.distance<u.distance)&&((u=A).subMeshId=m,t))break}}if(u){var E=null!=r?r:this.getWorldMatrix(),b=f.jp.Vector3[0],T=f.jp.Vector3[1];f.P.TransformCoordinatesToRef(e.origin,E,b),e.direction.scaleToRef(u.distance,T);var S=f.P.TransformNormal(T,E),M=S.addInPlace(b);return o.hit=!0,o.distance=f.P.Distance(b,M),o.pickedPoint=M,o.pickedMesh=this,o.bu=u.bu||0,o.bv=u.bv||0,o.subMeshFaceId=u.faceId,o.faceId=u.faceId+c.data[u.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),o.subMeshId=u.subMeshId,o}return o}},{key:"clone",value:function(e,t,n){return null}},{key:"releaseSubMeshes",value:function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this}},{key:"dispose",value:function(e){var t,i=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),t=0;t<this._intersectionsInProgress.length;t++){var o=this._intersectionsInProgress[t],l=o._intersectionsInProgress.indexOf(this);o._intersectionsInProgress.splice(l,1)}this._intersectionsInProgress.length=0;var u=this.getScene().lights;u.forEach((function(e){var t=e.includedOnlyMeshes.indexOf(i);-1!==t&&e.includedOnlyMeshes.splice(t,1),-1!==(t=e.excludedMeshes.indexOf(i))&&e.excludedMeshes.splice(t,1);var n=e.getShadowGenerator();if(n){var r=n.getShadowMap();r&&r.renderList&&-1!==(t=r.renderList.indexOf(i))&&r.renderList.splice(t,1)}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var c=this.getScene().getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,c.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),c.wipeCaches(),this.getScene().removeMesh(this),this._parentContainer){var h=this._parentContainer.meshes.indexOf(this);h>-1&&this._parentContainer.meshes.splice(h,1),this._parentContainer=null}if(a&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(t=0;t<this.getScene().particleSystems.length;t++)this.getScene().particleSystems[t].emitter===this&&(this.getScene().particleSystems[t].dispose(),t--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),(0,r.Z)((0,s.Z)(n.prototype),"dispose",this).call(this,e,a)}},{key:"addChild",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.setParent(this,t),this}},{key:"removeChild",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.setParent(null,t),this}},{key:"_initFacetData",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=new Array),e.facetPositions||(e.facetPositions=new Array),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(var t=0;t<e.facetNb;t++)e.facetNormals[t]=f.P.Zero(),e.facetPositions[t]=f.P.Zero();return e.facetDataEnabled=!0,this}},{key:"updateFacetData",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();var t=this.getVerticesData(v.o.PositionKind),n=this.getIndices(),i=this.getVerticesData(v.o.NormalKind),r=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,n instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(n);else if(n instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(n);else{for(var a=!1,o=0;o<n.length;o++)if(n[o]>65535){a=!0;break}e.depthSortedIndices=a?new Uint32Array(n):new Uint16Array(n)}if(e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!e.facetDepthSortFrom){var s=this.getScene().activeCamera;e.facetDepthSortFrom=s?s.position:f.P.Zero()}e.depthSortedFacets=[];for(var l=0;l<e.facetNb;l++){var u={ind:3*l,sqDistance:0};e.depthSortedFacets.push(u)}e.invertedMatrix=f.y3.Identity(),e.facetDepthSortOrigin=f.P.Zero()}e.bbSize.x=r.maximum.x-r.minimum.x>S.kn?r.maximum.x-r.minimum.x:S.kn,e.bbSize.y=r.maximum.y-r.minimum.y>S.kn?r.maximum.y-r.minimum.y:S.kn,e.bbSize.z=r.maximum.z-r.minimum.z>S.kn?r.maximum.z-r.minimum.z:S.kn;var c=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(c=c>e.bbSize.z?c:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/c),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/c),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/c),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=r,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),f.P.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,i&&p.x.ComputeNormals(t,n,i,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);for(var h=e.depthSortedIndices.length/3|0,d=0;d<h;d++){var _=e.depthSortedFacets[d].ind;e.depthSortedIndices[3*d]=n[_],e.depthSortedIndices[3*d+1]=n[_+1],e.depthSortedIndices[3*d+2]=n[_+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this}},{key:"getFacetLocalNormals",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals}},{key:"getFacetLocalPositions",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions}},{key:"getFacetLocalPartitioning",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning}},{key:"getFacetPosition",value:function(e){var t=f.P.Zero();return this.getFacetPositionToRef(e,t),t}},{key:"getFacetPositionToRef",value:function(e,t){var n=this.getFacetLocalPositions()[e],i=this.getWorldMatrix();return f.P.TransformCoordinatesToRef(n,i,t),this}},{key:"getFacetNormal",value:function(e){var t=f.P.Zero();return this.getFacetNormalToRef(e,t),t}},{key:"getFacetNormalToRef",value:function(e,t){var n=this.getFacetLocalNormals()[e];return f.P.TransformNormalToRef(n,this.getWorldMatrix(),t),this}},{key:"getFacetsAtLocalCoordinates",value:function(e,t,n){var i=this.getBoundingInfo(),r=this._internalAbstractMeshDataInfo._facetData,a=Math.floor((e-i.minimum.x*r.partitioningBBoxRatio)*r.subDiv.X*r.partitioningBBoxRatio/r.bbSize.x),o=Math.floor((t-i.minimum.y*r.partitioningBBoxRatio)*r.subDiv.Y*r.partitioningBBoxRatio/r.bbSize.y),s=Math.floor((n-i.minimum.z*r.partitioningBBoxRatio)*r.subDiv.Z*r.partitioningBBoxRatio/r.bbSize.z);return a<0||a>r.subDiv.max||o<0||o>r.subDiv.max||s<0||s>r.subDiv.max?null:r.facetPartitioning[a+r.subDiv.max*o+r.subDiv.max*r.subDiv.max*s]}},{key:"getClosestFacetAtCoordinates",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=this.getWorldMatrix(),s=f.jp.Matrix[5];o.invertToRef(s);var l=f.jp.Vector3[8];f.P.TransformCoordinatesFromFloatsToRef(e,t,n,s,l);var u=this.getClosestFacetAtLocalCoordinates(l.x,l.y,l.z,i,r,a);return i&&f.P.TransformCoordinatesFromFloatsToRef(i.x,i.y,i.z,o,i),u}},{key:"getClosestFacetAtLocalCoordinates",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=null,s=0,l=0,u=0,c=0,h=0,f=0,d=0,v=0,p=this.getFacetLocalPositions(),_=this.getFacetLocalNormals(),g=this.getFacetsAtLocalCoordinates(e,t,n);if(!g)return null;for(var m,y,A,E=Number.MAX_VALUE,b=E,T=0;T<g.length;T++)y=_[m=g[T]],c=(e-(A=p[m]).x)*y.x+(t-A.y)*y.y+(n-A.z)*y.z,(!r||r&&a&&c>=0||r&&!a&&c<=0)&&(c=y.x*A.x+y.y*A.y+y.z*A.z,h=-(y.x*e+y.y*t+y.z*n-c)/(y.x*y.x+y.y*y.y+y.z*y.z),(b=(s=(f=e+y.x*h)-e)*s+(l=(d=t+y.y*h)-t)*l+(u=(v=n+y.z*h)-n)*u)<E&&(E=b,o=m,i&&(i.x=f,i.y=d,i.z=v)));return o}},{key:"getFacetDataParameters",value:function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}},{key:"disableFacetData",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=new Array,e.facetNormals=new Array,e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this}},{key:"updateIndices",value:function(e,t){return this}},{key:"createNormals",value:function(e){var t,n=this.getVerticesData(v.o.PositionKind),i=this.getIndices();return t=this.isVerticesDataPresent(v.o.NormalKind)?this.getVerticesData(v.o.NormalKind):[],p.x.ComputeNormals(n,i,t,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(v.o.NormalKind,t,e),this}},{key:"alignWithNormal",value:function(e,t){t||(t=M.RD.Y);var n=f.jp.Vector3[0],i=f.jp.Vector3[1];return f.P.CrossToRef(t,e,i),f.P.CrossToRef(e,i,n),this.rotationQuaternion?f._f.RotationQuaternionFromAxisToRef(n,e,i,this.rotationQuaternion):f.P.RotationFromAxisToRef(n,e,i,this.rotation),this}},{key:"_checkOcclusionQuery",value:function(){return!1}},{key:"disableEdgesRendering",value:function(){throw(0,E.S)("EdgesRenderer")}},{key:"enableEdgesRendering",value:function(e,t,n){throw(0,E.S)("EdgesRenderer")}},{key:"getConnectedParticleSystems",value:function(){var e=this;return this._scene.particleSystems.filter((function(t){return t.emitter===e}))}}],[{key:"BILLBOARDMODE_NONE",get:function(){return _.Y.BILLBOARDMODE_NONE}},{key:"BILLBOARDMODE_X",get:function(){return _.Y.BILLBOARDMODE_X}},{key:"BILLBOARDMODE_Y",get:function(){return _.Y.BILLBOARDMODE_Y}},{key:"BILLBOARDMODE_Z",get:function(){return _.Y.BILLBOARDMODE_Z}},{key:"BILLBOARDMODE_ALL",get:function(){return _.Y.BILLBOARDMODE_ALL}},{key:"BILLBOARDMODE_USE_POSITION",get:function(){return _.Y.BILLBOARDMODE_USE_POSITION}}]),n}(_.Y);k.OCCLUSION_TYPE_NONE=0,k.OCCLUSION_TYPE_OPTIMISTIC=1,k.OCCLUSION_TYPE_STRICT=2,k.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,k.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,k.CULLINGSTRATEGY_STANDARD=0,k.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,k.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,k.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,I.H)("BABYLON.AbstractMesh",k)},7662:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var i=n(5671),r=n(3144),a=n(6900),o=n(7046),s=n(4527),l=n(2845),u=n(65),c=n(6639),h=n(9115),f=n(8517),d=n(7032),v=n(7721),p=n(4198),_=n(6176);function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var y=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,i.Z)(this,e),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=n||p.l.LastCreatedScene,this._scene&&(this.id=t,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=a,r?this.setAllVerticesData(r,a):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0)))}return(0,r.Z)(e,[{key:"boundingBias",get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)}},{key:"meshes",get:function(){return this._meshes}},{key:"extend",get:function(){return this._extend}},{key:"getScene",value:function(){return this._scene}},{key:"getEngine",value:function(){return this._engine}},{key:"isReady",value:function(){return 1===this.delayLoadState||0===this.delayLoadState}},{key:"doNotSerialize",get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0}},{key:"_rebuild",value:function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),this._vertexBuffers){this._vertexBuffers[e]._rebuild()}}},{key:"setAllVerticesData",value:function(e,t){e.applyToGeometry(this,t),this._notifyUpdate()}},{key:"setVerticesData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;n&&Array.isArray(t)&&(t=new Float32Array(t));var r=new l.o(this._engine,t,e,n,0===this._meshes.length,i);this.setVerticesBuffer(r)}},{key:"removeVerticesData",value:function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}},{key:"setVerticesBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.getKind();this._vertexBuffers[i]&&n&&this._vertexBuffers[i].dispose(),e._buffer&&e._buffer._increaseReferences(),this._vertexBuffers[i]=e;var r=this._meshes,a=r.length;if(i===l.o.PositionKind){var o=e.getData();null!=t?this._totalVertices=t:null!=o&&(this._totalVertices=o.length/(e.type===l.o.BYTE?e.byteStride:e.byteStride/4)),this._updateExtend(o),this._resetPointsArrayCache();for(var s=0;s<a;s++){var u=r[s];u.buildBoundingInfo(this._extend.minimum,this._extend.maximum),u._createGlobalSubMesh(u.isUnIndexed),u.computeWorldMatrix(!0),u.synchronizeInstances()}}this._notifyUpdate(i)}},{key:"updateVerticesDataDirectly",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,n,i),this._notifyUpdate(e))}},{key:"updateVerticesData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.getVertexBuffer(e);i&&(i.update(t),e===l.o.PositionKind&&this._updateBoundingInfo(n,t),this._notifyUpdate(e))}},{key:"_updateBoundingInfo",value:function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e){var n,i=g(this._meshes);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.hasBoundingInfo?r.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):r.buildBoundingInfo(this._extend.minimum,this._extend.maximum);var a,o=g(r.subMeshes);try{for(o.s();!(a=o.n()).done;){a.value.refreshBoundingInfo()}}catch(s){o.e(s)}finally{o.f()}}}catch(s){i.e(s)}finally{i.f()}}}},{key:"_bind",value:function(e,t,n,i){if(e){void 0===t&&(t=this._indexBuffer);var r=this.getVertexBuffers();if(r)if(t==this._indexBuffer&&(this._vertexArrayObjects||i)){var a=i||this._vertexArrayObjects;a[e.key]||(a[e.key]=this._engine.recordVertexArrayObject(r,t,e,n)),this._engine.bindVertexArrayObject(a[e.key],t)}else this._engine.bindBuffers(r,t,e,n)}}},{key:"getTotalVertices",value:function(){return this.isReady()?this._totalVertices:0}},{key:"getVerticesData",value:function(e,t,n){var i=this.getVertexBuffer(e);return i?i.getFloatData(this._totalVertices,n||t&&1!==this._meshes.length):null}},{key:"isVertexBufferUpdatable",value:function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()}},{key:"getVertexBuffer",value:function(e){return this.isReady()?this._vertexBuffers[e]:null}},{key:"getVertexBuffers",value:function(){return this.isReady()?this._vertexBuffers:null}},{key:"isVerticesDataPresent",value:function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}},{key:"getVerticesDataKinds",value:function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t}},{key:"updateIndices",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){var i=e.length!==this._indices.length;if(n||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),i){var r,a=g(this._meshes);try{for(a.s();!(r=a.n()).done;){var o=r.value;o._createGlobalSubMesh(!0)}}catch(s){a.e(s)}finally{a.f()}}}else this.setIndices(e,null,!0)}},{key:"setIndices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,this._indexBufferIsUpdatable=n,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,n)),null!=t&&(this._totalVertices=t);var i,r=g(this._meshes);try{for(r.s();!(i=r.n()).done;){var a=i.value;a._createGlobalSubMesh(!0),a.synchronizeInstances()}}catch(o){r.e(o)}finally{r.f()}this._notifyUpdate()}},{key:"getTotalIndices",value:function(){return this.isReady()?this._indices.length:0}},{key:"getIndices",value:function(e,t){if(!this.isReady())return null;var n=this._indices;return t||e&&1!==this._meshes.length?n.slice():n}},{key:"getIndexBuffer",value:function(){return this.isReady()?this._indexBuffer:null}},{key:"_releaseVertexArrayObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])}},{key:"releaseForMesh",value:function(e,t){var n=this._meshes,i=n.indexOf(e);-1!==i&&(n.splice(i,1),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject(),e._geometry=null,0===n.length&&t&&this.dispose())}},{key:"applyToMesh",value:function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject();var n=this._meshes;e._geometry=this,e._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),n.push(e),this.isReady()?this._applyToMesh(e):this._boundingInfo&&e.setBoundingInfo(this._boundingInfo)}}},{key:"_updateExtend",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!e&&!(e=this.getVerticesData(l.o.PositionKind)))return;this._extend=(0,v.k)(e,0,this._totalVertices,this.boundingBias,3)}}},{key:"_applyToMesh",value:function(e){var t=this._meshes.length;for(var n in this._vertexBuffers)1===t&&this._vertexBuffers[n].create(),n===l.o.PositionKind&&(this._extend||this._updateExtend(),e.buildBoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(e.isUnIndexed),e._updateBoundingInfo());1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()}},{key:"_notifyUpdate",value:function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e),this._vertexArrayObjects&&this._disposeVertexArrayObjects();var t,n=g(this._meshes);try{for(n.s();!(t=n.n()).done;){t.value._markSubMeshesAsAttributesDirty()}}catch(i){n.e(i)}finally{n.f()}}},{key:"load",value:function(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))}},{key:"_queueLoad",value:function(e,t){var n=this;this.delayLoadingFile&&(e.addPendingData(this),e._loadFile(this.delayLoadingFile,(function(i){if(n._delayLoadingFunction){n._delayLoadingFunction(JSON.parse(i),n),n.delayLoadState=1,n._delayInfo=[],e.removePendingData(n);for(var r=n._meshes,a=r.length,o=0;o<a;o++)n._applyToMesh(r[o]);t&&t()}}),void 0,!0))}},{key:"toLeftHanded",value:function(){var e=this.getIndices(!1);if(null!=e&&e.length>0){for(var t=0;t<e.length;t+=3){var n=e[t+0];e[t+0]=e[t+2],e[t+2]=n}this.setIndices(e)}var i=this.getVerticesData(l.o.PositionKind,!1);if(null!=i&&i.length>0){for(var r=0;r<i.length;r+=3)i[r+2]=-i[r+2];this.setVerticesData(l.o.PositionKind,i,!1)}var a=this.getVerticesData(l.o.NormalKind,!1);if(null!=a&&a.length>0){for(var o=0;o<a.length;o+=3)a[o+2]=-a[o+2];this.setVerticesData(l.o.NormalKind,a,!1)}}},{key:"_resetPointsArrayCache",value:function(){this._positions=null}},{key:"_generatePointsArray",value:function(){if(this._positions)return!0;var e=this.getVerticesData(l.o.PositionKind);if(!e||0===e.length)return!1;for(var t=3*this._positionsCache.length,n=this._positionsCache.length;t<e.length;t+=3,++n)this._positionsCache[n]=a.P.FromArray(e,t);for(var i=0,r=0;i<e.length;i+=3,++r)this._positionsCache[r].set(e[0+i],e[1+i],e[2+i]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0}},{key:"isDisposed",value:function(){return this._isDisposed}},{key:"_disposeVertexArrayObjects",value:function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={};for(var t=this._meshes,n=t.length,i=0;i<n;i++)t[i]._invalidateInstanceVertexArrayObject()}}},{key:"dispose",value:function(){var e,t=this._meshes,n=t.length;for(e=0;e<n;e++)this.releaseForMesh(t[e]);for(var i in this._meshes.length=0,this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[i].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){var r=this._parentContainer.geometries.indexOf(this);r>-1&&this._parentContainer.geometries.splice(r,1),this._parentContainer=null}this._isDisposed=!0}},{key:"copy",value:function(t){var n=new s.x;n.indices=[];var i=this.getIndices();if(i)for(var r=0;r<i.length;r++)n.indices.push(i[r]);var a,o=!1,l=!1;for(a in this._vertexBuffers){var u=this.getVerticesData(a);if(u&&(u instanceof Float32Array?n.set(new Float32Array(u),a):n.set(u.slice(0),a),!l)){var c=this.getVertexBuffer(a);c&&(l=!(o=c.isUpdatable()))}}var f=new e(t,this._scene,n,o);for(a in f.delayLoadState=this.delayLoadState,f.delayLoadingFile=this.delayLoadingFile,f._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)f._delayInfo=f._delayInfo||[],f._delayInfo.push(a);return f._boundingInfo=new h.j(this._extend.minimum,this._extend.maximum),f}},{key:"serialize",value:function(){var e={};return e.id=this.id,e.uniqueId=this.uniqueId,e.updatable=this._updatable,d.$&&d.$.HasTags(this)&&(e.tags=d.$.GetTags(this)),e}},{key:"_toNumberArray",value:function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)}},{key:"clearCachedData",value:function(){for(var e in this._indices=[],this._resetPointsArrayCache(),this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,e)&&(this._vertexBuffers[e]._buffer._data=null)}},{key:"serializeVerticeData",value:function(){var e=this.serialize();return this.isVerticesDataPresent(l.o.PositionKind)&&(e.positions=this._toNumberArray(this.getVerticesData(l.o.PositionKind)),this.isVertexBufferUpdatable(l.o.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(l.o.NormalKind)&&(e.normals=this._toNumberArray(this.getVerticesData(l.o.NormalKind)),this.isVertexBufferUpdatable(l.o.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(l.o.TangentKind)&&(e.tangents=this._toNumberArray(this.getVerticesData(l.o.TangentKind)),this.isVertexBufferUpdatable(l.o.TangentKind)&&(e.tangents._updatable=!0)),this.isVerticesDataPresent(l.o.UVKind)&&(e.uvs=this._toNumberArray(this.getVerticesData(l.o.UVKind)),this.isVertexBufferUpdatable(l.o.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(l.o.UV2Kind)&&(e.uv2s=this._toNumberArray(this.getVerticesData(l.o.UV2Kind)),this.isVertexBufferUpdatable(l.o.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(l.o.UV3Kind)&&(e.uv3s=this._toNumberArray(this.getVerticesData(l.o.UV3Kind)),this.isVertexBufferUpdatable(l.o.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(l.o.UV4Kind)&&(e.uv4s=this._toNumberArray(this.getVerticesData(l.o.UV4Kind)),this.isVertexBufferUpdatable(l.o.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(l.o.UV5Kind)&&(e.uv5s=this._toNumberArray(this.getVerticesData(l.o.UV5Kind)),this.isVertexBufferUpdatable(l.o.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(l.o.UV6Kind)&&(e.uv6s=this._toNumberArray(this.getVerticesData(l.o.UV6Kind)),this.isVertexBufferUpdatable(l.o.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(l.o.ColorKind)&&(e.colors=this._toNumberArray(this.getVerticesData(l.o.ColorKind)),this.isVertexBufferUpdatable(l.o.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(l.o.MatricesIndicesKind)&&(e.matricesIndices=this._toNumberArray(this.getVerticesData(l.o.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(l.o.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(l.o.MatricesWeightsKind)&&(e.matricesWeights=this._toNumberArray(this.getVerticesData(l.o.MatricesWeightsKind)),this.isVertexBufferUpdatable(l.o.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this._toNumberArray(this.getIndices()),e}}],[{key:"CreateGeometryForMesh",value:function(t){var n=new e(e.RandomId(),t.getScene());return n.applyToMesh(t),n}},{key:"ExtractFromMesh",value:function(e,t){var n=e._geometry;return n?n.copy(t):null}},{key:"RandomId",value:function(){return f.w1.RandomId()}},{key:"_GetGeometryByLoadedUniqueId",value:function(e,t){for(var n=0;n<t.geometries.length;n++)if(t.geometries[n]._loadedUniqueId===e)return t.geometries[n];return null}},{key:"_ImportGeometry",value:function(t,n){var i=n.getScene(),r=t.geometryUniqueId,a=t.geometryId;if(r||a){var s=r?this._GetGeometryByLoadedUniqueId(r,i):i.getGeometryById(a);s&&s.applyToMesh(n)}else if(t instanceof ArrayBuffer){var c=n._binaryInfo;if(c.positionsAttrDesc&&c.positionsAttrDesc.count>0){var h=new Float32Array(t,c.positionsAttrDesc.offset,c.positionsAttrDesc.count);n.setVerticesData(l.o.PositionKind,h,!1)}if(c.normalsAttrDesc&&c.normalsAttrDesc.count>0){var f=new Float32Array(t,c.normalsAttrDesc.offset,c.normalsAttrDesc.count);n.setVerticesData(l.o.NormalKind,f,!1)}if(c.tangetsAttrDesc&&c.tangetsAttrDesc.count>0){var d=new Float32Array(t,c.tangetsAttrDesc.offset,c.tangetsAttrDesc.count);n.setVerticesData(l.o.TangentKind,d,!1)}if(c.uvsAttrDesc&&c.uvsAttrDesc.count>0){var v=new Float32Array(t,c.uvsAttrDesc.offset,c.uvsAttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var p=1;p<v.length;p+=2)v[p]=1-v[p];n.setVerticesData(l.o.UVKind,v,!1)}if(c.uvs2AttrDesc&&c.uvs2AttrDesc.count>0){var g=new Float32Array(t,c.uvs2AttrDesc.offset,c.uvs2AttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var m=1;m<g.length;m+=2)g[m]=1-g[m];n.setVerticesData(l.o.UV2Kind,g,!1)}if(c.uvs3AttrDesc&&c.uvs3AttrDesc.count>0){var y=new Float32Array(t,c.uvs3AttrDesc.offset,c.uvs3AttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var A=1;A<y.length;A+=2)y[A]=1-y[A];n.setVerticesData(l.o.UV3Kind,y,!1)}if(c.uvs4AttrDesc&&c.uvs4AttrDesc.count>0){var E=new Float32Array(t,c.uvs4AttrDesc.offset,c.uvs4AttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var b=1;b<E.length;b+=2)E[b]=1-E[b];n.setVerticesData(l.o.UV4Kind,E,!1)}if(c.uvs5AttrDesc&&c.uvs5AttrDesc.count>0){var T=new Float32Array(t,c.uvs5AttrDesc.offset,c.uvs5AttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var S=1;S<T.length;S+=2)T[S]=1-T[S];n.setVerticesData(l.o.UV5Kind,T,!1)}if(c.uvs6AttrDesc&&c.uvs6AttrDesc.count>0){var M=new Float32Array(t,c.uvs6AttrDesc.offset,c.uvs6AttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var I=1;I<M.length;I+=2)M[I]=1-M[I];n.setVerticesData(l.o.UV6Kind,M,!1)}if(c.colorsAttrDesc&&c.colorsAttrDesc.count>0){var P=new Float32Array(t,c.colorsAttrDesc.offset,c.colorsAttrDesc.count);n.setVerticesData(l.o.ColorKind,P,!1,c.colorsAttrDesc.stride)}if(c.matricesIndicesAttrDesc&&c.matricesIndicesAttrDesc.count>0){for(var C=new Int32Array(t,c.matricesIndicesAttrDesc.offset,c.matricesIndicesAttrDesc.count),x=[],D=0;D<C.length;D++){var R=C[D];x.push(255&R),x.push((65280&R)>>8),x.push((16711680&R)>>16),x.push(R>>24&255)}n.setVerticesData(l.o.MatricesIndicesKind,x,!1)}if(c.matricesIndicesExtraAttrDesc&&c.matricesIndicesExtraAttrDesc.count>0){for(var k=new Int32Array(t,c.matricesIndicesExtraAttrDesc.offset,c.matricesIndicesExtraAttrDesc.count),O=[],L=0;L<k.length;L++){var F=k[L];O.push(255&F),O.push((65280&F)>>8),O.push((16711680&F)>>16),O.push(F>>24&255)}n.setVerticesData(l.o.MatricesIndicesExtraKind,O,!1)}if(c.matricesWeightsAttrDesc&&c.matricesWeightsAttrDesc.count>0){var N=new Float32Array(t,c.matricesWeightsAttrDesc.offset,c.matricesWeightsAttrDesc.count);n.setVerticesData(l.o.MatricesWeightsKind,N,!1)}if(c.indicesAttrDesc&&c.indicesAttrDesc.count>0){var w=new Int32Array(t,c.indicesAttrDesc.offset,c.indicesAttrDesc.count);n.setIndices(w,null)}if(c.subMeshesAttrDesc&&c.subMeshesAttrDesc.count>0){var B=new Int32Array(t,c.subMeshesAttrDesc.offset,5*c.subMeshesAttrDesc.count);n.subMeshes=[];for(var U=0;U<c.subMeshesAttrDesc.count;U++){var V=B[5*U+0],W=B[5*U+1],G=B[5*U+2],X=B[5*U+3],z=B[5*U+4];u.P.AddToMesh(V,W,G,X,z,n)}}}else if(t.positions&&t.normals&&t.indices){if(n.setVerticesData(l.o.PositionKind,t.positions,t.positions._updatable),n.setVerticesData(l.o.NormalKind,t.normals,t.normals._updatable),t.tangents&&n.setVerticesData(l.o.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&n.setVerticesData(l.o.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&n.setVerticesData(l.o.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&n.setVerticesData(l.o.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&n.setVerticesData(l.o.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&n.setVerticesData(l.o.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&n.setVerticesData(l.o.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&n.setVerticesData(l.o.ColorKind,o.HE.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,n.setVerticesData(l.o.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{for(var H=[],Z=0;Z<t.matricesIndices.length;Z++){var Y=t.matricesIndices[Z];H.push(255&Y),H.push((65280&Y)>>8),H.push((16711680&Y)>>16),H.push(Y>>24&255)}n.setVerticesData(l.o.MatricesIndicesKind,H,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,n.setVerticesData(l.o.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{for(var K=[],j=0;j<t.matricesIndicesExtra.length;j++){var q=t.matricesIndicesExtra[j];K.push(255&q),K.push((65280&q)>>8),K.push((16711680&q)>>16),K.push(q>>24&255)}n.setVerticesData(l.o.MatricesIndicesExtraKind,K,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(e._CleanMatricesWeights(t,n),n.setVerticesData(l.o.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&n.setVerticesData(l.o.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),n.setIndices(t.indices,null)}if(t.subMeshes){n.subMeshes=[];for(var Q=0;Q<t.subMeshes.length;Q++){var J=t.subMeshes[Q];u.P.AddToMesh(J.materialIndex,J.verticesStart,J.verticesCount,J.indexStart,J.indexCount,n)}}n._shouldGenerateFlatShading&&(n.convertToFlatShadedMesh(),n._shouldGenerateFlatShading=!1),n.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(n)}},{key:"_CleanMatricesWeights",value:function(e,t){var n=.001;if(c.Z.CleanBoneMatrixWeights){var i=0;if(e.skeletonId>-1){var r=t.getScene().getLastSkeletonById(e.skeletonId);if(r){i=r.bones.length;for(var a=t.getVerticesData(l.o.MatricesIndicesKind),o=t.getVerticesData(l.o.MatricesIndicesExtraKind),s=e.matricesWeights,u=e.matricesWeightsExtra,h=e.numBoneInfluencer,f=s.length,d=0;d<f;d+=4){for(var v=0,p=-1,_=0;_<4;_++){var g=s[d+_];v+=g,g<n&&p<0&&(p=_)}if(u)for(var m=0;m<4;m++){var y=u[d+m];v+=y,y<n&&p<0&&(p=m+4)}if((p<0||p>h-1)&&(p=h-1),v>n){for(var A=1/v,E=0;E<4;E++)s[d+E]*=A;if(u)for(var b=0;b<4;b++)u[d+b]*=A}else p>=4?(u[d+p-4]=1-v,o[d+p-4]=i):(s[d+p]=1-v,a[d+p]=i)}t.setVerticesData(l.o.MatricesIndicesKind,a),e.matricesWeightsExtra&&t.setVerticesData(l.o.MatricesIndicesExtraKind,o)}}}}},{key:"Parse",value:function(t,n,i){var r=new e(t.id,n,void 0,t.updatable);return r._loadedUniqueId=t.uniqueId,d.$&&d.$.AddTagsTo(r,t.tags),t.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+t.delayLoadingFile,r._boundingInfo=new h.j(a.P.FromArray(t.boundingBoxMinimum),a.P.FromArray(t.boundingBoxMaximum)),r._delayInfo=[],t.hasUVs&&r._delayInfo.push(l.o.UVKind),t.hasUVs2&&r._delayInfo.push(l.o.UV2Kind),t.hasUVs3&&r._delayInfo.push(l.o.UV3Kind),t.hasUVs4&&r._delayInfo.push(l.o.UV4Kind),t.hasUVs5&&r._delayInfo.push(l.o.UV5Kind),t.hasUVs6&&r._delayInfo.push(l.o.UV6Kind),t.hasColors&&r._delayInfo.push(l.o.ColorKind),t.hasMatricesIndices&&r._delayInfo.push(l.o.MatricesIndicesKind),t.hasMatricesWeights&&r._delayInfo.push(l.o.MatricesWeightsKind),r._delayLoadingFunction=s.x.ImportVertexData):s.x.ImportVertexData(t,r),n.pushGeometry(r,!0),r}}]),e}()},4527:function(e,t,n){"use strict";n.d(t,{x:function(){return y}});var i=n(885),r=n(5671),a=n(3144),o=n(4687),s=n.n(o),l=n(9477),u=n(6900),c=n(2845),h=n(5230),f=n(7046),d=n(2328),v=n(9336),p=n(5203),_=n(8298);function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var y=function(){function e(){(0,r.Z)(this,e),this._applyTo=(0,p.vp)(this._applyToCoroutine.bind(this))}return(0,a.Z)(e,[{key:"set",value:function(e,t){switch(e.length||d.Y.Warn("Setting vertex data kind '".concat(t,"' with an empty array")),t){case c.o.PositionKind:this.positions=e;break;case c.o.NormalKind:this.normals=e;break;case c.o.TangentKind:this.tangents=e;break;case c.o.UVKind:this.uvs=e;break;case c.o.UV2Kind:this.uvs2=e;break;case c.o.UV3Kind:this.uvs3=e;break;case c.o.UV4Kind:this.uvs4=e;break;case c.o.UV5Kind:this.uvs5=e;break;case c.o.UV6Kind:this.uvs6=e;break;case c.o.ColorKind:this.colors=e;break;case c.o.MatricesIndicesKind:this.matricesIndices=e;break;case c.o.MatricesWeightsKind:this.matricesWeights=e;break;case c.o.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case c.o.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}}},{key:"applyToMesh",value:function(e,t){return this._applyTo(e,t,!1),this}},{key:"applyToGeometry",value:function(e,t){return this._applyTo(e,t,!1),this}},{key:"updateMesh",value:function(e){return this._update(e),this}},{key:"updateGeometry",value:function(e){return this._update(e),this}},{key:"_applyToCoroutine",value:s().mark((function e(t){var n,i,r=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]&&r[1],i=r.length>2?r[2]:void 0,!this.positions){e.next=7;break}if(t.setVerticesData(c.o.PositionKind,this.positions,n),!i){e.next=7;break}return void(e.next=7);case 7:if(!this.normals){e.next=12;break}if(t.setVerticesData(c.o.NormalKind,this.normals,n),!i){e.next=12;break}return void(e.next=12);case 12:if(!this.tangents){e.next=17;break}if(t.setVerticesData(c.o.TangentKind,this.tangents,n),!i){e.next=17;break}return void(e.next=17);case 17:if(!this.uvs){e.next=22;break}if(t.setVerticesData(c.o.UVKind,this.uvs,n),!i){e.next=22;break}return void(e.next=22);case 22:if(!this.uvs2){e.next=27;break}if(t.setVerticesData(c.o.UV2Kind,this.uvs2,n),!i){e.next=27;break}return void(e.next=27);case 27:if(!this.uvs3){e.next=32;break}if(t.setVerticesData(c.o.UV3Kind,this.uvs3,n),!i){e.next=32;break}return void(e.next=32);case 32:if(!this.uvs4){e.next=37;break}if(t.setVerticesData(c.o.UV4Kind,this.uvs4,n),!i){e.next=37;break}return void(e.next=37);case 37:if(!this.uvs5){e.next=42;break}if(t.setVerticesData(c.o.UV5Kind,this.uvs5,n),!i){e.next=42;break}return void(e.next=42);case 42:if(!this.uvs6){e.next=47;break}if(t.setVerticesData(c.o.UV6Kind,this.uvs6,n),!i){e.next=47;break}return void(e.next=47);case 47:if(!this.colors){e.next=52;break}if(t.setVerticesData(c.o.ColorKind,this.colors,n),!i){e.next=52;break}return void(e.next=52);case 52:if(!this.matricesIndices){e.next=57;break}if(t.setVerticesData(c.o.MatricesIndicesKind,this.matricesIndices,n),!i){e.next=57;break}return void(e.next=57);case 57:if(!this.matricesWeights){e.next=62;break}if(t.setVerticesData(c.o.MatricesWeightsKind,this.matricesWeights,n),!i){e.next=62;break}return void(e.next=62);case 62:if(!this.matricesIndicesExtra){e.next=67;break}if(t.setVerticesData(c.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,n),!i){e.next=67;break}return void(e.next=67);case 67:if(!this.matricesWeightsExtra){e.next=72;break}if(t.setVerticesData(c.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,n),!i){e.next=72;break}return void(e.next=72);case 72:if(!this.indices){e.next=79;break}if(t.setIndices(this.indices,null,n),!i){e.next=77;break}return void(e.next=77);case 77:e.next=80;break;case 79:t.setIndices([],null);case 80:return e.abrupt("return",this);case 81:case"end":return e.stop()}}),e,this)}))},{key:"_update",value:function(e,t,n){return this.positions&&e.updateVerticesData(c.o.PositionKind,this.positions,t,n),this.normals&&e.updateVerticesData(c.o.NormalKind,this.normals,t,n),this.tangents&&e.updateVerticesData(c.o.TangentKind,this.tangents,t,n),this.uvs&&e.updateVerticesData(c.o.UVKind,this.uvs,t,n),this.uvs2&&e.updateVerticesData(c.o.UV2Kind,this.uvs2,t,n),this.uvs3&&e.updateVerticesData(c.o.UV3Kind,this.uvs3,t,n),this.uvs4&&e.updateVerticesData(c.o.UV4Kind,this.uvs4,t,n),this.uvs5&&e.updateVerticesData(c.o.UV5Kind,this.uvs5,t,n),this.uvs6&&e.updateVerticesData(c.o.UV6Kind,this.uvs6,t,n),this.colors&&e.updateVerticesData(c.o.ColorKind,this.colors,t,n),this.matricesIndices&&e.updateVerticesData(c.o.MatricesIndicesKind,this.matricesIndices,t,n),this.matricesWeights&&e.updateVerticesData(c.o.MatricesWeightsKind,this.matricesWeights,t,n),this.matricesIndicesExtra&&e.updateVerticesData(c.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,n),this.matricesWeightsExtra&&e.updateVerticesData(c.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,n),this.indices&&e.setIndices(this.indices,null),this}},{key:"transform",value:function(t){var n=t.determinant()<0;return this.positions&&e._TransformVector3Coordinates(this.positions,t),this.normals&&e._TransformVector3Normals(this.normals,t),this.tangents&&e._TransformVector4Normals(this.tangents,t),n&&this.indices&&e._FlipFaces(this.indices),this}},{key:"merge",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Array.isArray(e)?e.map((function(e){return[e,void 0]})):[[e,void 0]];return(0,p.s3)(this._mergeCoroutine(void 0,i,t,!1,n))}},{key:"_mergeCoroutine",value:s().mark((function t(n,r){var a,o,l,u,h,f,d,v,p,_,m,y,A,E,b,T,S,M,I,P,C,x,D,R,k=this,O=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:u=O.length>2&&void 0!==O[2]&&O[2],h=O.length>3?O[3]:void 0,f=O.length>4?O[4]:void 0,this._validate(),d=r.map((function(e){return e[0]})),v=g(d),t.prev=6,v.s();case 8:if((p=v.n()).done){t.next=15;break}if((_=p.value)._validate(),!this.normals==!_.normals&&!this.tangents==!_.tangents&&!this.uvs==!_.uvs&&!this.uvs2==!_.uvs2&&!this.uvs3==!_.uvs3&&!this.uvs4==!_.uvs4&&!this.uvs5==!_.uvs5&&!this.uvs6==!_.uvs6&&!this.colors==!_.colors&&!this.matricesIndices==!_.matricesIndices&&!this.matricesWeights==!_.matricesWeights&&!this.matricesIndicesExtra==!_.matricesIndicesExtra&&!this.matricesWeightsExtra==!_.matricesWeightsExtra){t.next=13;break}throw new Error("Cannot merge vertex data that do not have the same set of attributes");case 13:t.next=8;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(6),v.e(t.t0);case 20:return t.prev=20,v.f(),t.finish(20);case 23:if(m=d.reduce((function(e,t){var n,i;return e+(null!==(n=null===(i=t.indices)||void 0===i?void 0:i.length)&&void 0!==n?n:0)}),null!==(a=null===(o=this.indices)||void 0===o?void 0:o.length)&&void 0!==a?a:0),y=f||d.some((function(e){return e.indices===k.indices})),A=y?null===(l=this.indices)||void 0===l?void 0:l.slice():this.indices,!(m>0)){t.next=54;break}T=null!==(E=null===(b=A)||void 0===b?void 0:b.length)&&void 0!==E?E:0,A||(A=new Array(m)),A.length!==m&&(Array.isArray(A)?A.length=m:((S=u||A instanceof Uint32Array?new Uint32Array(m):new Uint16Array(m)).set(A),A=S),n&&n.determinant()<0&&e._FlipFaces(A,0,T)),M=this.positions?this.positions.length/3:0,I=g(r),t.prev=32,I.s();case 34:if((P=I.n()).done){t.next=46;break}if(C=(0,i.Z)(P.value,2),x=C[0],D=C[1],!x.indices){t.next=44;break}for(R=0;R<x.indices.length;R++)A[T+R]=x.indices[R]+M;if(D&&D.determinant()<0&&e._FlipFaces(A,T,x.indices.length),M+=x.positions.length/3,T+=x.indices.length,!h){t.next=44;break}return void(t.next=44);case 44:t.next=34;break;case 46:t.next=51;break;case 48:t.prev=48,t.t1=t.catch(32),I.e(t.t1);case 51:return t.prev=51,I.f(),t.finish(51);case 54:if(this.indices=A,this.positions=e._MergeElement(c.o.PositionKind,this.positions,n,r.map((function(e){return[e[0].positions,e[1]]}))),!h){t.next=59;break}return void(t.next=59);case 59:if(this.normals=e._MergeElement(c.o.NormalKind,this.normals,n,r.map((function(e){return[e[0].normals,e[1]]}))),!h){t.next=63;break}return void(t.next=63);case 63:if(this.tangents=e._MergeElement(c.o.TangentKind,this.tangents,n,r.map((function(e){return[e[0].tangents,e[1]]}))),!h){t.next=67;break}return void(t.next=67);case 67:if(this.uvs=e._MergeElement(c.o.UVKind,this.uvs,n,r.map((function(e){return[e[0].uvs,e[1]]}))),!h){t.next=71;break}return void(t.next=71);case 71:if(this.uvs2=e._MergeElement(c.o.UV2Kind,this.uvs2,n,r.map((function(e){return[e[0].uvs2,e[1]]}))),!h){t.next=75;break}return void(t.next=75);case 75:if(this.uvs3=e._MergeElement(c.o.UV3Kind,this.uvs3,n,r.map((function(e){return[e[0].uvs3,e[1]]}))),!h){t.next=79;break}return void(t.next=79);case 79:if(this.uvs4=e._MergeElement(c.o.UV4Kind,this.uvs4,n,r.map((function(e){return[e[0].uvs4,e[1]]}))),!h){t.next=83;break}return void(t.next=83);case 83:if(this.uvs5=e._MergeElement(c.o.UV5Kind,this.uvs5,n,r.map((function(e){return[e[0].uvs5,e[1]]}))),!h){t.next=87;break}return void(t.next=87);case 87:if(this.uvs6=e._MergeElement(c.o.UV6Kind,this.uvs6,n,r.map((function(e){return[e[0].uvs6,e[1]]}))),!h){t.next=91;break}return void(t.next=91);case 91:if(this.colors=e._MergeElement(c.o.ColorKind,this.colors,n,r.map((function(e){return[e[0].colors,e[1]]}))),!h){t.next=95;break}return void(t.next=95);case 95:if(this.matricesIndices=e._MergeElement(c.o.MatricesIndicesKind,this.matricesIndices,n,r.map((function(e){return[e[0].matricesIndices,e[1]]}))),!h){t.next=99;break}return void(t.next=99);case 99:if(this.matricesWeights=e._MergeElement(c.o.MatricesWeightsKind,this.matricesWeights,n,r.map((function(e){return[e[0].matricesWeights,e[1]]}))),!h){t.next=103;break}return void(t.next=103);case 103:if(this.matricesIndicesExtra=e._MergeElement(c.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,n,r.map((function(e){return[e[0].matricesIndicesExtra,e[1]]}))),!h){t.next=107;break}return void(t.next=107);case 107:return this.matricesWeightsExtra=e._MergeElement(c.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,n,r.map((function(e){return[e[0].matricesWeightsExtra,e[1]]}))),t.abrupt("return",this);case 109:case"end":return t.stop()}}),t,this,[[6,17,20,23],[32,48,51,54]])}))},{key:"_validate",value:function(){if(!this.positions)throw new _.LH("Positions are required",_.SM.MeshInvalidPositionsError);var e=function(e,t){var n=c.o.DeduceStride(e);if(t.length%n!=0)throw new Error("The "+e+"s array count must be a multiple of "+n);return t.length/n},t=e(c.o.PositionKind,this.positions),n=function(n,i){var r=e(n,i);if(r!==t)throw new Error("The "+n+"s element count ("+r+") does not match the positions count ("+t+")")};this.normals&&n(c.o.NormalKind,this.normals),this.tangents&&n(c.o.TangentKind,this.tangents),this.uvs&&n(c.o.UVKind,this.uvs),this.uvs2&&n(c.o.UV2Kind,this.uvs2),this.uvs3&&n(c.o.UV3Kind,this.uvs3),this.uvs4&&n(c.o.UV4Kind,this.uvs4),this.uvs5&&n(c.o.UV5Kind,this.uvs5),this.uvs6&&n(c.o.UV6Kind,this.uvs6),this.colors&&n(c.o.ColorKind,this.colors),this.matricesIndices&&n(c.o.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&n(c.o.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&n(c.o.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&n(c.o.MatricesWeightsExtraKind,this.matricesWeightsExtra)}},{key:"serialize",value:function(){var e={};return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e}}],[{key:"_TransformVector3Coordinates",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length,r=u.jp.Vector3[0],a=u.jp.Vector3[1],o=n;o<n+i;o+=3)u.P.FromArrayToRef(e,o,r),u.P.TransformCoordinatesToRef(r,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z}},{key:"_TransformVector3Normals",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length,r=u.jp.Vector3[0],a=u.jp.Vector3[1],o=n;o<n+i;o+=3)u.P.FromArrayToRef(e,o,r),u.P.TransformNormalToRef(r,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z}},{key:"_TransformVector4Normals",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length,r=u.jp.Vector4[0],a=u.jp.Vector4[1],o=n;o<n+i;o+=4)u.Lt.FromArrayToRef(e,o,r),u.Lt.TransformNormalToRef(r,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z,e[o+3]=a.w}},{key:"_FlipFaces",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,i=t;i<t+n;i+=3){var r=e[i+1];e[i+1]=e[i+2],e[i+2]=r}}},{key:"_MergeElement",value:function(t,n,r,a){var o=a.filter((function(e){return null!==e[0]&&void 0!==e[0]}));if(!n&&0==o.length)return n;if(!n)return this._MergeElement(t,o[0][0],o[0][1],o.slice(1));var s=o.reduce((function(e,t){return e+t[0].length}),n.length),l=t===c.o.PositionKind?e._TransformVector3Coordinates:t===c.o.NormalKind?e._TransformVector3Normals:t===c.o.TangentKind?e._TransformVector4Normals:function(){};if(n instanceof Float32Array){var u=new Float32Array(s);u.set(n),r&&l(u,r,0,n.length);var h,f=n.length,d=g(o);try{for(d.s();!(h=d.n()).done;){var v=(0,i.Z)(h.value,2),p=v[0],_=v[1];u.set(p,f),_&&l(u,_,f,p.length),f+=p.length}}catch(P){d.e(P)}finally{d.f()}return u}for(var m=new Array(s),y=0;y<n.length;y++)m[y]=n[y];r&&l(m,r,0,n.length);var A,E=n.length,b=g(o);try{for(b.s();!(A=b.n()).done;){for(var T=(0,i.Z)(A.value,2),S=T[0],M=T[1],I=0;I<S.length;I++)m[E+I]=S[I];M&&l(m,M,E,S.length),E+=S.length}}catch(P){b.e(P)}finally{b.f()}return m}},{key:"ExtractFromMesh",value:function(t,n,i){return e._ExtractFrom(t,n,i)}},{key:"ExtractFromGeometry",value:function(t,n,i){return e._ExtractFrom(t,n,i)}},{key:"_ExtractFrom",value:function(t,n,i){var r=new e;return t.isVerticesDataPresent(c.o.PositionKind)&&(r.positions=t.getVerticesData(c.o.PositionKind,n,i)),t.isVerticesDataPresent(c.o.NormalKind)&&(r.normals=t.getVerticesData(c.o.NormalKind,n,i)),t.isVerticesDataPresent(c.o.TangentKind)&&(r.tangents=t.getVerticesData(c.o.TangentKind,n,i)),t.isVerticesDataPresent(c.o.UVKind)&&(r.uvs=t.getVerticesData(c.o.UVKind,n,i)),t.isVerticesDataPresent(c.o.UV2Kind)&&(r.uvs2=t.getVerticesData(c.o.UV2Kind,n,i)),t.isVerticesDataPresent(c.o.UV3Kind)&&(r.uvs3=t.getVerticesData(c.o.UV3Kind,n,i)),t.isVerticesDataPresent(c.o.UV4Kind)&&(r.uvs4=t.getVerticesData(c.o.UV4Kind,n,i)),t.isVerticesDataPresent(c.o.UV5Kind)&&(r.uvs5=t.getVerticesData(c.o.UV5Kind,n,i)),t.isVerticesDataPresent(c.o.UV6Kind)&&(r.uvs6=t.getVerticesData(c.o.UV6Kind,n,i)),t.isVerticesDataPresent(c.o.ColorKind)&&(r.colors=t.getVerticesData(c.o.ColorKind,n,i)),t.isVerticesDataPresent(c.o.MatricesIndicesKind)&&(r.matricesIndices=t.getVerticesData(c.o.MatricesIndicesKind,n,i)),t.isVerticesDataPresent(c.o.MatricesWeightsKind)&&(r.matricesWeights=t.getVerticesData(c.o.MatricesWeightsKind,n,i)),t.isVerticesDataPresent(c.o.MatricesIndicesExtraKind)&&(r.matricesIndicesExtra=t.getVerticesData(c.o.MatricesIndicesExtraKind,n,i)),t.isVerticesDataPresent(c.o.MatricesWeightsExtraKind)&&(r.matricesWeightsExtra=t.getVerticesData(c.o.MatricesWeightsExtraKind,n,i)),r.indices=t.getIndices(n,i),r}},{key:"CreateRibbon",value:function(e){throw(0,h.S)("ribbonBuilder")}},{key:"CreateBox",value:function(e){throw(0,h.S)("boxBuilder")}},{key:"CreateTiledBox",value:function(e){throw(0,h.S)("tiledBoxBuilder")}},{key:"CreateTiledPlane",value:function(e){throw(0,h.S)("tiledPlaneBuilder")}},{key:"CreateSphere",value:function(e){throw(0,h.S)("sphereBuilder")}},{key:"CreateCylinder",value:function(e){throw(0,h.S)("cylinderBuilder")}},{key:"CreateTorus",value:function(e){throw(0,h.S)("torusBuilder")}},{key:"CreateLineSystem",value:function(e){throw(0,h.S)("linesBuilder")}},{key:"CreateDashedLines",value:function(e){throw(0,h.S)("linesBuilder")}},{key:"CreateGround",value:function(e){throw(0,h.S)("groundBuilder")}},{key:"CreateTiledGround",value:function(e){throw(0,h.S)("groundBuilder")}},{key:"CreateGroundFromHeightMap",value:function(e){throw(0,h.S)("groundBuilder")}},{key:"CreatePlane",value:function(e){throw(0,h.S)("planeBuilder")}},{key:"CreateDisc",value:function(e){throw(0,h.S)("discBuilder")}},{key:"CreatePolygon",value:function(e,t,n,i,r,a,o){throw(0,h.S)("polygonBuilder")}},{key:"CreateIcoSphere",value:function(e){throw(0,h.S)("icoSphereBuilder")}},{key:"CreatePolyhedron",value:function(e){throw(0,h.S)("polyhedronBuilder")}},{key:"CreateCapsule",value:function(){arguments.length>0&&void 0!==arguments[0]||u.P.Up();throw(0,h.S)("capsuleBuilder")}},{key:"CreateTorusKnot",value:function(e){throw(0,h.S)("torusKnotBuilder")}},{key:"ComputeNormals",value:function(e,t,n,i){var r=0,a=0,o=0,s=0,l=0,c=0,h=0,f=0,d=0,v=0,p=0,_=0,g=0,m=0,y=0,A=0,E=0,b=0,T=0,S=0,M=!1,I=!1,P=!1,C=!1,x=1,D=0,R=null;i&&(M=!!i.facetNormals,I=!!i.facetPositions,P=!!i.facetPartitioning,x=!0===i.useRightHandedSystem?-1:1,D=i.ratio||0,C=!!i.depthSort,R=i.distanceTo,C&&void 0===R&&(R=u.P.Zero()));var k=0,O=0,L=0,F=0;for(P&&i&&i.bbSize&&(k=i.subDiv.X*D/i.bbSize.x,O=i.subDiv.Y*D/i.bbSize.y,L=i.subDiv.Z*D/i.bbSize.z,F=i.subDiv.max*i.subDiv.max,i.facetPartitioning.length=0),r=0;r<e.length;r++)n[r]=0;var N=t.length/3|0;for(r=0;r<N;r++){if(g=(_=3*t[3*r])+1,m=_+2,A=(y=3*t[3*r+1])+1,E=y+2,T=(b=3*t[3*r+2])+1,S=b+2,a=e[_]-e[y],o=e[g]-e[A],s=e[m]-e[E],l=e[b]-e[y],c=e[T]-e[A],f=x*(o*(h=e[S]-e[E])-s*c),d=x*(s*l-a*h),v=x*(a*c-o*l),f/=p=0===(p=Math.sqrt(f*f+d*d+v*v))?1:p,d/=p,v/=p,M&&i&&(i.facetNormals[r].x=f,i.facetNormals[r].y=d,i.facetNormals[r].z=v),I&&i&&(i.facetPositions[r].x=(e[_]+e[y]+e[b])/3,i.facetPositions[r].y=(e[g]+e[A]+e[T])/3,i.facetPositions[r].z=(e[m]+e[E]+e[S])/3),P&&i){var w=Math.floor((i.facetPositions[r].x-i.bInfo.minimum.x*D)*k),B=Math.floor((i.facetPositions[r].y-i.bInfo.minimum.y*D)*O),U=Math.floor((i.facetPositions[r].z-i.bInfo.minimum.z*D)*L),V=Math.floor((e[_]-i.bInfo.minimum.x*D)*k),W=Math.floor((e[g]-i.bInfo.minimum.y*D)*O),G=Math.floor((e[m]-i.bInfo.minimum.z*D)*L),X=Math.floor((e[y]-i.bInfo.minimum.x*D)*k),z=Math.floor((e[A]-i.bInfo.minimum.y*D)*O),H=Math.floor((e[E]-i.bInfo.minimum.z*D)*L),Z=Math.floor((e[b]-i.bInfo.minimum.x*D)*k),Y=Math.floor((e[T]-i.bInfo.minimum.y*D)*O),K=Math.floor((e[S]-i.bInfo.minimum.z*D)*L),j=V+i.subDiv.max*W+F*G,q=X+i.subDiv.max*z+F*H,Q=Z+i.subDiv.max*Y+F*K,J=w+i.subDiv.max*B+F*U;i.facetPartitioning[J]=i.facetPartitioning[J]?i.facetPartitioning[J]:new Array,i.facetPartitioning[j]=i.facetPartitioning[j]?i.facetPartitioning[j]:new Array,i.facetPartitioning[q]=i.facetPartitioning[q]?i.facetPartitioning[q]:new Array,i.facetPartitioning[Q]=i.facetPartitioning[Q]?i.facetPartitioning[Q]:new Array,i.facetPartitioning[j].push(r),q!=j&&i.facetPartitioning[q].push(r),Q!=q&&Q!=j&&i.facetPartitioning[Q].push(r),J!=j&&J!=q&&J!=Q&&i.facetPartitioning[J].push(r)}if(C&&i&&i.facetPositions){var $=i.depthSortedFacets[r];$.ind=3*r,$.sqDistance=u.P.DistanceSquared(i.facetPositions[r],R)}n[_]+=f,n[g]+=d,n[m]+=v,n[y]+=f,n[A]+=d,n[E]+=v,n[b]+=f,n[T]+=d,n[S]+=v}for(r=0;r<n.length/3;r++)f=n[3*r],d=n[3*r+1],v=n[3*r+2],f/=p=0===(p=Math.sqrt(f*f+d*d+v*v))?1:p,d/=p,v/=p,n[3*r]=f,n[3*r+1]=d,n[3*r+2]=v}},{key:"_ComputeSides",value:function(t,n,i,r,a,o,s){var l,c,h=i.length,f=r.length;switch(t=t||e.DEFAULTSIDE){case e.FRONTSIDE:break;case e.BACKSIDE:for(l=0;l<h;l+=3){var d=i[l];i[l]=i[l+2],i[l+2]=d}for(c=0;c<f;c++)r[c]=-r[c];break;case e.DOUBLESIDE:for(var v=n.length,p=v/3,_=0;_<v;_++)n[v+_]=n[_];for(l=0;l<h;l+=3)i[l+h]=i[l+2]+p,i[l+1+h]=i[l+1]+p,i[l+2+h]=i[l]+p;for(c=0;c<f;c++)r[f+c]=-r[c];var g=a.length,m=0;for(m=0;m<g;m++)a[m+g]=a[m];for(o=o||new u.Lt(0,0,1,1),s=s||new u.Lt(0,0,1,1),m=0,l=0;l<g/2;l++)a[m]=o.x+(o.z-o.x)*a[m],a[m+1]=o.y+(o.w-o.y)*a[m+1],a[m+g]=s.x+(s.z-s.x)*a[m+g],a[m+g+1]=s.y+(s.w-s.y)*a[m+g+1],m+=2}}},{key:"ImportVertexData",value:function(t,n){var i=new e,r=t.positions;r&&i.set(r,c.o.PositionKind);var a=t.normals;a&&i.set(a,c.o.NormalKind);var o=t.tangents;o&&i.set(o,c.o.TangentKind);var s=t.uvs;s&&i.set(s,c.o.UVKind);var l=t.uv2s;l&&i.set(l,c.o.UV2Kind);var u=t.uv3s;u&&i.set(u,c.o.UV3Kind);var h=t.uv4s;h&&i.set(h,c.o.UV4Kind);var d=t.uv5s;d&&i.set(d,c.o.UV5Kind);var v=t.uv6s;v&&i.set(v,c.o.UV6Kind);var p=t.colors;p&&i.set(f.HE.CheckColors4(p,r.length/3),c.o.ColorKind);var _=t.matricesIndices;_&&i.set(_,c.o.MatricesIndicesKind);var g=t.matricesWeights;g&&i.set(g,c.o.MatricesWeightsKind);var m=t.indices;m&&(i.indices=m),n.setAllVerticesData(i,t.updatable)}}]),e}();y.FRONTSIDE=0,y.BACKSIDE=1,y.DOUBLESIDE=2,y.DEFAULTSIDE=0,(0,l.gn)([v.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];return!Array.isArray(i)}))],y,"_TransformVector3Coordinates",null),(0,l.gn)([v.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];return!Array.isArray(i)}))],y,"_TransformVector3Normals",null),(0,l.gn)([v.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];return!Array.isArray(i)}))],y,"_TransformVector4Normals",null),(0,l.gn)([v.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];return!Array.isArray(i)}))],y,"_FlipFaces",null)},9609:function(e,t,n){"use strict";n.d(t,{g:function(){return a}});var i=n(3144),r=n(5671),a=(0,i.Z)((function e(t,n){(0,r.Z)(this,e),this.distanceOrScreenCoverage=t,this.mesh=n}))},65:function(e,t,n){"use strict";n.d(t,{P:function(){return f}});var i=n(5671),r=n(3144),a=n(2845),o=(0,r.Z)((function e(t,n,r){(0,i.Z)(this,e),this.bu=t,this.bv=n,this.distance=r,this.faceId=0,this.subMeshId=0})),s=n(9115),l=n(7721),u=n(8618);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var f=function(){function e(t,n,r,a,o,s,l){var u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];(0,i.Z)(this,e),this.materialIndex=t,this.verticesStart=n,this.verticesCount=r,this.indexStart=a,this.indexCount=o,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=s,this._renderingMesh=l||s,c&&s.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=s.subMeshes.length-1,u&&(this.refreshBoundingInfo(),s.computeWorldMatrix(!0))}return(0,r.Z)(e,[{key:"materialDefines",get:function(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(e=this._getDrawWrapper())||void 0===e?void 0:e.defines},set:function(e){var t;(null!==(t=this._mainDrawWrapperOverride)&&void 0!==t?t:this._getDrawWrapper(void 0,!0)).defines=e}},{key:"_getDrawWrapper",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=null!==(t=e)&&void 0!==t?t:this._engine.currentRenderPassId;var i=this._drawWrappers[e];return!i&&n&&(this._drawWrappers[e]=i=new u.q(this._mesh.getScene().getEngine())),i}},{key:"_removeDrawWrapper",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n&&(null===(t=this._drawWrappers[e])||void 0===t||t.dispose());this._drawWrappers[e]=void 0}},{key:"effect",get:function(){var e,t;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:null!==(e=null===(t=this._getDrawWrapper())||void 0===t?void 0:t.effect)&&void 0!==e?e:null}},{key:"_drawWrapper",get:function(){var e;return null!==(e=this._mainDrawWrapperOverride)&&void 0!==e?e:this._getDrawWrapper(void 0,!0)}},{key:"_drawWrapperOverride",get:function(){return this._mainDrawWrapperOverride}},{key:"_setMainDrawWrapperOverride",value:function(e){this._mainDrawWrapperOverride=e}},{key:"setEffect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=this._drawWrapper;r.setEffect(e,t,i),void 0!==n&&(r.materialContext=n),e||(r.defines=null,r.materialContext=void 0)}},{key:"resetDrawCache",value:function(e){if(this._drawWrappers){if(void 0!==e)return void this._removeDrawWrapper(e);var t,n=c(this._drawWrappers);try{for(n.s();!(t=n.n()).done;){var i=t.value;null==i||i.dispose()}}catch(r){n.e(r)}finally{n.f()}}this._drawWrappers=[]}},{key:"IsGlobal",get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}},{key:"getBoundingInfo",value:function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo}},{key:"setBoundingInfo",value:function(e){return this._boundingInfo=e,this}},{key:"getMesh",value:function(){return this._mesh}},{key:"getRenderingMesh",value:function(){return this._renderingMesh}},{key:"getReplacementMesh",value:function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}},{key:"getEffectiveMesh",value:function(){var e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh}},{key:"getMaterial",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=null!==(e=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))&&void 0!==e?e:this._renderingMesh.material;if(!n)return t?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(n)){var i=n.getSubMaterial(this.materialIndex);return this._currentMaterial!==i&&(this._currentMaterial=i,this.resetDrawCache()),i}return n}},{key:"_isMultiMaterial",value:function(e){return void 0!==e.getSubMaterial}},{key:"refreshBoundingInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(a.o.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var t,n=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===n.length){var i=this._renderingMesh.getBoundingInfo();t={minimum:i.minimum.clone(),maximum:i.maximum.clone()}}else t=(0,l.y)(e,n,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new s.j(t.minimum,t.maximum),this}},{key:"_checkCollision",value:function(e){return this.getBoundingInfo()._checkCollision(e)}},{key:"updateBoundingInfo",value:function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this}},{key:"isInFrustum",value:function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)}},{key:"isCompletelyInFrustum",value:function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)}},{key:"render",value:function(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}},{key:"_getLinesIndexBuffer",value:function(e,t){if(!this._linesIndexBuffer){for(var n=[],i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)n.push(e[i],e[i+1],e[i+1],e[i+2],e[i+2],e[i]);this._linesIndexBuffer=t.createIndexBuffer(n),this._linesIndexCount=n.length}return this._linesIndexBuffer}},{key:"canIntersects",value:function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)}},{key:"intersects",value:function(e,t,n,i,r){var a=this.getMaterial();if(!a)return null;var o=3,s=!1;switch(a.fillMode){case 3:case 5:case 6:case 8:return null;case 7:o=1,s=!0}return 4===a.fillMode?n.length?this._intersectLines(e,t,n,this._mesh.intersectionThreshold,i):this._intersectUnIndexedLines(e,t,n,this._mesh.intersectionThreshold,i):!n.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,n,i,r):this._intersectTriangles(e,t,n,o,s,i,r)}},{key:"_intersectLines",value:function(e,t,n,i,r){for(var a=null,s=this.indexStart;s<this.indexStart+this.indexCount;s+=2){var l=t[n[s]],u=t[n[s+1]],c=e.intersectionSegment(l,u,i);if(!(c<0)&&((r||!a||c<a.distance)&&((a=new o(null,null,c)).faceId=s/2,r)))break}return a}},{key:"_intersectUnIndexedLines",value:function(e,t,n,i,r){for(var a=null,s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=2){var l=t[s],u=t[s+1],c=e.intersectionSegment(l,u,i);if(!(c<0)&&((r||!a||c<a.distance)&&((a=new o(null,null,c)).faceId=s/2,r)))break}return a}},{key:"_intersectTriangles",value:function(e,t,n,i,r,a,o){for(var s=null,l=-1,u=this.indexStart;u<this.indexStart+this.indexCount-(3-i);u+=i){l++;var c=n[u],h=n[u+1],f=n[u+2];if(r&&4294967295===f)u+=2;else{var d=t[c],v=t[h],p=t[f];if(d&&v&&p&&(!o||o(d,v,p,e))){var _=e.intersectsTriangle(d,v,p);if(_){if(_.distance<0)continue;if((a||!s||_.distance<s.distance)&&((s=_).faceId=l,a))break}}}}return s}},{key:"_intersectUnIndexedTriangles",value:function(e,t,n,i,r){for(var a=null,o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=3){var s=t[o],l=t[o+1],u=t[o+2];if(!r||r(s,l,u,e)){var c=e.intersectsTriangle(s,l,u);if(c){if(c.distance<0)continue;if((i||!a||c.distance<a.distance)&&((a=c).faceId=o/3,i))break}}}return a}},{key:"_rebuild",value:function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}},{key:"clone",value:function(t,n){var i=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,n,!1);if(!this.IsGlobal){var r=this.getBoundingInfo();if(!r)return i;i._boundingInfo=new s.j(r.minimum,r.maximum)}return i}},{key:"dispose",value:function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1),this.resetDrawCache()}},{key:"getClassName",value:function(){return"SubMesh"}}],[{key:"AddToMesh",value:function(t,n,i,r,a,o,s){var l=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];return new e(t,n,i,r,a,o,s,l)}},{key:"CreateFromIndices",value:function(t,n,i,r,a){for(var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=Number.MAX_VALUE,l=-Number.MAX_VALUE,u=a||r,c=u.getIndices(),h=n;h<n+i;h++){var f=c[h];f<s&&(s=f),f>l&&(l=f)}return new e(t,s,l-s+1,n,i,r,a,o)}}]),e}()},2668:function(e,t,n){"use strict";n.d(t,{Y:function(){return y}});var i=n(5671),r=n(3144),a=n(7326),o=n(1752),s=n(136),l=n(6215),u=n(1120),c=n(9477),h=n(9336),f=n(4174),d=n(6900),v=n(1396),p=n(7702);function _(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,u.Z)(e);if(t){var r=(0,u.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,l.Z)(this,n)}}var y=function(e){(0,s.Z)(n,e);var t=m(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,i.Z)(this,n),(r=t.call(this,e,o))._forward=new d.P(0,0,1),r._up=new d.P(0,1,0),r._right=new d.P(1,0,0),r._position=d.P.Zero(),r._rotation=d.P.Zero(),r._rotationQuaternion=null,r._scaling=d.P.One(),r._transformToBoneReferal=null,r._isAbsoluteSynced=!1,r._billboardMode=n.BILLBOARDMODE_NONE,r._preserveParentRotationForBillboard=!1,r.scalingDeterminant=1,r._infiniteDistance=!1,r.ignoreNonUniformScaling=!1,r.reIntegrateRotationIntoRotationQuaternion=!1,r._poseMatrix=null,r._localMatrix=d.y3.Zero(),r._usePivotMatrix=!1,r._absolutePosition=d.P.Zero(),r._absoluteScaling=d.P.Zero(),r._absoluteRotationQuaternion=d._f.Identity(),r._pivotMatrix=d.y3.Identity(),r._postMultiplyPivotMatrix=!1,r._isWorldMatrixFrozen=!1,r._indexInSceneTransformNodesArray=-1,r.onAfterWorldMatrixUpdateObservable=new f.y$,r._nonUniformScaling=!1,s&&r.getScene().addTransformNode((0,a.Z)(r)),r}return(0,r.Z)(n,[{key:"billboardMode",get:function(){return this._billboardMode},set:function(e){this._billboardMode!==e&&(this._billboardMode=e)}},{key:"preserveParentRotationForBillboard",get:function(){return this._preserveParentRotationForBillboard},set:function(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e)}},{key:"infiniteDistance",get:function(){return this._infiniteDistance},set:function(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)}},{key:"getClassName",value:function(){return"TransformNode"}},{key:"position",get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0}},{key:"isUsingPivotMatrix",value:function(){return this._usePivotMatrix}},{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0}},{key:"scaling",get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0}},{key:"rotationQuaternion",get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0}},{key:"forward",get:function(){return d.P.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}},{key:"up",get:function(){return d.P.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}},{key:"right",get:function(){return d.P.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}},{key:"updatePoseMatrix",value:function(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)}},{key:"getPoseMatrix",value:function(){return this._poseMatrix||(this._poseMatrix=d.y3.Identity()),this._poseMatrix}},{key:"_isSynchronized",value:function(){var e=this._cache;return this._billboardMode===e.billboardMode&&this._billboardMode===n.BILLBOARDMODE_NONE&&(!e.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}},{key:"_initCache",value:function(){(0,o.Z)((0,u.Z)(n.prototype),"_initCache",this).call(this);var e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1}},{key:"absolutePosition",get:function(){return this.getAbsolutePosition()}},{key:"absoluteScaling",get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}},{key:"absoluteRotationQuaternion",get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}},{key:"setPreTransformMatrix",value:function(e){return this.setPivotMatrix(e,!1)}},{key:"setPivotMatrix",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=d.y3.Invert(this._pivotMatrix)),this}},{key:"getPivotMatrix",value:function(){return this._pivotMatrix}},{key:"instantiateHierarchy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);i&&n&&n(this,i);var r,a=_(this.getChildTransformNodes(!0));try{for(a.s();!(r=a.n()).done;){var o=r.value;o.instantiateHierarchy(i,t,n)}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"freezeWorldMatrix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?t?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||d._f.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}},{key:"unfreezeWorldMatrix",value:function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}},{key:"isWorldMatrixFrozen",get:function(){return this._isWorldMatrixFrozen}},{key:"getAbsolutePosition",value:function(){return this.computeWorldMatrix(),this._absolutePosition}},{key:"setAbsolutePosition",value:function(e){if(!e)return this;var t,n,i;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],n=arguments[1],i=arguments[2]}else t=e.x,n=e.y,i=e.z;if(this.parent){var r=d.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(r),d.P.TransformCoordinatesFromFloatsToRef(t,n,i,r,this.position)}else this.position.x=t,this.position.y=n,this.position.z=i;return this._absolutePosition.copyFrom(e),this}},{key:"setPositionWithLocalVector",value:function(e){return this.computeWorldMatrix(),this.position=d.P.TransformNormal(e,this._localMatrix),this}},{key:"getPositionExpressedInLocalSpace",value:function(){this.computeWorldMatrix();var e=d.jp.Matrix[0];return this._localMatrix.invertToRef(e),d.P.TransformNormal(this.position,e)}},{key:"locallyTranslate",value:function(e){return this.computeWorldMatrix(!0),this.position=d.P.TransformCoordinates(e,this._localMatrix),this}},{key:"lookAt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:p.T.LOCAL,o=n._LookAtVectorCache,s=a===p.T.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(s,o),this.setDirection(o,t,i,r),a===p.T.WORLD&&this.parent)if(this.rotationQuaternion){var l=d.jp.Matrix[0];this.rotationQuaternion.toRotationMatrix(l);var u=d.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(u),u.invert(),l.multiplyToRef(u,l),this.rotationQuaternion.fromRotationMatrix(l)}else{var c=d.jp.Quaternion[0];d._f.FromEulerVectorToRef(this.rotation,c);var h=d.jp.Matrix[0];c.toRotationMatrix(h);var f=d.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.invert(),h.multiplyToRef(f,h),c.fromRotationMatrix(h),c.toEulerAnglesToRef(this.rotation)}return this}},{key:"getDirection",value:function(e){var t=d.P.Zero();return this.getDirectionToRef(e,t),t}},{key:"getDirectionToRef",value:function(e,t){return d.P.TransformNormalToRef(e,this.getWorldMatrix(),t),this}},{key:"setDirection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=-Math.atan2(e.z,e.x)+Math.PI/2,a=Math.sqrt(e.x*e.x+e.z*e.z),o=-Math.atan2(e.y,a);return this.rotationQuaternion?d._f.RotationYawPitchRollToRef(r+t,o+n,i,this.rotationQuaternion):(this.rotation.x=o+n,this.rotation.y=r+t,this.rotation.z=i),this}},{key:"setPivotPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.T.LOCAL;0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var n=this.getWorldMatrix();if(t==p.T.WORLD){var i=d.jp.Matrix[0];n.invertToRef(i),e=d.P.TransformCoordinates(e,i)}return this.setPivotMatrix(d.y3.Translation(-e.x,-e.y,-e.z),!0)}},{key:"getPivotPoint",value:function(){var e=d.P.Zero();return this.getPivotPointToRef(e),e}},{key:"getPivotPointToRef",value:function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this}},{key:"getAbsolutePivotPoint",value:function(){var e=d.P.Zero();return this.getAbsolutePivotPointToRef(e),e}},{key:"getAbsolutePivotPointToRef",value:function(e){return this.getPivotPointToRef(e),d.P.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this}},{key:"markAsDirty",value:function(e){if(this._isDirty)return this;if(this._children){var t,i=_(this._children);try{for(i.s();!(t=i.n()).done;){t.value.markAsDirty(e)}}catch(r){i.e(r)}finally{i.f()}}return(0,o.Z)((0,u.Z)(n.prototype),"markAsDirty",this).call(this,e)}},{key:"setParent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e&&!this.parent)return this;var i=d.jp.Quaternion[0],r=d.jp.Vector3[0],a=d.jp.Vector3[1],o=d.jp.Matrix[1];d.y3.IdentityToRef(o);var s=d.jp.Matrix[0];this.computeWorldMatrix(!0);var l=this.rotationQuaternion;return l||(l=n._TmpRotation,d._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,l)),d.y3.ComposeToRef(this.scaling,l,this.position,s),this.parent&&s.multiplyToRef(this.parent.computeWorldMatrix(!0),s),e&&(e.computeWorldMatrix(!0).invertToRef(o),s.multiplyToRef(o,s)),s.decompose(a,i,r,t?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(a),this.position.copyFrom(r),this.parent=e,this}},{key:"nonUniformScaling",get:function(){return this._nonUniformScaling}},{key:"_updateNonUniformScalingState",value:function(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)}},{key:"attachToBone",value:function(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(),e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}},{key:"detachFromBone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=e?this._currentParentWhenAttachingToBone:null,this):(e&&(this.parent=this._currentParentWhenAttachingToBone),this)}},{key:"rotate",value:function(e,t,i){var r;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&i!==p.T.LOCAL){if(this.parent){var a=d.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(a),e=d.P.TransformNormal(e,a)}(r=d._f.RotationAxisToRef(e,t,n._RotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else r=d._f.RotationAxisToRef(e,t,n._RotationAxisCache),this.rotationQuaternion.multiplyToRef(r,this.rotationQuaternion);return this}},{key:"rotateAround",value:function(e,t,n){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=d._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var i=d.jp.Vector3[0],r=d.jp.Vector3[1],a=d.jp.Vector3[2],o=d.jp.Quaternion[0],s=d.jp.Matrix[0],l=d.jp.Matrix[1],u=d.jp.Matrix[2],c=d.jp.Matrix[3];return e.subtractToRef(this.position,i),d.y3.TranslationToRef(i.x,i.y,i.z,s),d.y3.TranslationToRef(-i.x,-i.y,-i.z,l),d.y3.RotationAxisToRef(t,n,u),l.multiplyToRef(u,c),c.multiplyToRef(s,c),c.decompose(r,o,a),this.position.addInPlace(a),o.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}},{key:"translate",value:function(e,t,n){var i=e.scale(t);if(n&&n!==p.T.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(i));else{var r=this.getPositionExpressedInLocalSpace().add(i);this.setPositionWithLocalVector(r)}return this}},{key:"addRotation",value:function(e,t,n){var i;this.rotationQuaternion?i=this.rotationQuaternion:(i=d.jp.Quaternion[1],d._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,i));var r=d.jp.Quaternion[0];return d._f.RotationYawPitchRollToRef(t,e,n,r),i.multiplyInPlace(r),this.rotationQuaternion||i.toEulerAnglesToRef(this.rotation),this}},{key:"_getEffectiveParent",value:function(){return this.parent}},{key:"computeWorldMatrix",value:function(e){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var t=this.getScene().getRenderId();if(!this._isDirty&&!e&&(this._currentRenderId===t||this.isSynchronized()))return this._currentRenderId=t,this._worldMatrix;var i=this.getScene().activeCamera,r=0!=(this._billboardMode&n.BILLBOARDMODE_USE_POSITION),a=this._billboardMode!==n.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;this._updateCache();var o=this._cache;o.pivotMatrixUpdated=!1,o.billboardMode=this.billboardMode,o.infiniteDistance=this.infiniteDistance,o.parent=this._parentNode,this._currentRenderId=t,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var s,l=this._getEffectiveParent(),u=n._TmpScaling,c=this._position;if(this._infiniteDistance&&!this.parent&&i){var h=i.getWorldMatrix(),f=new d.P(h.m[12],h.m[13],h.m[14]);(c=n._TmpTranslation).copyFromFloats(this._position.x+f.x,this._position.y+f.y,this._position.z+f.z)}(u.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion)?(this._rotationQuaternion._isDirty=!1,s=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(d._f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(s=n._TmpRotation,d._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,s));if(this._usePivotMatrix){var v=d.jp.Matrix[1];d.y3.ScalingToRef(u.x,u.y,u.z,v);var p=d.jp.Matrix[0];s.toRotationMatrix(p),this._pivotMatrix.multiplyToRef(v,d.jp.Matrix[4]),d.jp.Matrix[4].multiplyToRef(p,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(c.x,c.y,c.z)}else d.y3.ComposeToRef(u,s,c,this._localMatrix);if(l&&l.getWorldMatrix){if(e&&l.computeWorldMatrix(e),a){this._transformToBoneReferal?l.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),d.jp.Matrix[7]):d.jp.Matrix[7].copyFrom(l.getWorldMatrix());var _=d.jp.Vector3[5],g=d.jp.Vector3[6];d.jp.Matrix[7].decompose(g,void 0,_),d.y3.ScalingToRef(g.x,g.y,g.z,d.jp.Matrix[7]),d.jp.Matrix[7].setTranslation(_),d.P.TransformNormalToRef(this._position,l.getWorldMatrix(),_),this._localMatrix.setTranslation(_),this._localMatrix.multiplyToRef(d.jp.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(l.getWorldMatrix(),d.jp.Matrix[6]),d.jp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(l.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(a&&i&&this.billboardMode&&!r){var m=d.jp.Vector3[0];if(this._worldMatrix.getTranslationToRef(m),d.jp.Matrix[1].copyFrom(i.getViewMatrix()),d.jp.Matrix[1].setTranslationFromFloats(0,0,0),d.jp.Matrix[1].invertToRef(d.jp.Matrix[0]),(this.billboardMode&n.BILLBOARDMODE_ALL)!==n.BILLBOARDMODE_ALL){d.jp.Matrix[0].decompose(void 0,d.jp.Quaternion[0],void 0);var y=d.jp.Vector3[1];d.jp.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&n.BILLBOARDMODE_X)!==n.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&n.BILLBOARDMODE_Y)!==n.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&n.BILLBOARDMODE_Z)!==n.BILLBOARDMODE_Z&&(y.z=0),d.y3.RotationYawPitchRollToRef(y.y,y.x,y.z,d.jp.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(d.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(d.jp.Vector3[0])}else if(a&&i&&this.billboardMode&&r){var A=d.jp.Vector3[0];this._worldMatrix.getTranslationToRef(A);var E=i.globalPosition;this._worldMatrix.invertToRef(d.jp.Matrix[1]);var b=d.jp.Vector3[1];d.P.TransformCoordinatesToRef(E,d.jp.Matrix[1],b),b.normalize();var T=-Math.atan2(b.z,b.x)+Math.PI/2,S=Math.sqrt(b.x*b.x+b.z*b.z),M=-Math.atan2(b.y,S);if(d._f.RotationYawPitchRollToRef(T,M,0,d.jp.Quaternion[0]),(this.billboardMode&n.BILLBOARDMODE_ALL)!==n.BILLBOARDMODE_ALL){var I=d.jp.Vector3[1];d.jp.Quaternion[0].toEulerAnglesToRef(I),(this.billboardMode&n.BILLBOARDMODE_X)!==n.BILLBOARDMODE_X&&(I.x=0),(this.billboardMode&n.BILLBOARDMODE_Y)!==n.BILLBOARDMODE_Y&&(I.y=0),(this.billboardMode&n.BILLBOARDMODE_Z)!==n.BILLBOARDMODE_Z&&(I.z=0),d.y3.RotationYawPitchRollToRef(I.y,I.x,I.z,d.jp.Matrix[0])}else d.y3.FromQuaternionToRef(d.jp.Quaternion[0],d.jp.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(d.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(d.jp.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):l&&l._nonUniformScaling?this._updateNonUniformScalingState(l._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=d.y3.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}},{key:"resetLocalMatrix",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.computeWorldMatrix(),e)for(var t=this.getChildren(),n=0;n<t.length;++n){var i=t[n];if(i){i.computeWorldMatrix();var r=d.jp.Matrix[0];i._localMatrix.multiplyToRef(this._localMatrix,r);var a=d.jp.Quaternion[0];r.decompose(i.scaling,a,i.position),i.rotationQuaternion?i.rotationQuaternion.copyFrom(a):a.toEulerAnglesToRef(i.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=d._f.Identity()),this._worldMatrix=d.y3.Identity()}},{key:"_afterComputeWorldMatrix",value:function(){}},{key:"registerAfterWorldMatrixUpdate",value:function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this}},{key:"unregisterAfterWorldMatrixUpdate",value:function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this}},{key:"getPositionInCameraSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e||(e=this.getScene().activeCamera),d.P.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())}},{key:"getDistanceToCamera",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()}},{key:"clone",value:function(e,t,i){var r=this,a=h.p4.Clone((function(){return new n(e,r.getScene())}),this);if(a.name=e,a.id=e,t&&(a.parent=t),!i)for(var o=this.getDescendants(!0),s=0;s<o.length;s++){var l=o[s];l.clone&&l.clone(e+"."+l.name,a)}return a}},{key:"serialize",value:function(e){var t=h.p4.Serialize(this,e);return t.type=this.getClassName(),t.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),t}},{key:"getChildTransformNodes",value:function(e,t){var i=[];return this._getDescendants(i,e,(function(e){return(!t||t(e))&&e instanceof n})),i}},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){var i=this._parentContainer.transformNodes.indexOf(this);i>-1&&this._parentContainer.transformNodes.splice(i,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),e){var r,a=this.getChildTransformNodes(!0),s=_(a);try{for(s.s();!(r=s.n()).done;){var l=r.value;l.parent=null,l.computeWorldMatrix(!0)}}catch(c){s.e(c)}finally{s.f()}}(0,o.Z)((0,u.Z)(n.prototype),"dispose",this).call(this,e,t)}},{key:"normalizeToUnitCube",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,i=null,r=null;t&&(this.rotationQuaternion?(r=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(i=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var a=this.getHierarchyBoundingVectors(e,n),o=a.max.subtract(a.min),s=Math.max(o.x,o.y,o.z);if(0===s)return this;var l=1/s;return this.scaling.scaleInPlace(l),t&&(this.rotationQuaternion&&r?this.rotationQuaternion.copyFrom(r):this.rotation&&i&&this.rotation.copyFrom(i)),this}},{key:"_syncAbsoluteScalingAndRotation",value:function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}],[{key:"Parse",value:function(e,t,i){var r=h.p4.Parse((function(){return new n(e.name,t)}),e,t,i);return e.localMatrix?r.setPreTransformMatrix(d.y3.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(d.y3.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),r._waitingParsedUniqueId=e.uniqueId,void 0!==e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),r}}]),n}(v.N);y.BILLBOARDMODE_NONE=0,y.BILLBOARDMODE_X=1,y.BILLBOARDMODE_Y=2,y.BILLBOARDMODE_Z=4,y.BILLBOARDMODE_ALL=7,y.BILLBOARDMODE_USE_POSITION=128,y._TmpRotation=d._f.Zero(),y._TmpScaling=d.P.Zero(),y._TmpTranslation=d.P.Zero(),y._LookAtVectorCache=new d.P(0,0,0),y._RotationAxisCache=new d._f,(0,c.gn)([(0,h.hd)("position")],y.prototype,"_position",void 0),(0,c.gn)([(0,h.hd)("rotation")],y.prototype,"_rotation",void 0),(0,c.gn)([(0,h.mv)("rotationQuaternion")],y.prototype,"_rotationQuaternion",void 0),(0,c.gn)([(0,h.hd)("scaling")],y.prototype,"_scaling",void 0),(0,c.gn)([(0,h.qC)("billboardMode")],y.prototype,"_billboardMode",void 0),(0,c.gn)([(0,h.qC)()],y.prototype,"scalingDeterminant",void 0),(0,c.gn)([(0,h.qC)("infiniteDistance")],y.prototype,"_infiniteDistance",void 0),(0,c.gn)([(0,h.qC)()],y.prototype,"ignoreNonUniformScaling",void 0),(0,c.gn)([(0,h.qC)()],y.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},8134:function(e,t,n){"use strict";n.d(t,{B:function(){return a},M:function(){return s}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"BuildArray",value:function(e,t){for(var n=[],i=0;i<e;++i)n.push(t());return n}},{key:"BuildTuple",value:function(t,n){return e.BuildArray(t,n)}}]),e}();var o=["push","splice","pop","shift","unshift"];function s(e,t){var n=o.map((function(n){return function(e,t,n){var i=e[t];if("function"!=typeof i)return null;var r=function i(){var r=e.length,a=i.previous.apply(e,arguments);return n(t,r),a};return i.next=r,r.previous=i,e[t]=r,function(){var n=r.previous;if(n){var i=r.next;i?(n.next=i,i.previous=n):(n.next=void 0,e[t]=n),r.next=void 0,r.previous=void 0}}}(e,n,t)}));return function(){n.forEach((function(e){null==e||e()}))}}},505:function(e,t,n){"use strict";n.d(t,{D:function(){return o}});var i=n(5671),r=n(3144),a=n(5092),o=function(){function e(t,n){(0,i.Z)(this,e),e.IsAvailable&&(this._observer=new window.ComputePressureObserver(t,n))}return(0,r.Z)(e,[{key:"observe",value:function(e){var t,n;(null===(t=this._observer)||void 0===t?void 0:t.observe)&&(null===(n=this._observer)||void 0===n||n.observe(e).catch((function(){})))}},{key:"unobserve",value:function(e){try{var t,n;(null===(t=this._observer)||void 0===t?void 0:t.unobserve)&&(null===(n=this._observer)||void 0===n||n.unobserve(e))}catch(i){}}}],[{key:"IsAvailable",get:function(){var e,t;return(0,a.CG)()&&"ComputePressureObserver"in window&&(null===(e=window.ComputePressureObserver)||void 0===e||null===(t=e.supportedSources)||void 0===t?void 0:t.includes("cpu"))}}]),e}()},5203:function(e,t,n){"use strict";function i(e,t,n){try{var i=e.next();i.done?t(i):i.value?i.value.then((function(){i.value=void 0,t(i)}),n):t(i)}catch(r){n(r)}}function r(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return function(n,r,a){var o=performance.now();void 0===e||o-e>t?(e=o,setTimeout((function(){i(n,r,a)}),0)):i(n,r,a)}}function a(e,t,n,i,r){!function a(){var o,s=function(e){e.done?n(e.value):void 0===o?o=!0:a()};do{o=void 0,r&&r.aborted?i(new Error("Aborted")):t(e,s,i),void 0===o&&(o=!1)}while(o)}()}function o(e,t){var n;return a(e,i,(function(e){return n=e}),(function(e){throw e}),t),n}function s(e,t,n){return new Promise((function(i,r){a(e,t,i,r,n)}))}function l(e,t){return function(){return o(e.apply(void 0,arguments),t)}}n.d(t,{KO:function(){return r},s3:function(){return o},sM:function(){return s},vp:function(){return l}})},9336:function(e,t,n){"use strict";n.d(t,{G6:function(){return P},N$:function(){return T},QC:function(){return A},RR:function(){return b},XX:function(){return S},hd:function(){return E},mv:function(){return M},n9:function(){return m},oU:function(){return g},p4:function(){return I},qC:function(){return _},qQ:function(){return y},wz:function(){return p}});var i=n(5671),r=n(3144),a=n(7032),o=n(6900),s=n(5230),l=n(7046),u={},c={},h=function(e,t,n){var i=e();a.$&&a.$.AddTagsTo(i,t.tags);var r=f(i);for(var o in r){var s=r[o],l=t[o],u=s.type;if(null!=l&&("uniqueId"!==o||I.AllowLoadingUniqueId))switch(u){case 0:case 6:case 11:i[o]=l;break;case 1:i[o]=n||l.isRenderTarget?l:l.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:i[o]=n?l:l.clone()}}return i};function f(e){var t=e.getClassName();if(c[t])return c[t];c[t]={};for(var n=c[t],i=e,r=t;r;){var a=u[r];for(var o in a)n[o]=a[o];var s=void 0,l=!1;do{if(!(s=Object.getPrototypeOf(i)).getClassName){l=!0;break}if(s.getClassName()!==r)break;i=s}while(s);if(l)break;r=s.getClassName(),i=s}return n}function d(e,t){return function(n,i){var r=function(e){var t=e.getClassName();return u[t]||(u[t]={}),u[t]}(n);r[i]||(r[i]={type:e,sourceName:t})}}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(n,i){var r=t||"_"+i;Object.defineProperty(n,i,{get:function(){return this[r]},set:function(t){"function"==typeof this.equals&&this.equals(t)||this[r]!==t&&(this[r]=t,n[e].apply(this))},enumerable:!0,configurable:!0})}}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return v(e,t)}function _(e){return d(0,e)}function g(e){return d(1,e)}function m(e){return d(2,e)}function y(e){return d(3,e)}function A(e){return d(4,e)}function E(e){return d(5,e)}function b(e){return d(6,e)}function T(e){return d(7,e)}function S(e){return d(8,e)}function M(e){return d(10,e)}var I=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"AppendSerializedAnimations",value:function(e,t){if(e.animations){t.animations=[];for(var n=0;n<e.animations.length;n++){var i=e.animations[n];t.animations.push(i.serialize())}}}},{key:"Serialize",value:function(t,n){n||(n={}),a.$&&(n.tags=a.$.GetTags(t));var i=f(t);for(var r in i){var o=i[r],s=o.sourceName||r,l=o.type,u=t[r];if(null!=u&&("uniqueId"!==r||e.AllowLoadingUniqueId))switch(l){case 0:n[s]=u;break;case 1:case 3:case 7:case 9:n[s]=u.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:n[s]=u.asArray();break;case 6:case 11:n[s]=u.id}}return n}},{key:"Parse",value:function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=t();r||(r=""),a.$&&a.$.AddTagsTo(s,n.tags);var u=f(s);for(var c in u){var h=u[c],d=n[h.sourceName||c],v=h.type;if(null!=d&&("uniqueId"!==c||e.AllowLoadingUniqueId)){var p=s;switch(v){case 0:p[c]=d;break;case 1:i&&(p[c]=e._TextureParser(d,i,r));break;case 2:p[c]=l.Wo.FromArray(d);break;case 3:p[c]=e._FresnelParametersParser(d);break;case 4:p[c]=o.FM.FromArray(d);break;case 5:p[c]=o.P.FromArray(d);break;case 6:i&&(p[c]=i.getLastMeshById(d));break;case 7:p[c]=e._ColorCurvesParser(d);break;case 8:p[c]=l.HE.FromArray(d);break;case 9:p[c]=e._ImageProcessingConfigurationParser(d);break;case 10:p[c]=o._f.FromArray(d);break;case 11:i&&(p[c]=i.getCameraById(d));break;case 12:p[c]=o.y3.FromArray(d)}}}return s}},{key:"Clone",value:function(e,t){return h(e,t,!1)}},{key:"Instanciate",value:function(e,t){return h(e,t,!0)}}]),e}();function P(e,t,n,i){var r=n.value;n.value=function(){var n=r;if("undefined"!=typeof _native&&_native[t]){var a=_native[t];n=i?function(){return i.apply(void 0,arguments)?a.apply(void 0,arguments):r.apply(void 0,arguments)}:a}return e[t]=n,n.apply(void 0,arguments)}}I.AllowLoadingUniqueId=!1,I._ImageProcessingConfigurationParser=function(e){throw(0,s.S)("ImageProcessingConfiguration")},I._FresnelParametersParser=function(e){throw(0,s.S)("FresnelParameters")},I._ColorCurvesParser=function(e){throw(0,s.S)("ColorCurves")},I._TextureParser=function(e,t,n){throw(0,s.S)("Texture")},P.filter=function(e){return function(t,n,i){return P(t,n,i,e)}}},3192:function(e,t,n){"use strict";n.d(t,{j:function(){return u}});var i=n(5671),r=n(3144),a=n(2328);function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var l=function(e,t){return e?e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(t):e.clone?e.clone():null:null};var u=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"DeepCopy",value:function(e,t,n,i){var r,s=function(e){var t=[];do{Object.getOwnPropertyNames(e).forEach((function(e){-1===t.indexOf(e)&&t.push(e)}))}while(e=Object.getPrototypeOf(e));return t}(e),u=o(s);try{for(u.s();!(r=u.n()).done;){var c=r.value;if(("_"!==c[0]||i&&-1!==i.indexOf(c))&&!(c.endsWith("Observable")||n&&-1!==n.indexOf(c))){var h=e[c],f=typeof h;if("function"!==f)try{if("object"===f)if(h instanceof Array){if(t[c]=[],h.length>0)if("object"==typeof h[0])for(var d=0;d<h.length;d++){var v=l(h[d],t);-1===t[c].indexOf(v)&&t[c].push(v)}else t[c]=h.slice(0)}else t[c]=l(h,t);else t[c]=h}catch(p){a.Y.Warn(p.message)}}}}catch(_){u.e(_)}finally{u.f()}}}]),e}()},5230:function(e,t,n){"use strict";function i(e){return"".concat(e," needs to be imported before as it contains a side-effect required by your code.")}n.d(t,{S:function(){return i}})},5092:function(e,t,n){"use strict";function i(){return"undefined"!=typeof window}function r(){return"undefined"!=typeof navigator}function a(){return"undefined"!=typeof document}function o(e){for(var t="",n=e.firstChild;n;)3===n.nodeType&&(t+=n.textContent),n=n.nextSibling;return t}n.d(t,{CG:function(){return i},MZ:function(){return s},n5:function(){return a},up:function(){return r},v:function(){return o}});var s={IsWindowObjectExist:i,IsNavigatorAvailable:r,IsDocumentAvailable:a,GetDOMTextContent:o}},8298:function(e,t,n){"use strict";n.d(t,{GU:function(){return c},LH:function(){return f},SM:function(){return h}});var i=n(7326),r=n(3144),a=n(5671),o=n(136),s=n(6215),l=n(1120);function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,l.Z)(e);if(t){var r=(0,l.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,s.Z)(this,n)}}var c=function(e){(0,o.Z)(n,e);var t=u(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n)}((0,n(2407).Z)(Error));c._setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e};var h={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},f=function(e){(0,o.Z)(n,e);var t=u(n);function n(e,r,o){var s;return(0,a.Z)(this,n),(s=t.call(this,e)).errorCode=r,s.innerError=o,s.name="RuntimeError",c._setPrototypeOf((0,i.Z)(s),n.prototype),s}return(0,r.Z)(n)}(c)},562:function(e,t,n){"use strict";n.d(t,{$K:function(){return U},rN:function(){return x},VL:function(){return w},vP:function(){return L},r6:function(){return k},Ip:function(){return O},FV:function(){return F},$M:function(){return R}});var i=n(4942),r=n(3144),a=n(5671),o=n(7326),s=n(136),l=n(6215),u=n(1120),c=n(8628),h=n(5092),f=n(4174),d=(0,r.Z)((function e(){(0,a.Z)(this,e)}));d.FilesToLoad={};var v=function(){function e(){(0,a.Z)(this,e)}return(0,r.Z)(e,null,[{key:"ExponentialBackoff",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(n,i,r){return 0!==i.status||r>=e||-1!==n.indexOf("file:")?-1:Math.pow(2,r)*t}}}]),e}(),p=n(8298),_=n(2399),g=n(9776),m=n(4796),y=n(4198),A=n(2328),E=n(8370);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,u.Z)(e);if(t){var r=(0,u.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,l.Z)(this,n)}}var M=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),I=function(e){(0,s.Z)(n,e);var t=S(n);function n(e,i){var r;return(0,a.Z)(this,n),(r=t.call(this,e,p.SM.LoadFileError)).name="LoadFileError",p.GU._setPrototypeOf((0,o.Z)(r),n.prototype),i instanceof c.g?r.request=i:r.file=i,r}return(0,r.Z)(n)}(p.LH),P=function(e){(0,s.Z)(n,e);var t=S(n);function n(e,i){var r;return(0,a.Z)(this,n),(r=t.call(this,e,p.SM.RequestFileError)).request=i,r.name="RequestFileError",p.GU._setPrototypeOf((0,o.Z)(r),n.prototype),r}return(0,r.Z)(n)}(p.LH),C=function(e){(0,s.Z)(n,e);var t=S(n);function n(e,i){var r;return(0,a.Z)(this,n),(r=t.call(this,e,p.SM.ReadFileError)).file=i,r.name="ReadFileError",p.GU._setPrototypeOf((0,o.Z)(r),n.prototype),r}return(0,r.Z)(n)}(p.LH),x={DefaultRetryStrategy:v.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:function(e){return e}},D=function(e){return e=e.replace(/#/gm,"%23")},R=function(e,t){if((!e||0!==e.indexOf("data:"))&&x.CorsBehavior)if("string"==typeof x.CorsBehavior||x.CorsBehavior instanceof String)t.crossOrigin=x.CorsBehavior;else{var n=x.CorsBehavior(e);n&&(t.crossOrigin=n)}},k=function(e,t,n,i){var r,a,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=arguments.length>5?arguments[5]:void 0,l=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?"undefined"!=typeof Blob&&"undefined"!=typeof URL?(a=URL.createObjectURL(new Blob([e],{type:o})),l=!0):a="data:".concat(o,";base64,")+(0,_.Gh)(e):e instanceof Blob?(a=URL.createObjectURL(e),l=!0):(a=D(e),a=x.PreprocessUrl(e));var u=y.l.LastCreatedEngine,c=function(t){if(n){var i=a||e.toString();n("Error while trying to load image: ".concat(0===i.indexOf("http")||i.length<=128?i:i.slice(0,128)+"..."),t)}};if("undefined"==typeof Image||null!==(r=null==u?void 0:u._features.forceBitmapOverHTMLImageElement)&&void 0!==r&&r)return L(a,(function(i){u.createImageBitmap(new Blob([i],{type:o}),T({premultiplyAlpha:"none"},s)).then((function(e){t(e),l&&URL.revokeObjectURL(a)})).catch((function(t){n&&n("Error while trying to load image: "+e,t)}))}),void 0,i||void 0,!0,(function(e,t){c(t)})),null;var h=new Image;R(a,h);var f=function e(){h.removeEventListener("load",e),h.removeEventListener("error",v),t(h),l&&h.src&&URL.revokeObjectURL(h.src)},v=function e(t){h.removeEventListener("load",f),h.removeEventListener("error",e),c(t),l&&h.src&&URL.revokeObjectURL(h.src)};h.addEventListener("load",f),h.addEventListener("error",v);var p="blob:"===a.substring(0,5),g="data:"===a.substring(0,5),m=function(){p||g?h.src=a:L(a,(function(e,t,n){var i=new Blob([e],{type:!o&&n?n:o}),r=URL.createObjectURL(i);l=!0,h.src=r}),void 0,i||void 0,!0,(function(e,t){c(t)}))},A=function(){i&&i.loadImage(a,h)};if(!p&&!g&&i&&i.enableTexturesOffline)i.open(A,m);else{if(-1!==a.indexOf("file:")){var E=decodeURIComponent(a.substring(5).toLowerCase());if(d.FilesToLoad[E]&&"undefined"!=typeof URL){try{var b;try{b=URL.createObjectURL(d.FilesToLoad[E])}catch(S){b=URL.createObjectURL(d.FilesToLoad[E])}h.src=b,l=!0}catch(M){h.src=""}return h}}m()}return h},O=function(e,t,n,i,r){var a=new FileReader,o={onCompleteObservable:new f.y$,abort:function(){return a.abort()}};return a.onloadend=function(){return o.onCompleteObservable.notifyObservers(o)},r&&(a.onerror=function(){r(new C("Unable to read ".concat(e.name),e))}),a.onload=function(e){t(e.target.result)},n&&(a.onprogress=n),i?a.readAsArrayBuffer(e):a.readAsText(e),o},L=function(e,t,n,i,r,a,o){if(e.name)return O(e,t,n,r,a?function(e){a(void 0,e)}:void 0);var s=e;if(-1!==s.indexOf("file:")){var l=decodeURIComponent(s.substring(5).toLowerCase());0===l.indexOf("./")&&(l=l.substring(2));var u=d.FilesToLoad[l];if(u)return O(u,t,n,r,a?function(e){return a(void 0,new I(e.message,e.file))}:void 0)}var c=B(s),h=c.match,v=c.type;if(h){var _={onCompleteObservable:new f.y$,abort:function(){return function(){}}};try{var g=r?U(s):W(s);t(g,void 0,v)}catch(p){a?a(void 0,p):A.Y.Error(p.message||"Failed to parse the Data URL")}return E.Q.SetImmediate((function(){_.onCompleteObservable.notifyObservers(_)})),_}return F(s,(function(e,n){t(e,null==n?void 0:n.responseURL,null==n?void 0:n.getResponseHeader("content-type"))}),n,i,r,a?function(e){a(e.request,new I(e.message,e.request))}:void 0,o)},F=function(e,t,n,i,r,a,o){e=D(e),e=x.PreprocessUrl(e);var s=x.BaseUrl+e,l=!1,u={onCompleteObservable:new f.y$,abort:function(){return l=!0}},d=function(){var e,i=new c.g,f=null,d=function(){i&&(n&&i.removeEventListener("progress",n),e&&i.removeEventListener("readystatechange",e),i.removeEventListener("loadend",v))},v=function(){d(),u.onCompleteObservable.notifyObservers(u),u.onCompleteObservable.clear(),n=void 0,e=null,v=null,a=void 0,o=void 0,t=void 0};u.abort=function(){l=!0,v&&v(),i&&i.readyState!==(XMLHttpRequest.DONE||4)&&i.abort(),null!==f&&(clearTimeout(f),f=null),i=null};var p=function(e){var t=e.message||"Unknown error";a&&i?a(new P(t,i)):A.Y.Error(t)};!function u(_){if(i){if(i.open("GET",s),o)try{o(i)}catch(g){return void p(g)}r&&(i.responseType="arraybuffer"),n&&i.addEventListener("progress",n),v&&i.addEventListener("loadend",v),e=function(){if(!l&&i&&i.readyState===(XMLHttpRequest.DONE||4)){if(e&&i.removeEventListener("readystatechange",e),i.status>=200&&i.status<300||0===i.status&&(!(0,h.CG)()||N())){try{t&&t(r?i.response:i.responseText,i)}catch(g){p(g)}return}var n=x.DefaultRetryStrategy;if(n){var o=n(s,i,_);if(-1!==o)return d(),i=new c.g,void(f=setTimeout((function(){return u(_+1)}),o))}var v=new P("Error status: "+i.status+" "+i.statusText+" - Unable to load "+s,i);a&&a(v)}},i.addEventListener("readystatechange",e),i.send()}}(0)};if(i&&i.enableSceneOffline){var v=function(e){e&&e.status>400?a&&a(e):d()};i.open((function(){i&&i.loadFile(x.BaseUrl+e,(function(e){!l&&t&&t(e),u.onCompleteObservable.notifyObservers(u)}),n?function(e){!l&&n&&n(e)}:void 0,v,r)}),v)}else d();return u},N=function(){return"undefined"!=typeof location&&"file:"===location.protocol},w=function(e){return M.test(e)},B=function(e){var t=M.exec(e);return null===t||0===t.length?{match:!1,type:""}:{match:!0,type:t[0].replace("data:","").replace("base64,","")}};function U(e){return(0,_.HQ)(e.split(",")[1])}var V,W=function(e){return(0,_.rP)(e.split(",")[1])};m.B._FileToolsLoadImage=k,m.B._FileToolsLoadFile=L,g.L._FileToolsLoadFile=L;!function(e,t,n,i,r,a,o,s,l,u){V={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:t,DefaultRetryStrategy:n.DefaultRetryStrategy,BaseUrl:n.BaseUrl,CorsBehavior:n.CorsBehavior,PreprocessUrl:n.PreprocessUrl,IsBase64DataUrl:i,IsFileURL:r,LoadFile:a,LoadImage:o,ReadFile:s,RequestFile:l,SetCorsBehavior:u},Object.defineProperty(V,"DefaultRetryStrategy",{get:function(){return n.DefaultRetryStrategy},set:function(e){n.DefaultRetryStrategy=e}}),Object.defineProperty(V,"BaseUrl",{get:function(){return n.BaseUrl},set:function(e){n.BaseUrl=e}}),Object.defineProperty(V,"PreprocessUrl",{get:function(){return n.PreprocessUrl},set:function(e){n.PreprocessUrl=e}}),Object.defineProperty(V,"CorsBehavior",{get:function(){return n.CorsBehavior},set:function(e){n.CorsBehavior=e}})}(U,W,x,w,N,L,k,O,F,R)},9950:function(e,t,n){"use strict";function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}n.d(t,{f:function(){return i}})},8797:function(e,t,n){"use strict";n.d(t,{K:function(){return s}});var i=n(5671),r=n(3144),a=n(2328),o=n(1704),s=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"Instantiate",value:function(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];var t=(0,o.q)(e);if(t)return t;a.Y.Warn(e+" not found, you may have missed an import.");for(var n=e.split("."),i=window||this,r=0,s=n.length;r<s;r++)i=i[n[r]];return"function"!=typeof i?null:i}}]),e}();s.RegisteredExternalClasses={}},2328:function(e,t,n){"use strict";n.d(t,{Y:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"_CheckLimit",value:function(t,n){var i=e._LogLimitOutputs[t];return i?i.current++:(i={limit:n,current:1},e._LogLimitOutputs[t]=i),i.current<=i.limit}},{key:"_GenerateLimitMessage",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=e._LogLimitOutputs[t];if(i&&e.MessageLimitReached){var r,a=this._Levels[n];if(i.current===i.limit)e[a.name](e.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,null!==(r=a.name)&&void 0!==r?r:""))}}},{key:"_AddLogEntry",value:function(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)}},{key:"_FormatMessage",value:function(e){var t=function(e){return e<10?"0"+e:""+e},n=new Date;return"["+t(n.getHours())+":"+t(n.getMinutes())+":"+t(n.getSeconds())+"]: "+e}},{key:"_LogDisabled",value:function(e,t){}},{key:"_LogEnabled",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;if(void 0===i||e._CheckLimit(n,i)){var r=e._FormatMessage(n),a=this._Levels[t];a.logFunc&&a.logFunc("BJS - "+r);var o="<div style='color:".concat(a.color,"'>").concat(r,"</div><br>");e._AddLogEntry(o),e._GenerateLimitMessage(n,t)}}},{key:"LogCache",get:function(){return e._LogCache}},{key:"ClearLogCache",value:function(){e._LogCache="",e._LogLimitOutputs={},e.errorsCount=0}},{key:"LogLevels",set:function(t){var n=this;e.Log=e._LogDisabled,e.Warn=e._LogDisabled,e.Error=e._LogDisabled,[e.MessageLogLevel,e.WarningLogLevel,e.ErrorLogLevel].forEach((function(i){(t&i)===i&&(e[n._Levels[i].name]=e._LogEnabled.bind(e,i))}))}}]),e}();a.NoneLogLevel=0,a.MessageLogLevel=1,a.WarningLogLevel=2,a.ErrorLogLevel=4,a.AllLogLevel=7,a.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",a._LogCache="",a._LogLimitOutputs={},a._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],a.errorsCount=0,a.Log=a._LogEnabled.bind(a,a.MessageLogLevel),a.Warn=a._LogEnabled.bind(a,a.WarningLogLevel),a.Error=a._LogEnabled.bind(a,a.ErrorLogLevel)},4174:function(e,t,n){"use strict";n.d(t,{y$:function(){return u}});var i=n(5671),r=n(3144);function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var s=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;(0,i.Z)(this,e),this.initialize(t,n,r,a)}return(0,r.Z)(e,[{key:"initialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return this.mask=e,this.skipNextObservers=t,this.target=n,this.currentTarget=i,this}}]),e}(),l=(0,r.Z)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,i.Z)(this,e),this.callback=t,this.mask=n,this.scope=r,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1})),u=function(){function e(t){(0,i.Z)(this,e),this._observers=new Array,this._eventState=new s(0),t&&(this._onObserverAdded=t)}return(0,r.Z)(e,[{key:"observers",get:function(){return this._observers}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!e)return null;var a=new l(e,t,i);return a.unregisterOnNextCall=r,n?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),a}},{key:"addOnce",value:function(e){return this.add(e,void 0,void 0,void 0,!0)}},{key:"remove",value:function(e){return!!e&&(-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))}},{key:"removeCallback",value:function(e,t){for(var n=0;n<this._observers.length;n++){var i=this._observers[n];if(!i._willBeUnregistered&&(i.callback===e&&(!t||t===i.scope)))return this._deferUnregister(i),!0}return!1}},{key:"_deferUnregister",value:function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((function(){t._remove(e)}),0)}},{key:"_remove",value:function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)}},{key:"makeObserverTopPriority",value:function(e){this._remove(e),this._observers.unshift(e)}},{key:"makeObserverBottomPriority",value:function(e){this._remove(e),this._observers.push(e)}},{key:"notifyObservers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;if(!this._observers.length)return!0;var o=this._eventState;o.mask=t,o.target=n,o.currentTarget=i,o.skipNextObservers=!1,o.lastReturnValue=e,o.userInfo=r;var s,l=a(this._observers);try{for(l.s();!(s=l.n()).done;){var u=s.value;if(!u._willBeUnregistered&&(u.mask&t&&(u.scope?o.lastReturnValue=u.callback.apply(u.scope,[e,o]):o.lastReturnValue=u.callback(e,o),u.unregisterOnNextCall&&this._deferUnregister(u)),o.skipNextObservers))return!1}}catch(c){l.e(c)}finally{l.f()}return!0}},{key:"notifyObserver",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(!e._willBeUnregistered){var i=this._eventState;i.mask=n,i.skipNextObservers=!1,e.callback(t,i),e.unregisterOnNextCall&&this._deferUnregister(e)}}},{key:"hasObservers",value:function(){return this._observers.length>0}},{key:"clear",value:function(){this._observers=new Array,this._onObserverAdded=null}},{key:"clone",value:function(){var t=new e;return t._observers=this._observers.slice(0),t}},{key:"hasSpecificMask",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=a(this._observers);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.mask&t||i.mask===t)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}}],[{key:"FromPromise",value:function(t,n){var i=new e;return t.then((function(e){i.notifyObservers(e)})).catch((function(e){if(!n)throw e;n.notifyObservers(e)})),i}}]),e}()},2864:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var i=n(5671),r=n(3144),a=n(2786),o=function(){function e(){(0,i.Z)(this,e),this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return(0,r.Z)(e,[{key:"min",get:function(){return this._min}},{key:"max",get:function(){return this._max}},{key:"average",get:function(){return this._average}},{key:"lastSecAverage",get:function(){return this._lastSecAverage}},{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this._totalAccumulated}},{key:"count",get:function(){return this._totalValueCount}},{key:"fetchNewFrame",value:function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}},{key:"addCount",value:function(t,n){e.Enabled&&(this._current+=t,n&&this._fetchResult())}},{key:"beginMonitoring",value:function(){e.Enabled&&(this._startMonitoringTime=a.F.Now)}},{key:"endMonitoring",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e.Enabled){t&&this.fetchNewFrame();var n=a.F.Now;this._current=n-this._startMonitoringTime,t&&this._fetchResult()}}},{key:"_fetchResult",value:function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=a.F.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}]),e}();o.Enabled=!0},2786:function(e,t,n){"use strict";n.d(t,{F:function(){return o}});var i=n(5671),r=n(3144),a=n(5092),o=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"Now",get:function(){return a.MZ.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}]),e}()},5934:function(e,t,n){"use strict";n.d(t,{f:function(){return h},t:function(){return c}});var i=n(1752),r=n(136),a=n(6215),o=n(1120),s=n(5671),l=n(3144);function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,o.Z)(e);if(t){var r=(0,o.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,a.Z)(this,n)}}var c=function(){function e(t){(0,s.Z)(this,e),this.length=0,this.data=new Array(t),this._id=e._GlobalId++}return(0,l.Z)(e,[{key:"push",value:function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)}},{key:"forEach",value:function(e){for(var t=0;t<this.length;t++)e(this.data[t])}},{key:"sort",value:function(e){this.data.sort(e)}},{key:"reset",value:function(){this.length=0}},{key:"dispose",value:function(){this.reset(),this.data&&(this.data.length=0)}},{key:"concat",value:function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}}},{key:"indexOf",value:function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t}},{key:"contains",value:function(e){return-1!==this.indexOf(e)}}]),e}();c._GlobalId=0;var h=function(e){(0,r.Z)(n,e);var t=u(n);function n(){var e;return(0,s.Z)(this,n),(e=t.apply(this,arguments))._duplicateId=0,e}return(0,l.Z)(n,[{key:"push",value:function(e){(0,i.Z)((0,o.Z)(n.prototype),"push",this).call(this,e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId}},{key:"pushNoDuplicate",value:function(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)}},{key:"reset",value:function(){(0,i.Z)((0,o.Z)(n.prototype),"reset",this).call(this),this._duplicateId++}},{key:"concatWithNoDuplicate",value:function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var n=(e.data||e)[t];this.pushNoDuplicate(n)}}}}]),n}(c)},128:function(e,t,n){"use strict";n.d(t,{x:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this._count=0,this._data={}}return(0,r.Z)(e,[{key:"copyFrom",value:function(e){var t=this;this.clear(),e.forEach((function(e,n){return t.add(e,n)}))}},{key:"get",value:function(e){var t=this._data[e];if(void 0!==t)return t}},{key:"getOrAddWithFactory",value:function(e,t){var n=this.get(e);return void 0!==n||(n=t(e))&&this.add(e,n),n}},{key:"getOrAdd",value:function(e,t){var n=this.get(e);return void 0!==n?n:(this.add(e,t),t)}},{key:"contains",value:function(e){return void 0!==this._data[e]}},{key:"add",value:function(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)}},{key:"set",value:function(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)}},{key:"getAndRemove",value:function(e){var t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null}},{key:"remove",value:function(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)}},{key:"clear",value:function(){this._data={},this._count=0}},{key:"count",get:function(){return this._count}},{key:"forEach",value:function(e){for(var t in this._data){e(t,this._data[t])}}},{key:"first",value:function(e){for(var t in this._data){var n=e(t,this._data[t]);if(n)return n}return null}}]),e}()},2399:function(e,t,n){"use strict";n.d(t,{Gh:function(){return i},HQ:function(){return a},rP:function(){return r}});var i=function(e){for(var t,n,i,r,a,o,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",c=0,h=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);c<h.length;)r=(t=h[c++])>>2,a=(3&t)<<4|(n=c<h.length?h[c++]:Number.NaN)>>4,o=(15&n)<<2|(i=c<h.length?h[c++]:Number.NaN)>>6,s=63&i,isNaN(n)?o=s=64:isNaN(i)&&(s=64),u+=l.charAt(r)+l.charAt(a)+l.charAt(o)+l.charAt(s);return u},r=function(e){return atob(e)},a=function(e){for(var t=r(e),n=t.length,i=new Uint8Array(new ArrayBuffer(n)),a=0;a<n;a++)i[a]=t.charCodeAt(a);return i.buffer}},7032:function(e,t,n){"use strict";n.d(t,{$:function(){return o}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"Eval",value:function(t,n){return"true"===(t=t.match(/\([^()]*\)/g)?t.replace(/\([^()]*\)/g,(function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,n)})):e._HandleParenthesisContent(t,n))||"false"!==t&&e.Eval(t,n)}},{key:"_HandleParenthesisContent",value:function(t,n){var i;n=n||function(e){return"true"===e};var r=t.split("||");for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a)){var o=e._SimplifyNegation(r[a].trim()),s=o.split("&&");if(s.length>1)for(var l=0;l<s.length;++l){var u=e._SimplifyNegation(s[l].trim());if(!(i="true"!==u&&"false"!==u?"!"===u[0]?!n(u.substring(1)):n(u):"true"===u)){o="false";break}}if(i||"true"===o){i=!0;break}i="true"!==o&&"false"!==o?"!"===o[0]?!n(o.substring(1)):n(o):"true"===o}return i?"true":"false"}},{key:"_SimplifyNegation",value:function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,(function(e){return(e=e.replace(/[\s]/g,(function(){return""}))).length%2?"!":""}))).trim())?e="false":"!false"===e&&(e="true"),e}}]),e}(),o=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"EnableFor",value:function(t){t._tags=t._tags||{},t.hasTags=function(){return e.HasTags(t)},t.addTags=function(n){return e.AddTagsTo(t,n)},t.removeTags=function(n){return e.RemoveTagsFrom(t,n)},t.matchesTagsQuery=function(n){return e.MatchesQuery(t,n)}}},{key:"DisableFor",value:function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}},{key:"HasTags",value:function(e){if(!e._tags)return!1;var t=e._tags;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))return!0;return!1}},{key:"GetTags",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e._tags)return null;if(t){var n=[];for(var i in e._tags)Object.prototype.hasOwnProperty.call(e._tags,i)&&!0===e._tags[i]&&n.push(i);return n.join(" ")}return e._tags}},{key:"AddTagsTo",value:function(t,n){n&&("string"==typeof n&&n.split(" ").forEach((function(n){e._AddTagTo(t,n)})))}},{key:"_AddTagTo",value:function(t,n){""!==(n=n.trim())&&"true"!==n&&"false"!==n&&(n.match(/[\s]/)||n.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(t),t._tags[n]=!0))}},{key:"RemoveTagsFrom",value:function(t,n){if(e.HasTags(t)){var i=n.split(" ");for(var r in i)e._RemoveTagFrom(t,i[r])}}},{key:"_RemoveTagFrom",value:function(e,t){delete e._tags[t]}},{key:"MatchesQuery",value:function(t,n){return void 0===n||(""===n?e.HasTags(t):a.Eval(n,(function(n){return e.HasTags(t)&&t._tags[n]})))}}]),e}()},8370:function(e,t,n){"use strict";n.d(t,{Q:function(){return o}});var i=n(5671),r=n(3144),a=n(5092),o=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"SetImmediate",value:function(e){(0,a.CG)()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)}}]),e}()},8517:function(e,t,n){"use strict";n.d(t,{$g:function(){return T},w1:function(){return b}});var i=n(531),r=n(5671),a=n(3144),o=n(4687),s=n.n(o),l=n(4174),u=n(5092),c=n(2328),h=n(3192),f=n(2786),d=n(5230),v=n(8628),p=n(4198),_=n(562),g=n(8370),m=n(8797),y=n(9950);function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var b=function(){function e(){(0,r.Z)(this,e)}var t;return(0,a.Z)(e,null,[{key:"BaseUrl",get:function(){return _.rN.BaseUrl},set:function(e){_.rN.BaseUrl=e}},{key:"DefaultRetryStrategy",get:function(){return _.rN.DefaultRetryStrategy},set:function(e){_.rN.DefaultRetryStrategy=e}},{key:"CorsBehavior",get:function(){return _.rN.CorsBehavior},set:function(e){_.rN.CorsBehavior=e}},{key:"UseFallbackTexture",get:function(){return p.l.UseFallbackTexture},set:function(e){p.l.UseFallbackTexture=e}},{key:"RegisteredExternalClasses",get:function(){return m.K.RegisteredExternalClasses},set:function(e){m.K.RegisteredExternalClasses=e}},{key:"fallbackTexture",get:function(){return p.l.FallbackTexture},set:function(e){p.l.FallbackTexture=e}},{key:"FetchToRef",value:function(e,t,n,i,r,a){var o=4*((Math.abs(e)*n%n|0)+(Math.abs(t)*i%i|0)*n);a.r=r[o]/255,a.g=r[o+1]/255,a.b=r[o+2]/255,a.a=r[o+3]/255}},{key:"Mix",value:function(e,t,n){return e*(1-n)+t*n}},{key:"Instantiate",value:function(e){return m.K.Instantiate(e)}},{key:"SetImmediate",value:function(e){g.Q.SetImmediate(e)}},{key:"IsExponentOfTwo",value:function(e){var t=1;do{t*=2}while(t<e);return t===e}},{key:"FloatRound",value:function(t){return Math.fround?Math.fround(t):(e._TmpFloatArray[0]=t,e._TmpFloatArray[0])}},{key:"GetFilename",value:function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)}},{key:"GetFolderPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.lastIndexOf("/");return n<0?t?e:"":e.substring(0,n+1)}},{key:"ToDegrees",value:function(e){return 180*e/Math.PI}},{key:"ToRadians",value:function(e){return e*Math.PI/180}},{key:"MakeArray",value:function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null}},{key:"GetPointerPrefix",value:function(e){var t="pointer";return(0,u.CG)()&&!window.PointerEvent&&(t="mouse"),!e._badDesktopOS||e._badOS||document&&"ontouchend"in document||(t="mouse"),t}},{key:"SetCorsBehavior",value:function(e,t){(0,_.$M)(e,t)}},{key:"SetReferrerPolicyBehavior",value:function(e,t){t.referrerPolicy=e}},{key:"CleanUrl",value:function(e){return e=e.replace(/#/gm,"%23")}},{key:"PreprocessUrl",get:function(){return _.rN.PreprocessUrl},set:function(e){_.rN.PreprocessUrl=e}},{key:"LoadImage",value:function(e,t,n,i,r,a){return(0,_.r6)(e,t,n,i,r,a)}},{key:"LoadFile",value:function(e,t,n,i,r,a){return(0,_.vP)(e,t,n,i,r,a)}},{key:"LoadFileAsync",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(n,i){(0,_.vP)(e,(function(e){n(e)}),void 0,void 0,t,(function(e,t){i(t)}))}))}},{key:"LoadScript",value:function(e,t,n,i){if("function"!=typeof self.importScripts)if((0,u.CG)()){var r=document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",e),i&&(a.id=i),a.onload=function(){t&&t()},a.onerror=function(t){n&&n("Unable to load script '".concat(e,"'"),t)},r.appendChild(a)}else null==n||n("Cannot load script '".concat(e,"' outside of a window or a worker"));else try{self.importScripts(e),t()}catch(o){null==n||n("Unable to load script '".concat(e,"' in worker"),o)}}},{key:"LoadScriptAsync",value:function(e){var t=this;return new Promise((function(n,i){t.LoadScript(e,(function(){n()}),(function(e,t){i(t)}))}))}},{key:"ReadFileAsDataURL",value:function(e,t,n){var i=new FileReader,r={onCompleteObservable:new l.y$,abort:function(){return i.abort()}};return i.onloadend=function(){r.onCompleteObservable.notifyObservers(r)},i.onload=function(e){t(e.target.result)},i.onprogress=n,i.readAsDataURL(e),r}},{key:"ReadFile",value:function(e,t,n,i,r){return(0,_.Ip)(e,t,n,i,r)}},{key:"FileAsURL",value:function(e){var t=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(t)}},{key:"Format",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toFixed(t)}},{key:"DeepCopy",value:function(e,t,n,i){h.j.DeepCopy(e,t,n,i)}},{key:"IsEmpty",value:function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}},{key:"RegisterTopRootEvents",value:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];e.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(r){}}}},{key:"UnregisterTopRootEvents",value:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];e.removeEventListener(i.name,i.handler);try{e.parent&&e.parent.removeEventListener(i.name,i.handler)}catch(r){}}}},{key:"DumpFramebuffer",value:(t=(0,i.Z)(s().mark((function t(n,i,r,a){var o,l,u,c,h=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=h.length>4&&void 0!==h[4]?h[4]:"image/png",l=h.length>5?h[5]:void 0,t.next=4,r.readPixels(0,0,n,i);case 4:u=t.sent,c=new Uint8Array(u.buffer),e.DumpData(n,i,c,a,o,l,!0);case 7:case"end":return t.stop()}}),t)}))),function(e,n,i,r){return t.apply(this,arguments)})},{key:"DumpData",value:function(t,n,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8?arguments[8]:void 0;e._ScreenshotCanvas||(e._ScreenshotCanvas=document.createElement("canvas")),e._ScreenshotCanvas.width=t,e._ScreenshotCanvas.height=n;var c=e._ScreenshotCanvas.getContext("2d");if(c){if(i instanceof Float32Array){for(var h=new Uint8Array(i.length),f=i.length;f--;){var d=i[f];h[f]=d<0?0:d>1?1:Math.round(255*d)}i=h}var v=c.createImageData(t,n),p=v.data;p.set(i),c.putImageData(v,0,0);var _=e._ScreenshotCanvas;if(s){var g=document.createElement("canvas");g.width=t,g.height=n;var m=g.getContext("2d");if(!m)return;m.translate(0,n),m.scale(1,-1),m.drawImage(e._ScreenshotCanvas,0,0),_=g}l?e.ToBlob(_,(function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;r&&r(t)},t.readAsArrayBuffer(e)}),a,u):e.EncodeScreenshotCanvasData(r,a,o,_,u)}}},{key:"DumpDataAsync",value:function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7?arguments[7]:void 0;return new Promise((function(u){e.DumpData(t,n,i,(function(e){return u(e)}),r,a,o,s,l)}))}},{key:"ToBlob",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",i=arguments.length>3?arguments[3]:void 0;e.toBlob||(e.toBlob=function(e,t,n){var i=this;setTimeout((function(){for(var r=atob(i.toDataURL(t,n).split(",")[1]),a=r.length,o=new Uint8Array(a),s=0;s<a;s++)o[s]=r.charCodeAt(s);e(new Blob([o]))}))}),e.toBlob((function(e){t(e)}),n,i)}},{key:"DownloadBlob",value:function(t,n){if("download"in document.createElement("a")){if(!n){var i=new Date;n="screenshot_"+((i.getFullYear()+"-"+(i.getMonth()+1)).slice(2)+"-"+i.getDate()+"_"+i.getHours()+"-"+("0"+i.getMinutes()).slice(-2))+".png"}e.Download(t,n)}else if(t&&"undefined"!=typeof URL){var r=URL.createObjectURL(t),a=window.open("");if(!a)return;var o=a.document.createElement("img");o.onload=function(){URL.revokeObjectURL(r)},o.src=r,a.document.body.appendChild(o)}}},{key:"EncodeScreenshotCanvasData",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(t){var o=(null!=r?r:e._ScreenshotCanvas).toDataURL(n,a);t(o)}else this.ToBlob(null!=r?r:e._ScreenshotCanvas,(function(t){t&&e.DownloadBlob(t,i)}),n,a)}},{key:"Download",value:function(e,t){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,t);else if("undefined"!=typeof URL){var n=window.URL.createObjectURL(e),i=document.createElement("a");document.body.appendChild(i),i.style.display="none",i.href=n,i.download=t,i.addEventListener("click",(function(){i.parentElement&&i.parentElement.removeChild(i)})),i.click(),window.URL.revokeObjectURL(n)}}},{key:"BackCompatCameraNoPreventDefault",value:function(e){return"boolean"==typeof e[0]?e[0]:"boolean"==typeof e[1]&&e[1]}},{key:"CreateScreenshot",value:function(e,t,n,i){throw(0,d.S)("ScreenshotTools")}},{key:"CreateScreenshotAsync",value:function(e,t,n){throw(0,d.S)("ScreenshotTools")}},{key:"CreateScreenshotUsingRenderTarget",value:function(e,t,n,i){throw(0,d.S)("ScreenshotTools")}},{key:"CreateScreenshotUsingRenderTargetAsync",value:function(e,t,n){throw(0,d.S)("ScreenshotTools")}},{key:"RandomId",value:function(){return(0,y.f)()}},{key:"IsBase64",value:function(e){return(0,_.VL)(e)}},{key:"DecodeBase64",value:function(e){return(0,_.$K)(e)}},{key:"errorsCount",get:function(){return c.Y.errorsCount}},{key:"Log",value:function(e){c.Y.Log(e)}},{key:"Warn",value:function(e){c.Y.Warn(e)}},{key:"Error",value:function(e){c.Y.Error(e)}},{key:"LogCache",get:function(){return c.Y.LogCache}},{key:"ClearLogCache",value:function(){c.Y.ClearLogCache()}},{key:"LogLevels",set:function(e){c.Y.LogLevels=e}},{key:"PerformanceLogLevel",set:function(t){return(t&e.PerformanceUserMarkLogLevel)===e.PerformanceUserMarkLogLevel?(e.StartPerformanceCounter=e._StartUserMark,void(e.EndPerformanceCounter=e._EndUserMark)):(t&e.PerformanceConsoleLogLevel)===e.PerformanceConsoleLogLevel?(e.StartPerformanceCounter=e._StartPerformanceConsole,void(e.EndPerformanceCounter=e._EndPerformanceConsole)):(e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,void(e.EndPerformanceCounter=e._EndPerformanceCounterDisabled))}},{key:"_StartPerformanceCounterDisabled",value:function(e,t){}},{key:"_EndPerformanceCounterDisabled",value:function(e,t){}},{key:"_StartUserMark",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e._Performance){if(!(0,u.CG)())return;e._Performance=window.performance}n&&e._Performance.mark&&e._Performance.mark(t+"-Begin")}},{key:"_EndUserMark",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n&&e._Performance.mark&&(e._Performance.mark(t+"-End"),e._Performance.measure(t,t+"-Begin",t+"-End"))}},{key:"_StartPerformanceConsole",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n&&(e._StartUserMark(t,n),console.time&&console.time(t))}},{key:"_EndPerformanceConsole",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n&&(e._EndUserMark(t,n),console.timeEnd(t))}},{key:"Now",get:function(){return f.F.Now}},{key:"GetClassName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;if(!t&&e.getClassName)n=e.getClassName();else{if(e instanceof Object){var i=t?e:Object.getPrototypeOf(e);n=i.constructor.__bjsclassName__}n||(n=typeof e)}return n}},{key:"First",value:function(e,t){var n,i=A(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(t(r))return r}}catch(a){i.e(a)}finally{i.f()}return null}},{key:"getFullClassName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null,i=null;if(!t&&e.getClassName)n=e.getClassName();else{if(e instanceof Object){var r=t?e:Object.getPrototypeOf(e);n=r.constructor.__bjsclassName__,i=r.constructor.__bjsmoduleName__}n||(n=typeof e)}return n?(null!=i?i+".":"")+n:null}},{key:"DelayAsync",value:function(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))}},{key:"IsSafari",value:function(){return!!(0,u.up)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}]),e}();b.UseCustomRequestHeaders=!1,b.CustomRequestHeaders=v.g.CustomRequestHeaders,b._TmpFloatArray=new Float32Array(1),b.GetDOMTextContent=u.v,b.GetAbsoluteUrl="object"==typeof document?function(e){var t=document.createElement("a");return t.href=e,t.href}:"function"==typeof URL&&"object"==typeof location?function(e){return new URL(e,location.origin).href}:function(){throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},b.NoneLogLevel=c.Y.NoneLogLevel,b.MessageLogLevel=c.Y.MessageLogLevel,b.WarningLogLevel=c.Y.WarningLogLevel,b.ErrorLogLevel=c.Y.ErrorLogLevel,b.AllLogLevel=c.Y.AllLogLevel,b.IsWindowObjectExist=u.CG,b.PerformanceNoneLogLevel=0,b.PerformanceUserMarkLogLevel=1,b.PerformanceConsoleLogLevel=2,b.StartPerformanceCounter=b._StartPerformanceCounterDisabled,b.EndPerformanceCounter=b._EndPerformanceCounterDisabled;var T=function(){function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,r.Z)(this,e),this.iterations=t,this.index=a-1,this._done=!1,this._fn=n,this._successCallback=i}return(0,a.Z)(e,[{key:"executeNext",value:function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}},{key:"breakLoop",value:function(){this._done=!0,this._successCallback()}}],[{key:"Run",value:function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=new e(t,n,i,r);return a.executeNext(),a}},{key:"SyncAsyncForLoop",value:function(t,n,i,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return e.Run(Math.ceil(t/n),(function(e){a&&a()?e.breakLoop():setTimeout((function(){for(var r=0;r<n;++r){var o=e.index*n+r;if(o>=t)break;if(i(o),a&&a()){e.breakLoop();break}}e.executeNext()}),o)}),r)}}]),e}();p.l.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},1704:function(e,t,n){"use strict";n.d(t,{H:function(){return r},q:function(){return a}});var i={};function r(e,t){i[e]=t}function a(e){return i[e]}},874:function(e,t,n){"use strict";n.d(t,{K:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"UniqueId",get:function(){var e=this._UniqueIdCounter;return this._UniqueIdCounter++,e}}]),e}();a._UniqueIdCounter=1},8628:function(e,t,n){"use strict";n.d(t,{g:function(){return s}});var i=n(5671),r=n(3144);function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var s=function(){function e(){(0,i.Z)(this,e),this._xhr="undefined"!=typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}return(0,r.Z)(e,[{key:"_injectCustomRequestHeaders",value:function(){if(!this._shouldSkipRequestModifications(this._requestURL))for(var t in e.CustomRequestHeaders){var n=e.CustomRequestHeaders[t];n&&this._xhr.setRequestHeader(t,n)}}},{key:"_shouldSkipRequestModifications",value:function(t){return e.SkipRequestModificationForBabylonCDN&&(t.includes("preview.babylonjs.com")||t.includes("cdn.babylonjs.com"))}},{key:"onprogress",get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e}},{key:"readyState",get:function(){return this._xhr.readyState}},{key:"status",get:function(){return this._xhr.status}},{key:"statusText",get:function(){return this._xhr.statusText}},{key:"response",get:function(){return this._xhr.response}},{key:"responseURL",get:function(){return this._xhr.responseURL}},{key:"responseText",get:function(){return this._xhr.responseText}},{key:"responseType",get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e}},{key:"timeout",get:function(){return this._xhr.timeout},set:function(e){this._xhr.timeout=e}},{key:"addEventListener",value:function(e,t,n){this._xhr.addEventListener(e,t,n)}},{key:"removeEventListener",value:function(e,t,n){this._xhr.removeEventListener(e,t,n)}},{key:"abort",value:function(){this._xhr.abort()}},{key:"send",value:function(t){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)}},{key:"open",value:function(t,n){var i,r=a(e.CustomRequestModifiers);try{for(r.s();!(i=r.n()).done;){var o=i.value;if(this._shouldSkipRequestModifications(n))return;o(this._xhr,n)}}catch(s){r.e(s)}finally{r.f()}return n=(n=n.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=n,this._xhr.open(t,n,!0)}},{key:"setRequestHeader",value:function(e,t){this._xhr.setRequestHeader(e,t)}},{key:"getResponseHeader",value:function(e){return this._xhr.getResponseHeader(e)}}]),e}();s.CustomRequestHeaders={},s.CustomRequestModifiers=new Array,s.SkipRequestModificationForBabylonCDN=!0},7570:function(e,t,n){"use strict";n.d(t,{O:function(){return o}});var i=n(5671),r=n(3144),a=n(2845),o=function(){function e(t){(0,i.Z)(this,e),this._vertexBuffers={},this._scene=t}return(0,r.Z)(e,[{key:"_prepareBuffers",value:function(){if(!this._vertexBuffers[a.o.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[a.o.PositionKind]=new a.o(this._scene.getEngine(),e,a.o.PositionKind,!1,!1,2),this._buildIndexBuffer()}}},{key:"_buildIndexBuffer",value:function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}},{key:"_rebuild",value:function(){var e=this._vertexBuffers[a.o.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())}},{key:"_prepareFrame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._scene.activeCamera;return!!n&&(!(!(t=t||n._postProcesses.filter((function(e){return null!=e})))||0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(n,e,null!=t),!0))}},{key:"directRender",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=this._scene.getEngine(),s=0;s<e.length;s++){var l;if(s<e.length-1)e[s+1].activate(this._scene.activeCamera,null==t?void 0:t.texture);else t?o.bindFramebuffer(t,i,void 0,void 0,n,r):a||o.restoreDefaultFramebuffer(),null===(l=o._debugInsertMarker)||void 0===l||l.call(o,"post process ".concat(e[s].name," output"));var u=e[s],c=u.apply();c&&(u.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,c),o.drawElementsType(0,0,6),u.onAfterRenderObservable.notifyObservers(c))}o.setDepthBuffer(!0),o.setDepthWrite(!0)}},{key:"_finalizeFrame",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=this._scene.activeCamera;if(a&&(i=i||a._postProcesses.filter((function(e){return null!=e})),0!==i.length&&this._scene.postProcessesEnabled)){for(var o=this._scene.getEngine(),s=0,l=i.length;s<l;s++){var u,c=i[s];if(s<l-1)c._outputTexture=i[s+1].activate(a,null==t?void 0:t.texture);else t?(o.bindFramebuffer(t,n,void 0,void 0,r),c._outputTexture=t):(o.restoreDefaultFramebuffer(),c._outputTexture=null),null===(u=o._debugInsertMarker)||void 0===u||u.call(o,"post process ".concat(i[s].name," output"));if(e)break;var h=c.apply();h&&(c.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,h),o.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(h))}o.setDepthBuffer(!0),o.setDepthWrite(!0),o.setAlphaMode(0)}}},{key:"dispose",value:function(){var e=this._vertexBuffers[a.o.PositionKind];e&&(e.dispose(),this._vertexBuffers[a.o.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}]),e}()},3639:function(e,t,n){"use strict";n.d(t,{$:function(){return h}});var i=n(3144),r=n(5671),a=n(5934),o=n(6900),s=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,r.Z)(this,e),this.index=t,this._opaqueSubMeshes=new a.t(256),this._transparentSubMeshes=new a.t(256),this._alphaTestSubMeshes=new a.t(256),this._depthOnlySubMeshes=new a.t(256),this._particleSystems=new a.t(256),this._spriteManagers=new a.t(256),this._empty=!0,this._edgesRenderers=new a.f(16),this._scene=n,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=o,this.transparentSortCompareFn=s}return(0,i.Z)(e,[{key:"opaqueSortCompareFn",set:function(t){this._opaqueSortCompareFn=t||e.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}},{key:"alphaTestSortCompareFn",set:function(t){this._alphaTestSortCompareFn=t||e.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}},{key:"transparentSortCompareFn",set:function(t){this._transparentSortCompareFn=t||e.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}},{key:"render",value:function(e,t,n,i){if(e)e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var r=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(r.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),r.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var a=r.getStencilBuffer();if(r.setStencilBuffer(!1),t&&this._renderSprites(),n&&this._renderParticles(i),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(r.setStencilBuffer(a),this._scene.useOrderIndependentTransparency){var o=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);o.length&&this._renderTransparent(o)}else this._renderTransparent(this._transparentSubMeshes);r.setAlphaMode(0)}if(r.setStencilBuffer(!1),this._edgesRenderers.length){for(var s=0;s<this._edgesRenderers.length;s++)this._edgesRenderers.data[s].render();r.setAlphaMode(0)}r.setStencilBuffer(a)}}},{key:"_renderOpaqueSorted",value:function(t){return e._RenderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}},{key:"_renderAlphaTestSorted",value:function(t){return e._RenderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}},{key:"_renderTransparentSorted",value:function(t){return e._RenderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)}},{key:"prepare",value:function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset(),this._empty=!0}},{key:"dispose",value:function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}},{key:"dispatch",value:function(e,t,n){void 0===t&&(t=e.getMesh()),void 0===n&&(n=e.getMaterial()),null!=n&&(n.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):n.needAlphaTesting()?(n.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(n.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)}},{key:"dispatchSprites",value:function(e){this._spriteManagers.push(e),this._empty=!1}},{key:"dispatchParticles",value:function(e){this._particleSystems.push(e),this._empty=!1}},{key:"_renderParticles",value:function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var n=0;n<this._particleSystems.length;n++){var i=this._particleSystems.data[n];if(0!==(t&&t.layerMask&i.layerMask)){var r=i.emitter;r.position&&e&&-1===e.indexOf(r)||this._scene._activeParticles.addCount(i.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}}},{key:"_renderSprites",value:function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var n=this._spriteManagers.data[t];0!==(e&&e.layerMask&n.layerMask)&&n.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}}],[{key:"_RenderSorted",value:function(t,n,i,r){var a,s=0,l=i?i.globalPosition:e._ZeroVector;if(r)for(;s<t.length;s++)(a=t.data[s])._alphaIndex=a.getMesh().alphaIndex,a._distanceToCamera=o.P.Distance(a.getBoundingInfo().boundingSphere.centerWorld,l);var u=t.length===t.data.length?t.data:t.data.slice(0,t.length);n&&u.sort(n);var c=u[0].getMesh().getScene();for(s=0;s<u.length;s++)if(a=u[s],!c._activeMeshesFrozenButKeepClipping||a.isInFrustum(c._frustumPlanes)){if(r){var h=a.getMaterial();if(h&&h.needDepthPrePass){var f=h.getScene().getEngine();f.setColorWrite(!1),f.setAlphaMode(0),a.render(!1),f.setColorWrite(!0)}}a.render(r)}}},{key:"defaultTransparentSortCompare",value:function(t,n){return t._alphaIndex>n._alphaIndex?1:t._alphaIndex<n._alphaIndex?-1:e.backToFrontSortCompare(t,n)}},{key:"backToFrontSortCompare",value:function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}},{key:"frontToBackSortCompare",value:function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0}},{key:"PainterSortCompare",value:function(e,t){var n=e.getMesh(),i=t.getMesh();return n.material&&i.material?n.material.uniqueId-i.material.uniqueId:n.uniqueId-i.uniqueId}}]),e}();function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}s._ZeroVector=o.P.Zero();var c=(0,i.Z)((function e(){(0,r.Z)(this,e)})),h=function(){function e(t){(0,r.Z)(this,e),this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new c,this._scene=t;for(var n=e.MIN_RENDERINGGROUPS;n<e.MAX_RENDERINGGROUPS;n++)this._autoClearDepthStencil[n]={autoClear:!0,depth:!0,stencil:!0}}return(0,i.Z)(e,[{key:"_clearDepthStencilBuffer",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)}},{key:"render",value:function(t,n,i,r){var a=this._renderingGroupInfo;if(a.scene=this._scene,a.camera=this._scene.activeCamera,this._scene.spriteManagers&&r)for(var o=0;o<this._scene.spriteManagers.length;o++){var s=this._scene.spriteManagers[o];this.dispatchSprites(s)}for(var u=e.MIN_RENDERINGGROUPS;u<e.MAX_RENDERINGGROUPS;u++){this._depthStencilBufferAlreadyCleaned=u===e.MIN_RENDERINGGROUPS;var c=this._renderingGroups[u];if(c&&!c._empty){var h=Math.pow(2,u);if(a.renderingGroupId=u,this._scene.onBeforeRenderingGroupObservable.notifyObservers(a,h),e.AUTOCLEAR){var f=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(u):this._autoClearDepthStencil[u];f&&f.autoClear&&this._clearDepthStencilBuffer(f.depth,f.stencil)}var d,v=l(this._scene._beforeRenderingGroupDrawStage);try{for(v.s();!(d=v.n()).done;){d.value.action(u)}}catch(g){v.e(g)}finally{v.f()}c.render(t,r,i,n);var p,_=l(this._scene._afterRenderingGroupDrawStage);try{for(_.s();!(p=_.n()).done;){p.value.action(u)}}catch(g){_.e(g)}finally{_.f()}this._scene.onAfterRenderingGroupObservable.notifyObservers(a,h)}}}},{key:"reset",value:function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var n=this._renderingGroups[t];n&&n.prepare()}}},{key:"dispose",value:function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}},{key:"freeRenderingGroups",value:function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var n=this._renderingGroups[t];n&&n.dispose()}}},{key:"_prepareRenderingGroup",value:function(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new s(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))}},{key:"dispatchSprites",value:function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)}},{key:"dispatchParticles",value:function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)}},{key:"dispatch",value:function(e,t,n){void 0===t&&(t=e.getMesh());var i=t.renderingGroupId||0;this._prepareRenderingGroup(i),this._renderingGroups[i].dispatch(e,t,n)}},{key:"setRenderingOrder",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=n,this._customTransparentSortCompareFn[e]=i,this._renderingGroups[e]){var r=this._renderingGroups[e];r.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],r.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],r.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}}},{key:"setRenderingAutoClearDepthStencil",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[e]={autoClear:t,depth:n,stencil:i}}},{key:"getAutoClearDepthStencilSetup",value:function(e){return this._autoClearDepthStencil[e]}}]),e}();h.MAX_RENDERINGGROUPS=4,h.MIN_RENDERINGGROUPS=0,h.AUTOCLEAR=!0},768:function(e,t,n){"use strict";n.d(t,{Q:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}return(0,r.Z)(e,[{key:"isDirty",get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}},{key:"alphaBlend",get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)}},{key:"setAlphaBlendConstants",value:function(e,t,n,i){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===n&&this._blendConstants[3]===i||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=n,this._blendConstants[3]=i,this._isBlendConstantsDirty=!0)}},{key:"setAlphaBlendFunctionParameters",value:function(e,t,n,i){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===n&&this._blendFunctionParameters[3]===i||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=n,this._blendFunctionParameters[3]=i,this._isBlendFunctionParametersDirty=!0)}},{key:"setAlphaEquationParameters",value:function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)}},{key:"reset",value:function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}},{key:"apply",value:function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}]),e}()},1379:function(e,t,n){"use strict";n.d(t,{k:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.Z)(this,e),this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,t&&this.reset()}return(0,r.Z)(e,[{key:"isDirty",get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}},{key:"zOffset",get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}},{key:"zOffsetUnits",get:function(){return this._zOffsetUnits},set:function(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}},{key:"cullFace",get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}},{key:"cull",get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}},{key:"depthFunc",get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}},{key:"depthMask",get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}},{key:"depthTest",get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}},{key:"frontFace",get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}},{key:"reset",value:function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}},{key:"apply",value:function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}]),e}()},5852:function(e,t,n){"use strict";n.d(t,{s:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this.reset()}return(0,r.Z)(e,[{key:"reset",value:function(){this.enabled=!1,this.mask=255,this.func=e.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=e.KEEP,this.opDepthFail=e.KEEP,this.opStencilDepthPass=e.REPLACE}},{key:"stencilFunc",get:function(){return this.func},set:function(e){this.func=e}},{key:"stencilFuncRef",get:function(){return this.funcRef},set:function(e){this.funcRef=e}},{key:"stencilFuncMask",get:function(){return this.funcMask},set:function(e){this.funcMask=e}},{key:"stencilOpStencilFail",get:function(){return this.opStencilFail},set:function(e){this.opStencilFail=e}},{key:"stencilOpDepthFail",get:function(){return this.opDepthFail},set:function(e){this.opDepthFail=e}},{key:"stencilOpStencilDepthPass",get:function(){return this.opStencilDepthPass},set:function(e){this.opStencilDepthPass=e}},{key:"stencilMask",get:function(){return this.mask},set:function(e){this.mask=e}},{key:"stencilTest",get:function(){return this.enabled},set:function(e){this.enabled=e}}]),e}();a.ALWAYS=519,a.KEEP=7680,a.REPLACE=7681},8789:function(e,t,n){"use strict";n.d(t,{C:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.Z)(this,e),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,t&&this.reset()}return(0,r.Z)(e,[{key:"isDirty",get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}},{key:"func",get:function(){return this._func},set:function(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}},{key:"funcRef",get:function(){return this._funcRef},set:function(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}},{key:"funcMask",get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}},{key:"opStencilFail",get:function(){return this._opStencilFail},set:function(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}},{key:"opDepthFail",get:function(){return this._opDepthFail},set:function(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}},{key:"opStencilDepthPass",get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}},{key:"mask",get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}},{key:"reset",value:function(){var e;this.stencilMaterial=void 0,null===(e=this.stencilGlobal)||void 0===e||e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}},{key:"apply",value:function(e){var t;if(e){var n=!this.useStencilGlobalOnly&&!(null===(t=this.stencilMaterial)||void 0===t||!t.enabled);this.enabled=n?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=n?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=n?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=n?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=n?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=n?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=n?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=n?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}}]),e}()},9403:function(e,t,n){"use strict";n.d(t,{p:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return(0,r.Z)(e,[{key:"environmentTexture",get:function(){return this._environmentTexture},set:function(e){this._environmentTexture=e}},{key:"getNodes",value:function(){var e=new Array;return e=(e=(e=(e=e.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach((function(t){return e=e.concat(t.bones)})),e}}],[{key:"AddParser",value:function(e,t){this._BabylonFileParsers[e]=t}},{key:"GetParser",value:function(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null}},{key:"AddIndividualParser",value:function(e,t){this._IndividualBabylonFileParsers[e]=t}},{key:"GetIndividualParser",value:function(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null}},{key:"Parse",value:function(e,t,n,i){for(var r in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,r)&&this._BabylonFileParsers[r](e,t,n,i)}}]),e}();a._BabylonFileParsers={},a._IndividualBabylonFileParsers={}},1396:function(e,t,n){"use strict";n.d(t,{N:function(){return v}});var i=n(3144),r=n(5671),a=n(9477),o=n(6900),s=n(9336),l=n(4174),u=n(4198),c=n(5230);function h(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var d=(0,i.Z)((function e(){(0,r.Z)(this,e),this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new l.y$,this._onClonedObservable=new l.y$})),v=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,r.Z)(this,e),this._isDirty=!1,this._nodeDataStorage=new d,this.state="",this.metadata=null,this.reservedDataStore=null,this._parentContainer=null,this.animations=new Array,this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=o.y3.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new l.y$,this._onDisposeObserver=null,this._behaviors=new Array,this.name=t,this.id=t,this._scene=n||u.l.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return(0,i.Z)(e,[{key:"doNotSerialize",get:function(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(e){this._nodeDataStorage._doNotSerialize=e}},{key:"isDisposed",value:function(){return this._nodeDataStorage._isDisposed}},{key:"parent",get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){var t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var n=this._parentNode._children.indexOf(this);-1!==n&&this._parentNode._children.splice(n,1),e||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}}},{key:"_serializeAsParent",value:function(e){e.parentId=this.uniqueId}},{key:"_addToSceneRootNodes",value:function(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}},{key:"_removeFromSceneRootNodes",value:function(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){var e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}},{key:"animationPropertiesOverride",get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e}},{key:"getClassName",value:function(){return"Node"}},{key:"onDispose",set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}},{key:"onEnabledStateChangedObservable",get:function(){return this._nodeDataStorage._onEnabledStateChangedObservable}},{key:"onClonedObservable",get:function(){return this._nodeDataStorage._onClonedObservable}},{key:"getScene",value:function(){return this._scene}},{key:"getEngine",value:function(){return this._scene.getEngine()}},{key:"addBehavior",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._behaviors.indexOf(e);return-1!==i||(e.init(),this._scene.isLoading&&!n?this._scene.onDataLoadedObservable.addOnce((function(){e.attach(t)})):e.attach(this),this._behaviors.push(e)),this}},{key:"removeBehavior",value:function(e){var t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}},{key:"behaviors",get:function(){return this._behaviors}},{key:"getBehaviorByName",value:function(e){var t,n=h(this._behaviors);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.name===e)return i}}catch(r){n.e(r)}finally{n.f()}return null}},{key:"getWorldMatrix",value:function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}},{key:"_getWorldMatrixDeterminant",value:function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}},{key:"worldMatrixFromCache",get:function(){return this._worldMatrix}},{key:"_initCache",value:function(){this._cache={},this._cache.parent=void 0}},{key:"updateCache",value:function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())}},{key:"_getActionManagerForTrigger",value:function(e){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}},{key:"_updateCache",value:function(e){}},{key:"_isSynchronized",value:function(){return!0}},{key:"_markSyncedWithParent",value:function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}},{key:"isSynchronizedWithParent",value:function(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}},{key:"isSynchronized",value:function(){return this._cache.parent!==this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}},{key:"isReady",value:function(){return this._nodeDataStorage._isReady}},{key:"markAsDirty",value:function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}},{key:"isEnabled",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return!1===e?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}},{key:"_syncParentEnabledState",value:function(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((function(e){e._syncParentEnabledState()}))}},{key:"setEnabled",value:function(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e),this._syncParentEnabledState())}},{key:"isDescendantOf",value:function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))}},{key:"_getDescendants",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if(this._children)for(var i=0;i<this._children.length;i++){var r=this._children[i];n&&!n(r)||e.push(r),t||r._getDescendants(e,!1,n)}}},{key:"getDescendants",value:function(e,t){var n=new Array;return this._getDescendants(n,e,t),n}},{key:"getChildMeshes",value:function(e,t){var n=[];return this._getDescendants(n,e,(function(e){return(!t||t(e))&&void 0!==e.cullingStrategy})),n}},{key:"getChildren",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(t,e)}},{key:"_setReady",value:function(e){e!==this._nodeDataStorage._isReady&&(e?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}},{key:"getAnimationByName",value:function(e){for(var t=0;t<this.animations.length;t++){var n=this.animations[t];if(n.name===e)return n}return null}},{key:"createAnimationRange",value:function(t,n,i){if(!this._ranges[t]){this._ranges[t]=e._AnimationRangeFactory(t,n,i);for(var r=0,a=this.animations.length;r<a;r++)this.animations[r]&&this.animations[r].createRange(t,n,i)}}},{key:"deleteAnimationRange",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=0,i=this.animations.length;n<i;n++)this.animations[n]&&this.animations[n].deleteRange(e,t);this._ranges[e]=null}},{key:"getAnimationRange",value:function(e){return this._ranges[e]||null}},{key:"getAnimationRanges",value:function(){var e,t=[];for(e in this._ranges)t.push(this._ranges[e]);return t}},{key:"beginAnimation",value:function(e,t,n,i){var r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,t,n,i):null}},{key:"serializeAnimationRanges",value:function(){var e=[];for(var t in this._ranges){var n=this._ranges[t];if(n){var i={};i.name=t,i.from=n.from,i.to=n.to,e.push(i)}}return e}},{key:"computeWorldMatrix",value:function(e){return this._worldMatrix||(this._worldMatrix=o.y3.Identity()),this._worldMatrix}},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!e){var n,i=this.getDescendants(!0),r=h(i);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.dispose(e,t)}}catch(u){r.e(u)}finally{r.f()}}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();var o,s=h(this._behaviors);try{for(s.s();!(o=s.n()).done;){var l=o.value;l.detach()}}catch(u){s.e(u)}finally{s.f()}this._behaviors.length=0,this.metadata=null}},{key:"getHierarchyBoundingVectors",value:function(){var e,t,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var r=this;if(r.getBoundingInfo&&r.subMeshes){var a=r.getBoundingInfo();e=a.boundingBox.minimumWorld.clone(),t=a.boundingBox.maximumWorld.clone()}else e=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(n){var s,l=this.getDescendants(!1),u=h(l);try{for(u.s();!(s=u.n()).done;){var c=s.value,f=c;if(f.computeWorldMatrix(!0),(!i||i(f))&&f.getBoundingInfo&&0!==f.getTotalVertices()){var d=f.getBoundingInfo(),v=d.boundingBox,p=v.minimumWorld,_=v.maximumWorld;o.P.CheckExtends(p,e,t),o.P.CheckExtends(_,e,t)}}}catch(g){u.e(g)}finally{u.f()}}return{min:e,max:t}}}],[{key:"AddNodeConstructor",value:function(e,t){this._NodeConstructors[e]=t}},{key:"Construct",value:function(e,t,n,i){var r=this._NodeConstructors[e];return r?r(t,n,i):null}},{key:"ParseAnimationRanges",value:function(e,t,n){if(t.ranges)for(var i=0;i<t.ranges.length;i++){var r=t.ranges[i];e.createAnimationRange(r.name,r.from,r.to)}}}]),e}();v._AnimationRangeFactory=function(e,t,n){throw(0,c.S)("AnimationRange")},v._NodeConstructors={},(0,a.gn)([(0,s.qC)()],v.prototype,"name",void 0),(0,a.gn)([(0,s.qC)()],v.prototype,"id",void 0),(0,a.gn)([(0,s.qC)()],v.prototype,"uniqueId",void 0),(0,a.gn)([(0,s.qC)()],v.prototype,"state",void 0),(0,a.gn)([(0,s.qC)()],v.prototype,"metadata",void 0)},3767:function(e,t,n){"use strict";n.d(t,{H:function(){return f},l:function(){return h}});var i=n(2982),r=n(136),a=n(6215),o=n(1120),s=n(2407),l=n(3144),u=n(5671);function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,o.Z)(e);if(t){var r=(0,o.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,a.Z)(this,n)}}var h=(0,l.Z)((function e(){(0,u.Z)(this,e)}));h.NAME_EFFECTLAYER="EffectLayer",h.NAME_LAYER="Layer",h.NAME_LENSFLARESYSTEM="LensFlareSystem",h.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",h.NAME_PARTICLESYSTEM="ParticleSystem",h.NAME_GAMEPAD="Gamepad",h.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",h.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",h.NAME_PREPASSRENDERER="PrePassRenderer",h.NAME_DEPTHRENDERER="DepthRenderer",h.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",h.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",h.NAME_SPRITE="Sprite",h.NAME_SUBSURFACE="SubSurface",h.NAME_OUTLINERENDERER="Outline",h.NAME_PROCEDURALTEXTURE="ProceduralTexture",h.NAME_SHADOWGENERATOR="ShadowGenerator",h.NAME_OCTREE="Octree",h.NAME_PHYSICSENGINE="PhysicsEngine",h.NAME_AUDIO="Audio",h.STEP_ISREADYFORMESH_EFFECTLAYER=0,h.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,h.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,h.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,h.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,h.STEP_BEFORECAMERADRAW_PREPASS=0,h.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,h.STEP_BEFORECAMERADRAW_LAYER=2,h.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,h.STEP_BEFORERENDERTARGETDRAW_LAYER=1,h.STEP_BEFORERENDERINGMESH_PREPASS=0,h.STEP_BEFORERENDERINGMESH_OUTLINE=1,h.STEP_AFTERRENDERINGMESH_PREPASS=0,h.STEP_AFTERRENDERINGMESH_OUTLINE=1,h.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,h.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,h.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,h.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,h.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,h.STEP_BEFORECLEAR_PREPASS=1,h.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,h.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,h.STEP_AFTERRENDERTARGETDRAW_LAYER=1,h.STEP_AFTERCAMERADRAW_PREPASS=0,h.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,h.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,h.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,h.STEP_AFTERCAMERADRAW_LAYER=4,h.STEP_AFTERRENDER_AUDIO=0,h.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,h.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,h.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,h.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,h.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,h.STEP_POINTERMOVE_SPRITE=0,h.STEP_POINTERDOWN_SPRITE=0,h.STEP_POINTERUP_SPRITE=0;var f=function(e){(0,r.Z)(n,e);var t=c(n);function n(e){return(0,u.Z)(this,n),t.call.apply(t,[this].concat((0,i.Z)(e)))}return(0,l.Z)(n,[{key:"registerStep",value:function(e,t,n){var i=0;for(Number.MAX_VALUE;i<this.length;i++){if(e<this[i].index)break}this.splice(i,0,{index:e,component:t,action:n.bind(t)})}},{key:"clear",value:function(){this.length=0}}],[{key:"Create",value:function(){return Object.create(n.prototype)}}]),n}((0,s.Z)(Array))},9477:function(e,t,n){"use strict";n.d(t,{gn:function(){return i}});function i(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}Object.create;Object.create},4944:function(e,t,n){"use strict";var i=n(2109),r=n(6790),a=n(7908),o=n(6244),s=n(9303),l=n(5417);i({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=a(this),n=o(t),i=l(t,0);return i.length=r(i,t,t,n,0,void 0===e?1:s(e)),i}})},3792:function(e,t,n){n(1223)("flat")},4600:function(e,t,n){"use strict";n.d(t,{Z:function(){return ul}});var i,r,a,o,s,l,u,c,h=n(7294),f=n(5900),d=n.n(f),v=n(3698),p=n(5063),_=n(8159),g=n(6553),m=n(9380),y=function(){var e=(0,v.Z)(),t=(0,h.useState)(!1),n=t[0],i=t[1],r=(0,h.useCallback)((function(){return i(!n)}),[n]),a=(0,h.useCallback)((function(){return i(!1)}),[i]);return(0,h.useLayoutEffect)((function(){return n&&document.body.classList.add("disable-scroll-mobile"),function(){return document.body.classList.remove("disable-scroll-mobile")}}),[n]),h.createElement("header",{className:d()("header",{"open-menu":n})},h.createElement("div",{className:"wrapper"},h.createElement(g.Z,{to:"/",className:"logo"},h.createElement("img",{className:"logo",alt:"Bonsai",src:_.Z})),h.createElement("nav",{className:"main-nav",onClick:a},h.createElement(m.fO,{to:"#services",className:"nav-item"},e("services:name")),h.createElement(m.fO,{to:"#about",className:"nav-item"},e("about:name")),h.createElement(m.fO,{to:"#contact",className:"nav-item"},e("contact:name")),h.createElement(p.Z,null)),h.createElement("button",{className:"button-menu show-in-mobile",onClick:r,"aria-label":"menu"},h.createElement("span",{className:"hamburger"}))))},A=n(9066),E=n(356),b=function(e){var t=e.children,n=e.className;return h.createElement(E.VA,null,h.createElement("div",{className:d()("outer-wrapper",n)},h.createElement(y,null),h.createElement("div",{className:"content"},t),h.createElement(A.Z,{hasNav:!0})))},T=n(1431),S={},M=180/Math.PI,I=Math.PI/180,P=Math.atan2,C=/([A-Z])/g,x=/(left|right|width|margin|padding|x)/i,D=/[\s,\(]\S/,R={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},k=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},O=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},L=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},F=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},N=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},w=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},B=function(e,t,n){return e.style[t]=n},U=function(e,t,n){return e.style.setProperty(t,n)},V=function(e,t,n){return e._gsap[t]=n},W=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},G=function(e,t,n,i,r){var a=e._gsap;a.scaleX=a.scaleY=n,a.renderTransform(r,a)},X=function(e,t,n,i,r){var a=e._gsap;a[t]=n,a.renderTransform(r,a)},z="transform",H=z+"Origin",Z=function(e){var t=this,n=this.target,i=n.style;if(e in S){if(this.tfm=this.tfm||{},"transform"!==e&&(~(e=R[e]||e).indexOf(",")?e.split(",").forEach((function(e){return t.tfm[e]=ce(n,e)})):this.tfm[e]=n._gsap.x?n._gsap[e]:ce(n,e)),this.props.indexOf(z)>=0)return;n._gsap.svg&&(this.svgo=n.getAttribute("data-svg-origin"),this.props.push(H,"")),e=z}i&&this.props.push(e,i[e])},Y=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},K=function(){var e,t,n=this.props,i=this.target,r=i.style,a=i._gsap;for(e=0;e<n.length;e+=2)n[e+1]?r[n[e]]=n[e+1]:r.removeProperty(n[e].replace(C,"-$1").toLowerCase());if(this.tfm){for(t in this.tfm)a[t]=this.tfm[t];a.svg&&(a.renderTransform(),i.setAttribute("data-svg-origin",this.svgo||"")),!(e=u())||e.isStart||r[z]||(Y(r),a.uncache=1)}},j=function(e,t){var n={target:e,props:[],revert:K,save:Z};return t&&t.split(",").forEach((function(e){return n.save(e)})),n},q=function(e,t){var n=r.createElementNS?r.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):r.createElement(e);return n.style?n:r.createElement(e)},Q=function e(t,n,i){var r=getComputedStyle(t);return r[n]||r.getPropertyValue(n.replace(C,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&e(t,$(n)||n,1)||""},J="O,Moz,ms,Ms,Webkit".split(","),$=function(e,t,n){var i=(t||s).style,r=5;if(e in i&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);r--&&!(J[r]+e in i););return r<0?null:(3===r?"ms":r>=0?J[r]:"")+e},ee=function(){"undefined"!=typeof window&&window.document&&(i=window,r=i.document,a=r.documentElement,s=q("div")||{style:{}},q("div"),z=$(z),H=z+"Origin",s.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",c=!!$("perspective"),u=T.p8.core.reverting,o=1)},te=function e(t){var n,i=q("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,o=this.nextSibling,s=this.style.cssText;if(a.appendChild(i),i.appendChild(this),this.style.display="block",t)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=e}catch(l){}else this._gsapBBox&&(n=this._gsapBBox());return r&&(o?r.insertBefore(this,o):r.appendChild(this)),a.removeChild(i),this.style.cssText=s,n},ne=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},ie=function(e){var t;try{t=e.getBBox()}catch(n){t=te.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===te||(t=te.call(e,!0)),!t||t.width||t.x||t.y?t:{x:+ne(e,["x","cx","x1"])||0,y:+ne(e,["y","cy","y1"])||0,width:0,height:0}},re=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!ie(e))},ae=function(e,t){if(t){var n=e.style;t in S&&t!==H&&(t=z),n.removeProperty?("ms"!==t.substr(0,2)&&"webkit"!==t.substr(0,6)||(t="-"+t),n.removeProperty(t.replace(C,"-$1").toLowerCase())):n.removeAttribute(t)}},oe=function(e,t,n,i,r,a){var o=new T.Fo(e._pt,t,n,0,1,a?w:N);return e._pt=o,o.b=i,o.e=r,e._props.push(n),o},se={deg:1,rad:1,turn:1},le={grid:1,flex:1},ue=function e(t,n,i,a){var o,l,u,c,h=parseFloat(i)||0,f=(i+"").trim().substr((h+"").length)||"px",d=s.style,v=x.test(n),p="svg"===t.tagName.toLowerCase(),_=(p?"client":"offset")+(v?"Width":"Height"),g=100,m="px"===a,y="%"===a;return a===f||!h||se[a]||se[f]?h:("px"!==f&&!m&&(h=e(t,n,i,"px")),c=t.getCTM&&re(t),!y&&"%"!==f||!S[n]&&!~n.indexOf("adius")?(d[v?"width":"height"]=g+(m?f:a),l=~n.indexOf("adius")||"em"===a&&t.appendChild&&!p?t:t.parentNode,c&&(l=(t.ownerSVGElement||{}).parentNode),l&&l!==r&&l.appendChild||(l=r.body),(u=l._gsap)&&y&&u.width&&v&&u.time===T.xr.time&&!u.uncache?(0,T.Pr)(h/u.width*g):((y||"%"===f)&&!le[Q(l,"display")]&&(d.position=Q(t,"position")),l===t&&(d.position="static"),l.appendChild(s),o=s[_],l.removeChild(s),d.position="absolute",v&&y&&((u=(0,T.DY)(l)).time=T.xr.time,u.width=l[_]),(0,T.Pr)(m?o*h/g:o&&h?g/o*h:0))):(o=c?t.getBBox()[v?"width":"height"]:t[_],(0,T.Pr)(y?h/o*g:h/100*o)))},ce=function(e,t,n,i){var r;return o||ee(),t in R&&"transform"!==t&&~(t=R[t]).indexOf(",")&&(t=t.split(",")[0]),S[t]&&"transform"!==t?(r=Ee(e,i),r="transformOrigin"!==t?r[t]:r.svg?r.origin:be(Q(e,H))+" "+r.zOrigin+"px"):(!(r=e.style[t])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=ve[t]&&ve[t](e,t,n)||Q(e,t)||(0,T.Ok)(e,t)||("opacity"===t?1:0)),n&&!~(r+"").trim().indexOf(" ")?ue(e,t,r,n)+n:r},he=function(e,t,n,i){if(!n||"none"===n){var r=$(t,e,1),a=r&&Q(e,r,1);a&&a!==n?(t=r,n=a):"borderColor"===t&&(n=Q(e,"borderTopColor"))}var o,s,l,u,c,h,f,d,v,p,_,g=new T.Fo(this._pt,e.style,t,0,1,T.Ks),m=0,y=0;if(g.b=n,g.e=i,n+="","auto"===(i+="")&&(e.style[t]=i,i=Q(e,t)||i,e.style[t]=n),o=[n,i],(0,T.kr)(o),i=o[1],l=(n=o[0]).match(T.d4)||[],(i.match(T.d4)||[]).length){for(;s=T.d4.exec(i);)f=s[0],v=i.substring(m,s.index),c?c=(c+1)%5:"rgba("!==v.substr(-5)&&"hsla("!==v.substr(-5)||(c=1),f!==(h=l[y++]||"")&&(u=parseFloat(h)||0,_=h.substr((u+"").length),"="===f.charAt(1)&&(f=(0,T.cy)(u,f)+_),d=parseFloat(f),p=f.substr((d+"").length),m=T.d4.lastIndex-p.length,p||(p=p||T.Fc.units[t]||_,m===i.length&&(i+=p,g.e+=p)),_!==p&&(u=ue(e,t,h,p)||0),g._pt={_next:g._pt,p:v||1===y?v:",",s:u,c:d-u,m:c&&c<4||"zIndex"===t?Math.round:0});g.c=m<i.length?i.substring(m,i.length):""}else g.r="display"===t&&"none"===i?w:N;return T.bQ.test(i)&&(g.e=0),this._pt=g,g},fe={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},de=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n,i,r,a=t.t,o=a.style,s=t.u,l=a._gsap;if("all"===s||!0===s)o.cssText="",i=1;else for(r=(s=s.split(",")).length;--r>-1;)n=s[r],S[n]&&(i=1,n="transformOrigin"===n?H:z),ae(a,n);i&&(ae(a,z),l&&(l.svg&&a.removeAttribute("transform"),Ee(a,1),l.uncache=1,Y(o)))}},ve={clearProps:function(e,t,n,i,r){if("isFromStart"!==r.data){var a=e._pt=new T.Fo(e._pt,t,n,0,0,de);return a.u=i,a.pr=-10,a.tween=r,e._props.push(n),1}}},pe=[1,0,0,1,0,0],_e={},ge=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},me=function(e){var t=Q(e,z);return ge(t)?pe:t.substr(7).match(T.SI).map(T.Pr)},ye=function(e,t){var n,i,r,o,s=e._gsap||(0,T.DY)(e),l=e.style,u=me(e);return s.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(u=[(r=e.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?pe:u:(u!==pe||e.offsetParent||e===a||s.svg||(r=l.display,l.display="block",(n=e.parentNode)&&e.offsetParent||(o=1,i=e.nextElementSibling,a.appendChild(e)),u=me(e),r?l.display=r:ae(e,"display"),o&&(i?n.insertBefore(e,i):n?n.appendChild(e):a.removeChild(e))),t&&u.length>6?[u[0],u[1],u[4],u[5],u[12],u[13]]:u)},Ae=function(e,t,n,i,r,a){var o,s,l,u=e._gsap,c=r||ye(e,!0),h=u.xOrigin||0,f=u.yOrigin||0,d=u.xOffset||0,v=u.yOffset||0,p=c[0],_=c[1],g=c[2],m=c[3],y=c[4],A=c[5],E=t.split(" "),b=parseFloat(E[0])||0,T=parseFloat(E[1])||0;n?c!==pe&&(s=p*m-_*g)&&(l=b*(-_/s)+T*(p/s)-(p*A-_*y)/s,b=b*(m/s)+T*(-g/s)+(g*A-m*y)/s,T=l):(b=(o=ie(e)).x+(~E[0].indexOf("%")?b/100*o.width:b),T=o.y+(~(E[1]||E[0]).indexOf("%")?T/100*o.height:T)),i||!1!==i&&u.smooth?(y=b-h,A=T-f,u.xOffset=d+(y*p+A*g)-y,u.yOffset=v+(y*_+A*m)-A):u.xOffset=u.yOffset=0,u.xOrigin=b,u.yOrigin=T,u.smooth=!!i,u.origin=t,u.originIsAbsolute=!!n,e.style[H]="0px 0px",a&&(oe(a,u,"xOrigin",h,b),oe(a,u,"yOrigin",f,T),oe(a,u,"xOffset",d,u.xOffset),oe(a,u,"yOffset",v,u.yOffset)),e.setAttribute("data-svg-origin",b+" "+T)},Ee=function(e,t){var n=e._gsap||new T.l1(e);if("x"in n&&!t&&!n.uncache)return n;var i,r,a,o,s,l,u,h,f,d,v,p,_,g,m,y,A,E,b,S,C,x,D,R,k,O,L,F,N,w,B,U,V=e.style,W=n.scaleX<0,G="px",X="deg",Z=getComputedStyle(e),Y=Q(e,H)||"0";return i=r=a=l=u=h=f=d=v=0,o=s=1,n.svg=!(!e.getCTM||!re(e)),Z.translate&&("none"===Z.translate&&"none"===Z.scale&&"none"===Z.rotate||(V[z]=("none"!==Z.translate?"translate3d("+(Z.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==Z.rotate?"rotate("+Z.rotate+") ":"")+("none"!==Z.scale?"scale("+Z.scale.split(" ").join(",")+") ":"")+Z[z]),V.scale=V.rotate=V.translate="none"),g=ye(e,n.svg),n.svg&&(n.uncache?(k=e.getBBox(),Y=n.xOrigin-k.x+"px "+(n.yOrigin-k.y)+"px",R=""):R=!t&&e.getAttribute("data-svg-origin"),Ae(e,R||Y,!!R||n.originIsAbsolute,!1!==n.smooth,g)),p=n.xOrigin||0,_=n.yOrigin||0,g!==pe&&(E=g[0],b=g[1],S=g[2],C=g[3],i=x=g[4],r=D=g[5],6===g.length?(o=Math.sqrt(E*E+b*b),s=Math.sqrt(C*C+S*S),l=E||b?P(b,E)*M:0,(f=S||C?P(S,C)*M+l:0)&&(s*=Math.abs(Math.cos(f*I))),n.svg&&(i-=p-(p*E+_*S),r-=_-(p*b+_*C))):(U=g[6],w=g[7],L=g[8],F=g[9],N=g[10],B=g[11],i=g[12],r=g[13],a=g[14],u=(m=P(U,N))*M,m&&(R=x*(y=Math.cos(-m))+L*(A=Math.sin(-m)),k=D*y+F*A,O=U*y+N*A,L=x*-A+L*y,F=D*-A+F*y,N=U*-A+N*y,B=w*-A+B*y,x=R,D=k,U=O),h=(m=P(-S,N))*M,m&&(y=Math.cos(-m),B=C*(A=Math.sin(-m))+B*y,E=R=E*y-L*A,b=k=b*y-F*A,S=O=S*y-N*A),l=(m=P(b,E))*M,m&&(R=E*(y=Math.cos(m))+b*(A=Math.sin(m)),k=x*y+D*A,b=b*y-E*A,D=D*y-x*A,E=R,x=k),u&&Math.abs(u)+Math.abs(l)>359.9&&(u=l=0,h=180-h),o=(0,T.Pr)(Math.sqrt(E*E+b*b+S*S)),s=(0,T.Pr)(Math.sqrt(D*D+U*U)),m=P(x,D),f=Math.abs(m)>2e-4?m*M:0,v=B?1/(B<0?-B:B):0),n.svg&&(R=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!ge(Q(e,z)),R&&e.setAttribute("transform",R))),Math.abs(f)>90&&Math.abs(f)<270&&(W?(o*=-1,f+=l<=0?180:-180,l+=l<=0?180:-180):(s*=-1,f+=f<=0?180:-180)),t=t||n.uncache,n.x=i-((n.xPercent=i&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-i)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+G,n.y=r-((n.yPercent=r&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-r)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+G,n.z=a+G,n.scaleX=(0,T.Pr)(o),n.scaleY=(0,T.Pr)(s),n.rotation=(0,T.Pr)(l)+X,n.rotationX=(0,T.Pr)(u)+X,n.rotationY=(0,T.Pr)(h)+X,n.skewX=f+X,n.skewY=d+X,n.transformPerspective=v+G,(n.zOrigin=parseFloat(Y.split(" ")[2])||0)&&(V[H]=be(Y)),n.xOffset=n.yOffset=0,n.force3D=T.Fc.force3D,n.renderTransform=n.svg?xe:c?Ce:Se,n.uncache=0,n},be=function(e){return(e=e.split(" "))[0]+" "+e[1]},Te=function(e,t,n){var i=(0,T.Wy)(t);return(0,T.Pr)(parseFloat(t)+parseFloat(ue(e,"x",n+"px",i)))+i},Se=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Ce(e,t)},Me="0deg",Ie="0px",Pe=") ",Ce=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,a=n.x,o=n.y,s=n.z,l=n.rotation,u=n.rotationY,c=n.rotationX,h=n.skewX,f=n.skewY,d=n.scaleX,v=n.scaleY,p=n.transformPerspective,_=n.force3D,g=n.target,m=n.zOrigin,y="",A="auto"===_&&e&&1!==e||!0===_;if(m&&(c!==Me||u!==Me)){var E,b=parseFloat(u)*I,T=Math.sin(b),S=Math.cos(b);b=parseFloat(c)*I,E=Math.cos(b),a=Te(g,a,T*E*-m),o=Te(g,o,-Math.sin(b)*-m),s=Te(g,s,S*E*-m+m)}p!==Ie&&(y+="perspective("+p+Pe),(i||r)&&(y+="translate("+i+"%, "+r+"%) "),(A||a!==Ie||o!==Ie||s!==Ie)&&(y+=s!==Ie||A?"translate3d("+a+", "+o+", "+s+") ":"translate("+a+", "+o+Pe),l!==Me&&(y+="rotate("+l+Pe),u!==Me&&(y+="rotateY("+u+Pe),c!==Me&&(y+="rotateX("+c+Pe),h===Me&&f===Me||(y+="skew("+h+", "+f+Pe),1===d&&1===v||(y+="scale("+d+", "+v+Pe),g.style[z]=y||"translate(0, 0)"},xe=function(e,t){var n,i,r,a,o,s=t||this,l=s.xPercent,u=s.yPercent,c=s.x,h=s.y,f=s.rotation,d=s.skewX,v=s.skewY,p=s.scaleX,_=s.scaleY,g=s.target,m=s.xOrigin,y=s.yOrigin,A=s.xOffset,E=s.yOffset,b=s.forceCSS,S=parseFloat(c),M=parseFloat(h);f=parseFloat(f),d=parseFloat(d),(v=parseFloat(v))&&(d+=v=parseFloat(v),f+=v),f||d?(f*=I,d*=I,n=Math.cos(f)*p,i=Math.sin(f)*p,r=Math.sin(f-d)*-_,a=Math.cos(f-d)*_,d&&(v*=I,o=Math.tan(d-v),r*=o=Math.sqrt(1+o*o),a*=o,v&&(o=Math.tan(v),n*=o=Math.sqrt(1+o*o),i*=o)),n=(0,T.Pr)(n),i=(0,T.Pr)(i),r=(0,T.Pr)(r),a=(0,T.Pr)(a)):(n=p,a=_,i=r=0),(S&&!~(c+"").indexOf("px")||M&&!~(h+"").indexOf("px"))&&(S=ue(g,"x",c,"px"),M=ue(g,"y",h,"px")),(m||y||A||E)&&(S=(0,T.Pr)(S+m-(m*n+y*r)+A),M=(0,T.Pr)(M+y-(m*i+y*a)+E)),(l||u)&&(o=g.getBBox(),S=(0,T.Pr)(S+l/100*o.width),M=(0,T.Pr)(M+u/100*o.height)),o="matrix("+n+","+i+","+r+","+a+","+S+","+M+")",g.setAttribute("transform",o),b&&(g.style[z]=o)},De=function(e,t,n,i,r){var a,o,s=360,l=(0,T.r9)(r),u=parseFloat(r)*(l&&~r.indexOf("rad")?M:1)-i,c=i+u+"deg";return l&&("short"===(a=r.split("_")[1])&&(u%=s)!==u%180&&(u+=u<0?s:-360),"cw"===a&&u<0?u=(u+36e9)%s-~~(u/s)*s:"ccw"===a&&u>0&&(u=(u-36e9)%s-~~(u/s)*s)),e._pt=o=new T.Fo(e._pt,t,n,i,u,O),o.e=c,o.u="deg",e._props.push(n),o},Re=function(e,t){for(var n in t)e[n]=t[n];return e},ke=function(e,t,n){var i,r,a,o,s,l,u,c=Re({},n._gsap),h=n.style;for(r in c.svg?(a=n.getAttribute("transform"),n.setAttribute("transform",""),h[z]=t,i=Ee(n,1),ae(n,z),n.setAttribute("transform",a)):(a=getComputedStyle(n)[z],h[z]=t,i=Ee(n,1),h[z]=a),S)(a=c[r])!==(o=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(s=(0,T.Wy)(a)!==(u=(0,T.Wy)(o))?ue(n,r,a,u):parseFloat(a),l=parseFloat(o),e._pt=new T.Fo(e._pt,i,r,s,l-s,k),e._pt.u=u||0,e._props.push(r));Re(i,c)};(0,T.fS)("padding,margin,Width,Radius",(function(e,t){var n="Top",i="Right",r="Bottom",a="Left",o=(t<3?[n,i,r,a]:[n+a,n+i,r+i,r+a]).map((function(n){return t<2?e+n:"border"+n+e}));ve[t>1?"border"+e:e]=function(e,t,n,i,r){var a,s;if(arguments.length<4)return a=o.map((function(t){return ce(e,t,n)})),5===(s=a.join(" ")).split(a[0]).length?a[0]:s;a=(i+"").split(" "),s={},o.forEach((function(e,t){return s[e]=a[t]=a[t]||a[(t-1)/2|0]})),e.init(t,s,r)}}));var Oe,Le,Fe,Ne={name:"css",register:ee,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,r){var a,s,l,u,c,h,f,d,v,p,_,g,m,y,A,E,b,M,I,P,C=this._props,x=e.style,O=n.vars.startAt;for(f in o||ee(),this.styles=this.styles||j(e),E=this.styles.props,this.tween=n,t)if("autoRound"!==f&&(s=t[f],!T.$i[f]||!(0,T.if)(f,t,n,i,e,r)))if(c=typeof s,h=ve[f],"function"===c&&(c=typeof(s=s.call(n,i,e,r))),"string"===c&&~s.indexOf("random(")&&(s=(0,T.UI)(s)),h)h(this,e,f,s,n)&&(A=1);else if("--"===f.substr(0,2))a=(getComputedStyle(e).getPropertyValue(f)+"").trim(),s+="",T.GN.lastIndex=0,T.GN.test(a)||(d=(0,T.Wy)(a),v=(0,T.Wy)(s)),v?d!==v&&(a=ue(e,f,a,v)+v):d&&(s+=d),this.add(x,"setProperty",a,s,i,r,0,0,f),C.push(f),E.push(f,x[f]);else if("undefined"!==c){if(O&&f in O?(a="function"==typeof O[f]?O[f].call(n,i,e,r):O[f],(0,T.r9)(a)&&~a.indexOf("random(")&&(a=(0,T.UI)(a)),(0,T.Wy)(a+"")||(a+=T.Fc.units[f]||(0,T.Wy)(ce(e,f))||""),"="===(a+"").charAt(1)&&(a=ce(e,f))):a=ce(e,f),u=parseFloat(a),(p="string"===c&&"="===s.charAt(1)&&s.substr(0,2))&&(s=s.substr(2)),l=parseFloat(s),f in R&&("autoAlpha"===f&&(1===u&&"hidden"===ce(e,"visibility")&&l&&(u=0),E.push("visibility",x.visibility),oe(this,x,"visibility",u?"inherit":"hidden",l?"inherit":"hidden",!l)),"scale"!==f&&"transform"!==f&&~(f=R[f]).indexOf(",")&&(f=f.split(",")[0])),_=f in S)if(this.styles.save(f),g||((m=e._gsap).renderTransform&&!t.parseTransform||Ee(e,t.parseTransform),y=!1!==t.smoothOrigin&&m.smooth,(g=this._pt=new T.Fo(this._pt,x,z,0,1,m.renderTransform,m,0,-1)).dep=1),"scale"===f)this._pt=new T.Fo(this._pt,m,"scaleY",m.scaleY,(p?(0,T.cy)(m.scaleY,p+l):l)-m.scaleY||0,k),this._pt.u=0,C.push("scaleY",f),f+="X";else{if("transformOrigin"===f){E.push(H,x[H]),M=void 0,I=void 0,P=void 0,M=(b=s).split(" "),I=M[0],P=M[1]||"50%","top"!==I&&"bottom"!==I&&"left"!==P&&"right"!==P||(b=I,I=P,P=b),M[0]=fe[I]||I,M[1]=fe[P]||P,s=M.join(" "),m.svg?Ae(e,s,0,y,0,this):((v=parseFloat(s.split(" ")[2])||0)!==m.zOrigin&&oe(this,m,"zOrigin",m.zOrigin,v),oe(this,x,f,be(a),be(s)));continue}if("svgOrigin"===f){Ae(e,s,1,y,0,this);continue}if(f in _e){De(this,m,f,u,p?(0,T.cy)(u,p+s):s);continue}if("smoothOrigin"===f){oe(this,m,"smooth",m.smooth,s);continue}if("force3D"===f){m[f]=s;continue}if("transform"===f){ke(this,s,e);continue}}else f in x||(f=$(f)||f);if(_||(l||0===l)&&(u||0===u)&&!D.test(s)&&f in x)l||(l=0),(d=(a+"").substr((u+"").length))!==(v=(0,T.Wy)(s)||(f in T.Fc.units?T.Fc.units[f]:d))&&(u=ue(e,f,a,v)),this._pt=new T.Fo(this._pt,_?m:x,f,u,(p?(0,T.cy)(u,p+l):l)-u,_||"px"!==v&&"zIndex"!==f||!1===t.autoRound?k:F),this._pt.u=v||0,d!==v&&"%"!==v&&(this._pt.b=a,this._pt.r=L);else if(f in x)he.call(this,e,f,a,p?p+s:s);else{if(!(f in e)){(0,T.lC)(f,s);continue}this.add(e,f,a||e[f],p?p+s:s,i,r)}_||E.push(f,x[f]),C.push(f)}A&&(0,T.JV)(this)},render:function(e,t){if(t.tween._time||!u())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:ce,aliases:R,getSetter:function(e,t,n){var i=R[t];return i&&i.indexOf(",")<0&&(t=i),t in S&&t!==H&&(e._gsap.x||ce(e,"x"))?n&&l===n?"scale"===t?W:V:(l=n||{})&&("scale"===t?G:X):e.style&&!(0,T.m2)(e.style[t])?B:~t.indexOf("-")?U:(0,T.S5)(e,t)},core:{_removeProperty:ae,_getMatrix:ye}};T.p8.utils.checkPrefix=$,T.p8.core.getStyleSaver=j,Oe="x,y,z,scale,scaleX,scaleY,xPercent,yPercent",Le="rotation,rotationX,rotationY,skewX,skewY",Fe=(0,T.fS)(Oe+","+Le+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(e){S[e]=1})),(0,T.fS)(Le,(function(e){T.Fc.units[e]="deg",_e[e]=1})),R[Fe[13]]=Oe+","+Le,(0,T.fS)("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(e){var t=e.split(":");R[t[1]]=Fe[t[0]]})),(0,T.fS)("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(e){T.Fc.units[e]="px"})),T.p8.registerPlugin(Ne);var we=T.p8.registerPlugin(Ne)||T.p8,Be=(we.core.Tween,function(e){return function(t,n){var i="string"==typeof t&&t,r=i?n:t,a=[];return(0,h.useEffect)((function(){var t=i||a;return we.killTweensOf(t),e(t,r),function(){we.killTweensOf(t)}}),[]),function(e){e&&!a.includes(e)&&a.push(e)}}}),Ue={y:20,opacity:0,duration:.7,delay:0,ease:"power2.out"},Ve=function(){var e=Be((function(e,t){void 0===t&&(t={}),we.to(e,{opacity:1,duration:t.duration,delay:t.delay}),we.from(e,Object.assign({},Ue,t))}));return e.apply(void 0,arguments)};function We(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}var Ge=function(e){var t=e.label,n=e.disabled,i=e.clear,r=void 0!==i&&i,a=e.children,o=e.icon,s=(0,v.Z)(),l=d()("button",{"is-clear":r,"is-disabled":n}),u=h.createElement("div",{className:"button-content"},o?h.createElement("span",{className:"icon"},o):null,t?h.createElement("span",{className:"button-text"},s(t)):null,h.createElement("span",{className:"button-shadow"}));return h.createElement(h.Fragment,null,a({buttonClasses:l,buttonContent:u}))},Xe=["to"],ze=function(e){var t=e.to,n=We(e,Xe);return h.createElement(Ge,n,(function(e){var n=e.buttonClasses,i=e.buttonContent;return h.createElement(m.fO,{className:n,to:t},i)}))},He=n(2977),Ze=n(8911),Ye=n(9522),Ke=n(4527),je=n(6176);function qe(e){var t=[],n=[],i=[],r=[],a=e.width||e.size||1,o=e.height||e.size||1,s=0===e.sideOrientation?0:e.sideOrientation||Ke.x.DEFAULTSIDE,l=a/2,u=o/2;n.push(-l,-u,0),i.push(0,0,-1),r.push(0,je.e.UseOpenGLOrientationForUV?1:0),n.push(l,-u,0),i.push(0,0,-1),r.push(1,je.e.UseOpenGLOrientationForUV?1:0),n.push(l,u,0),i.push(0,0,-1),r.push(1,je.e.UseOpenGLOrientationForUV?0:1),n.push(-l,u,0),i.push(0,0,-1),r.push(0,je.e.UseOpenGLOrientationForUV?0:1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),Ke.x._ComputeSides(s,n,t,i,r,e.frontUVs,e.backUVs);var c=new Ke.x;return c.indices=t,c.positions=n,c.normals=i,c.uvs=r,c}function Qe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=new Ye.Kj(e,n);t.sideOrientation=Ye.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;var r=qe(t);return r.applyToMesh(i,t.updatable),t.sourcePlane&&(i.translate(t.sourcePlane.normal,-t.sourcePlane.d),i.setDirection(t.sourcePlane.normal.scale(-1))),i}Ke.x.CreatePlane=qe,Ye.Kj.CreatePlane=function(e,t,n,i,r){return Qe(e,{size:t,width:t,height:t,sideOrientation:r,updatable:i},n)};n(4944),n(3792);var Je=n(6900),$e=n(7046);function et(e){var t,n=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],r=[],a=e.width||e.size||1,o=e.height||e.size||1,s=e.depth||e.size||1,l=e.wrap||!1,u=void 0===e.topBaseAt?1:e.topBaseAt,c=void 0===e.bottomBaseAt?0:e.bottomBaseAt,h=[2,0,3,1][u=(u+4)%4],f=[2,0,1,3][c=(c+4)%4],d=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(l){n=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],d=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var v=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],p=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],_=[17,18,19,16],g=[22,23,20,21];h>0;)v.unshift(v.pop()),_.unshift(_.pop()),h--;for(;f>0;)p.unshift(p.pop()),g.unshift(g.pop()),f--;v=v.flat(),p=p.flat(),d=d.concat(v).concat(p),n.push(_[0],_[2],_[3],_[0],_[1],_[2]),n.push(g[0],g[2],g[3],g[0],g[1],g[2])}var m=[a/2,o/2,s/2];t=d.reduce((function(e,t,n){return e.concat(t*m[n%3])}),[]);for(var y=0===e.sideOrientation?0:e.sideOrientation||Ke.x.DEFAULTSIDE,A=e.faceUV||new Array(6),E=e.faceColors,b=[],T=0;T<6;T++)void 0===A[T]&&(A[T]=new Je.Lt(0,0,1,1)),E&&void 0===E[T]&&(E[T]=new $e.HE(1,1,1,1));for(var S=0;S<6;S++)if(r.push(A[S].z,je.e.UseOpenGLOrientationForUV?1-A[S].w:A[S].w),r.push(A[S].x,je.e.UseOpenGLOrientationForUV?1-A[S].w:A[S].w),r.push(A[S].x,je.e.UseOpenGLOrientationForUV?1-A[S].y:A[S].y),r.push(A[S].z,je.e.UseOpenGLOrientationForUV?1-A[S].y:A[S].y),E)for(var M=0;M<4;M++)b.push(E[S].r,E[S].g,E[S].b,E[S].a);Ke.x._ComputeSides(y,t,n,i,r,e.frontUVs,e.backUVs);var I=new Ke.x;if(I.indices=n,I.positions=t,I.normals=i,I.uvs=r,E){var P=y===Ke.x.DOUBLESIDE?b.concat(b):b;I.colors=P}return I}function tt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=new Ye.Kj(e,n);t.sideOrientation=Ye.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;var r=et(t);return r.applyToMesh(i,t.updatable),i}Ke.x.CreateBox=et,Ye.Kj.CreateBox=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a={size:t,sideOrientation:r,updatable:i};return tt(e,a,n)};var nt,it=n(7702),rt=n(3681),at=(n(2465),n(5602));!function(e){e[e.CW=0]="CW",e[e.CCW=1]="CCW"}(nt||(nt={}));var ot=n(3683),st=n(5671),lt=n(3144),ut=function(){function e(t,n){(0,st.Z)(this,e),this.width=t,this.height=n}return(0,lt.Z)(e,[{key:"toString",value:function(){return"{W: ".concat(this.width,", H: ").concat(this.height,"}")}},{key:"getClassName",value:function(){return"Size"}},{key:"getHashCode",value:function(){var e=0|this.width;return e=397*e^(0|this.height)}},{key:"copyFrom",value:function(e){this.width=e.width,this.height=e.height}},{key:"copyFromFloats",value:function(e,t){return this.width=e,this.height=t,this}},{key:"set",value:function(e,t){return this.copyFromFloats(e,t)}},{key:"multiplyByFloats",value:function(t,n){return new e(this.width*t,this.height*n)}},{key:"clone",value:function(){return new e(this.width,this.height)}},{key:"equals",value:function(e){return!!e&&(this.width===e.width&&this.height===e.height)}},{key:"surface",get:function(){return this.width*this.height}},{key:"add",value:function(t){return new e(this.width+t.width,this.height+t.height)}},{key:"subtract",value:function(t){return new e(this.width-t.width,this.height-t.height)}}],[{key:"Zero",value:function(){return new e(0,0)}},{key:"Lerp",value:function(t,n,i){return new e(t.width+(n.width-t.width)*i,t.height+(n.height-t.height)*i)}}]),e}(),ct=(n(628),n(7326)),ht=n(1752),ft=n(136),dt=n(6215),vt=n(1120),pt=n(9477),_t=n(9336),gt=n(4174),mt=n(1396),yt=n(3365),At=n(2786),Et=function(){function e(){(0,st.Z)(this,e),this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return(0,lt.Z)(e,[{key:"name",get:function(){return"AutoRotation"}},{key:"zoomStopsAnimation",get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e}},{key:"idleRotationSpeed",get:function(){return this._idleRotationSpeed},set:function(e){this._idleRotationSpeed=e}},{key:"idleRotationWaitTime",get:function(){return this._idleRotationWaitTime},set:function(e){this._idleRotationWaitTime=e}},{key:"idleRotationSpinupTime",get:function(){return this._idleRotationSpinupTime},set:function(e){this._idleRotationSpinupTime=e}},{key:"rotationInProgress",get:function(){return Math.abs(this._cameraRotationSpeed)>0}},{key:"init",value:function(){}},{key:"attach",value:function(e){var t=this;this._attachedCamera=e;var n=this._attachedCamera.getScene();this._onPrePointerObservableObserver=n.onPrePointerObservable.add((function(e){e.type!==yt.kD.POINTERDOWN?e.type===yt.kD.POINTERUP&&(t._isPointerDown=!1):t._isPointerDown=!0})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((function(){if(!t._reachTargetAlpha()){var e=At.F.Now,n=0;null!=t._lastFrameTime&&(n=e-t._lastFrameTime),t._lastFrameTime=e,t._applyUserInteraction();var i=e-t._lastInteractionTime-t._idleRotationWaitTime,r=Math.max(Math.min(i/t._idleRotationSpinupTime,1),0);t._cameraRotationSpeed=t._idleRotationSpeed*r,t._attachedCamera&&(t._attachedCamera.alpha-=t._cameraRotationSpeed*(n/1e3))}}))}},{key:"detach",value:function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}}},{key:"resetLastInteractionTime",value:function(e){this._lastInteractionTime=null!=e?e:At.F.Now}},{key:"_reachTargetAlpha",value:function(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<rt.kn}},{key:"_userIsZooming",value:function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}},{key:"_shouldAnimationStopForInteraction",value:function(){if(!this._attachedCamera)return!1;var e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()}},{key:"_applyUserInteraction",value:function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=At.F.Now)}},{key:"_userIsMoving",value:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}]),e}();function bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}var Tt=function(){function e(){(0,st.Z)(this,e),this._easingMode=e.EASINGMODE_EASEIN}return(0,lt.Z)(e,[{key:"setEasingMode",value:function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t}},{key:"getEasingMode",value:function(){return this._easingMode}},{key:"easeInCore",value:function(e){throw new Error("You must implement this method")}},{key:"ease",value:function(t){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(t);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)}}]),e}();Tt.EASINGMODE_EASEIN=0,Tt.EASINGMODE_EASEOUT=1,Tt.EASINGMODE_EASEINOUT=2;var St,Mt=function(e){(0,ft.Z)(n,e);var t=bt(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,st.Z)(this,n),(e=t.call(this)).amplitude=i,e}return(0,lt.Z)(n,[{key:"easeInCore",value:function(e){var t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)}}]),n}(Tt),It=function(e){(0,ft.Z)(n,e);var t=bt(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return(0,st.Z)(this,n),(e=t.call(this)).exponent=i,e}return(0,lt.Z)(n,[{key:"easeInCore",value:function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)}}]),n}(Tt),Pt=n(1704);!function(e){e[e.NONE=0]="NONE",e[e.STEP=1]="STEP"}(St||(St={}));var Ct=function(){function e(t,n,i){(0,st.Z)(this,e),this.name=t,this.from=n,this.to=i}return(0,lt.Z)(e,[{key:"clone",value:function(){return new e(this.name,this.from,this.to)}}]),e}(),xt=n(8628);function Dt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Rt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Rt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var kt=function(){function e(t,n,i,r,a,o){(0,st.Z)(this,e),this.name=t,this.targetProperty=n,this.framePerSecond=i,this.dataType=r,this.loopMode=a,this.enableBlending=o,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=n.split("."),this.dataType=r,this.loopMode=void 0===a?e.ANIMATIONLOOPMODE_CYCLE:a,this.uniqueId=e._UniqueIdGenerator++}return(0,lt.Z)(e,[{key:"runtimeAnimations",get:function(){return this._runtimeAnimations}},{key:"hasRunningRuntimeAnimations",get:function(){var e,t=Dt(this._runtimeAnimations);try{for(t.s();!(e=t.n()).done;){if(!e.value.isStopped())return!0}}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"toString",value:function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var n=!0;for(var i in this._ranges)n&&(t+=", ",n=!1),t+=i;t+="}"}return t}},{key:"addEvent",value:function(e){this._events.push(e),this._events.sort((function(e,t){return e.frame-t.frame}))}},{key:"removeEvents",value:function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)}},{key:"getEvents",value:function(){return this._events}},{key:"createRange",value:function(e,t,n){this._ranges[e]||(this._ranges[e]=new Ct(e,t,n))}},{key:"deleteRange",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._ranges[e];if(n){if(t)for(var i=n.from,r=n.to,a=this._keys.length-1;a>=0;a--)this._keys[a].frame>=i&&this._keys[a].frame<=r&&this._keys.splice(a,1);this._ranges[e]=null}}},{key:"getRange",value:function(e){return this._ranges[e]}},{key:"getKeys",value:function(){return this._keys}},{key:"getHighestFrame",value:function(){for(var e=0,t=0,n=this._keys.length;t<n;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e}},{key:"getEasingFunction",value:function(){return this._easingFunction}},{key:"setEasingFunction",value:function(e){this._easingFunction=e}},{key:"floatInterpolateFunction",value:function(e,t,n){return at.R.Lerp(e,t,n)}},{key:"floatInterpolateFunctionWithTangents",value:function(e,t,n,i,r){return at.R.Hermite(e,t,n,i,r)}},{key:"quaternionInterpolateFunction",value:function(e,t,n){return Je._f.Slerp(e,t,n)}},{key:"quaternionInterpolateFunctionWithTangents",value:function(e,t,n,i,r){return Je._f.Hermite(e,t,n,i,r).normalize()}},{key:"vector3InterpolateFunction",value:function(e,t,n){return Je.P.Lerp(e,t,n)}},{key:"vector3InterpolateFunctionWithTangents",value:function(e,t,n,i,r){return Je.P.Hermite(e,t,n,i,r)}},{key:"vector2InterpolateFunction",value:function(e,t,n){return Je.FM.Lerp(e,t,n)}},{key:"vector2InterpolateFunctionWithTangents",value:function(e,t,n,i,r){return Je.FM.Hermite(e,t,n,i,r)}},{key:"sizeInterpolateFunction",value:function(e,t,n){return ut.Lerp(e,t,n)}},{key:"color3InterpolateFunction",value:function(e,t,n){return $e.Wo.Lerp(e,t,n)}},{key:"color3InterpolateFunctionWithTangents",value:function(e,t,n,i,r){return $e.Wo.Hermite(e,t,n,i,r)}},{key:"color4InterpolateFunction",value:function(e,t,n){return $e.HE.Lerp(e,t,n)}},{key:"color4InterpolateFunctionWithTangents",value:function(e,t,n,i,r){return $e.HE.Hermite(e,t,n,i,r)}},{key:"_getKeyValue",value:function(e){return"function"==typeof e?e():e}},{key:"evaluate",value:function(t){return this._interpolate(t,{key:0,repeatCount:0,loopMode:e.ANIMATIONLOOPMODE_CONSTANT})}},{key:"_interpolate",value:function(t,n){if(n.loopMode===e.ANIMATIONLOOPMODE_CONSTANT&&n.repeatCount>0)return n.highLimitValue.clone?n.highLimitValue.clone():n.highLimitValue;for(var i=this._keys,r=i.length,a=n.key;a>=0&&t<i[a].frame;)--a;for(;a+1<=r-1&&t>=i[a+1].frame;)++a;if(n.key=a,a<0)return this._getKeyValue(i[0].value);if(a+1>r-1)return this._getKeyValue(i[r-1].value);var o=i[a],s=i[a+1],l=this._getKeyValue(o.value),u=this._getKeyValue(s.value);if(o.interpolation===St.STEP)return s.frame>t?l:u;var c=void 0!==o.outTangent&&void 0!==s.inTangent,h=s.frame-o.frame,f=(t-o.frame)/h,d=this.getEasingFunction();switch(null!==d&&(f=d.ease(f)),this.dataType){case e.ANIMATIONTYPE_FLOAT:var v=c?this.floatInterpolateFunctionWithTangents(l,o.outTangent*h,u,s.inTangent*h,f):this.floatInterpolateFunction(l,u,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return v;case e.ANIMATIONLOOPMODE_RELATIVE:return n.offsetValue*n.repeatCount+v}break;case e.ANIMATIONTYPE_QUATERNION:var p=c?this.quaternionInterpolateFunctionWithTangents(l,o.outTangent.scale(h),u,s.inTangent.scale(h),f):this.quaternionInterpolateFunction(l,u,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return p;case e.ANIMATIONLOOPMODE_RELATIVE:return p.addInPlace(n.offsetValue.scale(n.repeatCount))}return p;case e.ANIMATIONTYPE_VECTOR3:var _=c?this.vector3InterpolateFunctionWithTangents(l,o.outTangent.scale(h),u,s.inTangent.scale(h),f):this.vector3InterpolateFunction(l,u,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return _;case e.ANIMATIONLOOPMODE_RELATIVE:return _.add(n.offsetValue.scale(n.repeatCount))}break;case e.ANIMATIONTYPE_VECTOR2:var g=c?this.vector2InterpolateFunctionWithTangents(l,o.outTangent.scale(h),u,s.inTangent.scale(h),f):this.vector2InterpolateFunction(l,u,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return g;case e.ANIMATIONLOOPMODE_RELATIVE:return g.add(n.offsetValue.scale(n.repeatCount))}break;case e.ANIMATIONTYPE_SIZE:switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(l,u,f);case e.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(l,u,f).add(n.offsetValue.scale(n.repeatCount))}break;case e.ANIMATIONTYPE_COLOR3:var m=c?this.color3InterpolateFunctionWithTangents(l,o.outTangent.scale(h),u,s.inTangent.scale(h),f):this.color3InterpolateFunction(l,u,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return m;case e.ANIMATIONLOOPMODE_RELATIVE:return m.add(n.offsetValue.scale(n.repeatCount))}break;case e.ANIMATIONTYPE_COLOR4:var y=c?this.color4InterpolateFunctionWithTangents(l,o.outTangent.scale(h),u,s.inTangent.scale(h),f):this.color4InterpolateFunction(l,u,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return y;case e.ANIMATIONLOOPMODE_RELATIVE:return y.add(n.offsetValue.scale(n.repeatCount))}break;case e.ANIMATIONTYPE_MATRIX:switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return e.AllowMatricesInterpolation?this.matrixInterpolateFunction(l,u,f,n.workValue):l;case e.ANIMATIONLOOPMODE_RELATIVE:return l}}return 0}},{key:"matrixInterpolateFunction",value:function(t,n,i,r){return e.AllowMatrixDecomposeForInterpolation?r?(Je.y3.DecomposeLerpToRef(t,n,i,r),r):Je.y3.DecomposeLerp(t,n,i):r?(Je.y3.LerpToRef(t,n,i,r),r):Je.y3.Lerp(t,n,i)}},{key:"clone",value:function(){var t=new e(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges)for(var n in t._ranges={},this._ranges){var i=this._ranges[n];i&&(t._ranges[n]=i.clone())}return t}},{key:"setKeys",value:function(e){this._keys=e.slice(0)}},{key:"serialize",value:function(){var t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;var n=this.dataType;t.keys=[];for(var i=this.getKeys(),r=0;r<i.length;r++){var a=i[r],o={};switch(o.frame=a.frame,n){case e.ANIMATIONTYPE_FLOAT:o.values=[a.value],void 0!==a.inTangent&&o.values.push(a.inTangent),void 0!==a.outTangent&&(void 0===a.inTangent&&o.values.push(void 0),o.values.push(a.outTangent)),void 0!==a.interpolation&&(void 0===a.inTangent&&o.values.push(void 0),void 0===a.outTangent&&o.values.push(void 0),o.values.push(a.interpolation));break;case e.ANIMATIONTYPE_QUATERNION:case e.ANIMATIONTYPE_MATRIX:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:case e.ANIMATIONTYPE_COLOR4:o.values=a.value.asArray(),null!=a.inTangent&&o.values.push(a.inTangent.asArray()),null!=a.outTangent&&(void 0===a.inTangent&&o.values.push(void 0),o.values.push(a.outTangent.asArray())),void 0!==a.interpolation&&(void 0===a.inTangent&&o.values.push(void 0),void 0===a.outTangent&&o.values.push(void 0),o.values.push(a.interpolation))}t.keys.push(o)}for(var s in t.ranges=[],this._ranges){var l=this._ranges[s];if(l){var u={};u.name=s,u.from=l.from,u.to=l.to,t.ranges.push(u)}}return t}}],[{key:"_PrepareAnimation",value:function(t,n,i,r,a,o,s,l){var u=void 0;if(!isNaN(parseFloat(a))&&isFinite(a)?u=e.ANIMATIONTYPE_FLOAT:a instanceof Je._f?u=e.ANIMATIONTYPE_QUATERNION:a instanceof Je.P?u=e.ANIMATIONTYPE_VECTOR3:a instanceof Je.FM?u=e.ANIMATIONTYPE_VECTOR2:a instanceof $e.Wo?u=e.ANIMATIONTYPE_COLOR3:a instanceof $e.HE?u=e.ANIMATIONTYPE_COLOR4:a instanceof ut&&(u=e.ANIMATIONTYPE_SIZE),null==u)return null;var c=new e(t,n,i,u,s),h=[{frame:0,value:a},{frame:r,value:o}];return c.setKeys(h),void 0!==l&&c.setEasingFunction(l),c}},{key:"CreateAnimation",value:function(t,n,i,r){var a=new e(t+"Animation",t,i,n,e.ANIMATIONLOOPMODE_CONSTANT);return a.setEasingFunction(r),a}},{key:"CreateAndStartAnimation",value:function(t,n,i,r,a,o,s,l,u,c,h){var f=e._PrepareAnimation(t,i,r,a,o,s,l,u);return f?(n.getScene&&(h=n.getScene()),h?h.beginDirectAnimation(n,[f],0,a,1===f.loopMode,1,c):null):null}},{key:"CreateAndStartHierarchyAnimation",value:function(t,n,i,r,a,o,s,l,u,c,h){var f=e._PrepareAnimation(t,r,a,o,s,l,u,c);return f?n.getScene().beginDirectHierarchyAnimation(n,i,[f],0,o,1===f.loopMode,1,h):null}},{key:"CreateMergeAndStartAnimation",value:function(t,n,i,r,a,o,s,l,u,c){var h=e._PrepareAnimation(t,i,r,a,o,s,l,u);return h?(n.animations.push(h),n.getScene().beginAnimation(n,0,a,1===h.loopMode,1,c)):null}},{key:"MakeAnimationAdditive",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,o=t;if(r&&((o=t.clone()).name=a||o.name),!o._keys.length)return o;n=n>=0?n:0;var s=0,l=o._keys[0],u=o._keys.length-1,c=o._keys[u],h={referenceValue:l.value,referencePosition:Je.jp.Vector3[0],referenceQuaternion:Je.jp.Quaternion[0],referenceScaling:Je.jp.Vector3[1],keyPosition:Je.jp.Vector3[2],keyQuaternion:Je.jp.Quaternion[1],keyScaling:Je.jp.Vector3[3]},f=!1,d=l.frame,v=c.frame;if(i){var p=o.getRange(i);p&&(d=p.from,v=p.to)}var _=l.frame===d,g=c.frame===v;if(1===o._keys.length){var m=o._getKeyValue(o._keys[0]);h.referenceValue=m.clone?m.clone():m,f=!0}else if(n<=l.frame){var y=o._getKeyValue(l.value);h.referenceValue=y.clone?y.clone():y,f=!0}else if(n>=c.frame){var A=o._getKeyValue(c.value);h.referenceValue=A.clone?A.clone():A,f=!0}for(var E=0;!f||!_||!g&&E<o._keys.length-1;){var b=o._keys[E],T=o._keys[E+1];if(!f&&n>=b.frame&&n<=T.frame){var S=void 0;if(n===b.frame)S=o._getKeyValue(b.value);else if(n===T.frame)S=o._getKeyValue(T.value);else{var M={key:E,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};S=o._interpolate(n,M)}h.referenceValue=S.clone?S.clone():S,f=!0}if(!_&&d>=b.frame&&d<=T.frame){if(d===b.frame)s=E;else if(d===T.frame)s=E+1;else{var I={key:E,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},P=o._interpolate(d,I),C={frame:d,value:P.clone?P.clone():P};o._keys.splice(E+1,0,C),s=E+1}_=!0}if(!g&&v>=b.frame&&v<=T.frame){if(v===b.frame)u=E;else if(v===T.frame)u=E+1;else{var x={key:E,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},D=o._interpolate(v,x),R={frame:v,value:D.clone?D.clone():D};o._keys.splice(E+1,0,R),u=E+1}g=!0}E++}for(o.dataType===e.ANIMATIONTYPE_QUATERNION?h.referenceValue.normalize().conjugateInPlace():o.dataType===e.ANIMATIONTYPE_MATRIX&&(h.referenceValue.decompose(h.referenceScaling,h.referenceQuaternion,h.referencePosition),h.referenceQuaternion.normalize().conjugateInPlace()),E=s;E<=u;E++){var k=o._keys[E];if(!E||o.dataType===e.ANIMATIONTYPE_FLOAT||k.value!==l.value)switch(o.dataType){case e.ANIMATIONTYPE_MATRIX:k.value.decompose(h.keyScaling,h.keyQuaternion,h.keyPosition),h.keyPosition.subtractInPlace(h.referencePosition),h.keyScaling.divideInPlace(h.referenceScaling),h.referenceQuaternion.multiplyToRef(h.keyQuaternion,h.keyQuaternion),Je.y3.ComposeToRef(h.keyScaling,h.keyQuaternion,h.keyPosition,k.value);break;case e.ANIMATIONTYPE_QUATERNION:h.referenceValue.multiplyToRef(k.value,k.value);break;case e.ANIMATIONTYPE_VECTOR2:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:case e.ANIMATIONTYPE_COLOR4:k.value.subtractToRef(h.referenceValue,k.value);break;case e.ANIMATIONTYPE_SIZE:k.value.width-=h.referenceValue.width,k.value.height-=h.referenceValue.height;break;default:k.value-=h.referenceValue}}return o}},{key:"TransitionTo",value:function(e,t,n,i,r,a,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(o<=0)return n[e]=t,s&&s(),null;var l=r*(o/1e3);a.setKeys([{frame:0,value:n[e].clone?n[e].clone():n[e]},{frame:l,value:t}]),n.animations||(n.animations=[]),n.animations.push(a);var u=i.beginAnimation(n,0,l,!1);return u.onAnimationEnd=s,u}},{key:"_UniversalLerp",value:function(e,t,n){var i=e.constructor;return i.Lerp?i.Lerp(e,t,n):i.Slerp?i.Slerp(e,t,n):e.toFixed?e*(1-n)+n*t:t}},{key:"Parse",value:function(t){var n,i,r=new e(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),a=t.dataType,o=[];for(t.enableBlending&&(r.enableBlending=t.enableBlending),t.blendingSpeed&&(r.blendingSpeed=t.blendingSpeed),i=0;i<t.keys.length;i++){var s=t.keys[i],l=void 0,u=void 0,c=void 0;switch(a){case e.ANIMATIONTYPE_FLOAT:n=s.values[0],s.values.length>=2&&(l=s.values[1]),s.values.length>=3&&(u=s.values[2]),s.values.length>=4&&(c=s.values[3]);break;case e.ANIMATIONTYPE_QUATERNION:if(n=Je._f.FromArray(s.values),s.values.length>=8){var h=Je._f.FromArray(s.values.slice(4,8));h.equals(Je._f.Zero())||(l=h)}if(s.values.length>=12){var f=Je._f.FromArray(s.values.slice(8,12));f.equals(Je._f.Zero())||(u=f)}s.values.length>=13&&(c=s.values[12]);break;case e.ANIMATIONTYPE_MATRIX:n=Je.y3.FromArray(s.values),s.values.length>=17&&(c=s.values[16]);break;case e.ANIMATIONTYPE_COLOR3:n=$e.Wo.FromArray(s.values),s.values[3]&&(l=$e.Wo.FromArray(s.values[3])),s.values[4]&&(u=$e.Wo.FromArray(s.values[4])),s.values[5]&&(c=s.values[5]);break;case e.ANIMATIONTYPE_COLOR4:n=$e.HE.FromArray(s.values),s.values[4]&&(l=$e.HE.FromArray(s.values[4])),s.values[5]&&(u=$e.HE.FromArray(s.values[5])),s.values[6]&&(c=$e.HE.FromArray(s.values[6]));break;case e.ANIMATIONTYPE_VECTOR3:default:n=Je.P.FromArray(s.values),s.values[3]&&(l=Je.P.FromArray(s.values[3])),s.values[4]&&(u=Je.P.FromArray(s.values[4])),s.values[5]&&(c=s.values[5])}var d={};d.frame=s.frame,d.value=n,null!=l&&(d.inTangent=l),null!=u&&(d.outTangent=u),null!=c&&(d.interpolation=c),o.push(d)}if(r.setKeys(o),t.ranges)for(i=0;i<t.ranges.length;i++)n=t.ranges[i],r.createRange(n.name,n.from,n.to);return r}},{key:"AppendSerializedAnimations",value:function(e,t){_t.p4.AppendSerializedAnimations(e,t)}},{key:"ParseFromFileAsync",value:function(e,t){var n=this;return new Promise((function(i,r){var a=new xt.g;a.addEventListener("readystatechange",(function(){if(4==a.readyState)if(200==a.status){var t=JSON.parse(a.responseText);if(t.animations&&(t=t.animations),t.length){var o,s=new Array,l=Dt(t);try{for(l.s();!(o=l.n()).done;){var u=o.value;s.push(n.Parse(u))}}catch(h){l.e(h)}finally{l.f()}i(s)}else{var c=n.Parse(t);e&&(c.name=e),i(c)}}else r("Unable to load the animation")})),a.open("GET",t),a.send()}))}},{key:"ParseFromSnippetAsync",value:function(e){var t=this;return new Promise((function(n,i){var r=new xt.g;r.addEventListener("readystatechange",(function(){if(4==r.readyState)if(200==r.status){var a=JSON.parse(JSON.parse(r.responseText).jsonPayload);if(a.animations){var o,s=JSON.parse(a.animations),l=new Array,u=Dt(s.animations);try{for(u.s();!(o=u.n()).done;){var c=o.value,h=t.Parse(c);h.snippetId=e,l.push(h)}}catch(v){u.e(v)}finally{u.f()}n(l)}else{var f=JSON.parse(a.animation),d=t.Parse(f);d.snippetId=e,n(d)}}else i("Unable to load the snippet "+e)})),r.open("GET",t.SnippetUrl+"/"+e.replace(/#/g,"/")),r.send()}))}}]),e}();kt._UniqueIdGenerator=0,kt.AllowMatricesInterpolation=!1,kt.AllowMatrixDecomposeForInterpolation=!0,kt.SnippetUrl="https://snippet.babylonjs.com",kt.ANIMATIONTYPE_FLOAT=0,kt.ANIMATIONTYPE_VECTOR3=1,kt.ANIMATIONTYPE_QUATERNION=2,kt.ANIMATIONTYPE_MATRIX=3,kt.ANIMATIONTYPE_COLOR3=4,kt.ANIMATIONTYPE_COLOR4=7,kt.ANIMATIONTYPE_VECTOR2=5,kt.ANIMATIONTYPE_SIZE=6,kt.ANIMATIONLOOPMODE_RELATIVE=0,kt.ANIMATIONLOOPMODE_CYCLE=1,kt.ANIMATIONLOOPMODE_CONSTANT=2,kt.CreateFromSnippetAsync=kt.ParseFromSnippetAsync,(0,Pt.H)("BABYLON.Animation",kt),mt.N._AnimationRangeFactory=function(e,t,n){return new Ct(e,t,n)};var Ot=function(){function e(){(0,st.Z)(this,e),this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return(0,lt.Z)(e,[{key:"name",get:function(){return"Bouncing"}},{key:"autoTransitionRange",get:function(){return this._autoTransitionRange},set:function(e){var t=this;if(this._autoTransitionRange!==e){this._autoTransitionRange=e;var n=this._attachedCamera;n&&(e?this._onMeshTargetChangedObserver=n.onMeshTargetChangedObservable.add((function(e){if(e){e.computeWorldMatrix(!0);var n=e.getBoundingInfo().diagonalLength;t.lowerRadiusTransitionRange=.05*n,t.upperRadiusTransitionRange=.05*n}})):this._onMeshTargetChangedObserver&&n.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}}},{key:"init",value:function(){}},{key:"attach",value:function(e){var t=this;this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((function(){t._attachedCamera&&(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))}))}},{key:"detach",value:function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}},{key:"_isRadiusAtLimit",value:function(e){return!!this._attachedCamera&&(this._attachedCamera.radius===e&&!this._radiusIsAnimating)}},{key:"_applyBoundRadiusAnimation",value:function(t){var n=this;if(this._attachedCamera){this._radiusBounceTransition||(e.EasingFunction.setEasingMode(e.EasingMode),this._radiusBounceTransition=kt.CreateAnimation("radius",kt.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var i=kt.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(function(){return n._clearAnimationLocks()}));i&&this._animatables.push(i)}}},{key:"_clearAnimationLocks",value:function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}},{key:"stopAllAnimations",value:function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}]),e}();Ot.EasingFunction=new Mt(.3),Ot.EasingMode=Tt.EASINGMODE_EASEOUT;var Lt=function(){function e(){(0,st.Z)(this,e),this.onTargetFramingAnimationEndObservable=new gt.y$,this._mode=e.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return(0,lt.Z)(e,[{key:"name",get:function(){return"Framing"}},{key:"mode",get:function(){return this._mode},set:function(e){this._mode=e}},{key:"radiusScale",get:function(){return this._radiusScale},set:function(e){this._radiusScale=e}},{key:"positionScale",get:function(){return this._positionScale},set:function(e){this._positionScale=e}},{key:"defaultElevation",get:function(){return this._defaultElevation},set:function(e){this._defaultElevation=e}},{key:"elevationReturnTime",get:function(){return this._elevationReturnTime},set:function(e){this._elevationReturnTime=e}},{key:"elevationReturnWaitTime",get:function(){return this._elevationReturnWaitTime},set:function(e){this._elevationReturnWaitTime=e}},{key:"zoomStopsAnimation",get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e}},{key:"framingTime",get:function(){return this._framingTime},set:function(e){this._framingTime=e}},{key:"init",value:function(){}},{key:"attach",value:function(t){var n=this;this._attachedCamera=t;var i=this._attachedCamera.getScene();e.EasingFunction.setEasingMode(e.EasingMode),this._onPrePointerObservableObserver=i.onPrePointerObservable.add((function(e){e.type!==yt.kD.POINTERDOWN?e.type===yt.kD.POINTERUP&&(n._isPointerDown=!1):n._isPointerDown=!0})),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((function(e){e&&n.zoomOnMesh(e,void 0,(function(){n.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((function(){n._applyUserInteraction(),n._maintainCameraAboveGround()}))}},{key:"detach",value:function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}}},{key:"zoomOnMesh",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.computeWorldMatrix(!0);var i=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(i.minimumWorld,i.maximumWorld,t,n)}},{key:"zoomOnMeshHierarchy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.computeWorldMatrix(!0);var i=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(i.min,i.max,t,n)}},{key:"zoomOnMeshesHierarchy",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=new Je.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new Je.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=0;a<e.length;a++){var o=e[a].getHierarchyBoundingVectors(!0);Je.P.CheckExtends(o.min,i,r),Je.P.CheckExtends(o.max,i,r)}this.zoomOnBoundingInfo(i,r,t,n)}},{key:"zoomOnBoundingInfo",value:function(t,n){var i,r=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._attachedCamera){var s=t.y,l=n.y,u=s+(l-s)*this._positionScale,c=n.subtract(t).scale(.5);if(a)i=new Je.P(0,u,0);else{var h=t.add(c);i=new Je.P(h.x,u,h.z)}this._vectorTransition||(this._vectorTransition=kt.CreateAnimation("target",kt.ANIMATIONTYPE_VECTOR3,60,e.EasingFunction)),this._betaIsAnimating=!0;var f=kt.TransitionTo("target",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);f&&this._animatables.push(f);var d=0;if(this._mode===e.FitFrustumSidesMode){var v=this._calculateLowerRadiusFromModelBoundingSphere(t,n);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=c.length()+this._attachedCamera.minZ),d=v}else this._mode===e.IgnoreBoundsSizeMode&&(d=this._calculateLowerRadiusFromModelBoundingSphere(t,n),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var p=n.subtract(t).length();this._attachedCamera.panningSensibility=5e3/p,this._attachedCamera.wheelPrecision=100/d}this._radiusTransition||(this._radiusTransition=kt.CreateAnimation("radius",kt.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),(f=kt.TransitionTo("radius",d,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(function(){r.stopAllAnimations(),o&&o(),r._attachedCamera&&r._attachedCamera.useInputToRestoreState&&r._attachedCamera.storeState()})))&&this._animatables.push(f)}}},{key:"_calculateLowerRadiusFromModelBoundingSphere",value:function(t,n){var i=n.subtract(t).length(),r=this._getFrustumSlope(),a=.5*i*this._radiusScale,o=a*Math.sqrt(1+1/(r.x*r.x)),s=a*Math.sqrt(1+1/(r.y*r.y)),l=Math.max(o,s),u=this._attachedCamera;return u?(u.lowerRadiusLimit&&this._mode===e.IgnoreBoundsSizeMode&&(l=l<u.lowerRadiusLimit?u.lowerRadiusLimit:l),u.upperRadiusLimit&&(l=l>u.upperRadiusLimit?u.upperRadiusLimit:l),l):0}},{key:"_maintainCameraAboveGround",value:function(){var t=this;if(!(this._elevationReturnTime<0)){var n=At.F.Now-this._lastInteractionTime,i=.5*Math.PI-this._defaultElevation,r=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>r&&n>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=kt.CreateAnimation("beta",kt.ANIMATIONTYPE_FLOAT,60,e.EasingFunction));var a=kt.TransitionTo("beta",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(function(){t._clearAnimationLocks(),t.stopAllAnimations()}));a&&this._animatables.push(a)}}}},{key:"_getFrustumSlope",value:function(){var e=this._attachedCamera;if(!e)return Je.FM.Zero();var t=e.getScene().getEngine().getAspectRatio(e),n=Math.tan(e.fov/2),i=n*t;return new Je.FM(i,n)}},{key:"_clearAnimationLocks",value:function(){this._betaIsAnimating=!1}},{key:"_applyUserInteraction",value:function(){this.isUserIsMoving&&(this._lastInteractionTime=At.F.Now,this.stopAllAnimations(),this._clearAnimationLocks())}},{key:"stopAllAnimations",value:function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}},{key:"isUserIsMoving",get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}]),e}();Lt.EasingFunction=new It,Lt.EasingMode=Tt.EASINGMODE_EASEINOUT,Lt.IgnoreBoundsSizeMode=0,Lt.FitFrustumSidesMode=1;var Ft=n(7337);function Nt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}var wt=function(e){(0,ft.Z)(n,e);var t=Nt(n);function n(e,i,r){var a,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return(0,st.Z)(this,n),(a=t.call(this,e,i,r,o))._tmpUpVector=Je.P.Zero(),a._tmpTargetVector=Je.P.Zero(),a.cameraDirection=new Je.P(0,0,0),a.cameraRotation=new Je.FM(0,0),a.ignoreParentScaling=!1,a.updateUpVectorFromRotation=!1,a._tmpQuaternion=new Je._f,a.rotation=new Je.P(0,0,0),a.speed=2,a.noRotationConstraint=!1,a.invertRotation=!1,a.inverseRotationSpeed=.2,a.lockedTarget=null,a._currentTarget=Je.P.Zero(),a._initialFocalDistance=1,a._viewMatrix=Je.y3.Zero(),a._camMatrix=Je.y3.Zero(),a._cameraTransformMatrix=Je.y3.Zero(),a._cameraRotationMatrix=Je.y3.Zero(),a._referencePoint=new Je.P(0,0,1),a._transformedReferencePoint=Je.P.Zero(),a._defaultUp=Je.P.Up(),a._cachedRotationZ=0,a._cachedQuaternionRotationZ=0,a}return(0,lt.Z)(n,[{key:"getFrontPosition",value:function(e){this.getWorldMatrix();var t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)}},{key:"_getLockedTargetPosition",value:function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null}},{key:"storeState",value:function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),(0,ht.Z)((0,vt.Z)(n.prototype),"storeState",this).call(this)}},{key:"_restoreStateValues",value:function(){return!!(0,ht.Z)((0,vt.Z)(n.prototype),"_restoreStateValues",this).call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}},{key:"_initCache",value:function(){(0,ht.Z)((0,vt.Z)(n.prototype),"_initCache",this).call(this),this._cache.lockedTarget=new Je.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new Je.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new Je._f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}},{key:"_updateCache",value:function(e){e||(0,ht.Z)((0,vt.Z)(n.prototype),"_updateCache",this).call(this);var t=this._getLockedTargetPosition();t?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(t):this._cache.lockedTarget=t.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}},{key:"_isSynchronizedViewMatrix",value:function(){if(!(0,ht.Z)((0,vt.Z)(n.prototype),"_isSynchronizedViewMatrix",this).call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}},{key:"_computeLocalCameraSpeed",value:function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))}},{key:"setTarget",value:function(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=rt.kn),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),Je.y3.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var t=e.subtract(this.position);t.x>=0?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&Je._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}},{key:"target",get:function(){return this.getTarget()},set:function(e){this.setTarget(e)}},{key:"getTarget",value:function(){return this._currentTarget}},{key:"_decideIfNeedsToMove",value:function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}},{key:"_updatePosition",value:function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(Je.jp.Matrix[0]),Je.P.TransformNormalToRef(this.cameraDirection,Je.jp.Matrix[0],Je.jp.Vector3[0]),void this.position.addInPlace(Je.jp.Vector3[0]);this.position.addInPlace(this.cameraDirection)}},{key:"_checkInputs",value:function(){var e=this.invertRotation?-this.inverseRotationSpeed:1,t=this._decideIfNeedsToMove(),i=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(t&&this._updatePosition(),i){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*e,this.rotation.y+=this.cameraRotation.y*e,!this.noRotationConstraint){var r=1.570796;this.rotation.x>r&&(this.rotation.x=r),this.rotation.x<-r&&(this.rotation.x=-r)}if(this.rotationQuaternion)this.rotation.lengthSquared()&&Je._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}t&&(Math.abs(this.cameraDirection.x)<this.speed*rt.kn&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*rt.kn&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*rt.kn&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*rt.kn&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*rt.kn&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),(0,ht.Z)((0,vt.Z)(n.prototype),"_checkInputs",this).call(this)}},{key:"_updateCameraRotationMatrix",value:function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):Je.y3.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}},{key:"_rotateUpVectorWithCameraRotationMatrix",value:function(){return Je.P.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}},{key:"_getViewMatrix",value:function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),Je.P.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?it.RD.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(Je._f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),it.RD.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}},{key:"_computeViewMatrix",value:function(e,t,n){if(this.ignoreParentScaling){if(this.parent){var i=this.parent.getWorldMatrix();Je.P.TransformCoordinatesToRef(e,i,this._globalPosition),Je.P.TransformCoordinatesToRef(t,i,this._tmpTargetVector),Je.P.TransformNormalToRef(n,i,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(t),this._tmpUpVector.copyFrom(n);this.getScene().useRightHandedSystem?Je.y3.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):Je.y3.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?Je.y3.LookAtRHToRef(e,t,n,this._viewMatrix):Je.y3.LookAtLHToRef(e,t,n,this._viewMatrix),this.parent){var r=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(r,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e)}},{key:"createRigCamera",value:function(e,t){if(this.cameraRigMode!==Ft.V.RIG_MODE_NONE){var i=new n(e,this.position.clone(),this.getScene());return i.isRigCamera=!0,i.rigParent=this,this.cameraRigMode!==Ft.V.RIG_MODE_VR&&this.cameraRigMode!==Ft.V.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new Je._f),i._cameraRigParams={},i.rotationQuaternion=new Je._f),i.mode=this.mode,i.orthoLeft=this.orthoLeft,i.orthoRight=this.orthoRight,i.orthoTop=this.orthoTop,i.orthoBottom=this.orthoBottom,i}return null}},{key:"_updateRigCameras",value:function(){var e=this._rigCameras[0],t=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case Ft.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Ft.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Ft.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Ft.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Ft.V.RIG_MODE_STEREOSCOPIC_INTERLACED:var i=this.cameraRigMode===Ft.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,r=this.cameraRigMode===Ft.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,t);break;case Ft.V.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),t.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),t.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),t.position.copyFrom(this.position)}(0,ht.Z)((0,vt.Z)(n.prototype),"_updateRigCameras",this).call(this)}},{key:"_getRigCamPositionAndTarget",value:function(e,t){this.getTarget().subtractToRef(this.position,n._TargetFocalPoint),n._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var i=n._TargetFocalPoint.addInPlace(this.position);Je.y3.TranslationToRef(-i.x,-i.y,-i.z,n._TargetTransformMatrix),n._TargetTransformMatrix.multiplyToRef(Je.y3.RotationAxis(t.upVector,e),n._RigCamTransformMatrix),Je.y3.TranslationToRef(i.x,i.y,i.z,n._TargetTransformMatrix),n._RigCamTransformMatrix.multiplyToRef(n._TargetTransformMatrix,n._RigCamTransformMatrix),Je.P.TransformCoordinatesToRef(this.position,n._RigCamTransformMatrix,t.position),t.setTarget(i)}},{key:"getClassName",value:function(){return"TargetCamera"}}]),n}(Ft.V);wt._RigCamTransformMatrix=new Je.y3,wt._TargetTransformMatrix=new Je.y3,wt._TargetFocalPoint=new Je.P,(0,pt.gn)([(0,_t.hd)()],wt.prototype,"rotation",void 0),(0,pt.gn)([(0,_t.qC)()],wt.prototype,"speed",void 0),(0,pt.gn)([(0,_t.RR)("lockedTargetId")],wt.prototype,"lockedTarget",void 0);var Bt=n(2328),Ut={},Vt=function(){function e(t){(0,st.Z)(this,e),this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=function(){}}return(0,lt.Z)(e,[{key:"add",value:function(e){var t=e.getSimpleName();this.attached[t]?Bt.Y.Warn("camera input of type "+t+" already exists on camera"):(this.attached[t]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedToElement&&e.attachControl(this.noPreventDefault))}},{key:"remove",value:function(e){for(var t in this.attached){var n=this.attached[t];n===e&&(n.detachControl(),n.camera=null,delete this.attached[t],this.rebuildInputCheck())}}},{key:"removeByType",value:function(e){for(var t in this.attached){var n=this.attached[t];n.getClassName()===e&&(n.detachControl(),n.camera=null,delete this.attached[t],this.rebuildInputCheck())}}},{key:"_addCheckInputs",value:function(e){var t=this.checkInputs;return function(){t(),e()}}},{key:"attachInput",value:function(e){this.attachedToElement&&e.attachControl(this.noPreventDefault)}},{key:"attachElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement)for(var t in e=!Ft.V.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedToElement=!0,this.noPreventDefault=e,this.attached)this.attached[t].attachControl(e)}},{key:"detachElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t in this.attached)this.attached[t].detachControl(),e&&(this.attached[t].camera=null);this.attachedToElement=!1}},{key:"rebuildInputCheck",value:function(){for(var e in this.checkInputs=function(){},this.attached){var t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}}},{key:"clear",value:function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}}},{key:"serialize",value:function(e){var t={};for(var n in this.attached){var i=this.attached[n],r=_t.p4.Serialize(i);t[i.getClassName()]=r}e.inputsmgr=t}},{key:"parse",value:function(e){var t=this,n=e.inputsmgr;if(n){this.clear();var i=function(e){var i=Ut[e];if(i){var r=n[e],a=_t.p4.Parse((function(){return new i}),r,null);t.add(a)}};for(var r in n)i(r)}else{var a=function(n){var i=Ut[t.attached[n].getClassName()];if(i){var r=_t.p4.Parse((function(){return new i}),e,null);t.remove(t.attached[n]),t.add(r)}};for(var o in this.attached)a(o)}}}]),e}(),Wt=n(8517),Gt=function(){function e(){(0,st.Z)(this,e),this._currentActiveButton=-1,this.buttons=[0,1,2]}return(0,lt.Z)(e,[{key:"attachControl",value:function(e){var t=this;e=Wt.w1.BackCompatCameraNoPreventDefault(arguments);var n=this.camera.getEngine(),i=n.getInputElement(),r=0,a=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(o){var s=o.event,l="touch"===s.pointerType;if(!n.isInVRExclusivePointerMode&&(o.type===yt.kD.POINTERMOVE||-1!==t.buttons.indexOf(s.button))){var u=s.target;if(t._altKey=s.altKey,t._ctrlKey=s.ctrlKey,t._metaKey=s.metaKey,t._shiftKey=s.shiftKey,t._buttonsPressed=s.buttons,n.isPointerLock){var c=s.movementX,h=s.movementY;t.onTouch(null,c,h),t._pointA=null,t._pointB=null}else if(o.type!==yt.kD.POINTERDOWN||-1!==t._currentActiveButton&&!l)if(o.type===yt.kD.POINTERDOUBLETAP)t.onDoubleTap(s.pointerType);else if(o.type!==yt.kD.POINTERUP||t._currentActiveButton!==s.button&&!l){if(o.type===yt.kD.POINTERMOVE)if(e||s.preventDefault(),t._pointA&&null===t._pointB){var f=s.clientX-t._pointA.x,d=s.clientY-t._pointA.y;t.onTouch(t._pointA,f,d),t._pointA.x=s.clientX,t._pointA.y=s.clientY}else if(t._pointA&&t._pointB){var v=t._pointA.pointerId===s.pointerId?t._pointA:t._pointB;v.x=s.clientX,v.y=s.clientY;var p=t._pointA.x-t._pointB.x,_=t._pointA.y-t._pointB.y,g=p*p+_*_,m={x:(t._pointA.x+t._pointB.x)/2,y:(t._pointA.y+t._pointB.y)/2,pointerId:s.pointerId,type:o.type};t.onMultiTouch(t._pointA,t._pointB,r,g,a,m),a=m,r=g}}else{try{null==u||u.releasePointerCapture(s.pointerId)}catch(y){}l||(t._pointB=null),n._badOS?t._pointA=t._pointB=null:t._pointB&&t._pointA&&t._pointA.pointerId==s.pointerId?(t._pointA=t._pointB,t._pointB=null):t._pointA&&t._pointB&&t._pointB.pointerId==s.pointerId?t._pointB=null:t._pointA=t._pointB=null,(0!==r||a)&&(t.onMultiTouch(t._pointA,t._pointB,r,0,a,null),r=0,a=null),t._currentActiveButton=-1,t.onButtonUp(s),e||s.preventDefault()}else{try{null==u||u.setPointerCapture(s.pointerId)}catch(y){}null===t._pointA?t._pointA={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType}:null===t._pointB&&(t._pointB={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType}),-1!==t._currentActiveButton||l||(t._currentActiveButton=s.button),t.onButtonDown(s),e||(s.preventDefault(),i&&i.focus())}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,yt.kD.POINTERDOWN|yt.kD.POINTERUP|yt.kD.POINTERMOVE|yt.kD.POINTERDOUBLETAP),this._onLostFocus=function(){t._pointA=t._pointB=null,r=0,a=null,t.onLostFocus()},this._contextMenuBind=this.onContextMenu.bind(this),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);var o=this.camera.getScene().getEngine().getHostWindow();o&&Wt.w1.RegisterTopRootEvents(o,[{name:"blur",handler:this._onLostFocus}])}},{key:"detachControl",value:function(){if(this._onLostFocus){var e=this.camera.getScene().getEngine().getHostWindow();e&&Wt.w1.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._contextMenuBind){var t=this.camera.getScene().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}},{key:"getClassName",value:function(){return"BaseCameraPointersInput"}},{key:"getSimpleName",value:function(){return"pointers"}},{key:"onDoubleTap",value:function(e){}},{key:"onTouch",value:function(e,t,n){}},{key:"onMultiTouch",value:function(e,t,n,i,r,a){}},{key:"onContextMenu",value:function(e){e.preventDefault()}},{key:"onButtonDown",value:function(e){}},{key:"onButtonUp",value:function(e){}},{key:"onLostFocus",value:function(){}}]),e}();function Xt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}(0,pt.gn)([(0,_t.qC)()],Gt.prototype,"buttons",void 0);var zt=function(e){(0,ft.Z)(n,e);var t=Xt(n);function n(){var e;return(0,st.Z)(this,n),(e=t.apply(this,arguments)).buttons=[0,1,2],e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.pinchPrecision=12,e.pinchDeltaPercentage=0,e.useNaturalPinchZoom=!1,e.pinchZoom=!0,e.panningSensibility=1e3,e.multiTouchPanning=!0,e.multiTouchPanAndZoom=!0,e.pinchInwards=!0,e._isPanClick=!1,e._twoFingerActivityCount=0,e._isPinching=!1,e}return(0,lt.Z)(n,[{key:"getClassName",value:function(){return"ArcRotateCameraPointersInput"}},{key:"_computeMultiTouchPanning",value:function(e,t){if(0!==this.panningSensibility&&e&&t){var n=t.x-e.x,i=t.y-e.y;this.camera.inertialPanningX+=-n/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility}}},{key:"_computePinchZoom",value:function(e,t){var i=this.camera.radius||n.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(e)/Math.sqrt(t):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(t-e)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(t-e)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}},{key:"onTouch",value:function(e,t,n){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=n/this.angularSensibilityY)}},{key:"onDoubleTap",value:function(){this.camera.useInputToRestoreState&&this.camera.restoreState()}},{key:"onMultiTouch",value:function(e,t,n,i,r,a){0===n&&null===r||0===i&&null===a||(this.multiTouchPanAndZoom?(this._computePinchZoom(n,i),this._computeMultiTouchPanning(r,a)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(i)-Math.sqrt(n))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(n,i),this._isPinching=!0):this._computeMultiTouchPanning(r,a)):this.multiTouchPanning?this._computeMultiTouchPanning(r,a):this.pinchZoom&&this._computePinchZoom(n,i))}},{key:"onButtonDown",value:function(e){this._isPanClick=e.button===this.camera._panningMouseButton}},{key:"onButtonUp",value:function(){this._twoFingerActivityCount=0,this._isPinching=!1}},{key:"onLostFocus",value:function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}]),n}(Gt);zt.MinimumRadiusForPinch=.001,(0,pt.gn)([(0,_t.qC)()],zt.prototype,"buttons",void 0),(0,pt.gn)([(0,_t.qC)()],zt.prototype,"angularSensibilityX",void 0),(0,pt.gn)([(0,_t.qC)()],zt.prototype,"angularSensibilityY",void 0),(0,pt.gn)([(0,_t.qC)()],zt.prototype,"pinchPrecision",void 0),(0,pt.gn)([(0,_t.qC)()],zt.prototype,"pinchDeltaPercentage",void 0),(0,pt.gn)([(0,_t.qC)()],zt.prototype,"useNaturalPinchZoom",void 0),(0,pt.gn)([(0,_t.qC)()],zt.prototype,"pinchZoom",void 0),(0,pt.gn)([(0,_t.qC)()],zt.prototype,"panningSensibility",void 0),(0,pt.gn)([(0,_t.qC)()],zt.prototype,"multiTouchPanning",void 0),(0,pt.gn)([(0,_t.qC)()],zt.prototype,"multiTouchPanAndZoom",void 0),Ut.ArcRotateCameraPointersInput=zt;var Ht=n(3531),Zt=function(){function e(){(0,st.Z)(this,e),this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return(0,lt.Z)(e,[{key:"attachControl",value:function(e){var t=this;e=Wt.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){t._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(n){var i=n.event;if(!i.metaKey)if(n.type===Ht.OG.KEYDOWN)t._ctrlPressed=i.ctrlKey,t._altPressed=i.altKey,(-1!==t.keysUp.indexOf(i.keyCode)||-1!==t.keysDown.indexOf(i.keyCode)||-1!==t.keysLeft.indexOf(i.keyCode)||-1!==t.keysRight.indexOf(i.keyCode)||-1!==t.keysReset.indexOf(i.keyCode))&&(-1===t._keys.indexOf(i.keyCode)&&t._keys.push(i.keyCode),i.preventDefault&&(e||i.preventDefault()));else if(-1!==t.keysUp.indexOf(i.keyCode)||-1!==t.keysDown.indexOf(i.keyCode)||-1!==t.keysLeft.indexOf(i.keyCode)||-1!==t.keysRight.indexOf(i.keyCode)||-1!==t.keysReset.indexOf(i.keyCode)){var r=t._keys.indexOf(i.keyCode);r>=0&&t._keys.splice(r,1),i.preventDefault&&(e||i.preventDefault())}})))}},{key:"detachControl",value:function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}},{key:"checkInputs",value:function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var n=this._keys[t];-1!==this.keysLeft.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(n)&&e.useInputToRestoreState&&e.restoreState()}}},{key:"getClassName",value:function(){return"ArcRotateCameraKeyboardMoveInput"}},{key:"getSimpleName",value:function(){return"keyboard"}}]),e}();(0,pt.gn)([(0,_t.qC)()],Zt.prototype,"keysUp",void 0),(0,pt.gn)([(0,_t.qC)()],Zt.prototype,"keysDown",void 0),(0,pt.gn)([(0,_t.qC)()],Zt.prototype,"keysLeft",void 0),(0,pt.gn)([(0,_t.qC)()],Zt.prototype,"keysRight",void 0),(0,pt.gn)([(0,_t.qC)()],Zt.prototype,"keysReset",void 0),(0,pt.gn)([(0,_t.qC)()],Zt.prototype,"panningSensibility",void 0),(0,pt.gn)([(0,_t.qC)()],Zt.prototype,"zoomingSensibility",void 0),(0,pt.gn)([(0,_t.qC)()],Zt.prototype,"useAltToZoom",void 0),(0,pt.gn)([(0,_t.qC)()],Zt.prototype,"angularSpeed",void 0),Ut.ArcRotateCameraKeyboardMoveInput=Zt;var Yt=n(1187),Kt=function(){function e(){(0,st.Z)(this,e),this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._inertialPanning=Je.P.Zero()}return(0,lt.Z)(e,[{key:"_computeDeltaFromMouseWheelLegacyEvent",value:function(e,t){var n=.01*e*this.wheelDeltaPercentage*t;return e>0?n/(1+this.wheelDeltaPercentage):n*(1+this.wheelDeltaPercentage)}},{key:"attachControl",value:function(e){var t=this;e=Wt.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(n){if(n.type===yt.kD.POINTERWHEEL){var i=n.event,r=0,a=i.deltaMode===Yt.G.DOM_DELTA_LINE?40:1,o=-i.deltaY*a;if(t.customComputeDeltaFromMouseWheel)r=t.customComputeDeltaFromMouseWheel(o,t,i);else if(t.wheelDeltaPercentage){if((r=t._computeDeltaFromMouseWheelLegacyEvent(o,t.camera.radius))>0){for(var s=t.camera.radius,l=t.camera.inertialRadiusOffset+r,u=0;u<20&&Math.abs(l)>.001;u++)s-=l,l*=t.camera.inertia;s=at.R.Clamp(s,0,Number.MAX_VALUE),r=t._computeDeltaFromMouseWheelLegacyEvent(o,s)}}else r=o/(40*t.wheelPrecision);r&&(t.zoomToMouseLocation&&t._hitPlane?t._zoomToMouse(r):t.camera.inertialRadiusOffset+=r),i.preventDefault&&(e||i.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,yt.kD.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}},{key:"detachControl",value:function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)}},{key:"checkInputs",value:function(){if(this.zoomToMouseLocation){var e=this.camera;0+e.inertialAlphaOffset+e.inertialBetaOffset+e.inertialRadiusOffset&&(this._updateHitPlane(),e.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(e.inertia),this._zeroIfClose(this._inertialPanning))}}},{key:"getClassName",value:function(){return"ArcRotateCameraMouseWheelInput"}},{key:"getSimpleName",value:function(){return"mousewheel"}},{key:"_updateHitPlane",value:function(){var e=this.camera,t=e.target.subtract(e.position);this._hitPlane=ot.J.FromPositionAndNormal(e.target,t)}},{key:"_getPosition",value:function(){var e,t=this.camera,n=t.getScene(),i=n.createPickingRay(n.pointerX,n.pointerY,Je.y3.Identity(),t,!1),r=0;this._hitPlane&&(r=null!==(e=i.intersectsPlane(this._hitPlane))&&void 0!==e?e:0);return i.origin.addInPlace(i.direction.scaleInPlace(r))}},{key:"_zoomToMouse",value:function(e){var t=this.camera,n=1-t.inertia;if(t.lowerRadiusLimit){var i,r=null!==(i=t.lowerRadiusLimit)&&void 0!==i?i:0;t.radius-(t.inertialRadiusOffset+e)/n<r&&(e=(t.radius-r)*n-t.inertialRadiusOffset)}if(t.upperRadiusLimit){var a,o=null!==(a=t.upperRadiusLimit)&&void 0!==a?a:0;t.radius-(t.inertialRadiusOffset+e)/n>o&&(e=(t.radius-o)*n-t.inertialRadiusOffset)}var s=e/n/t.radius,l=this._getPosition(),u=Je.jp.Vector3[6];l.subtractToRef(t.target,u),u.scaleInPlace(s),u.scaleInPlace(n),this._inertialPanning.addInPlace(u),t.inertialRadiusOffset+=e}},{key:"_zeroIfClose",value:function(e){Math.abs(e.x)<rt.kn&&(e.x=0),Math.abs(e.y)<rt.kn&&(e.y=0),Math.abs(e.z)<rt.kn&&(e.z=0)}}]),e}();function jt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}(0,pt.gn)([(0,_t.qC)()],Kt.prototype,"wheelPrecision",void 0),(0,pt.gn)([(0,_t.qC)()],Kt.prototype,"zoomToMouseLocation",void 0),(0,pt.gn)([(0,_t.qC)()],Kt.prototype,"wheelDeltaPercentage",void 0),Ut.ArcRotateCameraMouseWheelInput=Kt;var qt=function(e){(0,ft.Z)(n,e);var t=jt(n);function n(e){return(0,st.Z)(this,n),t.call(this,e)}return(0,lt.Z)(n,[{key:"addMouseWheel",value:function(){return this.add(new Kt),this}},{key:"addPointers",value:function(){return this.add(new zt),this}},{key:"addKeyboard",value:function(){return this.add(new Zt),this}}]),n}(Vt);function Qt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}mt.N.AddNodeConstructor("ArcRotateCamera",(function(e,t){return function(){return new Jt(e,0,0,1,Je.P.Zero(),t)}}));var Jt=function(e){(0,ft.Z)(n,e);var t=Qt(n);function n(e,i,r,a,o,s){var l,u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return(0,st.Z)(this,n),(l=t.call(this,e,Je.P.Zero(),s,u)).inertialAlphaOffset=0,l.inertialBetaOffset=0,l.inertialRadiusOffset=0,l.lowerAlphaLimit=null,l.upperAlphaLimit=null,l.lowerBetaLimit=.01,l.upperBetaLimit=Math.PI-.01,l.lowerRadiusLimit=null,l.upperRadiusLimit=null,l.inertialPanningX=0,l.inertialPanningY=0,l.pinchToPanMaxDistance=20,l.panningDistanceLimit=null,l.panningOriginTarget=Je.P.Zero(),l.panningInertia=.9,l.zoomOnFactor=1,l.targetScreenOffset=Je.FM.Zero(),l.allowUpsideDown=!0,l.useInputToRestoreState=!0,l._viewMatrix=new Je.y3,l.panningAxis=new Je.P(1,1,0),l._transformedDirection=new Je.P,l.mapPanning=!1,l.onMeshTargetChangedObservable=new gt.y$,l.checkCollisions=!1,l.collisionRadius=new Je.P(.5,.5,.5),l._previousPosition=Je.P.Zero(),l._collisionVelocity=Je.P.Zero(),l._newPosition=Je.P.Zero(),l._computationVector=Je.P.Zero(),l._onCollisionPositionChange=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n?(l.setPosition(t),l.onCollide&&l.onCollide(n)):l._previousPosition.copyFrom(l._position);var i=Math.cos(l.alpha),r=Math.sin(l.alpha),a=Math.cos(l.beta),o=Math.sin(l.beta);0===o&&(o=1e-4);var s=l._getTargetPosition();l._computationVector.copyFromFloats(l.radius*i*o,l.radius*a,l.radius*r*o),s.addToRef(l._computationVector,l._newPosition),l._position.copyFrom(l._newPosition);var u=l.upVector;l.allowUpsideDown&&l.beta<0&&(u=(u=u.clone()).negate()),l._computeViewMatrix(l._position,s,u),l._viewMatrix.addAtIndex(12,l.targetScreenOffset.x),l._viewMatrix.addAtIndex(13,l.targetScreenOffset.y),l._collisionTriggered=!1},l._target=Je.P.Zero(),o&&l.setTarget(o),l.alpha=i,l.beta=r,l.radius=a,l.getViewMatrix(),l.inputs=new qt((0,ct.Z)(l)),l.inputs.addKeyboard().addMouseWheel().addPointers(),l}return(0,lt.Z)(n,[{key:"target",get:function(){return this._target},set:function(e){this.setTarget(e)}},{key:"targetHost",get:function(){return this._targetHost},set:function(e){e&&this.setTarget(e)}},{key:"getTarget",value:function(){return this.target}},{key:"position",get:function(){return this._position},set:function(e){this.setPosition(e)}},{key:"upVector",get:function(){return this._upVector},set:function(e){this._upToYMatrix||(this._yToUpMatrix=new Je.y3,this._upToYMatrix=new Je.y3,this._upVector=Je.P.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()}},{key:"setMatUp",value:function(){Je.y3.RotationAlignToRef(Je.P.UpReadOnly,this._upVector,this._yToUpMatrix),Je.y3.RotationAlignToRef(this._upVector,Je.P.UpReadOnly,this._upToYMatrix)}},{key:"angularSensibilityX",get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)}},{key:"angularSensibilityY",get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)}},{key:"pinchPrecision",get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)}},{key:"pinchDeltaPercentage",get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)}},{key:"useNaturalPinchZoom",get:function(){var e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom},set:function(e){var t=this.inputs.attached.pointers;t&&(t.useNaturalPinchZoom=e)}},{key:"panningSensibility",get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)}},{key:"keysUp",get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}},{key:"keysDown",get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}},{key:"keysLeft",get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}},{key:"keysRight",get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}},{key:"wheelPrecision",get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)}},{key:"zoomToMouseLocation",get:function(){var e=this.inputs.attached.mousewheel;return!!e&&e.zoomToMouseLocation},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.zoomToMouseLocation=e)}},{key:"wheelDeltaPercentage",get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)}},{key:"bouncingBehavior",get:function(){return this._bouncingBehavior}},{key:"useBouncingBehavior",get:function(){return null!=this._bouncingBehavior},set:function(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new Ot,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}},{key:"framingBehavior",get:function(){return this._framingBehavior}},{key:"useFramingBehavior",get:function(){return null!=this._framingBehavior},set:function(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new Lt,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}},{key:"autoRotationBehavior",get:function(){return this._autoRotationBehavior}},{key:"useAutoRotationBehavior",get:function(){return null!=this._autoRotationBehavior},set:function(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new Et,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}},{key:"_initCache",value:function(){(0,ht.Z)((0,vt.Z)(n.prototype),"_initCache",this).call(this),this._cache._target=new Je.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Je.FM.Zero()}},{key:"_updateCache",value:function(e){e||(0,ht.Z)((0,vt.Z)(n.prototype),"_updateCache",this).call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}},{key:"_getTargetPosition",value:function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}var t=this._getLockedTargetPosition();return t||this._target}},{key:"storeState",value:function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),(0,ht.Z)((0,vt.Z)(n.prototype),"storeState",this).call(this)}},{key:"_restoreStateValues",value:function(){return!!(0,ht.Z)((0,vt.Z)(n.prototype),"_restoreStateValues",this).call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}},{key:"_isSynchronizedViewMatrix",value:function(){return!!(0,ht.Z)((0,vt.Z)(n.prototype),"_isSynchronizedViewMatrix",this).call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}},{key:"attachControl",value:function(e,t){var n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments;t=Wt.w1.BackCompatCameraNoPreventDefault(a),this._useCtrlForPanning=i,this._panningMouseButton=r,"boolean"==typeof a[0]&&(a.length>1&&(this._useCtrlForPanning=a[1]),a.length>2&&(this._panningMouseButton=a[2])),this.inputs.attachElement(t),this._reset=function(){n.inertialAlphaOffset=0,n.inertialBetaOffset=0,n.inertialRadiusOffset=0,n.inertialPanningX=0,n.inertialPanningY=0}}},{key:"detachControl",value:function(){this.inputs.detachElement(),this._reset&&this._reset()}},{key:"_checkInputs",value:function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var e=this.invertRotation?-1:1,t=this.inertialAlphaOffset;this.beta<=0&&(t*=-1),this.getScene().useRightHandedSystem&&(t*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(t*=-1),this.alpha+=t*e,this.beta+=this.inertialBetaOffset*e,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<rt.kn&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<rt.kn&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*rt.kn&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){var i=new Je.P(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),i.multiplyInPlace(this.panningAxis),Je.P.TransformNormalToRef(i,this._cameraTransformMatrix,this._transformedDirection),!this.mapPanning&&this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),Je.P.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*rt.kn&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*rt.kn&&(this.inertialPanningY=0)}this._checkLimits(),(0,ht.Z)((0,vt.Z)(n.prototype),"_checkInputs",this).call(this)}}},{key:"_checkLimits",value:function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}},{key:"rebuildAnglesAndRadius",value:function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Je.P.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);var e=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var t=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=2*t*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}},{key:"setPosition",value:function(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())}},{key:"setTarget",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(r=null!==(t=this.overrideCloneAlphaBetaRadius)&&void 0!==t?t:r,e.getBoundingInfo)this._targetBoundingCenter=n?e.getBoundingInfo().boundingBox.centerWorld.clone():null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var a=e,o=this._getTargetPosition();if(o&&!i&&o.equals(a))return;this._targetHost=null,this._target=a,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}r||this.rebuildAnglesAndRadius()}},{key:"_getViewMatrix",value:function(){var e=Math.cos(this.alpha),t=Math.sin(this.alpha),n=Math.cos(this.beta),i=Math.sin(this.beta);0===i&&(i=1e-4),0===this.radius&&(this.radius=1e-4);var r=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*i,this.radius*n,this.radius*t*i),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Je.P.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),r.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var a=this.getScene().collisionCoordinator;this._collider||(this._collider=a.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,a.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var o=this.upVector;this.allowUpsideDown&&i<0&&(o=o.negate()),this._computeViewMatrix(this._position,r,o),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=r,this._viewMatrix}},{key:"zoomOn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e||this.getScene().meshes;var n=Ye.Kj.MinMax(e),i=Je.P.Distance(n.min,n.max);this.radius=i*this.zoomOnFactor,this.focusOn({min:n.min,max:n.max,distance:i},t)}},{key:"focusOn",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===e.min){var r=e||this.getScene().meshes;t=Ye.Kj.MinMax(r),n=Je.P.Distance(t.min,t.max)}else{var a=e;t=a,n=a.distance}this._target=Ye.Kj.Center(t),i||(this.maxZ=2*n)}},{key:"createRigCamera",value:function(e,t){var i=0;switch(this.cameraRigMode){case Ft.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Ft.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Ft.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Ft.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case Ft.V.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===t?1:-1);break;case Ft.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===t?-1:1)}var r=new n(e,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return r._cameraRigParams={},r.isRigCamera=!0,r.rigParent=this,r.upVector=this.upVector,r.mode=this.mode,r.orthoLeft=this.orthoLeft,r.orthoRight=this.orthoRight,r.orthoBottom=this.orthoBottom,r.orthoTop=this.orthoTop,r}},{key:"_updateRigCameras",value:function(){var e=this._rigCameras[0],t=this._rigCameras[1];switch(e.beta=t.beta=this.beta,this.cameraRigMode){case Ft.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Ft.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Ft.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Ft.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case Ft.V.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Ft.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}(0,ht.Z)((0,vt.Z)(n.prototype),"_updateRigCameras",this).call(this)}},{key:"dispose",value:function(){this.inputs.clear(),(0,ht.Z)((0,vt.Z)(n.prototype),"dispose",this).call(this)}},{key:"getClassName",value:function(){return"ArcRotateCamera"}}]),n}(wt);(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"alpha",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"beta",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"radius",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,pt.gn)([(0,_t.hd)("target")],Jt.prototype,"_target",void 0),(0,pt.gn)([(0,_t.RR)("targetHost")],Jt.prototype,"_targetHost",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"inertialAlphaOffset",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"inertialBetaOffset",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"inertialRadiusOffset",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"lowerAlphaLimit",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"upperAlphaLimit",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"lowerBetaLimit",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"upperBetaLimit",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"lowerRadiusLimit",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"upperRadiusLimit",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"inertialPanningX",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"inertialPanningY",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"pinchToPanMaxDistance",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"panningDistanceLimit",void 0),(0,pt.gn)([(0,_t.hd)()],Jt.prototype,"panningOriginTarget",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"panningInertia",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"zoomToMouseLocation",null),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"zoomOnFactor",void 0),(0,pt.gn)([(0,_t.QC)()],Jt.prototype,"targetScreenOffset",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"allowUpsideDown",void 0),(0,pt.gn)([(0,_t.qC)()],Jt.prototype,"useInputToRestoreState",void 0);var $t=n(5934),en=n(2845),tn=function(){function e(){(0,st.Z)(this,e),this.previousWorldMatrices={},this.previousBones={}}return(0,lt.Z)(e,[{key:"bindForSubMesh",value:function(e,t,n,i,r){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&-1!==t.prePassRenderer.getIndex(2)){this.previousWorldMatrices[n.uniqueId]||(this.previousWorldMatrices[n.uniqueId]=i.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());var a=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=a.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==a.frameId&&(this._lastUpdateFrameId=a.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[n.uniqueId]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[n.uniqueId]=i.clone()}}}],[{key:"AddUniforms",value:function(e){e.push("previousWorld","previousViewProjection","mPreviousBones")}},{key:"AddSamplers",value:function(e){}}]),e}(),nn=n(7823),rn=n(6556),an=n(4071),on=n(4771);function sn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}var ln=function(e){(0,ft.Z)(n,e);var t=sn(n);function n(e,i){var r,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,st.Z)(this,n),(r=t.call(this,e,i))._normalMatrix=new Je.y3,r._storeEffectOnSubMeshes=a,r}return(0,lt.Z)(n,[{key:"getEffect",value:function(){return this._storeEffectOnSubMeshes?this._activeEffect:(0,ht.Z)((0,vt.Z)(n.prototype),"getEffect",this).call(this)}},{key:"isReady",value:function(e,t){return!!e&&(!this._storeEffectOnSubMeshes||(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t)))}},{key:"_isReadyForSubMesh",value:function(e){var t=e.materialDefines;return!(this.checkReadyOnEveryCall||!e.effect||!t||t._renderId!==this.getScene().getRenderId())}},{key:"bindOnlyWorldMatrix",value:function(e){this._activeEffect.setMatrix("world",e)}},{key:"bindOnlyNormalMatrix",value:function(e){this._activeEffect.setMatrix("normalMatrix",e)}},{key:"bind",value:function(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])}},{key:"_afterBind",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,ht.Z)((0,vt.Z)(n.prototype),"_afterBind",this).call(this,e,t),this.getScene()._cachedEffect=t}},{key:"_mustRebind",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e.isCachedMaterialInvalid(this,t,n)}}]),n}(rn.F),un=n(114),cn=n(4198),hn=n(9950);n(562);function fn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}var dn=function(e){(0,ft.Z)(n,e);var t=fn(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,st.Z)(this,n),(i=t.call(this,null)).metadata=null,i.reservedDataStore=null,i._hasAlpha=!1,i._getAlphaFromRGB=!1,i.level=1,i._coordinatesIndex=0,i.optimizeUVAllocation=!0,i._coordinatesMode=0,i.wrapR=1,i.anisotropicFilteringLevel=n.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,i._isCube=!1,i._gammaSpace=!0,i.invertZ=!1,i.lodLevelInAlpha=!1,i.isRenderTarget=!1,i._prefiltered=!1,i._forceSerialize=!1,i.animations=new Array,i.onDisposeObservable=new gt.y$,i._onDisposeObserver=null,i._scene=null,i._uid=null,i._parentContainer=null,i._loadingError=!1,e?n._IsScene(e)?i._scene=e:i._engine=e:i._scene=cn.l.LastCreatedScene,i._scene&&(i.uniqueId=i._scene.getUniqueId(),i._scene.addTexture((0,ct.Z)(i)),i._engine=i._scene.getEngine()),i._texture=r,i._uid=null,i}return(0,lt.Z)(n,[{key:"hasAlpha",get:function(){return this._hasAlpha},set:function(e){var t=this;this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))}},{key:"getAlphaFromRGB",get:function(){return this._getAlphaFromRGB},set:function(e){var t=this;this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))}},{key:"coordinatesIndex",get:function(){return this._coordinatesIndex},set:function(e){var t=this;this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))}},{key:"coordinatesMode",get:function(){return this._coordinatesMode},set:function(e){var t=this;this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))}},{key:"wrapU",get:function(){return this._wrapU},set:function(e){this._wrapU=e}},{key:"wrapV",get:function(){return this._wrapV},set:function(e){this._wrapV=e}},{key:"isCube",get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(e){this._texture?this._texture.isCube=e:this._isCube=e}},{key:"is3D",get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)}},{key:"is2DArray",get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)}},{key:"gammaSpace",get:function(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace},set:function(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this._markAllSubMeshesAsTexturesDirty()}},{key:"isRGBD",get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(e){this._texture&&(this._texture._isRGBD=e)}},{key:"noMipmap",get:function(){return!1}},{key:"lodGenerationOffset",get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)}},{key:"lodGenerationScale",get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)}},{key:"linearSpecularLOD",get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(e){this._texture&&(this._texture._linearSpecularLOD=e)}},{key:"irradianceTexture",get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(e){this._texture&&(this._texture._irradianceTexture=e)}},{key:"uid",get:function(){return this._uid||(this._uid=(0,hn.f)()),this._uid}},{key:"toString",value:function(){return this.name}},{key:"getClassName",value:function(){return"BaseTexture"}},{key:"onDispose",set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}},{key:"isBlocking",get:function(){return!0}},{key:"loadingError",get:function(){return this._loadingError}},{key:"errorObject",get:function(){return this._errorObject}},{key:"getScene",value:function(){return this._scene}},{key:"_getEngine",value:function(){return this._engine}},{key:"checkTransformsAreIdentical",value:function(e){return null!==e}},{key:"getTextureMatrix",value:function(){return Je.y3.IdentityReadOnly}},{key:"getReflectionTextureMatrix",value:function(){return Je.y3.IdentityReadOnly}},{key:"isReadyOrNotBlocking",value:function(){return!this.isBlocking||this.isReady()||this.loadingError}},{key:"scale",value:function(e){}},{key:"canRescale",get:function(){return!1}},{key:"_getFromCache",value:function(e,t,n,i,r,a){var o=this._getEngine();if(!o)return null;for(var s=o._getUseSRGBBuffer(!!r,t),l=o.getLoadedTexturesCache(),u=0;u<l.length;u++){var c=l[u];if(!(void 0!==r&&s!==c._useSRGBBuffer||void 0!==i&&i!==c.invertY||c.url!==e||c.generateMipMaps!==!t||n&&n!==c.samplingMode||void 0!==a&&a!==c.isCube))return c.incrementReferences(),c}return null}},{key:"_rebuild",value:function(){}},{key:"clone",value:function(){return null}},{key:"textureType",get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}},{key:"textureFormat",get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}},{key:"_markAllSubMeshesAsTexturesDirty",value:function(){var e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}},{key:"readPixels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;var u=this._getEngine();if(!u)return null;var c=this.getSize(),h=c.width,f=c.height;0!==t&&(h/=Math.pow(2,t),f/=Math.pow(2,t),h=Math.round(h),f=Math.round(f)),s=Math.min(h,s),l=Math.min(f,l);try{return this._texture.isCube?u._readTexturePixels(this._texture,s,l,e,t,n,i,r,a,o):u._readTexturePixels(this._texture,s,l,-1,t,n,i,r,a,o)}catch(d){return null}}},{key:"_readPixelsSync",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;var a=this.getSize(),o=a.width,s=a.height,l=this._getEngine();if(!l)return null;0!=t&&(o/=Math.pow(2,t),s/=Math.pow(2,t),o=Math.round(o),s=Math.round(s));try{return this._texture.isCube?l._readTexturePixelsSync(this._texture,o,s,e,t,n,i,r):l._readTexturePixelsSync(this._texture,o,s,-1,t,n,i,r)}catch(u){return null}}},{key:"_lodTextureHigh",get:function(){return this._texture?this._texture._lodTextureHigh:null}},{key:"_lodTextureMid",get:function(){return this._texture?this._texture._lodTextureMid:null}},{key:"_lodTextureLow",get:function(){return this._texture?this._texture._lodTextureLow:null}},{key:"dispose",value:function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);var e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){var t=this._parentContainer.textures.indexOf(this);t>-1&&this._parentContainer.textures.splice(t,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,(0,ht.Z)((0,vt.Z)(n.prototype),"dispose",this).call(this)}},{key:"serialize",value:function(){if(!this.name)return null;var e=_t.p4.Serialize(this);return _t.p4.AppendSerializedAnimations(this,e),e}}],[{key:"WhenAllReady",value:function(e,t){var n=e.length;if(0!==n)for(var i=0;i<e.length;i++){var r=e[i];if(r.isReady())0==--n&&t();else{var a=r.onLoadObservable;a?a.addOnce((function(){0==--n&&t()})):0==--n&&t()}}else t()}},{key:"_IsScene",value:function(e){return"Scene"===e.getClassName()}}]),n}(function(){function e(t){(0,st.Z)(this,e),this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=ut.Zero(),this._cachedBaseSize=ut.Zero(),this._initialSamplingMode=2,this._texture=t,this._texture&&(this._engine=this._texture.getEngine())}return(0,lt.Z)(e,[{key:"wrapU",get:function(){return this._wrapU},set:function(e){this._wrapU=e}},{key:"wrapV",get:function(){return this._wrapV},set:function(e){this._wrapV=e}},{key:"coordinatesMode",get:function(){return 0}},{key:"isCube",get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)}},{key:"is3D",get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)}},{key:"is2DArray",get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)}},{key:"getClassName",value:function(){return"ThinTexture"}},{key:"isReady",value:function(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}},{key:"delayLoad",value:function(){}},{key:"getInternalTexture",value:function(){return this._texture}},{key:"getSize",value:function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}},{key:"getBaseSize",value:function(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}},{key:"samplingMode",get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}},{key:"updateSamplingMode",value:function(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)}},{key:"releaseInternalTexture",value:function(){this._texture&&(this._texture.dispose(),this._texture=null)}},{key:"dispose",value:function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}]),e}());dn.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,pt.gn)([(0,_t.qC)()],dn.prototype,"uniqueId",void 0),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"name",void 0),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"metadata",void 0),(0,pt.gn)([(0,_t.qC)("hasAlpha")],dn.prototype,"_hasAlpha",void 0),(0,pt.gn)([(0,_t.qC)("getAlphaFromRGB")],dn.prototype,"_getAlphaFromRGB",void 0),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"level",void 0),(0,pt.gn)([(0,_t.qC)("coordinatesIndex")],dn.prototype,"_coordinatesIndex",void 0),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"optimizeUVAllocation",void 0),(0,pt.gn)([(0,_t.qC)("coordinatesMode")],dn.prototype,"_coordinatesMode",void 0),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"wrapU",null),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"wrapV",null),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"wrapR",void 0),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"anisotropicFilteringLevel",void 0),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"isCube",null),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"is3D",null),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"is2DArray",null),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"gammaSpace",null),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"invertZ",void 0),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"lodLevelInAlpha",void 0),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"lodGenerationOffset",null),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"lodGenerationScale",null),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"linearSpecularLOD",null),(0,pt.gn)([(0,_t.oU)()],dn.prototype,"irradianceTexture",null),(0,pt.gn)([(0,_t.qC)()],dn.prototype,"isRenderTarget",void 0);var vn=n(5230),pn=n(8370),_n=n(8797),gn=n(2399),mn=n(531),yn=n(4687),An=n.n(yn);function En(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.width,r=t.height;if(e instanceof Float32Array){for(var a=e.byteLength/e.BYTES_PER_ELEMENT,o=new Uint8Array(a);--a>=0;){var s=e[a];s<0?s=0:s>1&&(s=1),o[a]=255*s}e=o}var l=document.createElement("canvas");l.width=i,l.height=r;var u=l.getContext("2d");if(!u)return null;var c=u.createImageData(i,r),h=c.data;if(h.set(e),u.putImageData(c,0,0),n){var f=document.createElement("canvas");f.width=i,f.height=r;var d=f.getContext("2d");return d?(d.translate(0,r),d.scale(1,-1),d.drawImage(l,0,0),f.toDataURL("image/png")):null}return l.toDataURL("image/png")}function bn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=e.getInternalTexture();if(!i)return null;var r=e._readPixelsSync(t,n);return r?En(r,e.getSize(),i.invertY):null}function Tn(e){return Sn.apply(this,arguments)}function Sn(){return Sn=(0,mn.Z)(An().mark((function e(t){var n,i,r,a,o=arguments;return An().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:0,i=o.length>2&&void 0!==o[2]?o[2]:0,r=t.getInternalTexture()){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,t.readPixels(n,i);case 7:if(a=e.sent){e.next=10;break}return e.abrupt("return",null);case 10:return e.abrupt("return",En(a,t.getSize(),r.invertY));case 11:case"end":return e.stop()}}),e)}))),Sn.apply(this,arguments)}function Mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}var In=function(e){(0,ft.Z)(n,e);var t=Mn(n);function n(e,i,r,a){var o,s,l,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.TRILINEAR_SAMPLINGMODE,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]&&arguments[8],v=arguments.length>9?arguments[9]:void 0,p=arguments.length>10?arguments[10]:void 0,_=arguments.length>11?arguments[11]:void 0,g=arguments.length>12?arguments[12]:void 0,m=arguments.length>13?arguments[13]:void 0;(0,st.Z)(this,n),(s=t.call(this,i)).url=null,s.uOffset=0,s.vOffset=0,s.uScale=1,s.vScale=1,s.uAng=0,s.vAng=0,s.wAng=0,s.uRotationCenter=.5,s.vRotationCenter=.5,s.wRotationCenter=.5,s.homogeneousRotationInUVTransform=!1,s.inspectableCustomProperties=null,s._noMipmap=!1,s._invertY=!1,s._rowGenerationMatrix=null,s._cachedTextureMatrix=null,s._projectionModeMatrix=null,s._t0=null,s._t1=null,s._t2=null,s._cachedUOffset=-1,s._cachedVOffset=-1,s._cachedUScale=0,s._cachedVScale=0,s._cachedUAng=-1,s._cachedVAng=-1,s._cachedWAng=-1,s._cachedProjectionMatrixId=-1,s._cachedURotationCenter=-1,s._cachedVRotationCenter=-1,s._cachedWRotationCenter=-1,s._cachedHomogeneousRotationInUVTransform=!1,s._cachedCoordinatesMode=-1,s._buffer=null,s._deleteBuffer=!1,s._format=null,s._delayedOnLoad=null,s._delayedOnError=null,s.onLoadObservable=new gt.y$,s._isBlocking=!0,s.name=e||"",s.url=e;var y,A,E,b,T,S,M,I,P,C=!1,x=null;"object"==typeof r&&null!==r?(l=null!==(y=r.noMipmap)&&void 0!==y&&y,a=null!==(A=r.invertY)&&void 0!==A?A:!je.e.UseOpenGLOrientationForUV,u=null!==(E=r.samplingMode)&&void 0!==E?E:n.TRILINEAR_SAMPLINGMODE,c=null!==(b=r.onLoad)&&void 0!==b?b:null,h=null!==(T=r.onError)&&void 0!==T?T:null,f=null!==(S=r.buffer)&&void 0!==S?S:null,d=null!==(M=r.deleteBuffer)&&void 0!==M&&M,v=r.format,p=r.mimeType,_=r.loaderOptions,g=r.creationFlags,C=null!==(I=r.useSRGBBuffer)&&void 0!==I&&I,x=null!==(P=r.internalTexture)&&void 0!==P?P:null):l=!!r;s._noMipmap=l,s._invertY=void 0===a?!je.e.UseOpenGLOrientationForUV:a,s._initialSamplingMode=u,s._buffer=f,s._deleteBuffer=d,s._mimeType=p,s._loaderOptions=_,s._creationFlags=g,s._useSRGBBuffer=C,s._forcedExtension=m,v&&(s._format=v);var D=s.getScene(),R=s._getEngine();if(!R)return(0,dt.Z)(s);R.onBeforeTextureInitObservable.notifyObservers((0,ct.Z)(s));var k=function(){s._texture&&(s._texture._invertVScale&&(s.vScale*=-1,s.vOffset+=1),null!==s._texture._cachedWrapU&&(s.wrapU=s._texture._cachedWrapU,s._texture._cachedWrapU=null),null!==s._texture._cachedWrapV&&(s.wrapV=s._texture._cachedWrapV,s._texture._cachedWrapV=null),null!==s._texture._cachedWrapR&&(s.wrapR=s._texture._cachedWrapR,s._texture._cachedWrapR=null)),s.onLoadObservable.hasObservers()&&s.onLoadObservable.notifyObservers((0,ct.Z)(s)),c&&c(),!s.isBlocking&&D&&D.resetCachedMaterial()},O=function(e,t){s._loadingError=!0,s._errorObject={message:e,exception:t},h&&h(e,t),n.OnTextureLoadErrorObservable.notifyObservers((0,ct.Z)(s))};if(!s.url)return s._delayedOnLoad=k,s._delayedOnError=O,(0,dt.Z)(s);if(s._texture=null!==(o=x)&&void 0!==o?o:s._getFromCache(s.url,l,u,s._invertY,C),s._texture)if(s._texture.isReady)pn.Q.SetImmediate((function(){return k()}));else{var L=s._texture.onLoadedObservable.add(k);s._texture.onErrorObservable.add((function(e){var t;O(e.message,e.exception),null===(t=s._texture)||void 0===t||t.onLoadedObservable.remove(L)}))}else if(D&&D.useDelayedTextureLoading)s.delayLoadState=4,s._delayedOnLoad=k,s._delayedOnError=O;else{try{s._texture=R.createTexture(s.url,l,s._invertY,D,u,k,O,s._buffer,void 0,s._format,s._forcedExtension,p,_,g,C)}catch(F){throw O("error loading",F),F}d&&(s._buffer=null)}return s}return(0,lt.Z)(n,[{key:"noMipmap",get:function(){return this._noMipmap}},{key:"mimeType",get:function(){return this._mimeType}},{key:"isBlocking",get:function(){return this._isBlocking},set:function(e){this._isBlocking=e}},{key:"invertY",get:function(){return this._invertY}},{key:"updateURL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=i,this.delayLoadState=4,n&&(this._delayedOnLoad=n),this.delayLoad()}},{key:"delayLoad",value:function(){if(4===this.delayLoadState){var e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer),this._texture?this._delayedOnLoad&&(this._texture.isReady?pn.Q.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}}},{key:"_prepareRowForTextureGeneration",value:function(e,t,n,i){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,n-=this.wRotationCenter,Je.P.TransformCoordinatesFromFloatsToRef(e,t,n,this._rowGenerationMatrix,i),i.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,i.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,i.z+=this.wRotationCenter}},{key:"checkTransformsAreIdentical",value:function(e){return null!==e&&this.uOffset===e.uOffset&&this.vOffset===e.vOffset&&this.uScale===e.uScale&&this.vScale===e.vScale&&this.uAng===e.uAng&&this.vAng===e.vAng&&this.wAng===e.wAng}},{key:"getTextureMatrix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*t===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*t,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=Je.y3.Zero(),this._rowGenerationMatrix=new Je.y3,this._t0=Je.P.Zero(),this._t1=Je.P.Zero(),this._t2=Je.P.Zero()),Je.y3.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(Je.y3.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,Je.jp.Matrix[0]),Je.y3.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,Je.jp.Matrix[1]),Je.y3.ScalingToRef(this._cachedUScale,this._cachedVScale,0,Je.jp.Matrix[2]),Je.y3.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,Je.jp.Matrix[3]),Je.jp.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(Je.jp.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(Je.jp.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(Je.jp.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),Je.y3.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var n=this.getScene();return n?(this.optimizeUVAllocation&&n.markAllMaterialsAsDirty(1,(function(t){return t.hasTexture(e)})),this._cachedTextureMatrix):this._cachedTextureMatrix}},{key:"getReflectionTextureMatrix",value:function(){var e=this,t=this.getScene();if(!t)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==n.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===t.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}this._cachedTextureMatrix||(this._cachedTextureMatrix=Je.y3.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=Je.y3.Zero());var i=this._cachedCoordinatesMode!==this.coordinatesMode;switch(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case n.PLANAR_MODE:Je.y3.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case n.PROJECTION_MODE:Je.y3.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var r=t.getProjectionMatrix();this._cachedProjectionMatrixId=r.updateFlag,r.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:Je.y3.IdentityToRef(this._cachedTextureMatrix)}return i&&t.markAllMaterialsAsDirty(1,(function(t){return-1!==t.getActiveTextures().indexOf(e)})),this._cachedTextureMatrix}},{key:"clone",value:function(){var e=this,t={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return _t.p4.Clone((function(){return new n(e._texture?e._texture.url:null,e.getScene(),t)}),this)}},{key:"serialize",value:function(){var e=this.name;n.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");var t=(0,ht.Z)((0,vt.Z)(n.prototype),"serialize",this).call(this);return t?((n.SerializeBuffers||n.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(t.base64String=this._buffer,t.name=t.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?t.base64String="data:image/png;base64,"+(0,gn.Gh)(this._buffer):(n.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(t.base64String=!this._engine||this._engine._features.supportSyncTextureRead?bn(this):Tn(this))),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t._creationFlags=this._creationFlags,t._useSRGBBuffer=this._useSRGBBuffer,this.name=e,t):null}},{key:"getClassName",value:function(){return"Texture"}},{key:"dispose",value:function(){(0,ht.Z)((0,vt.Z)(n.prototype),"dispose",this).call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null}}],[{key:"Parse",value:function(e,t,i){if(e.customType){var r=_n.K.Instantiate(e.customType).Parse(e,t,i);return e.samplingMode&&r.updateSamplingMode&&r._samplingMode&&r._samplingMode!==e.samplingMode&&r.updateSamplingMode(e.samplingMode),r}if(e.isCube&&!e.isRenderTarget)return n._CubeTextureParser(e,t,i);if(!e.name&&!e.isRenderTarget)return null;var a=function(t){if(t&&t._texture&&(t._texture._cachedWrapU=null,t._texture._cachedWrapV=null,t._texture._cachedWrapR=null),e.samplingMode){var n=e.samplingMode;t&&t.samplingMode!==n&&t.updateSamplingMode(n)}if(t&&e.animations)for(var i=0;i<e.animations.length;i++){var r=e.animations[i],a=(0,Pt.q)("BABYLON.Animation");a&&t.animations.push(a.Parse(r))}};return _t.p4.Parse((function(){var r,o,s,l,u=!0;if(e.noMipmap&&(u=!1),e.mirrorPlane){var c=n._CreateMirror(e.name,e.renderTargetSize,t,u);return c._waitingRenderList=e.renderList,c.mirrorPlane=ot.J.FromArray(e.mirrorPlane),a(c),c}if(e.isRenderTarget){var h,f=null;if(e.isCube){if(t.reflectionProbes)for(var d=0;d<t.reflectionProbes.length;d++){var v=t.reflectionProbes[d];if(v.name===e.name)return v.cubeTexture}}else(f=n._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,u,null!==(h=e._creationFlags)&&void 0!==h?h:0))._waitingRenderList=e.renderList;return a(f),f}return e.base64String?(r=n.CreateFromBase64String(e.base64String,e.base64String,t,!u,e.invertY,e.samplingMode,(function(){a(r)}),null!==(o=e._creationFlags)&&void 0!==o?o:0,null!==(s=e._useSRGBBuffer)&&void 0!==s&&s)).name=e.name:(l=e.name&&e.name.indexOf("://")>0?e.name:i+e.name,e.url&&(e.url.startsWith("data:")||n.UseSerializedUrlIfAny)&&(l=e.url),r=new n(l,t,!u,e.invertY,e.samplingMode,(function(){a(r)}))),r}),e,t)}},{key:"CreateFromBase64String",value:function(e,t,i,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n.TRILINEAR_SAMPLINGMODE,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,c=arguments.length>9?arguments[9]:void 0;return new n("data:"+t,i,r,a,o,s,l,e,!1,u,void 0,void 0,c)}},{key:"LoadFromDataString",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n.TRILINEAR_SAMPLINGMODE,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,h=arguments.length>10?arguments[10]:void 0;return"data:"!==e.substr(0,5)&&(e="data:"+e),new n(e,i,a,o,s,l,u,t,r,c,void 0,void 0,h)}}]),n}(dn);In.SerializeBuffers=!0,In.ForceSerializeBuffers=!1,In.OnTextureLoadErrorObservable=new gt.y$,In._CubeTextureParser=function(e,t,n){throw(0,vn.S)("CubeTexture")},In._CreateMirror=function(e,t,n,i){throw(0,vn.S)("MirrorTexture")},In._CreateRenderTargetTexture=function(e,t,n,i,r){throw(0,vn.S)("RenderTargetTexture")},In.NEAREST_SAMPLINGMODE=1,In.NEAREST_NEAREST_MIPLINEAR=8,In.BILINEAR_SAMPLINGMODE=2,In.LINEAR_LINEAR_MIPNEAREST=11,In.TRILINEAR_SAMPLINGMODE=3,In.LINEAR_LINEAR_MIPLINEAR=3,In.NEAREST_NEAREST_MIPNEAREST=4,In.NEAREST_LINEAR_MIPNEAREST=5,In.NEAREST_LINEAR_MIPLINEAR=6,In.NEAREST_LINEAR=7,In.NEAREST_NEAREST=1,In.LINEAR_NEAREST_MIPNEAREST=9,In.LINEAR_NEAREST_MIPLINEAR=10,In.LINEAR_LINEAR=2,In.LINEAR_NEAREST=12,In.EXPLICIT_MODE=0,In.SPHERICAL_MODE=1,In.PLANAR_MODE=2,In.CUBIC_MODE=3,In.PROJECTION_MODE=4,In.SKYBOX_MODE=5,In.INVCUBIC_MODE=6,In.EQUIRECTANGULAR_MODE=7,In.FIXED_EQUIRECTANGULAR_MODE=8,In.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,In.CLAMP_ADDRESSMODE=0,In.WRAP_ADDRESSMODE=1,In.MIRROR_ADDRESSMODE=2,In.UseSerializedUrlIfAny=!1,(0,pt.gn)([(0,_t.qC)()],In.prototype,"url",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"uOffset",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"vOffset",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"uScale",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"vScale",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"uAng",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"vAng",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"wAng",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"uRotationCenter",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"vRotationCenter",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"wRotationCenter",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"homogeneousRotationInUVTransform",void 0),(0,pt.gn)([(0,_t.qC)()],In.prototype,"isBlocking",null),(0,Pt.H)("BABYLON.Texture",In),_t.p4._TextureParser=In.Parse;var Pn=function(){function e(){(0,st.Z)(this,e)}return(0,lt.Z)(e,null,[{key:"DiffuseTextureEnabled",get:function(){return this._DiffuseTextureEnabled},set:function(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"DetailTextureEnabled",get:function(){return this._DetailTextureEnabled},set:function(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"AmbientTextureEnabled",get:function(){return this._AmbientTextureEnabled},set:function(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"OpacityTextureEnabled",get:function(){return this._OpacityTextureEnabled},set:function(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"ReflectionTextureEnabled",get:function(){return this._ReflectionTextureEnabled},set:function(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"EmissiveTextureEnabled",get:function(){return this._EmissiveTextureEnabled},set:function(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"SpecularTextureEnabled",get:function(){return this._SpecularTextureEnabled},set:function(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"BumpTextureEnabled",get:function(){return this._BumpTextureEnabled},set:function(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"LightmapTextureEnabled",get:function(){return this._LightmapTextureEnabled},set:function(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"RefractionTextureEnabled",get:function(){return this._RefractionTextureEnabled},set:function(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"ColorGradingTextureEnabled",get:function(){return this._ColorGradingTextureEnabled},set:function(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"FresnelEnabled",get:function(){return this._FresnelEnabled},set:function(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,He.D.MarkAllMaterialsAsDirty(4))}},{key:"ClearCoatTextureEnabled",get:function(){return this._ClearCoatTextureEnabled},set:function(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"ClearCoatBumpTextureEnabled",get:function(){return this._ClearCoatBumpTextureEnabled},set:function(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"ClearCoatTintTextureEnabled",get:function(){return this._ClearCoatTintTextureEnabled},set:function(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"SheenTextureEnabled",get:function(){return this._SheenTextureEnabled},set:function(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"AnisotropicTextureEnabled",get:function(){return this._AnisotropicTextureEnabled},set:function(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"ThicknessTextureEnabled",get:function(){return this._ThicknessTextureEnabled},set:function(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"RefractionIntensityTextureEnabled",get:function(){return this._ThicknessTextureEnabled},set:function(e){this._RefractionIntensityTextureEnabled!==e&&(this._RefractionIntensityTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"TranslucencyIntensityTextureEnabled",get:function(){return this._ThicknessTextureEnabled},set:function(e){this._TranslucencyIntensityTextureEnabled!==e&&(this._TranslucencyIntensityTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}},{key:"IridescenceTextureEnabled",get:function(){return this._IridescenceTextureEnabled},set:function(e){this._IridescenceTextureEnabled!==e&&(this._IridescenceTextureEnabled=e,He.D.MarkAllMaterialsAsDirty(1))}}]),e}();Pn._DiffuseTextureEnabled=!0,Pn._DetailTextureEnabled=!0,Pn._AmbientTextureEnabled=!0,Pn._OpacityTextureEnabled=!0,Pn._ReflectionTextureEnabled=!0,Pn._EmissiveTextureEnabled=!0,Pn._SpecularTextureEnabled=!0,Pn._BumpTextureEnabled=!0,Pn._LightmapTextureEnabled=!0,Pn._RefractionTextureEnabled=!0,Pn._ColorGradingTextureEnabled=!0,Pn._FresnelEnabled=!0,Pn._ClearCoatTextureEnabled=!0,Pn._ClearCoatBumpTextureEnabled=!0,Pn._ClearCoatTintTextureEnabled=!0,Pn._SheenTextureEnabled=!0,Pn._AnisotropicTextureEnabled=!0,Pn._ThicknessTextureEnabled=!0,Pn._RefractionIntensityTextureEnabled=!0,Pn._TranslucencyIntensityTextureEnabled=!0,Pn._IridescenceTextureEnabled=!0;var Cn=n(8084),xn="uniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform vec3 vAmbientColor;\nuniform float visibility;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#if defined(USE_LOCAL_REFRACTIONMAP_CUBIC) && defined(REFRACTIONMAP_3D)\nuniform vec3 vRefractionPosition;\nuniform vec3 vRefractionSize; \n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n";Cn.v.IncludesShadersStore.defaultFragmentDeclaration=xn;var Dn="layout(std140,column_major) uniform;\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif \nmat4 view;\nmat4 projection;\nvec4 vEyePosition;\n};\n";Cn.v.IncludesShadersStore.sceneUboDeclaration=Dn;var Rn="#ifdef WEBGL2\nuniform mat4 world;\nuniform float visibility;\n#else\nlayout(std140,column_major) uniform;\nuniform Mesh\n{\nmat4 world;\nfloat visibility;\n};\n#endif\n#define WORLD_UBO\n";Cn.v.IncludesShadersStore.meshUboDeclaration=Rn;var kn="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nfloat alphaCutOff;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec3 vRefractionPosition;\nvec3 vRefractionSize;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nvec4 vDiffuseColor;\nvec3 vAmbientColor;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n";Cn.v.IncludesShadersStore.defaultUboDeclaration=kn;var On="#ifdef PREPASS\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out highp vec4 glFragData[{X}];highp vec4 gl_FragColor;\n#ifdef PREPASS_DEPTH\nvarying highp vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nvarying highp vec4 vCurrentPosition;varying highp vec4 vPreviousPosition;\n#endif\n#endif\n";Cn.v.IncludesShadersStore.prePassDeclaration=On;var Ln="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out vec2 depth; \nlayout(location=1) out vec4 frontColor;\nlayout(location=2) out vec4 backColor;\n#define MAX_DEPTH 99999.0\nhighp vec4 gl_FragColor;\nuniform sampler2D oitDepthSampler;\nuniform sampler2D oitFrontColorSampler;\n#endif\n";Cn.v.IncludesShadersStore.oitDeclaration=Ln;var Fn="#ifdef MAINUV{X}\nvarying vec2 vMainUV{X};\n#endif\n";Cn.v.IncludesShadersStore.mainUVVaryingDeclaration=Fn;var Nn="const float PI=3.1415926535897932384626433832795;\nconst float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{\nvec3 nearZeroSection=0.0773993808*color;\nvec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{\nvec3 nearZeroSection=12.92*color;\nvec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;\nfloat remainingSection=pow(0.947867299*(color+0.055),2.4);\nreturn color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;\nfloat remainingSection=1.055*pow(color,0.41666)-0.055;\nreturn color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nvec3 square(vec3 value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat normVariance=varianceAmount/255.0;\nfloat dither=mix(-normVariance,normVariance,rand);\nreturn dither;\n}\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D =max(rgbdMaxRange/maxRGB,1.);\nD =clamp(floor(D)/255.0,0.,1.);\nvec3 rgb=color.rgb*D;\nrgb=toGammaSpace(rgb);\nreturn vec4(clamp(rgb,0.,1.),D); \n}\nvec3 fromRGBD(vec4 rgbd) {\nrgbd.rgb=toLinearSpace(rgbd.rgb);\nreturn rgbd.rgb/rgbd.a;\n}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\nvec3 intersectPositionWS=vertexPos+origVec*distance;\nreturn intersectPositionWS-cubePos;\n}\n";Cn.v.IncludesShadersStore.helperFunctions=Nn;var wn="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif\n";Cn.v.IncludesShadersStore.lightFragmentDeclaration=wn;var Bn="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X}; \n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n";Cn.v.IncludesShadersStore.lightUboDeclaration=Bn;var Un="struct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w==0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}";Cn.v.IncludesShadersStore.lightsFragmentFunctions=Un;var Vn="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\n#define inline\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nreturn depth>shadow ? darkness : 1.0;\n}\n#define inline\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\n#define inline\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness); \nreturn esm;\n}\n#define inline\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\n#if defined(WEBGL2) || defined(WEBGPU)\n#define inline\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nvec3 uvLayer=vec3(uv.x,uv.y,layer);\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;\n}\n#endif\n#define inline\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;\n}\n}\n#define inline\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#ifdef IS_NDC_HALF_ZRANGE\n#define ZINCLIP clipSpace.z\n#else\n#define ZINCLIP uvDepth.z\n#endif\n#if defined(WEBGL2) || defined(WEBGPU)\n#define GREATEST_LESS_THAN_ONE 0.99999994\n#define inline\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat shadow=texture2D(shadowSampler,uvDepthLayer);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n#define inline\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture2D(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nelse\n{\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\nfloat AAOffset=shadowMapSizeInverse*10.;\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);\nvec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec4 offset=vec4(poissonSamplers[i],0.);\noffset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);\nshadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\nshadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture2D(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nelse\n{\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\nfloat AAOffset=shadowMapSizeInverse*10.;\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n}\n#define inline\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\n#define inline\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\n#define inline\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\n#define inline\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#define inline\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#define inline\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#endif\n#endif\n";Cn.v.IncludesShadersStore.shadowsFragmentFunctions=Vn;var Wn="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\nuniform sampler2D _SAMPLERNAME_Sampler;\n#endif\n";Cn.v.IncludesShadersStore.samplerFragmentDeclaration=Wn;var Gn="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif\n";Cn.v.IncludesShadersStore.fresnelFunction=Gn;var Xn="vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0); \n}\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(1.0-s,t,0); \n}\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=worldPos.xyz-eyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*(view*worldPos));\n}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*vec4(positionW,1.));\n}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\n";Cn.v.IncludesShadersStore.reflectionFunction=Xn;var zn="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";Cn.v.IncludesShadersStore.imageProcessingDeclaration=zn;var Hn="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\ncolor=saturate(color);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);\nfloat dither=mix(-ditherIntensity,ditherIntensity,rand);\nresult.rgb=saturate(result.rgb+vec3(dither));\n#endif\nreturn result;\n}";Cn.v.IncludesShadersStore.imageProcessingFunctions=Hn;var Zn="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\nvec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)\n{\n#ifdef NORMALXYSCALE\nnormal=normalize(normal*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*normal);\n}\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{\nreturn perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);\n}\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n";Cn.v.IncludesShadersStore.bumpFragmentMainFunctions=Zn;var Yn="#if defined(BUMP)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)\n#endif\n#if defined(DETAIL)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,texCoord+vCurrOffset).w;\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n";Cn.v.IncludesShadersStore.bumpFragmentFunctions=Yn;var Kn="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";Cn.v.IncludesShadersStore.clipPlaneFragmentDeclaration=Kn;var jn="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif\n";Cn.v.IncludesShadersStore.logDepthDeclaration=jn;var qn="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR==vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif\n";Cn.v.IncludesShadersStore.fogFragmentDeclaration=qn;var Qn="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{\ndiscard;\n}\n#endif\n";Cn.v.IncludesShadersStore.clipPlaneFragment=Qn;var Jn="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#elif defined(BUMP)\nfloat normalScale=vBumpInfos.y;\n#else\nfloat normalScale=1.0;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#elif defined(BUMP)\nvec2 TBNUV=gl_FrontFacing ? vBumpUV : -vBumpUV;\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vTangentSpaceParams);\n#else\nvec2 TBNUV=gl_FrontFacing ? vDetailUV : -vDetailUV;\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nvec2 TBNUV=gl_FrontFacing ? vMainUV1 : -vMainUV1;\nmat3 TBN=cotangent_frame(normalW,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef DETAIL\nvec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);\nvec2 detailNormalRG=detailColor.wy*2.0-1.0;\nfloat detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));\nvec3 detailNormal=vec3(detailNormalRG,detailNormalB);\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz *2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#elif !defined(DETAIL)\nnormalW=perturbNormal(TBN,texture2D(bumpSampler,vBumpUV+uvOffset).xyz,vBumpInfos.y);\n#else\nvec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;\n#if DETAIL_NORMALBLENDMETHOD==0 \ndetailNormal.xy*=vDetailInfos.z;\nvec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));\n#elif DETAIL_NORMALBLENDMETHOD==1 \ndetailNormal.xy*=vDetailInfos.z;\nbumpNormal+=vec3(0.0,0.0,1.0);\ndetailNormal*=vec3(-1.0,-1.0,1.0);\nvec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;\n#endif\nnormalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);\n#endif\n#elif defined(DETAIL)\ndetailNormal.xy*=vDetailInfos.z;\nnormalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);\n#endif\n";Cn.v.IncludesShadersStore.bumpFragment=Jn;var $n="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif\n";Cn.v.IncludesShadersStore.depthPrePass=$n;var ei="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#ifdef IRIDESCENCE\npreInfo.iridescenceIntensity=iridescenceIntensity;\n#endif\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\npreInfo.roughness=sheenOut.sheenIntensity;\n#else\n#ifdef HEMILIGHT{X}\npreInfo.roughness=sheenOut.sheenRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef CLEARCOAT\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearcoatOut.clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\nabsorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) \n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {\nindex{X}=i;\nbreak;\n}\n}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];\nfloat diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};\nif (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{\nindex{X}+=1;\nfloat nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else \ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif\n";Cn.v.IncludesShadersStore.lightFragment=ei;var ti="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";Cn.v.IncludesShadersStore.logDepthFragment=ti;var ni="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";Cn.v.IncludesShadersStore.fogFragment=ni;var ii="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\nfloat fragDepth=gl_FragCoord.z; \n#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS\nuint halfFloat=packHalf2x16(vec2(fragDepth));\nvec2 full=unpackHalf2x16(halfFloat);\nfragDepth=full.x;\n#endif\nivec2 fragCoord=ivec2(gl_FragCoord.xy);\nvec2 lastDepth=texelFetch(oitDepthSampler,fragCoord,0).rg;\nvec4 lastFrontColor=texelFetch(oitFrontColorSampler,fragCoord,0);\ndepth.rg=vec2(-MAX_DEPTH);\nfrontColor=lastFrontColor;\nbackColor=vec4(0.0);\n#ifdef USE_REVERSE_DEPTHBUFFER\nfloat furthestDepth=-lastDepth.x;\nfloat nearestDepth=lastDepth.y;\n#else\nfloat nearestDepth=-lastDepth.x;\nfloat furthestDepth=lastDepth.y;\n#endif\nfloat alphaMultiplier=1.0-lastFrontColor.a;\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth>nearestDepth || fragDepth<furthestDepth) {\n#else\nif (fragDepth<nearestDepth || fragDepth>furthestDepth) {\n#endif\nreturn;\n}\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth<nearestDepth && fragDepth>furthestDepth) {\n#else\nif (fragDepth>nearestDepth && fragDepth<furthestDepth) {\n#endif\ndepth.rg=vec2(-fragDepth,fragDepth);\nreturn;\n}\n#endif\n";Cn.v.IncludesShadersStore.oitFragment=ii;var ri="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\n#include<oitDeclaration>\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#define RECIPROCAL_PI2 0.15915494\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_SAMPLERNAME_,diffuse)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULARTERM)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_SAMPLERNAME_,specular)\n#endif\n#include<fresnelFunction>\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\nfloat alpha=vDiffuseColor.a;\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef DETAIL\nbaseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec4 refractionColor=vec4(0.,0.,0.,1.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\n#ifdef USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,vRefractionSize,vRefractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector);\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords);\n#endif\n#ifdef RGBDREFRACTION\nrefractionColor.rgb=fromRGBD(refractionColor);\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor.rgb=toGammaSpace(refractionColor.rgb);\n#endif\nrefractionColor.rgb*=vRefractionInfos.x;\n#endif\nvec4 reflectionColor=vec4(0.,0.,0.,1.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nvReflectionUVW.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords);\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor.rgb=toGammaSpace(reflectionColor.rgb);\n#endif\nreflectionColor.rgb*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n#ifdef ALPHATEST\n#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS\nif (alpha<alphaCutOff)\ndiscard;\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);\n#endif\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor.rgb;\n#else\ncolor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=color.a>0.4 ? 1.0 : 0.0;\ngl_FragData[0]=color; \n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_IRRADIANCE\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4((view*vec4(normalW,0.0)).rgb,writeGeometryInfo); \n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#if defined(SPECULARTERM)\n#if defined(SPECULAR)\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularMapColor)*writeGeometryInfo; \n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularColor,1.0)*writeGeometryInfo;\n#endif\n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0)*writeGeometryInfo;\n#endif\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=color;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {\nfrontColor.rgb+=color.rgb*color.a*alphaMultiplier;\nfrontColor.a=1.0-alphaMultiplier*(1.0-color.a);\n} else {\nbackColor+=color;\n}\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";Cn.v.ShadersStore.defaultPixelShader=ri;var ai="uniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\nuniform mat4 detailMatrix;\n#endif\n#define ADDITIONAL_VERTEX_DECLARATION\n";Cn.v.IncludesShadersStore.defaultVertexDeclaration=ai;var oi="#ifdef UV{X}\nattribute vec2 uv{X};\n#endif\n";Cn.v.IncludesShadersStore.uvAttributeDeclaration=oi;var si="#if NUM_BONE_INFLUENCERS>0\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#ifdef BONES_VELOCITY_ENABLED\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#endif\n#ifdef BONETEXTURE\n#define inline\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index *4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif\n#endif\n";Cn.v.IncludesShadersStore.bonesDeclaration=si;var li="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform float bakedVertexAnimationTime;\nuniform vec2 bakedVertexAnimationTextureSizeInverted;\nuniform vec4 bakedVertexAnimationSettings;\nuniform sampler2D bakedVertexAnimationTexture;\n#ifdef INSTANCES\nattribute vec4 bakedVertexAnimationSettingsInstanced;\n#endif\n#define inline\nmat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)\n{\nfloat offset=index*4.0;\nfloat frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;\nfloat dx=bakedVertexAnimationTextureSizeInverted.x;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n";Cn.v.IncludesShadersStore.bakedVertexAnimationDeclaration=li;var ui="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#ifdef INSTANCESCOLOR\nattribute vec4 instanceColor;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute vec4 previousWorld0;\nattribute vec4 previousWorld1;\nattribute vec4 previousWorld2;\nattribute vec4 previousWorld3;\n#ifdef THIN_INSTANCES\nuniform mat4 previousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform mat4 previousWorld;\n#endif\n#endif\n";Cn.v.IncludesShadersStore.instancesDeclaration=ui;var ci="#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nuniform mat4 previousViewProjection;\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\n#endif\n";Cn.v.IncludesShadersStore.prePassVertexDeclaration=ci;var hi="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n";Cn.v.IncludesShadersStore.samplerVertexDeclaration=hi;var fi="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n";Cn.v.IncludesShadersStore.bumpVertexDeclaration=fi;var di="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nvarying float fClipDistance6;\n#endif\n";Cn.v.IncludesShadersStore.clipPlaneVertexDeclaration=di;var vi="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";Cn.v.IncludesShadersStore.fogVertexDeclaration=vi;var pi="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#endif\n";Cn.v.IncludesShadersStore.lightVxFragmentDeclaration=pi;var _i="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n";Cn.v.IncludesShadersStore.lightVxUboDeclaration=_i;var gi="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#ifdef MORPHTARGETS_TEXTURE \nprecision mediump sampler2DArray; \nuniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];\nuniform vec3 morphTargetTextureInfo;\nuniform sampler2DArray morphTargets;\nvec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)\n{ \nfloat y=floor(vertexIndex/morphTargetTextureInfo.y);\nfloat x=vertexIndex-y*morphTargetTextureInfo.y;\nvec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);\nreturn texture(morphTargets,textureUV).xyz;\n}\n#endif\n#endif\n";Cn.v.IncludesShadersStore.morphTargetsVertexGlobalDeclaration=gi;var mi="#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#endif\n#endif\n";Cn.v.IncludesShadersStore.morphTargetsVertexDeclaration=mi;var yi="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nfloat vertexID;\n#endif\n#endif\n";Cn.v.IncludesShadersStore.morphTargetsVertexGlobal=yi;var Ai="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE \nvertexID=float(gl_VertexID)*morphTargetTextureInfo.x;\npositionUpdated+=(readVector3FromRawSampler({X},vertexID)-position)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(readVector3FromRawSampler({X},vertexID) -normal)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(readVector3FromRawSampler({X},vertexID).xy-uv)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(readVector3FromRawSampler({X},vertexID) -tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#else\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n";Cn.v.IncludesShadersStore.morphTargetsVertex=Ai;var Ei="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,previousWorld2,previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\nfinalWorld=world*finalWorld;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\nmat4 finalWorld=world;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=previousWorld;\n#endif\n#endif\n";Cn.v.IncludesShadersStore.instancesVertex=Ei;var bi="#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n";Cn.v.IncludesShadersStore.bonesVertex=bi;var Ti="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\n#define BVASNAME bakedVertexAnimationSettingsInstanced\n#else\n#define BVASNAME bakedVertexAnimationSettings\n#endif\nfloat VATStartFrame=BVASNAME.x;\nfloat VATEndFrame=BVASNAME.y;\nfloat VATOffsetFrame=BVASNAME.z;\nfloat VATSpeed=BVASNAME.w;\nfloat totalFrames=VATEndFrame-VATStartFrame+1.0;\nfloat time=bakedVertexAnimationTime*VATSpeed/totalFrames;\nfloat frameCorrection=time<1.0 ? 0.0 : 1.0;\nfloat numOfFrames=totalFrames-frameCorrection;\nfloat VATFrameNum=fract(time)*numOfFrames;\nVATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);\nVATFrameNum=floor(VATFrameNum);\nVATFrameNum+=VATStartFrame+frameCorrection;\nmat4 VATInfluence;\nVATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;\n}\n#endif\n";Cn.v.IncludesShadersStore.bakedVertexAnimation=Ti;var Si="#ifdef PREPASS_DEPTH\nvViewPos=(view*worldPos).rgb;\n#endif\n#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*worldPos;\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;\npreviousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*finalPreviousWorld*previousInfluence*vec4(positionUpdated,1.0);\n#else\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#endif\n";Cn.v.IncludesShadersStore.prePassVertex=Si;var Mi="#if !defined(UV{X}) && defined(MAINUV{X})\nvec2 uv{X}=vec2(0.,0.);\n#endif\n#ifdef MAINUV{X}\nvMainUV{X}=uv{X};\n#endif\n";Cn.v.IncludesShadersStore.uvVariableDeclaration=Mi;var Ii="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nif (v_INFONAME_==0.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uvUpdated,1.0,0.0));\n}\n#ifdef UV2\nelse if (v_INFONAME_==1.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef UV3\nelse if (v_INFONAME_==2.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv3,1.0,0.0));\n}\n#endif\n#ifdef UV4\nelse if (v_INFONAME_==3.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv4,1.0,0.0));\n}\n#endif\n#ifdef UV5\nelse if (v_INFONAME_==4.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv5,1.0,0.0));\n}\n#endif\n#ifdef UV6\nelse if (v_INFONAME_==5.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv6,1.0,0.0));\n}\n#endif\n#endif\n";Cn.v.IncludesShadersStore.samplerVertexImplementation=Ii;var Pi="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif\n";Cn.v.IncludesShadersStore.bumpVertex=Pi;var Ci="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";Cn.v.IncludesShadersStore.clipPlaneVertex=Ci;var xi="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";Cn.v.IncludesShadersStore.fogVertex=xi;var Di="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {\nvPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}[i]=(-vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}[i]=(vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}=(-vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}=(vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#endif\n";Cn.v.IncludesShadersStore.shadowsVertex=Di;var Ri="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvColor=vec4(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvColor*=color;\n#else\nvColor.rgb*=color.rgb;\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvColor*=instanceColor;\n#endif\n#endif\n";Cn.v.IncludesShadersStore.vertexColorMixing=Ri;var ki="#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n";Cn.v.IncludesShadersStore.pointCloudVertex=ki;var Oi="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";Cn.v.IncludesShadersStore.logDepthVertex=Oi;var Li="#include<__decl__defaultVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<mainUVVaryingDeclaration>[1..7]\n#include<samplerVertexDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#if defined(SPECULARTERM)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular)\n#endif\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));\nvNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_MATRIXNAME_,diffuse,_INFONAME_,DiffuseInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#if defined(SPECULARTERM)\n#include<samplerVertexImplementation>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_MATRIXNAME_,specular,_INFONAME_,SpecularInfos.x)\n#endif\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";Cn.v.ShadersStore.defaultVertexShader=Li;function Fi(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ni(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ni(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ni(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var wi=function(){function e(){(0,st.Z)(this,e),this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return(0,lt.Z)(e,[{key:"unBindMesh",value:function(){this._mesh=null}},{key:"addFallback",value:function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)}},{key:"addCPUSkinningFallback",value:function(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)}},{key:"hasMoreFallbacks",get:function(){return this._currentRank<=this._maxRank}},{key:"reduce",value:function(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;for(var n=this._mesh.getScene(),i=0;i<n.meshes.length;i++){var r=n.meshes[i];if(r.material){if(r.computeBonesUsingShaders&&0!==r.numBoneInfluencers)if(r.material.getEffect()===t)r.computeBonesUsingShaders=!1;else if(r.subMeshes){var a,o=Fi(r.subMeshes);try{for(o.s();!(a=o.n()).done;){if(a.value.effect===t){r.computeBonesUsingShaders=!1;break}}}catch(u){o.e(u)}finally{o.f()}}}else!this._mesh.material&&r.computeBonesUsingShaders&&r.numBoneInfluencers>0&&(r.computeBonesUsingShaders=!1)}}else{var s=this._defines[this._currentRank];if(s)for(var l=0;l<s.length;l++)e=e.replace("#define "+s[l],"");this._currentRank++}return e}}]),e}(),Bi=n(2982);function Ui(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Vi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vi(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Vi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var Wi=function(){function e(t){(0,st.Z)(this,e),this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=t,this._scene=t.getScene(),this._engine=this._scene.getEngine()}return(0,lt.Z)(e,[{key:"_addPlugin",value:function(t){for(var n=0;n<this._plugins.length;++n)if(this._plugins[n].name===t.name)throw'Plugin "'.concat(t.name,'" already added to the material "').concat(this._material.name,'"!');if(this._material._uniformBufferLayoutBuilt)throw'The plugin "'.concat(t.name,'" can\'t be added to the material "').concat(this._material.name,'" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.');var i=t.getClassName();e._MaterialPluginClassToMainDefine[i]||(e._MaterialPluginClassToMainDefine[i]="MATERIALPLUGIN_"+ ++e._MaterialPluginCounter),this._material._callbackPluginEventGeneric=this._handlePluginEvent.bind(this),this._plugins.push(t),this._plugins.sort((function(e,t){return e.priority-t.priority})),this._codeInjectionPoints={};var r={};r[e._MaterialPluginClassToMainDefine[i]]={type:"boolean",default:!0};var a,o=Ui(this._plugins);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.collectDefines(r),this._collectPointNames("vertex",s.getCustomCode("vertex")),this._collectPointNames("fragment",s.getCustomCode("fragment"))}}catch(l){o.e(l)}finally{o.f()}this._defineNamesFromPlugins=r}},{key:"_activatePlugin",value:function(e){-1===this._activePlugins.indexOf(e)&&(this._activePlugins.push(e),this._activePlugins.sort((function(e,t){return e.priority-t.priority})),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),e.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(e),this._activePluginsForExtraEvents.sort((function(e,t){return e.priority-t.priority})),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}},{key:"getPlugin",value:function(e){for(var t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e)return this._plugins[t];return null}},{key:"_handlePluginEventIsReadyForSubMesh",value:function(e){var t,n=!0,i=Ui(this._activePlugins);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=n&&r.isReadyForSubMesh(e.defines,this._scene,this._engine,e.subMesh)}}catch(a){i.e(a)}finally{i.f()}e.isReadyForSubMesh=n}},{key:"_handlePluginEventPrepareDefinesBeforeAttributes",value:function(e){var t,n=Ui(this._activePlugins);try{for(n.s();!(t=n.n()).done;){t.value.prepareDefinesBeforeAttributes(e.defines,this._scene,e.mesh)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_handlePluginEventPrepareDefines",value:function(e){var t,n=Ui(this._activePlugins);try{for(n.s();!(t=n.n()).done;){t.value.prepareDefines(e.defines,this._scene,e.mesh)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_handlePluginEventHardBindForSubMesh",value:function(e){var t,n=Ui(this._activePluginsForExtraEvents);try{for(n.s();!(t=n.n()).done;){t.value.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_handlePluginEventBindForSubMesh",value:function(e){var t,n=Ui(this._activePlugins);try{for(n.s();!(t=n.n()).done;){t.value.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_handlePluginEventHasRenderTargetTextures",value:function(e){var t,n=!1,i=Ui(this._activePluginsForExtraEvents);try{for(i.s();!(t=i.n()).done;){if(n=t.value.hasRenderTargetTextures())break}}catch(r){i.e(r)}finally{i.f()}e.hasRenderTargetTextures=n}},{key:"_handlePluginEventFillRenderTargetTextures",value:function(e){var t,n=Ui(this._activePluginsForExtraEvents);try{for(n.s();!(t=n.n()).done;){t.value.fillRenderTargetTextures(e.renderTargets)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_handlePluginEvent",value:function(e,t){switch(e){case an.S.GetActiveTextures:var n,i=t,r=Ui(this._activePlugins);try{for(r.s();!(n=r.n()).done;){n.value.getActiveTextures(i.activeTextures)}}catch(D){r.e(D)}finally{r.f()}break;case an.S.GetAnimatables:var a,o=t,s=Ui(this._activePlugins);try{for(s.s();!(a=s.n()).done;){a.value.getAnimatables(o.animatables)}}catch(D){s.e(D)}finally{s.f()}break;case an.S.HasTexture:var l,u=t,c=!1,h=Ui(this._activePlugins);try{for(h.s();!(l=h.n()).done;){if(c=l.value.hasTexture(u.texture))break}}catch(D){h.e(D)}finally{h.f()}u.hasTexture=c;break;case an.S.Disposed:var f,d=t,v=Ui(this._plugins);try{for(v.s();!(f=v.n()).done;){f.value.dispose(d.forceDisposeTextures)}}catch(D){v.e(D)}finally{v.f()}break;case an.S.GetDefineNames:t.defineNames=this._defineNamesFromPlugins;break;case an.S.PrepareEffect:var p,_,g,m,y=t,A=Ui(this._activePlugins);try{for(A.s();!(p=A.n()).done;){var E=p.value;y.fallbackRank=E.addFallbacks(y.defines,y.fallbacks,y.fallbackRank),E.getAttributes(y.attributes,this._scene,y.mesh)}}catch(D){A.e(D)}finally{A.f()}if(this._uniformList.length>0)(_=y.uniforms).push.apply(_,(0,Bi.Z)(this._uniformList));if(this._samplerList.length>0)(g=y.samplers).push.apply(g,(0,Bi.Z)(this._samplerList));if(this._uboList.length>0)(m=y.uniformBuffersNames).push.apply(m,(0,Bi.Z)(this._uboList));y.customCode=this._injectCustomCode(y.customCode);break;case an.S.PrepareUniformBuffer:var b=t;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];var T,S=Ui(this._plugins);try{for(S.s();!(T=S.n()).done;){var M=T.value,I=M.getUniforms();if(I){if(I.ubo){var P,C=Ui(I.ubo);try{for(C.s();!(P=C.n()).done;){var x=P.value;b.ubo.addUniform(x.name,x.size),this._uboDeclaration+="".concat(x.type," ").concat(x.name,";\r\n"),this._uniformList.push(x.name)}}catch(D){C.e(D)}finally{C.f()}}I.vertex&&(this._vertexDeclaration+=I.vertex+"\r\n"),I.fragment&&(this._fragmentDeclaration+=I.fragment+"\r\n")}M.getSamplers(this._samplerList),M.getUniformBuffersNames(this._uboList)}}catch(D){S.e(D)}finally{S.f()}}}},{key:"_collectPointNames",value:function(e,t){if(t)for(var n in t)this._codeInjectionPoints[e]||(this._codeInjectionPoints[e]={}),this._codeInjectionPoints[e][n]=!0}},{key:"_injectCustomCode",value:function(e){var t=this;return function(n,i){var r;e&&(i=e(n,i)),t._uboDeclaration&&(i=i.replace("#define ADDITIONAL_UBO_DECLARATION",t._uboDeclaration)),t._vertexDeclaration&&(i=i.replace("#define ADDITIONAL_VERTEX_DECLARATION",t._vertexDeclaration)),t._fragmentDeclaration&&(i=i.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",t._fragmentDeclaration));var a=null===(r=t._codeInjectionPoints)||void 0===r?void 0:r[n];if(!a)return i;for(var o in a){var s,l="",u=Ui(t._activePlugins);try{for(u.s();!(s=u.n()).done;){var c=s.value.getCustomCode(n);null!=c&&c[o]&&(l+=c[o]+"\r\n")}}catch(_){u.e(_)}finally{u.f()}if(l.length>0)if("!"===o.charAt(0))for(var h=new RegExp(o.substring(1),"g"),f=h.exec(i);null!==f;){for(var d=l,v=0;v<f.length;++v)d=d.replace("$"+v,f[v]);i=i.replace(f[0],d),f=h.exec(i)}else{var p="#define "+o;i=i.replace(p,"\r\n"+l+"\r\n"+p)}}return i}}}]),e}();Wi._MaterialPluginClassToMainDefine={},Wi._MaterialPluginCounter=0;var Gi=function(){function e(t,n,i,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];(0,st.Z)(this,e),this.priority=500,this.registerForExtraEvents=!1,this._material=t,this.name=n,this.priority=i,t.pluginManager||(t.pluginManager=new Wi(t)),this._pluginDefineNames=r,this._pluginManager=t.pluginManager,a&&this._pluginManager._addPlugin(this),o&&this._enable(!0),this.markAllDefinesAsDirty=t._dirtyCallbacks[63]}return(0,lt.Z)(e,[{key:"_enable",value:function(e){e&&this._pluginManager._activatePlugin(this)}},{key:"getClassName",value:function(){return"MaterialPluginBase"}},{key:"isReadyForSubMesh",value:function(e,t,n,i){return!0}},{key:"hardBindForSubMesh",value:function(e,t,n,i){}},{key:"bindForSubMesh",value:function(e,t,n,i){}},{key:"dispose",value:function(e){}},{key:"getCustomCode",value:function(e){return null}},{key:"collectDefines",value:function(e){if(this._pluginDefineNames)for(var t=0,n=Object.keys(this._pluginDefineNames);t<n.length;t++){var i=n[t];if("_"!==i[0]){var r=typeof this._pluginDefineNames[i];e[i]={type:"number"===r?"number":"string"===r?"string":"boolean"===r?"boolean":"object",default:this._pluginDefineNames[i]}}}}},{key:"prepareDefinesBeforeAttributes",value:function(e,t,n){}},{key:"prepareDefines",value:function(e,t,n){}},{key:"hasTexture",value:function(e){return!1}},{key:"hasRenderTargetTextures",value:function(){return!1}},{key:"fillRenderTargetTextures",value:function(e){}},{key:"getActiveTextures",value:function(e){}},{key:"getAnimatables",value:function(e){}},{key:"addFallbacks",value:function(e,t,n){return n}},{key:"getSamplers",value:function(e){}},{key:"getAttributes",value:function(e,t,n){}},{key:"getUniformBuffersNames",value:function(e){}},{key:"getUniforms",value:function(){return{}}},{key:"copyTo",value:function(e){_t.p4.Clone((function(){return e}),this)}},{key:"serialize",value:function(){return _t.p4.Serialize(this)}},{key:"parse",value:function(e,t,n){var i=this;_t.p4.Parse((function(){return i}),e,t,n)}}]),e}();function Xi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}(0,pt.gn)([(0,_t.qC)()],Gi.prototype,"name",void 0),(0,pt.gn)([(0,_t.qC)()],Gi.prototype,"priority",void 0),(0,pt.gn)([(0,_t.qC)()],Gi.prototype,"registerForExtraEvents",void 0);var zi=function(e){(0,ft.Z)(n,e);var t=Xi(n);function n(){var e;return(0,st.Z)(this,n),(e=t.apply(this,arguments)).DETAIL=!1,e.DETAILDIRECTUV=0,e.DETAIL_NORMALBLENDMETHOD=0,e}return(0,lt.Z)(n)}(on.H),Hi=function(e){(0,ft.Z)(n,e);var t=Xi(n);function n(e){var i,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,st.Z)(this,n),(i=t.call(this,e,"DetailMap",140,new zi,r))._texture=null,i.diffuseBlendLevel=1,i.roughnessBlendLevel=1,i.bumpLevel=1,i._normalBlendMethod=rn.F.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,i._isEnabled=!1,i.isEnabled=!1,i._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],i}return(0,lt.Z)(n,[{key:"_markAllSubMeshesAsTexturesDirty",value:function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}},{key:"isReadyForSubMesh",value:function(e,t,n){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&n.getCaps().standardDerivatives&&this._texture&&Pn.DetailTextureEnabled&&!this._texture.isReady())}},{key:"prepareDefines",value:function(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var n=t.getEngine();e._areTexturesDirty&&(n.getCaps().standardDerivatives&&this._texture&&Pn.DetailTextureEnabled&&this._isEnabled?(un.G.PrepareDefinesForMergedUV(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1}},{key:"bindForSubMesh",value:function(e,t){if(this._isEnabled){var n=this._material.isFrozen;e.useUbo&&n&&e.isSync||this._texture&&Pn.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),un.G.BindTextureMatrix(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&Pn.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture)}}},{key:"hasTexture",value:function(e){return this._texture===e}},{key:"getActiveTextures",value:function(e){this._texture&&e.push(this._texture)}},{key:"getAnimatables",value:function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}},{key:"dispose",value:function(e){var t;e&&(null===(t=this._texture)||void 0===t||t.dispose())}},{key:"getClassName",value:function(){return"DetailMapConfiguration"}},{key:"getSamplers",value:function(e){e.push("detailSampler")}},{key:"getUniforms",value:function(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}]),n}(Gi);function Zi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}(0,pt.gn)([(0,_t.oU)("detailTexture"),(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],Hi.prototype,"texture",void 0),(0,pt.gn)([(0,_t.qC)()],Hi.prototype,"diffuseBlendLevel",void 0),(0,pt.gn)([(0,_t.qC)()],Hi.prototype,"roughnessBlendLevel",void 0),(0,pt.gn)([(0,_t.qC)()],Hi.prototype,"bumpLevel",void 0),(0,pt.gn)([(0,_t.qC)(),(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],Hi.prototype,"normalBlendMethod",void 0),(0,pt.gn)([(0,_t.qC)(),(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],Hi.prototype,"isEnabled",void 0);var Yi={effect:null,subMesh:null},Ki=function(e){(0,ft.Z)(n,e);var t=Zi(n);function n(e){var i;return(0,st.Z)(this,n),(i=t.call(this,e)).MAINUV1=!1,i.MAINUV2=!1,i.MAINUV3=!1,i.MAINUV4=!1,i.MAINUV5=!1,i.MAINUV6=!1,i.DIFFUSE=!1,i.DIFFUSEDIRECTUV=0,i.BAKED_VERTEX_ANIMATION_TEXTURE=!1,i.AMBIENT=!1,i.AMBIENTDIRECTUV=0,i.OPACITY=!1,i.OPACITYDIRECTUV=0,i.OPACITYRGB=!1,i.REFLECTION=!1,i.EMISSIVE=!1,i.EMISSIVEDIRECTUV=0,i.SPECULAR=!1,i.SPECULARDIRECTUV=0,i.BUMP=!1,i.BUMPDIRECTUV=0,i.PARALLAX=!1,i.PARALLAXOCCLUSION=!1,i.SPECULAROVERALPHA=!1,i.CLIPPLANE=!1,i.CLIPPLANE2=!1,i.CLIPPLANE3=!1,i.CLIPPLANE4=!1,i.CLIPPLANE5=!1,i.CLIPPLANE6=!1,i.ALPHATEST=!1,i.DEPTHPREPASS=!1,i.ALPHAFROMDIFFUSE=!1,i.POINTSIZE=!1,i.FOG=!1,i.SPECULARTERM=!1,i.DIFFUSEFRESNEL=!1,i.OPACITYFRESNEL=!1,i.REFLECTIONFRESNEL=!1,i.REFRACTIONFRESNEL=!1,i.EMISSIVEFRESNEL=!1,i.FRESNEL=!1,i.NORMAL=!1,i.TANGENT=!1,i.UV1=!1,i.UV2=!1,i.UV3=!1,i.UV4=!1,i.UV5=!1,i.UV6=!1,i.VERTEXCOLOR=!1,i.VERTEXALPHA=!1,i.NUM_BONE_INFLUENCERS=0,i.BonesPerMesh=0,i.BONETEXTURE=!1,i.BONES_VELOCITY_ENABLED=!1,i.INSTANCES=!1,i.THIN_INSTANCES=!1,i.INSTANCESCOLOR=!1,i.GLOSSINESS=!1,i.ROUGHNESS=!1,i.EMISSIVEASILLUMINATION=!1,i.LINKEMISSIVEWITHDIFFUSE=!1,i.REFLECTIONFRESNELFROMSPECULAR=!1,i.LIGHTMAP=!1,i.LIGHTMAPDIRECTUV=0,i.OBJECTSPACE_NORMALMAP=!1,i.USELIGHTMAPASSHADOWMAP=!1,i.REFLECTIONMAP_3D=!1,i.REFLECTIONMAP_SPHERICAL=!1,i.REFLECTIONMAP_PLANAR=!1,i.REFLECTIONMAP_CUBIC=!1,i.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,i.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,i.REFLECTIONMAP_PROJECTION=!1,i.REFLECTIONMAP_SKYBOX=!1,i.REFLECTIONMAP_EXPLICIT=!1,i.REFLECTIONMAP_EQUIRECTANGULAR=!1,i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,i.REFLECTIONMAP_OPPOSITEZ=!1,i.INVERTCUBICMAP=!1,i.LOGARITHMICDEPTH=!1,i.REFRACTION=!1,i.REFRACTIONMAP_3D=!1,i.REFLECTIONOVERALPHA=!1,i.TWOSIDEDLIGHTING=!1,i.SHADOWFLOAT=!1,i.MORPHTARGETS=!1,i.MORPHTARGETS_NORMAL=!1,i.MORPHTARGETS_TANGENT=!1,i.MORPHTARGETS_UV=!1,i.NUM_MORPH_INFLUENCERS=0,i.MORPHTARGETS_TEXTURE=!1,i.NONUNIFORMSCALING=!1,i.PREMULTIPLYALPHA=!1,i.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,i.ALPHABLEND=!0,i.PREPASS=!1,i.PREPASS_IRRADIANCE=!1,i.PREPASS_IRRADIANCE_INDEX=-1,i.PREPASS_ALBEDO_SQRT=!1,i.PREPASS_ALBEDO_SQRT_INDEX=-1,i.PREPASS_DEPTH=!1,i.PREPASS_DEPTH_INDEX=-1,i.PREPASS_NORMAL=!1,i.PREPASS_NORMAL_INDEX=-1,i.PREPASS_POSITION=!1,i.PREPASS_POSITION_INDEX=-1,i.PREPASS_VELOCITY=!1,i.PREPASS_VELOCITY_INDEX=-1,i.PREPASS_REFLECTIVITY=!1,i.PREPASS_REFLECTIVITY_INDEX=-1,i.SCENE_MRT_COUNT=0,i.RGBDLIGHTMAP=!1,i.RGBDREFLECTION=!1,i.RGBDREFRACTION=!1,i.IMAGEPROCESSING=!1,i.VIGNETTE=!1,i.VIGNETTEBLENDMODEMULTIPLY=!1,i.VIGNETTEBLENDMODEOPAQUE=!1,i.TONEMAPPING=!1,i.TONEMAPPING_ACES=!1,i.CONTRAST=!1,i.COLORCURVES=!1,i.COLORGRADING=!1,i.COLORGRADING3D=!1,i.SAMPLER3DGREENDEPTH=!1,i.SAMPLER3DBGRMAP=!1,i.DITHER=!1,i.IMAGEPROCESSINGPOSTPROCESS=!1,i.SKIPFINALCOLORCLAMP=!1,i.MULTIVIEW=!1,i.ORDER_INDEPENDENT_TRANSPARENCY=!1,i.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,i.IS_REFLECTION_LINEAR=!1,i.IS_REFRACTION_LINEAR=!1,i.EXPOSURE=!1,i.rebuild(),i}return(0,lt.Z)(n,[{key:"setReflectionMode",value:function(e){for(var t=0,n=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];t<n.length;t++){var i=n[t];this[i]=i===e}}}]),n}(on.H),ji=function(e){(0,ft.Z)(n,e);var t=Zi(n);function n(e,i){var r;return(0,st.Z)(this,n),(r=t.call(this,e,i))._diffuseTexture=null,r._ambientTexture=null,r._opacityTexture=null,r._reflectionTexture=null,r._emissiveTexture=null,r._specularTexture=null,r._bumpTexture=null,r._lightmapTexture=null,r._refractionTexture=null,r.ambientColor=new $e.Wo(0,0,0),r.diffuseColor=new $e.Wo(1,1,1),r.specularColor=new $e.Wo(1,1,1),r.emissiveColor=new $e.Wo(0,0,0),r.specularPower=64,r._useAlphaFromDiffuseTexture=!1,r._useEmissiveAsIllumination=!1,r._linkEmissiveWithDiffuse=!1,r._useSpecularOverAlpha=!1,r._useReflectionOverAlpha=!1,r._disableLighting=!1,r._useObjectSpaceNormalMap=!1,r._useParallax=!1,r._useParallaxOcclusion=!1,r.parallaxScaleBias=.05,r._roughness=0,r.indexOfRefraction=.98,r.invertRefractionY=!0,r.alphaCutOff=.4,r._useLightmapAsShadowmap=!1,r._useReflectionFresnelFromSpecular=!1,r._useGlossinessFromSpecularMapAlpha=!1,r._maxSimultaneousLights=4,r._invertNormalMapX=!1,r._invertNormalMapY=!1,r._twoSidedLighting=!1,r._renderTargets=new $t.t(16),r._worldViewProjectionMatrix=Je.y3.Zero(),r._globalAmbientColor=new $e.Wo(0,0,0),r._cacheHasRenderTargetTextures=!1,r.detailMap=new Hi((0,ct.Z)(r)),r._attachImageProcessingConfiguration(null),r.prePassConfiguration=new tn,r.getRenderTargetTextures=function(){return r._renderTargets.reset(),n.ReflectionTextureEnabled&&r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),n.RefractionTextureEnabled&&r._refractionTexture&&r._refractionTexture.isRenderTarget&&r._renderTargets.push(r._refractionTexture),r._eventInfo.renderTargets=r._renderTargets,r._callbackPluginEventFillRenderTargetTextures(r._eventInfo),r._renderTargets},r}return(0,lt.Z)(n,[{key:"imageProcessingConfiguration",get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}},{key:"_attachImageProcessingConfiguration",value:function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){t._markAllSubMeshesAsImageProcessingDirty()}))))}},{key:"isPrePassCapable",get:function(){return!this.disableDepthWrite}},{key:"cameraColorCurvesEnabled",get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}},{key:"cameraColorGradingEnabled",get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e}},{key:"cameraToneMappingEnabled",get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e}},{key:"cameraExposure",get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e}},{key:"cameraContrast",get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e}},{key:"cameraColorGradingTexture",get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e}},{key:"cameraColorCurves",get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e}},{key:"canRenderToMRT",get:function(){return!0}},{key:"hasRenderTargetTextures",get:function(){return!!(n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}},{key:"getClassName",value:function(){return"StandardMaterial"}},{key:"useLogarithmicDepth",get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()}},{key:"needAlphaBlending",value:function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}},{key:"needAlphaTesting",value:function(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===rn.F.MATERIAL_ALPHATEST)}},{key:"_shouldUseAlphaFromDiffuseTexture",value:function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==rn.F.MATERIAL_OPAQUE}},{key:"_hasAlphaChannel",value:function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture}},{key:"getAlphaTestTexture",value:function(){return this._diffuseTexture}},{key:"isReadyForSubMesh",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._uniformBufferLayoutBuilt||this.buildUniformLayout(),t.effect&&this.isFrozen&&t.effect._wasPreviouslyReady&&t.effect._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(this._callbackPluginEventGeneric(an.S.GetDefineNames,this._eventInfo),t.materialDefines=new Ki(this._eventInfo.defineNames));var r=this.getScene(),a=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();a._needNormals=un.G.PrepareDefinesForLights(r,e,a,!0,this._maxSimultaneousLights,this._disableLighting),un.G.PrepareDefinesForMultiview(r,a);var s=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if(un.G.PrepareDefinesForPrePass(r,a,this.canRenderToMRT&&!s),un.G.PrepareDefinesForOIT(r,a,s),a._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,a._needUVs=!1;for(var l=1;l<=6;++l)a["MAINUV"+l]=!1;if(r.texturesEnabled){if(a.DIFFUSEDIRECTUV=0,a.BUMPDIRECTUV=0,a.AMBIENTDIRECTUV=0,a.OPACITYDIRECTUV=0,a.EMISSIVEDIRECTUV=0,a.SPECULARDIRECTUV=0,a.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&n.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;un.G.PrepareDefinesForMergedUV(this._diffuseTexture,a,"DIFFUSE")}else a.DIFFUSE=!1;if(this._ambientTexture&&n.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;un.G.PrepareDefinesForMergedUV(this._ambientTexture,a,"AMBIENT")}else a.AMBIENT=!1;if(this._opacityTexture&&n.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;un.G.PrepareDefinesForMergedUV(this._opacityTexture,a,"OPACITY"),a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else a.OPACITY=!1;if(this._reflectionTexture&&n.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(a._needNormals=!0,a.REFLECTION=!0,a.ROUGHNESS=this._roughness>0,a.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,a.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===In.INVCUBIC_MODE,a.REFLECTIONMAP_3D=this._reflectionTexture.isCube,a.REFLECTIONMAP_OPPOSITEZ=a.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,a.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case In.EXPLICIT_MODE:a.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case In.PLANAR_MODE:a.setReflectionMode("REFLECTIONMAP_PLANAR");break;case In.PROJECTION_MODE:a.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case In.SKYBOX_MODE:a.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case In.SPHERICAL_MODE:a.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case In.EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case In.FIXED_EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case In.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case In.CUBIC_MODE:case In.INVCUBIC_MODE:default:a.setReflectionMode("REFLECTIONMAP_CUBIC")}a.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else a.REFLECTION=!1,a.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&n.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;un.G.PrepareDefinesForMergedUV(this._emissiveTexture,a,"EMISSIVE")}else a.EMISSIVE=!1;if(this._lightmapTexture&&n.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;un.G.PrepareDefinesForMergedUV(this._lightmapTexture,a,"LIGHTMAP"),a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,a.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else a.LIGHTMAP=!1;if(this._specularTexture&&n.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;un.G.PrepareDefinesForMergedUV(this._specularTexture,a,"SPECULAR"),a.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else a.SPECULAR=!1;if(r.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&n.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;un.G.PrepareDefinesForMergedUV(this._bumpTexture,a,"BUMP"),a.PARALLAX=this._useParallax,a.PARALLAXOCCLUSION=this._useParallaxOcclusion,a.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else a.BUMP=!1,a.PARALLAX=!1,a.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&n.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.REFRACTION=!0,a.REFRACTIONMAP_3D=this._refractionTexture.isCube,a.RGBDREFRACTION=this._refractionTexture.isRGBD,a.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else a.REFRACTION=!1;a.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else a.DIFFUSE=!1,a.AMBIENT=!1,a.OPACITY=!1,a.REFLECTION=!1,a.EMISSIVE=!1,a.LIGHTMAP=!1,a.BUMP=!1,a.REFRACTION=!1;a.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),a.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,a.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,a.SPECULAROVERALPHA=this._useSpecularOverAlpha,a.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,a.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,a.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(e)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=a,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(a._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a),a.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,a.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(a._areFresnelDirty&&(n.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(a.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,a.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,a.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,a.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,a.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,a.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,a._needNormals=!0,a.FRESNEL=!0):a.FRESNEL=!1),un.G.PrepareDefinesForMisc(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,a),un.G.PrepareDefinesForFrameBoundValues(r,o,a,i,null,t.getRenderingMesh().hasThinInstances),this._eventInfo.defines=a,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),un.G.PrepareDefinesForAttributes(e,a,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo),a.isDirty){var u=a._areLightsDisposed;a.markAsProcessed();var c=new wi;a.REFLECTION&&c.addFallback(0,"REFLECTION"),a.SPECULAR&&c.addFallback(0,"SPECULAR"),a.BUMP&&c.addFallback(0,"BUMP"),a.PARALLAX&&c.addFallback(1,"PARALLAX"),a.PARALLAXOCCLUSION&&c.addFallback(0,"PARALLAXOCCLUSION"),a.SPECULAROVERALPHA&&c.addFallback(0,"SPECULAROVERALPHA"),a.FOG&&c.addFallback(1,"FOG"),a.POINTSIZE&&c.addFallback(0,"POINTSIZE"),a.LOGARITHMICDEPTH&&c.addFallback(0,"LOGARITHMICDEPTH"),un.G.HandleFallbacksForShadows(a,c,this._maxSimultaneousLights),a.SPECULARTERM&&c.addFallback(0,"SPECULARTERM"),a.DIFFUSEFRESNEL&&c.addFallback(1,"DIFFUSEFRESNEL"),a.OPACITYFRESNEL&&c.addFallback(2,"OPACITYFRESNEL"),a.REFLECTIONFRESNEL&&c.addFallback(3,"REFLECTIONFRESNEL"),a.EMISSIVEFRESNEL&&c.addFallback(4,"EMISSIVEFRESNEL"),a.FRESNEL&&c.addFallback(4,"FRESNEL"),a.MULTIVIEW&&c.addFallback(0,"MULTIVIEW");var h=[en.o.PositionKind];a.NORMAL&&h.push(en.o.NormalKind),a.TANGENT&&h.push(en.o.TangentKind);for(var f=1;f<=6;++f)a["UV"+f]&&h.push("uv".concat(1===f?"":f));a.VERTEXCOLOR&&h.push(en.o.ColorKind),un.G.PrepareAttributesForBones(h,e,a,c),un.G.PrepareAttributesForInstances(h,a),un.G.PrepareAttributesForMorphTargets(h,e,a),un.G.PrepareAttributesForBakedVertexAnimation(h,e,a);var d="default",v=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],p=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],_=["Material","Scene","Mesh"];this._eventInfo.fallbacks=c,this._eventInfo.fallbackRank=0,this._eventInfo.defines=a,this._eventInfo.uniforms=v,this._eventInfo.attributes=h,this._eventInfo.samplers=p,this._eventInfo.uniformBuffersNames=_,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._callbackPluginEventGeneric(an.S.PrepareEffect,this._eventInfo),tn.AddUniforms(v),tn.AddSamplers(p),nn.$&&(nn.$.PrepareUniforms(v,a),nn.$.PrepareSamplers(p,a)),un.G.PrepareUniformsAndSamplersList({uniformsNames:v,uniformBuffersNames:_,samplers:p,defines:a,maxSimultaneousLights:this._maxSimultaneousLights});var g={};this.customShaderNameResolve&&(d=this.customShaderNameResolve(d,v,_,p,a,h,g));var m=a.toString(),y=t.effect,A=r.getEngine().createEffect(d,{attributes:h,uniformsNames:v,uniformBuffersNames:_,samplers:p,defines:m,fallbacks:c,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS},processFinalCode:g.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:a.PREPASS},o);if(A)if(this._onEffectCreatedObservable&&(Yi.effect=A,Yi.subMesh=t,this._onEffectCreatedObservable.notifyObservers(Yi)),this.allowShaderHotSwapping&&y&&!A.isReady()){if(A=y,a.markAsUnprocessed(),u)return a._areLightsDisposed=!0,!1}else r.resetCachedMaterial(),t.setEffect(A,a,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(a._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,t.effect._wasPreviouslyUsingInstances=i,r.performancePriority!==Ze.a.BackwardCompatible&&(this.checkReadyOnlyOnce=!0),!0)}},{key:"buildUniformLayout",value:function(){var e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("alphaCutOff",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vRefractionPosition",3),e.addUniform("vRefractionSize",3),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vDiffuseColor",4),e.addUniform("vAmbientColor",3),(0,ht.Z)((0,vt.Z)(n.prototype),"buildUniformLayout",this).call(this)}},{key:"bindForSubMesh",value:function(e,t,i){var r=this.getScene(),a=i.materialDefines;if(a){var o=i.effect;if(o){this._activeEffect=o,t.getMeshUniformBuffer().bindToEffect(o,"Mesh"),t.transferToEffect(e),this._uniformBuffer.bindToEffect(o,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,r,t,e,this.isFrozen),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),a.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var s=this._mustRebind(r,o,t.visibility);un.G.BindBonesParameters(t,o);var l=this._uniformBuffer;if(s){if(this.bindViewProjection(o),!l.useUbo||!this.isFrozen||!l.isSync){if(n.FresnelEnabled&&a.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(l.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),l.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&l.updateColor4("opacityParts",new $e.Wo(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(l.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),l.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(l.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),l.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(l.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),l.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),r.texturesEnabled){if(this._diffuseTexture&&n.DiffuseTextureEnabled&&(l.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),un.G.BindTextureMatrix(this._diffuseTexture,l,"diffuse")),this._ambientTexture&&n.AmbientTextureEnabled&&(l.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),un.G.BindTextureMatrix(this._ambientTexture,l,"ambient")),this._opacityTexture&&n.OpacityTextureEnabled&&(l.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),un.G.BindTextureMatrix(this._opacityTexture,l,"opacity")),this._hasAlphaChannel()&&l.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&n.ReflectionTextureEnabled&&(l.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),l.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var u=this._reflectionTexture;l.updateVector3("vReflectionPosition",u.boundingBoxPosition),l.updateVector3("vReflectionSize",u.boundingBoxSize)}if(this._emissiveTexture&&n.EmissiveTextureEnabled&&(l.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),un.G.BindTextureMatrix(this._emissiveTexture,l,"emissive")),this._lightmapTexture&&n.LightmapTextureEnabled&&(l.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),un.G.BindTextureMatrix(this._lightmapTexture,l,"lightmap")),this._specularTexture&&n.SpecularTextureEnabled&&(l.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),un.G.BindTextureMatrix(this._specularTexture,l,"specular")),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&(l.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),un.G.BindTextureMatrix(this._bumpTexture,l,"bump"),r._mirroredCameraPosition?l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&n.RefractionTextureEnabled){var c=1;if(this._refractionTexture.isCube||(l.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(c=this._refractionTexture.depth)),l.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,c,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){var h=this._refractionTexture;l.updateVector3("vRefractionPosition",h.boundingBoxPosition),l.updateVector3("vRefractionSize",h.boundingBoxSize)}}}this.pointsCloud&&l.updateFloat("pointSize",this.pointSize),a.SPECULARTERM&&l.updateColor4("vSpecularColor",this.specularColor,this.specularPower),l.updateColor3("vEmissiveColor",n.EmissiveTextureEnabled?this.emissiveColor:$e.Wo.BlackReadOnly),l.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),r.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),l.updateColor3("vAmbientColor",this._globalAmbientColor)}r.texturesEnabled&&(this._diffuseTexture&&n.DiffuseTextureEnabled&&o.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&n.AmbientTextureEnabled&&o.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&n.OpacityTextureEnabled&&o.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&n.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?o.setTexture("reflectionCubeSampler",this._reflectionTexture):o.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&n.EmissiveTextureEnabled&&o.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&n.LightmapTextureEnabled&&o.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&n.SpecularTextureEnabled&&o.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&o.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&n.RefractionTextureEnabled&&(this._refractionTexture.isCube?o.setTexture("refractionCubeSampler",this._refractionTexture):o.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(o),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),un.G.BindClipPlane(o,r),this.bindEyePosition(o)}else r.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(s||!this.isFrozen){var f;if(r.lightsEnabled&&!this._disableLighting&&un.G.BindLights(r,t,o,a,this._maxSimultaneousLights),(r.fogEnabled&&t.applyFog&&r.fogMode!==Ze.x.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||t.receiveShadows||a.PREPASS)&&this.bindView(o),un.G.BindFogParameters(r,t,o),a.NUM_MORPH_INFLUENCERS&&un.G.BindMorphTargetParameters(t,o),a.BAKED_VERTEX_ANIMATION_TEXTURE)null===(f=t.bakedVertexAnimationManager)||void 0===f||f.bind(o,a.INSTANCES);this.useLogarithmicDepth&&un.G.BindLogDepth(a,o,r),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(t,this._activeEffect),l.update()}}}},{key:"getAnimatables",value:function(){var e=(0,ht.Z)((0,vt.Z)(n.prototype),"getAnimatables",this).call(this);return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e}},{key:"getActiveTextures",value:function(){var e=(0,ht.Z)((0,vt.Z)(n.prototype),"getActiveTextures",this).call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e}},{key:"hasTexture",value:function(e){return!!(0,ht.Z)((0,vt.Z)(n.prototype),"hasTexture",this).call(this,e)||(this._diffuseTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._specularTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e))))))))}},{key:"dispose",value:function(e,t){var i,r,a,o,s,l,u,c,h;t&&(null===(i=this._diffuseTexture)||void 0===i||i.dispose(),null===(r=this._ambientTexture)||void 0===r||r.dispose(),null===(a=this._opacityTexture)||void 0===a||a.dispose(),null===(o=this._reflectionTexture)||void 0===o||o.dispose(),null===(s=this._emissiveTexture)||void 0===s||s.dispose(),null===(l=this._specularTexture)||void 0===l||l.dispose(),null===(u=this._bumpTexture)||void 0===u||u.dispose(),null===(c=this._lightmapTexture)||void 0===c||c.dispose(),null===(h=this._refractionTexture)||void 0===h||h.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),(0,ht.Z)((0,vt.Z)(n.prototype),"dispose",this).call(this,e,t)}},{key:"clone",value:function(e){var t=this,i=_t.p4.Clone((function(){return new n(e,t.getScene())}),this);return i.name=e,i.id=e,this.stencil.copyTo(i.stencil),i}}],[{key:"Parse",value:function(e,t,i){var r=_t.p4.Parse((function(){return new n(e.name,t)}),e,t,i);return e.stencil&&r.stencil.parse(e.stencil,t,i),r}},{key:"DiffuseTextureEnabled",get:function(){return Pn.DiffuseTextureEnabled},set:function(e){Pn.DiffuseTextureEnabled=e}},{key:"DetailTextureEnabled",get:function(){return Pn.DetailTextureEnabled},set:function(e){Pn.DetailTextureEnabled=e}},{key:"AmbientTextureEnabled",get:function(){return Pn.AmbientTextureEnabled},set:function(e){Pn.AmbientTextureEnabled=e}},{key:"OpacityTextureEnabled",get:function(){return Pn.OpacityTextureEnabled},set:function(e){Pn.OpacityTextureEnabled=e}},{key:"ReflectionTextureEnabled",get:function(){return Pn.ReflectionTextureEnabled},set:function(e){Pn.ReflectionTextureEnabled=e}},{key:"EmissiveTextureEnabled",get:function(){return Pn.EmissiveTextureEnabled},set:function(e){Pn.EmissiveTextureEnabled=e}},{key:"SpecularTextureEnabled",get:function(){return Pn.SpecularTextureEnabled},set:function(e){Pn.SpecularTextureEnabled=e}},{key:"BumpTextureEnabled",get:function(){return Pn.BumpTextureEnabled},set:function(e){Pn.BumpTextureEnabled=e}},{key:"LightmapTextureEnabled",get:function(){return Pn.LightmapTextureEnabled},set:function(e){Pn.LightmapTextureEnabled=e}},{key:"RefractionTextureEnabled",get:function(){return Pn.RefractionTextureEnabled},set:function(e){Pn.RefractionTextureEnabled=e}},{key:"ColorGradingTextureEnabled",get:function(){return Pn.ColorGradingTextureEnabled},set:function(e){Pn.ColorGradingTextureEnabled=e}},{key:"FresnelEnabled",get:function(){return Pn.FresnelEnabled},set:function(e){Pn.FresnelEnabled=e}}]),n}(ln);(0,pt.gn)([(0,_t.oU)("diffuseTexture")],ji.prototype,"_diffuseTexture",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],ji.prototype,"diffuseTexture",void 0),(0,pt.gn)([(0,_t.oU)("ambientTexture")],ji.prototype,"_ambientTexture",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"ambientTexture",void 0),(0,pt.gn)([(0,_t.oU)("opacityTexture")],ji.prototype,"_opacityTexture",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],ji.prototype,"opacityTexture",void 0),(0,pt.gn)([(0,_t.oU)("reflectionTexture")],ji.prototype,"_reflectionTexture",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"reflectionTexture",void 0),(0,pt.gn)([(0,_t.oU)("emissiveTexture")],ji.prototype,"_emissiveTexture",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"emissiveTexture",void 0),(0,pt.gn)([(0,_t.oU)("specularTexture")],ji.prototype,"_specularTexture",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"specularTexture",void 0),(0,pt.gn)([(0,_t.oU)("bumpTexture")],ji.prototype,"_bumpTexture",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"bumpTexture",void 0),(0,pt.gn)([(0,_t.oU)("lightmapTexture")],ji.prototype,"_lightmapTexture",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"lightmapTexture",void 0),(0,pt.gn)([(0,_t.oU)("refractionTexture")],ji.prototype,"_refractionTexture",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"refractionTexture",void 0),(0,pt.gn)([(0,_t.n9)("ambient")],ji.prototype,"ambientColor",void 0),(0,pt.gn)([(0,_t.n9)("diffuse")],ji.prototype,"diffuseColor",void 0),(0,pt.gn)([(0,_t.n9)("specular")],ji.prototype,"specularColor",void 0),(0,pt.gn)([(0,_t.n9)("emissive")],ji.prototype,"emissiveColor",void 0),(0,pt.gn)([(0,_t.qC)()],ji.prototype,"specularPower",void 0),(0,pt.gn)([(0,_t.qC)("useAlphaFromDiffuseTexture")],ji.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],ji.prototype,"useAlphaFromDiffuseTexture",void 0),(0,pt.gn)([(0,_t.qC)("useEmissiveAsIllumination")],ji.prototype,"_useEmissiveAsIllumination",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"useEmissiveAsIllumination",void 0),(0,pt.gn)([(0,_t.qC)("linkEmissiveWithDiffuse")],ji.prototype,"_linkEmissiveWithDiffuse",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"linkEmissiveWithDiffuse",void 0),(0,pt.gn)([(0,_t.qC)("useSpecularOverAlpha")],ji.prototype,"_useSpecularOverAlpha",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"useSpecularOverAlpha",void 0),(0,pt.gn)([(0,_t.qC)("useReflectionOverAlpha")],ji.prototype,"_useReflectionOverAlpha",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"useReflectionOverAlpha",void 0),(0,pt.gn)([(0,_t.qC)("disableLighting")],ji.prototype,"_disableLighting",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsLightsDirty")],ji.prototype,"disableLighting",void 0),(0,pt.gn)([(0,_t.qC)("useObjectSpaceNormalMap")],ji.prototype,"_useObjectSpaceNormalMap",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"useObjectSpaceNormalMap",void 0),(0,pt.gn)([(0,_t.qC)("useParallax")],ji.prototype,"_useParallax",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"useParallax",void 0),(0,pt.gn)([(0,_t.qC)("useParallaxOcclusion")],ji.prototype,"_useParallaxOcclusion",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"useParallaxOcclusion",void 0),(0,pt.gn)([(0,_t.qC)()],ji.prototype,"parallaxScaleBias",void 0),(0,pt.gn)([(0,_t.qC)("roughness")],ji.prototype,"_roughness",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"roughness",void 0),(0,pt.gn)([(0,_t.qC)()],ji.prototype,"indexOfRefraction",void 0),(0,pt.gn)([(0,_t.qC)()],ji.prototype,"invertRefractionY",void 0),(0,pt.gn)([(0,_t.qC)()],ji.prototype,"alphaCutOff",void 0),(0,pt.gn)([(0,_t.qC)("useLightmapAsShadowmap")],ji.prototype,"_useLightmapAsShadowmap",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"useLightmapAsShadowmap",void 0),(0,pt.gn)([(0,_t.qQ)("diffuseFresnelParameters")],ji.prototype,"_diffuseFresnelParameters",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsFresnelDirty")],ji.prototype,"diffuseFresnelParameters",void 0),(0,pt.gn)([(0,_t.qQ)("opacityFresnelParameters")],ji.prototype,"_opacityFresnelParameters",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsFresnelAndMiscDirty")],ji.prototype,"opacityFresnelParameters",void 0),(0,pt.gn)([(0,_t.qQ)("reflectionFresnelParameters")],ji.prototype,"_reflectionFresnelParameters",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsFresnelDirty")],ji.prototype,"reflectionFresnelParameters",void 0),(0,pt.gn)([(0,_t.qQ)("refractionFresnelParameters")],ji.prototype,"_refractionFresnelParameters",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsFresnelDirty")],ji.prototype,"refractionFresnelParameters",void 0),(0,pt.gn)([(0,_t.qQ)("emissiveFresnelParameters")],ji.prototype,"_emissiveFresnelParameters",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsFresnelDirty")],ji.prototype,"emissiveFresnelParameters",void 0),(0,pt.gn)([(0,_t.qC)("useReflectionFresnelFromSpecular")],ji.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsFresnelDirty")],ji.prototype,"useReflectionFresnelFromSpecular",void 0),(0,pt.gn)([(0,_t.qC)("useGlossinessFromSpecularMapAlpha")],ji.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,pt.gn)([(0,_t.qC)("maxSimultaneousLights")],ji.prototype,"_maxSimultaneousLights",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsLightsDirty")],ji.prototype,"maxSimultaneousLights",void 0),(0,pt.gn)([(0,_t.qC)("invertNormalMapX")],ji.prototype,"_invertNormalMapX",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"invertNormalMapX",void 0),(0,pt.gn)([(0,_t.qC)("invertNormalMapY")],ji.prototype,"_invertNormalMapY",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"invertNormalMapY",void 0),(0,pt.gn)([(0,_t.qC)("twoSidedLighting")],ji.prototype,"_twoSidedLighting",void 0),(0,pt.gn)([(0,_t.wz)("_markAllSubMeshesAsTexturesDirty")],ji.prototype,"twoSidedLighting",void 0),(0,pt.gn)([(0,_t.qC)()],ji.prototype,"useLogarithmicDepth",null),(0,Pt.H)("BABYLON.StandardMaterial",ji),Ze.x.DefaultMaterialFactory=function(e){return new ji("default material",e)};var qi=n(2668),Qi=n(9370),Ji=n(3192);function $i(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return er(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return er(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function er(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function tr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}Ye.Kj._instancedMeshFactory=function(e,t){var n=new nr(e,t);if(t.instancedBuffers)for(var i in n.instancedBuffers={},t.instancedBuffers)n.instancedBuffers[i]=t.instancedBuffers[i];return n};var nr=function(e){(0,ft.Z)(n,e);var t=tr(n);function n(e,i){var r;(0,st.Z)(this,n),(r=t.call(this,e,i.getScene()))._indexInSourceMeshInstanceArray=-1,r._distanceToCamera=0,i.addInstance((0,ct.Z)(r)),r._sourceMesh=i,r._unIndexed=i._unIndexed,r.position.copyFrom(i.position),r.rotation.copyFrom(i.rotation),r.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(r.rotationQuaternion=i.rotationQuaternion.clone()),r.animations=i.animations.slice();var a,o=$i(i.getAnimationRanges());try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&r.createAnimationRange(s.name,s.from,s.to)}}catch(l){o.e(l)}finally{o.f()}return r.infiniteDistance=i.infiniteDistance,r.setPivotMatrix(i.getPivotMatrix()),r.refreshBoundingInfo(!0,!0),r._syncSubMeshes(),r}return(0,lt.Z)(n,[{key:"getClassName",value:function(){return"InstancedMesh"}},{key:"lightSources",get:function(){return this._sourceMesh._lightSources}},{key:"_resyncLightSources",value:function(){}},{key:"_resyncLightSource",value:function(){}},{key:"_removeLightSource",value:function(){}},{key:"receiveShadows",get:function(){return this._sourceMesh.receiveShadows}},{key:"material",get:function(){return this._sourceMesh.material}},{key:"visibility",get:function(){return this._sourceMesh.visibility}},{key:"skeleton",get:function(){return this._sourceMesh.skeleton}},{key:"renderingGroupId",get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&Bt.Y.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}},{key:"getTotalVertices",value:function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}},{key:"getTotalIndices",value:function(){return this._sourceMesh.getTotalIndices()}},{key:"sourceMesh",get:function(){return this._sourceMesh}},{key:"createInstance",value:function(e){return this._sourceMesh.createInstance(e)}},{key:"isReady",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(e,!0)}},{key:"getVerticesData",value:function(e,t){return this._sourceMesh.getVerticesData(e,t)}},{key:"setVerticesData",value:function(e,t,n,i){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,n,i),this.sourceMesh}},{key:"updateVerticesData",value:function(e,t,n,i){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,n,i),this.sourceMesh}},{key:"setIndices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh}},{key:"isVerticesDataPresent",value:function(e){return this._sourceMesh.isVerticesDataPresent(e)}},{key:"getIndices",value:function(){return this._sourceMesh.getIndices()}},{key:"_positions",get:function(){return this._sourceMesh._positions}},{key:"refreshBoundingInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;var n=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e,t),n),this}},{key:"_preActivate",value:function(){return this._currentLOD&&this._currentLOD._preActivate(),this}},{key:"_activate",value:function(e,t){if((0,ht.Z)((0,vt.Z)(n.prototype),"_activate",this).call(this,e,t),this._sourceMesh.subMeshes||Bt.Y.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}},{key:"_postActivate",value:function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}},{key:"getWorldMatrix",value:function(){if(this._currentLOD&&this._currentLOD.billboardMode!==qi.Y.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new Je.y3);var e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,Je.jp.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(Je.jp.Vector3[7]),this._currentLOD._masterMesh=e,this._billboardWorldMatrix}return(0,ht.Z)((0,vt.Z)(n.prototype),"getWorldMatrix",this).call(this)}},{key:"isAnInstance",get:function(){return!0}},{key:"getLOD",value:function(e){if(!e)return this;var t=this.sourceMesh.getLODLevels();if(t&&0!==t.length){var n=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(e,n.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}},{key:"_preActivateForIntermediateRendering",value:function(e){return this.sourceMesh._preActivateForIntermediateRendering(e)}},{key:"_syncSubMeshes",value:function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this}},{key:"_generatePointsArray",value:function(){return this._sourceMesh._generatePointsArray()}},{key:"_updateBoundingInfo",value:function(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}},{key:"clone",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=(i||this._sourceMesh).createInstance(e);if(Ji.j.DeepCopy(this,r,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!n)for(var a=0;a<this.getScene().meshes.length;a++){var o=this.getScene().meshes[a];o.parent===this&&o.clone(o.name,r)}return r.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(r),r}},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.removeInstance(this),(0,ht.Z)((0,vt.Z)(n.prototype),"dispose",this).call(this,e,t)}},{key:"_serializeAsParent",value:function(e){(0,ht.Z)((0,vt.Z)(n.prototype),"_serializeAsParent",this).call(this,e),e.parentId=this._sourceMesh.uniqueId,e.parentInstanceIndex=this._indexInSourceMeshInstanceArray}},{key:"instantiateHierarchy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0,t&&t.newSourcedMesh);i&&n&&n(this,i);var r,a=$i(this.getChildTransformNodes(!0));try{for(a.s();!(r=a.n()).done;){var o=r.value;o.instantiateHierarchy(i,t,n)}}catch(s){a.e(s)}finally{a.f()}return i}}]),n}(Qi.x);Ye.Kj.prototype.registerInstancedBuffer=function(e,t){var n,i;if(null===(n=this._userInstancedBuffersStorage)||void 0===n||null===(i=n.vertexBuffers[e])||void 0===i||i.dispose(),!this.instancedBuffers){this.instancedBuffers={};var r,a=$i(this.instances);try{for(a.s();!(r=a.n()).done;){r.value.instancedBuffers={}}}catch(l){a.e(l)}finally{a.f()}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0})}this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new en.o(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0);var o,s=$i(this.instances);try{for(s.s();!(o=s.n()).done;){o.value.instancedBuffers[e]=null}}catch(l){s.e(l)}finally{s.f()}this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},Ye.Kj.prototype._processInstancedBuffers=function(e,t){var n=e.length;for(var i in this.instancedBuffers){for(var r=this._userInstancedBuffersStorage.sizes[i],a=this._userInstancedBuffersStorage.strides[i],o=(n+1)*a;r<o;)r*=2;this._userInstancedBuffersStorage.data[i].length!=r&&(this._userInstancedBuffersStorage.data[i]=new Float32Array(r),this._userInstancedBuffersStorage.sizes[i]=r,this._userInstancedBuffersStorage.vertexBuffers[i]&&(this._userInstancedBuffersStorage.vertexBuffers[i].dispose(),this._userInstancedBuffersStorage.vertexBuffers[i]=null));var s=this._userInstancedBuffersStorage.data[i],l=0;if(t){var u=this.instancedBuffers[i];u.toArray?u.toArray(s,l):u.copyToArray?u.copyToArray(s,l):s[l]=u,l+=a}for(var c=0;c<n;c++){var h=e[c].instancedBuffers[i];h.toArray?h.toArray(s,l):h.copyToArray?h.copyToArray(s,l):s[l]=h,l+=a}this._userInstancedBuffersStorage.vertexBuffers[i]?this._userInstancedBuffersStorage.vertexBuffers[i].updateDirectly(s,0):(this._userInstancedBuffersStorage.vertexBuffers[i]=new en.o(this.getEngine(),this._userInstancedBuffersStorage.data[i],i,!0,!1,a,!0),this._invalidateInstanceVertexArrayObject())}},Ye.Kj.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(var e in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[e]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},Ye.Kj.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}};var ir=n(1952),rr=n(1221);function ar(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return or(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return or(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function or(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function sr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}var lr=function(e){(0,ft.Z)(n,e);var t=sr(n);function n(e,i){var r;return(0,st.Z)(this,n),(r=t.call(this,e,i)).diffuse=new $e.Wo(1,1,1),r.specular=new $e.Wo(1,1,1),r.falloffType=n.FALLOFF_DEFAULT,r.intensity=1,r._range=Number.MAX_VALUE,r._inverseSquaredRange=0,r._photometricScale=1,r._intensityMode=n.INTENSITYMODE_AUTOMATIC,r._radius=1e-5,r.renderPriority=0,r._shadowEnabled=!0,r._excludeWithLayerMask=0,r._includeOnlyWithLayerMask=0,r._lightmapMode=0,r._excludedMeshesIds=new Array,r._includedOnlyMeshesIds=new Array,r._isLight=!0,r.getScene().addLight((0,ct.Z)(r)),r._uniformBuffer=new ir.M(r.getScene().getEngine(),void 0,void 0,e),r._buildUniformLayout(),r.includedOnlyMeshes=new Array,r.excludedMeshes=new Array,r._resyncMeshes(),r}return(0,lt.Z)(n,[{key:"range",get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)}},{key:"intensityMode",get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())}},{key:"includedOnlyMeshes",get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)}},{key:"excludedMeshes",get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)}},{key:"excludeWithLayerMask",get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()}},{key:"includeOnlyWithLayerMask",get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()}},{key:"lightmapMode",get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())}},{key:"transferTexturesToEffect",value:function(e,t){return this}},{key:"_bindLight",value:function(e,t,n,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=e.toString(),o=!1;if(this._uniformBuffer.bindToEffect(n,"Light"+a),this._renderId!==t.getRenderId()||this._lastUseSpecular!==i||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=i;var s=this.getScaledIntensity();this.transferToEffect(n,a),this.diffuse.scaleToRef(s,$e.zZ.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",$e.zZ.Color3[0],this.range,a),i&&(this.specular.scaleToRef(s,$e.zZ.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",$e.zZ.Color3[1],this.radius,a)),o=!0}if(this.transferTexturesToEffect(n,a),t.shadowsEnabled&&this.shadowEnabled&&r){var l=this.getShadowGenerator();l&&(l.bindShadowLight(a,n),o=!0)}o?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}},{key:"getClassName",value:function(){return"Light"}},{key:"toString",value:function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var n=0;n<this.animations.length;n++)t+=", animation[0]: "+this.animations[n].toString(e);return t}},{key:"_syncParentEnabledState",value:function(){(0,ht.Z)((0,vt.Z)(n.prototype),"_syncParentEnabledState",this).call(this),this.isDisposed()||this._resyncMeshes()}},{key:"setEnabled",value:function(e){(0,ht.Z)((0,vt.Z)(n.prototype),"setEnabled",this).call(this,e),this._resyncMeshes()}},{key:"getShadowGenerator",value:function(){return this._shadowGenerator}},{key:"getAbsolutePosition",value:function(){return Je.P.Zero()}},{key:"canAffectMesh",value:function(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))}},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this),this._parentContainer){var i=this._parentContainer.lights.indexOf(this);i>-1&&this._parentContainer.lights.splice(i,1),this._parentContainer=null}var r,a=ar(this.getScene().meshes);try{for(a.s();!(r=a.n()).done;){var o=r.value;o._removeLightSource(this,!0)}}catch(s){a.e(s)}finally{a.f()}this._uniformBuffer.dispose(),this.getScene().removeLight(this),(0,ht.Z)((0,vt.Z)(n.prototype),"dispose",this).call(this,e,t)}},{key:"getTypeID",value:function(){return 0}},{key:"getScaledIntensity",value:function(){return this._photometricScale*this.intensity}},{key:"clone",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=n.GetConstructorFromName(this.getTypeID(),e,this.getScene());if(!i)return null;var r=_t.p4.Clone(i,this);return e&&(r.name=e),t&&(r.parent=t),r.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(r),r}},{key:"serialize",value:function(){var e=_t.p4.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(e),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach((function(t){e.excludedMeshesIds.push(t.id)}))),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((function(t){e.includedOnlyMeshesIds.push(t.id)}))),_t.p4.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}},{key:"_hookArrayForExcluded",value:function(e){var t=this,n=e.push;e.push=function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];for(var o=n.apply(e,r),s=0,l=r;s<l.length;s++){var u=l[s];u._resyncLightSource(t)}return o};var i=e.splice;e.splice=function(n,r){var a,o=i.apply(e,[n,r]),s=ar(o);try{for(s.s();!(a=s.n()).done;){a.value._resyncLightSource(t)}}catch(l){s.e(l)}finally{s.f()}return o};var r,a=ar(e);try{for(a.s();!(r=a.n()).done;){r.value._resyncLightSource(this)}}catch(o){a.e(o)}finally{a.f()}}},{key:"_hookArrayForIncludedOnly",value:function(e){var t=this,n=e.push;e.push=function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];var o=n.apply(e,r);return t._resyncMeshes(),o};var i=e.splice;e.splice=function(n,r){var a=i.apply(e,[n,r]);return t._resyncMeshes(),a},this._resyncMeshes()}},{key:"_resyncMeshes",value:function(){var e,t=ar(this.getScene().meshes);try{for(t.s();!(e=t.n()).done;){e.value._resyncLightSource(this)}}catch(n){t.e(n)}finally{t.f()}}},{key:"_markMeshesAsLightDirty",value:function(){var e,t=ar(this.getScene().meshes);try{for(t.s();!(e=t.n()).done;){var n=e.value;-1!==n.lightSources.indexOf(this)&&n._markSubMeshesAsLightDirty()}}catch(i){t.e(i)}finally{t.f()}}},{key:"_computePhotometricScale",value:function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}},{key:"_getPhotometricScale",value:function(){var e=0,t=this.getTypeID(),i=this.intensityMode;switch(i===n.INTENSITYMODE_AUTOMATIC&&(i=t===n.LIGHTTYPEID_DIRECTIONALLIGHT?n.INTENSITYMODE_ILLUMINANCE:n.INTENSITYMODE_LUMINOUSINTENSITY),t){case n.LIGHTTYPEID_POINTLIGHT:case n.LIGHTTYPEID_SPOTLIGHT:switch(i){case n.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case n.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case n.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case n.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case n.INTENSITYMODE_ILLUMINANCE:e=1;break;case n.INTENSITYMODE_LUMINANCE:var r=this.radius;r=Math.max(r,.001),e=2*Math.PI*(1-Math.cos(r))}break;case n.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e}},{key:"_reorderLightsInScene",value:function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()}}],[{key:"GetConstructorFromName",value:function(e,t,n){var i=mt.N.Construct("Light_Type_"+e,t,n);return i||null}},{key:"Parse",value:function(e,t){var i=n.GetConstructorFromName(e.type,e.name,t);if(!i)return null;var r=_t.p4.Parse(i,e,t);if(e.excludedMeshesIds&&(r._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(r._includedOnlyMeshesIds=e.includedOnlyMeshesIds),void 0!==e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.falloffType&&(r.falloffType=e.falloffType),void 0!==e.lightmapMode&&(r.lightmapMode=e.lightmapMode),e.animations){for(var a=0;a<e.animations.length;a++){var o=e.animations[a],s=(0,Pt.q)("BABYLON.Animation");s&&r.animations.push(s.Parse(o))}mt.N.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&r.setEnabled(e.isEnabled),r}}]),n}(mt.N);function ur(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}lr.FALLOFF_DEFAULT=rr.m.FALLOFF_DEFAULT,lr.FALLOFF_PHYSICAL=rr.m.FALLOFF_PHYSICAL,lr.FALLOFF_GLTF=rr.m.FALLOFF_GLTF,lr.FALLOFF_STANDARD=rr.m.FALLOFF_STANDARD,lr.LIGHTMAP_DEFAULT=rr.m.LIGHTMAP_DEFAULT,lr.LIGHTMAP_SPECULAR=rr.m.LIGHTMAP_SPECULAR,lr.LIGHTMAP_SHADOWSONLY=rr.m.LIGHTMAP_SHADOWSONLY,lr.INTENSITYMODE_AUTOMATIC=rr.m.INTENSITYMODE_AUTOMATIC,lr.INTENSITYMODE_LUMINOUSPOWER=rr.m.INTENSITYMODE_LUMINOUSPOWER,lr.INTENSITYMODE_LUMINOUSINTENSITY=rr.m.INTENSITYMODE_LUMINOUSINTENSITY,lr.INTENSITYMODE_ILLUMINANCE=rr.m.INTENSITYMODE_ILLUMINANCE,lr.INTENSITYMODE_LUMINANCE=rr.m.INTENSITYMODE_LUMINANCE,lr.LIGHTTYPEID_POINTLIGHT=rr.m.LIGHTTYPEID_POINTLIGHT,lr.LIGHTTYPEID_DIRECTIONALLIGHT=rr.m.LIGHTTYPEID_DIRECTIONALLIGHT,lr.LIGHTTYPEID_SPOTLIGHT=rr.m.LIGHTTYPEID_SPOTLIGHT,lr.LIGHTTYPEID_HEMISPHERICLIGHT=rr.m.LIGHTTYPEID_HEMISPHERICLIGHT,(0,pt.gn)([(0,_t.n9)()],lr.prototype,"diffuse",void 0),(0,pt.gn)([(0,_t.n9)()],lr.prototype,"specular",void 0),(0,pt.gn)([(0,_t.qC)()],lr.prototype,"falloffType",void 0),(0,pt.gn)([(0,_t.qC)()],lr.prototype,"intensity",void 0),(0,pt.gn)([(0,_t.qC)()],lr.prototype,"range",null),(0,pt.gn)([(0,_t.qC)()],lr.prototype,"intensityMode",null),(0,pt.gn)([(0,_t.qC)()],lr.prototype,"radius",null),(0,pt.gn)([(0,_t.qC)()],lr.prototype,"_renderPriority",void 0),(0,pt.gn)([(0,_t.wz)("_reorderLightsInScene")],lr.prototype,"renderPriority",void 0),(0,pt.gn)([(0,_t.qC)("shadowEnabled")],lr.prototype,"_shadowEnabled",void 0),(0,pt.gn)([(0,_t.qC)("excludeWithLayerMask")],lr.prototype,"_excludeWithLayerMask",void 0),(0,pt.gn)([(0,_t.qC)("includeOnlyWithLayerMask")],lr.prototype,"_includeOnlyWithLayerMask",void 0),(0,pt.gn)([(0,_t.qC)("lightmapMode")],lr.prototype,"_lightmapMode",void 0),mt.N.AddNodeConstructor("Light_Type_3",(function(e,t){return function(){return new cr(e,Je.P.Zero(),t)}}));var cr=function(e){(0,ft.Z)(n,e);var t=ur(n);function n(e,i,r){var a;return(0,st.Z)(this,n),(a=t.call(this,e,r)).groundColor=new $e.Wo(0,0,0),a.direction=i||Je.P.Up(),a}return(0,lt.Z)(n,[{key:"_buildUniformLayout",value:function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}},{key:"getClassName",value:function(){return"HemisphericLight"}},{key:"setDirectionToTarget",value:function(e){return this.direction=Je.P.Normalize(e.subtract(Je.P.Zero())),this.direction}},{key:"getShadowGenerator",value:function(){return null}},{key:"transferToEffect",value:function(e,t){var n=Je.P.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",n.x,n.y,n.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this}},{key:"transferToNodeMaterialEffect",value:function(e,t){var n=Je.P.Normalize(this.direction);return e.setFloat3(t,n.x,n.y,n.z),this}},{key:"computeWorldMatrix",value:function(){return this._worldMatrix||(this._worldMatrix=Je.y3.Identity()),this._worldMatrix}},{key:"getTypeID",value:function(){return lr.LIGHTTYPEID_HEMISPHERICLIGHT}},{key:"prepareLightSpecificDefines",value:function(e,t){e["HEMILIGHT"+t]=!0}}]),n}(lr);function hr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}(0,pt.gn)([(0,_t.n9)()],cr.prototype,"groundColor",void 0),(0,pt.gn)([(0,_t.hd)()],cr.prototype,"direction",void 0);var fr=function(e){(0,ft.Z)(n,e);var t=hr(n);function n(){var e;return(0,st.Z)(this,n),(e=t.apply(this,arguments))._needProjectionMatrixCompute=!0,e}return(0,lt.Z)(n,[{key:"_setPosition",value:function(e){this._position=e}},{key:"position",get:function(){return this._position},set:function(e){this._setPosition(e)}},{key:"_setDirection",value:function(e){this._direction=e}},{key:"direction",get:function(){return this._direction},set:function(e){this._setDirection(e)}},{key:"shadowMinZ",get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()}},{key:"shadowMaxZ",get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()}},{key:"computeTransformedInformation",value:function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=Je.P.Zero()),Je.P.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=Je.P.Zero()),Je.P.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}},{key:"getDepthScale",value:function(){return 50}},{key:"getShadowDirection",value:function(e){return this.transformedDirection?this.transformedDirection:this.direction}},{key:"getAbsolutePosition",value:function(){return this.transformedPosition?this.transformedPosition:this.position}},{key:"setDirectionToTarget",value:function(e){return this.direction=Je.P.Normalize(e.subtract(this.position)),this.direction}},{key:"getRotation",value:function(){this.direction.normalize();var e=Je.P.Cross(this.direction,it.RD.Y),t=Je.P.Cross(e,this.direction);return Je.P.RotationFromAxis(e,t,this.direction)}},{key:"needCube",value:function(){return!1}},{key:"needProjectionMatrixCompute",value:function(){return this._needProjectionMatrixCompute}},{key:"forceProjectionMatrixCompute",value:function(){this._needProjectionMatrixCompute=!0}},{key:"_initCache",value:function(){(0,ht.Z)((0,vt.Z)(n.prototype),"_initCache",this).call(this),this._cache.position=Je.P.Zero()}},{key:"_isSynchronized",value:function(){return!!this._cache.position.equals(this.position)}},{key:"computeWorldMatrix",value:function(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=Je.y3.Identity()),Je.y3.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}},{key:"getDepthMinZ",value:function(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ}},{key:"getDepthMaxZ",value:function(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ}},{key:"setShadowProjectionMatrix",value:function(e,t,n){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,n,e):this._setDefaultShadowProjectionMatrix(e,t,n),this}},{key:"_syncParentEnabledState",value:function(){(0,ht.Z)((0,vt.Z)(n.prototype),"_syncParentEnabledState",this).call(this),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}}]),n}(lr);function dr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,vt.Z)(e);if(t){var r=(0,vt.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,dt.Z)(this,n)}}(0,pt.gn)([(0,_t.hd)()],fr.prototype,"position",null),(0,pt.gn)([(0,_t.hd)()],fr.prototype,"direction",null),(0,pt.gn)([(0,_t.qC)()],fr.prototype,"shadowMinZ",null),(0,pt.gn)([(0,_t.qC)()],fr.prototype,"shadowMaxZ",null),mt.N.AddNodeConstructor("Light_Type_0",(function(e,t){return function(){return new vr(e,Je.P.Zero(),t)}}));var vr=function(e){(0,ft.Z)(n,e);var t=dr(n);function n(e,i,r){var a;return(0,st.Z)(this,n),(a=t.call(this,e,r))._shadowAngle=Math.PI/2,a.position=i,a}return(0,lt.Z)(n,[{key:"shadowAngle",get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()}},{key:"direction",get:function(){return this._direction},set:function(e){var t=this.needCube();this._direction=e,this.needCube()!==t&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()}},{key:"getClassName",value:function(){return"PointLight"}},{key:"getTypeID",value:function(){return lr.LIGHTTYPEID_POINTLIGHT}},{key:"needCube",value:function(){return!this.direction}},{key:"getShadowDirection",value:function(e){if(this.direction)return(0,ht.Z)((0,vt.Z)(n.prototype),"getShadowDirection",this).call(this,e);switch(e){case 0:return new Je.P(1,0,0);case 1:return new Je.P(-1,0,0);case 2:return new Je.P(0,-1,0);case 3:return new Je.P(0,1,0);case 4:return new Je.P(0,0,1);case 5:return new Je.P(0,0,-1)}return Je.P.Zero()}},{key:"_setDefaultShadowProjectionMatrix",value:function(e,t,n){var i=this.getScene().activeCamera;if(i){var r=void 0!==this.shadowMinZ?this.shadowMinZ:i.minZ,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:i.maxZ,o=this.getScene().getEngine().useReverseDepthBuffer;Je.y3.PerspectiveFovLHToRef(this.shadowAngle,1,o?a:r,o?r:a,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}}},{key:"_buildUniformLayout",value:function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}},{key:"transferToEffect",value:function(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this}},{key:"transferToNodeMaterialEffect",value:function(e,t){return this.computeTransformedInformation()?e.setFloat3(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(t,this.position.x,this.position.y,this.position.z),this}},{key:"prepareLightSpecificDefines",value:function(e,t){e["POINTLIGHT"+t]=!0}}]),n}(fr);(0,pt.gn)([(0,_t.qC)()],vr.prototype,"shadowAngle",null);var pr=1.5,_r=1.5,gr=.5,mr=6,yr=-4,Ar=-6,Er=1.2,br=[[0,0,0,0,0,0,1,1,1],[0,0,0,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1]],Tr=function(e){return e+"-"+Math.random().toString(36).slice(2)},Sr=function(){function e(e){var t=this;this.engine=null,this.scene=null,this.camera=null,this.viewportRatio=Er,this.nodes=[],this.frameCount=0,this.onFrame=function(){for(var e=t.frameCount,n=0;n<t.nodes.length;n++)for(var i=t.nodes[n],r=0;r<i.length;r++){var a=i[r];a&&(a.position.y=pr*(Math.sin(e*_r*.01-.2*r+(e*_r*.006+.3*n))/10+Math.sin(e*_r*.01-r*n*.2)/10+Math.cos(e*_r*.02-.2*r)/8-.25))}t.frameCount=e+1,t.scene.render()},this.canvas=e,this.engine=new He.D(e,!0,{stencil:!0}),this.createScene(),this.populateScene(),this.engine.runRenderLoop(this.onFrame)}var t=e.prototype;return t.createScene=function(){this.scene=new Ze.x(this.engine),this.camera=new Jt("cam",0,0,0,Je.P.Zero(),this.scene,!0),this.camera.minZ=.1,this.camera.setPosition(new Je.P(5,5,-5)),this.camera.mode=1,this.camera.orthoTop=mr,this.camera.orthoBottom=-mr,this.camera.orthoLeft=-mr*this.viewportRatio,this.camera.orthoRight=mr*this.viewportRatio},t.createBlock=function(e){var t={faceUV:[new Je.Lt(0,0,1,1),new Je.Lt(0,0,.9,.9),new Je.Lt(0,0,1,.9),new Je.Lt(0,0,1,1),new Je.Lt(0,0,1,1),new Je.Lt(0,0,1,0)],wrap:!0},n=new ji(Tr("mat"));n.emissiveColor=$e.Wo.Red(),n.diffuseColor=$e.Wo.White(),n.emissiveColor=$e.Wo.White(),n.diffuseTexture=e;var i=tt(Tr("box"),Object.assign({size:1,height:2},t),this.scene);return i.material=n,i},t.populateScene=function(){var e=Qe("foor",{size:150},this.scene);e.material=new ji(Tr("mat")),e.material.emissiveColor=$e.Wo.White(),e.rotation.x=Math.PI/2,e.position.y=0;var t=new qi.Y("root");t.position.x=yr,t.position.z=Ar;var n=new In("data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAQDAwQDAwQEAwQFBAQFBgoHBgYGBg0JCggKDw0QEA8NDw4RExgUERIXEg4PFRwVFxkZGxsbEBQdHx0aHxgaGxr/2wBDAQQFBQYFBgwHBwwaEQ8RGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhr/wAARCAEAAQADASIAAhEBAxEB/8QAGQABAQEBAQEAAAAAAAAAAAAAAAYCBAEI/8QAIxABAAAFBAMBAQEAAAAAAAAAAAEDBAUVAjRTcoKSshJCMv/EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD7NlStc3Xp0S4frVq/zpdOLrOGPtpYte9kdlWCXxdZwx9tJi6zhj7aVQAl8XWcMfbSYus4Y+2lUAJfF1nDH20mLrOGPtpVACXxdZwx9tJi6zhj7aVQAl8XWcMfbSYus4Y+2lUAJfF1nDH20mLrOGPtpVACXxdZwx9tJi6zhj7aVQAl8XWcMfbSYus4Y+2lUAJfF1nDH20mLrOGPtpVACXxdZwx9tJi6zhj7aVQAl8XWcMfbSYus4Y+2lUAJfF1nDH20mLrOGPtpVACXxdZwx9tJi6zhj7aVQAl8XWcMfbSYus4Y+2lUAJfF1nDH20uabK1yZmrRMh+dUP5WKXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0dK165WvTrl6vzqh/ToyVXzRBUiWyVXzRMlV80QVIlslV80TJVfNEFSJbJVfNEyVXzRBUiWyVXzRMlV80QVIlslV80TJVfNEFSJbJVfNEyVXzRBUiWyVXzRMlV80QVIlslV80TJVfNEFSJbJVfNEyVXzRBUiWyVXzRMlV80QVIlslV80TJVfNEFSJbJVfNEyVXzRBUiWyVXzRMlV80QVIlslV80TJVfNEFSl7pv5/j8vMlV80XPNm65uvVrmav1q1f0D//2Q=="),i=this.createBlock(n);i.parent=t,i.setEnabled(!1),window.floor=e,window.root=t;for(var r=0;r<9;r++){var a=[];this.nodes[r]=a;for(var o=0;o<9;o++)if(br[r][o]){var s=i.createInstance();s.position.x=(1+gr)*r,s.position.z=(1+gr)*o,s.parent=t,s.setEnabled(!0),a[o]=s}else a[o]=!1}},t.onResize=function(){this.engine.resize()},t.dispose=function(){this.camera.dispose(),this.scene.dispose(),this.engine.dispose()},e}(),Mr=function(){var e=(0,h.useRef)(null);return(0,h.useEffect)((function(){if(e.current){var t=new Sr(e.current);e.current.classList.add("visible");var n=function(){return t.onResize()};return window.addEventListener("resize",n),function(){t.dispose(),window.removeEventListener("resize",n)}}}),[e]),h.createElement("div",{className:"animated-grid"},h.createElement("canvas",{className:"viewport",ref:e}))},Ir=function(){var e=(0,v.Z)(),t=Ve(),n=Ve({delay:.2});Ve({delay:.3});return h.createElement("div",{className:"hero",ref:t},h.createElement("div",{className:"wrapper"},h.createElement(Mr,null),h.createElement("div",{className:"hero-info",ref:n},h.createElement("h1",{className:"alpha"},e("hero:title",{span:function(e){return h.createElement("span",{className:"emphasis-text"},e)}})),h.createElement("p",{className:"intro-text"},e("hero:subtitle")),h.createElement(ze,{label:"action:hire",to:"#contact"}))))},Pr=function(e){var t,n=e.className,i=e.children,r=e.skin,a=e.id;return h.createElement("div",{className:d()("brick",(t={},t[n]=n,t[r]=r,t)),id:a},h.createElement("div",{className:"wrapper"},i))};Pr.defaultProps={skin:!1};var Cr=Pr;var xr="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDg5IDExOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxuczpzZXJpZj0iaHR0cDovL3d3dy5zZXJpZi5jb20vIiBzdHlsZT0iZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ij4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuNDY1MTk1LDAsMCwwLjY5NzA3LC00NTYuODUyLC00NDAuMjQ4KSI+CiAgICAgICAgPGcgaWQ9IkFydGJvYXJkNCI+CiAgICAgICAgICAgIDxyZWN0IHg9Ijk4MS42MDIiIHk9IjYzMi45NTIiIHdpZHRoPSIxOTAuMjY1IiBoZWlnaHQ9IjE2OC4xMzEiIHN0eWxlPSJmaWxsOm5vbmU7Ii8+CiAgICAgICAgICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDIuNzE0NTgsMCwwLDEuOTMzODksLTE4NDQuNzcsLTY2OC42NTgpIj4KICAgICAgICAgICAgICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuODk0Nzg3LDAsMCwwLjg0MjQzOCwtMTM3NC40LDEyMC4yNjYpIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMjcwMC44LDY3OC4wOTdMMjczOC45MSw2NTYuNTIzTDI3NzcuMyw2NzkuMTc2TDI3MzguNzgsNzAwLjkwNUwyNzAwLjgsNjc4LjA5N1oiIHN0eWxlPSJzdHJva2U6cmdiKDE1MywxNTMsMTUzKTtzdHJva2Utd2lkdGg6MS4yNXB4OyIvPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoMC44OTQ3ODcsMCwwLDAuODY5ODEsLTEzNzQuNCwxMDEuNjA5KSI+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTI3MDAuNiw3MzIuNjg4TDI3MDAuNjUsNjc4LjIzOUwyNzM4LjUxLDcwMC4yNTVMMjczOC4xLDc1Ni4xMjYiIHN0eWxlPSJzdHJva2U6cmdiKDE1MywxNTMsMTUzKTtzdHJva2Utd2lkdGg6MS4yNXB4OyIvPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoMC44OTQ3ODcsMCwwLDAuODc4OTY1LC0xMzc0LjQsOTUuMzU5NikiPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0yNzM4LjA1LDc1NS43MDFMMjczOC41MSw3MDAuMTcyTDI3NzcuMzQsNjc5LjI0TDI3NzcuMjIsNzMyLjgzMyIgc3R5bGU9InN0cm9rZTpyZ2IoMTUzLDE1MywxNTMpO3N0cm9rZS13aWR0aDoxLjI1cHg7Ii8+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPgo=";function Dr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Rr,kr,Or,Lr,Fr,Nr,wr,Br,Ur,Vr,Wr,Gr,Xr=function(){return Rr||"undefined"!=typeof window&&(Rr=window.gsap)&&Rr.registerPlugin&&Rr},zr=1,Hr=[],Zr=[],Yr=[],Kr=Date.now,jr=function(e,t){return t},qr=function(e,t){return~Yr.indexOf(e)&&Yr[Yr.indexOf(e)+1][t]},Qr=function(e){return!!~Vr.indexOf(e)},Jr=function(e,t,n,i,r){return e.addEventListener(t,n,{passive:!i,capture:!!r})},$r=function(e,t,n,i){return e.removeEventListener(t,n,!!i)},ea="scrollLeft",ta="scrollTop",na=function(){return Wr&&Wr.isPressed||Zr.cache++},ia=function(e,t){var n=function n(i){if(i||0===i){zr&&(Or.history.scrollRestoration="manual");var r=Wr&&Wr.isPressed;i=n.v=Math.round(i)||(Wr&&Wr.iOS?1:0),e(i),n.cacheID=Zr.cache,r&&jr("ss",i)}else(t||Zr.cache!==n.cacheID||jr("ref"))&&(n.cacheID=Zr.cache,n.v=e());return n.v+n.offset};return n.offset=0,e&&n},ra={s:ea,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:ia((function(e){return arguments.length?Or.scrollTo(e,aa.sc()):Or.pageXOffset||Lr.scrollLeft||Fr.scrollLeft||Nr.scrollLeft||0}))},aa={s:ta,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:ra,sc:ia((function(e){return arguments.length?Or.scrollTo(ra.sc(),e):Or.pageYOffset||Lr.scrollTop||Fr.scrollTop||Nr.scrollTop||0}))},oa=function(e){return Rr.utils.toArray(e)[0]||("string"==typeof e&&!1!==Rr.config().nullTargetWarn?console.warn("Element not found:",e):null)},sa=function(e,t){var n=t.s,i=t.sc,r=Zr.indexOf(e),a=i===aa.sc?1:2;return!~r&&(r=Zr.push(e)-1),Zr[r+a]||(Zr[r+a]=ia(qr(e,n),!0)||(Qr(e)?i:ia((function(t){return arguments.length?e[n]=t:e[n]}))))},la=function(e,t,n){var i=e,r=e,a=Kr(),o=a,s=t||50,l=Math.max(500,3*s),u=function(e,t){var l=Kr();t||l-a>s?(r=i,i=e,o=a,a=l):n?i+=e:i=r+(e-r)/(l-o)*(a-o)};return{update:u,reset:function(){r=i=n?0:i,o=a=0},getVelocity:function(e){var t=o,s=r,c=Kr();return(e||0===e)&&e!==i&&u(e),a===o||c-o>l?0:(i+(n?s:-s))/((n?c:a)-t)*1e3}}},ua=function(e,t){return t&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},ca=function(e){var t=Math.max.apply(Math,e),n=Math.min.apply(Math,e);return Math.abs(t)>=Math.abs(n)?t:n},ha=function(){var e,t,n,i;(Ur=Rr.core.globals().ScrollTrigger)&&Ur.core&&(e=Ur.core,t=e.bridge||{},n=e._scrollers,i=e._proxies,n.push.apply(n,Zr),i.push.apply(i,Yr),Zr=n,Yr=i,jr=function(e,n){return t[e](n)})},fa=function(e){return(Rr=e||Xr())&&"undefined"!=typeof document&&document.body&&(Or=window,Lr=document,Fr=Lr.documentElement,Nr=Lr.body,Vr=[Or,Lr,Fr,Nr],Rr.utils.clamp,Br="onpointerenter"in Nr?"pointer":"mouse",wr=da.isTouch=Or.matchMedia&&Or.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in Or||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,Gr=da.eventTypes=("ontouchstart"in Fr?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in Fr?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout((function(){return zr=0}),500),ha(),kr=1),kr};ra.op=aa,Zr.cache=0;var da=function(){function e(e){this.init(e)}var t,n,i;return e.prototype.init=function(e){kr||fa(Rr)||console.warn("Please gsap.registerPlugin(Observer)"),Ur||ha();var t=e.tolerance,n=e.dragMinimum,i=e.type,r=e.target,a=e.lineHeight,o=e.debounce,s=e.preventDefault,l=e.onStop,u=e.onStopDelay,c=e.ignore,h=e.wheelSpeed,f=e.event,d=e.onDragStart,v=e.onDragEnd,p=e.onDrag,_=e.onPress,g=e.onRelease,m=e.onRight,y=e.onLeft,A=e.onUp,E=e.onDown,b=e.onChangeX,T=e.onChangeY,S=e.onChange,M=e.onToggleX,I=e.onToggleY,P=e.onHover,C=e.onHoverEnd,x=e.onMove,D=e.ignoreCheck,R=e.isNormalizer,k=e.onGestureStart,O=e.onGestureEnd,L=e.onWheel,F=e.onEnable,N=e.onDisable,w=e.onClick,B=e.scrollSpeed,U=e.capture,V=e.allowClicks,W=e.lockAxis,G=e.onLockAxis;this.target=r=oa(r)||Fr,this.vars=e,c&&(c=Rr.utils.toArray(c)),t=t||1e-9,n=n||0,h=h||1,B=B||1,i=i||"wheel,touch,pointer",o=!1!==o,a||(a=parseFloat(Or.getComputedStyle(Nr).lineHeight)||22);var X,z,H,Z,Y,K,j,q=this,Q=0,J=0,$=sa(r,ra),ee=sa(r,aa),te=$(),ne=ee(),ie=~i.indexOf("touch")&&!~i.indexOf("pointer")&&"pointerdown"===Gr[0],re=Qr(r),ae=r.ownerDocument||Lr,oe=[0,0,0],se=[0,0,0],le=0,ue=function(){return le=Kr()},ce=function(e,t){return(q.event=e)&&c&&~c.indexOf(e.target)||t&&ie&&"touch"!==e.pointerType||D&&D(e,t)},he=function(){var e=q.deltaX=ca(oe),n=q.deltaY=ca(se),i=Math.abs(e)>=t,r=Math.abs(n)>=t;S&&(i||r)&&S(q,e,n,oe,se),i&&(m&&q.deltaX>0&&m(q),y&&q.deltaX<0&&y(q),b&&b(q),M&&q.deltaX<0!=Q<0&&M(q),Q=q.deltaX,oe[0]=oe[1]=oe[2]=0),r&&(E&&q.deltaY>0&&E(q),A&&q.deltaY<0&&A(q),T&&T(q),I&&q.deltaY<0!=J<0&&I(q),J=q.deltaY,se[0]=se[1]=se[2]=0),(Z||H)&&(x&&x(q),H&&(p(q),H=!1),Z=!1),K&&!(K=!1)&&G&&G(q),Y&&(L(q),Y=!1),X=0},fe=function(e,t,n){oe[n]+=e,se[n]+=t,q._vx.update(e),q._vy.update(t),o?X||(X=requestAnimationFrame(he)):he()},de=function(e,t){W&&!j&&(q.axis=j=Math.abs(e)>Math.abs(t)?"x":"y",K=!0),"y"!==j&&(oe[2]+=e,q._vx.update(e,!0)),"x"!==j&&(se[2]+=t,q._vy.update(t,!0)),o?X||(X=requestAnimationFrame(he)):he()},ve=function(e){if(!ce(e,1)){var t=(e=ua(e,s)).clientX,i=e.clientY,r=t-q.x,a=i-q.y,o=q.isDragging;q.x=t,q.y=i,(o||Math.abs(q.startX-t)>=n||Math.abs(q.startY-i)>=n)&&(p&&(H=!0),o||(q.isDragging=!0),de(r,a),o||d&&d(q))}},pe=q.onPress=function(e){ce(e,1)||(q.axis=j=null,z.pause(),q.isPressed=!0,e=ua(e),Q=J=0,q.startX=q.x=e.clientX,q.startY=q.y=e.clientY,q._vx.reset(),q._vy.reset(),Jr(R?r:ae,Gr[1],ve,s,!0),q.deltaX=q.deltaY=0,_&&_(q))},_e=function(e){if(!ce(e,1)){$r(R?r:ae,Gr[1],ve,!0);var t=q.isDragging&&(Math.abs(q.x-q.startX)>3||Math.abs(q.y-q.startY)>3),n=ua(e);t||(q._vx.reset(),q._vy.reset(),s&&V&&Rr.delayedCall(.08,(function(){if(Kr()-le>300&&!e.defaultPrevented)if(e.target.click)e.target.click();else if(ae.createEvent){var t=ae.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,Or,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(t)}}))),q.isDragging=q.isGesturing=q.isPressed=!1,l&&!R&&z.restart(!0),v&&t&&v(q),g&&g(q,t)}},ge=function(e){return e.touches&&e.touches.length>1&&(q.isGesturing=!0)&&k(e,q.isDragging)},me=function(){return(q.isGesturing=!1)||O(q)},ye=function(e){if(!ce(e)){var t=$(),n=ee();fe((t-te)*B,(n-ne)*B,1),te=t,ne=n,l&&z.restart(!0)}},Ae=function(e){if(!ce(e)){e=ua(e,s),L&&(Y=!0);var t=(1===e.deltaMode?a:2===e.deltaMode?Or.innerHeight:1)*h;fe(e.deltaX*t,e.deltaY*t,0),l&&!R&&z.restart(!0)}},Ee=function(e){if(!ce(e)){var t=e.clientX,n=e.clientY,i=t-q.x,r=n-q.y;q.x=t,q.y=n,Z=!0,(i||r)&&de(i,r)}},be=function(e){q.event=e,P(q)},Te=function(e){q.event=e,C(q)},Se=function(e){return ce(e)||ua(e,s)&&w(q)};z=q._dc=Rr.delayedCall(u||.25,(function(){q._vx.reset(),q._vy.reset(),z.pause(),l&&l(q)})).pause(),q.deltaX=q.deltaY=0,q._vx=la(0,50,!0),q._vy=la(0,50,!0),q.scrollX=$,q.scrollY=ee,q.isDragging=q.isGesturing=q.isPressed=!1,q.enable=function(e){return q.isEnabled||(Jr(re?ae:r,"scroll",na),i.indexOf("scroll")>=0&&Jr(re?ae:r,"scroll",ye,s,U),i.indexOf("wheel")>=0&&Jr(r,"wheel",Ae,s,U),(i.indexOf("touch")>=0&&wr||i.indexOf("pointer")>=0)&&(Jr(r,Gr[0],pe,s,U),Jr(ae,Gr[2],_e),Jr(ae,Gr[3],_e),V&&Jr(r,"click",ue,!1,!0),w&&Jr(r,"click",Se),k&&Jr(ae,"gesturestart",ge),O&&Jr(ae,"gestureend",me),P&&Jr(r,Br+"enter",be),C&&Jr(r,Br+"leave",Te),x&&Jr(r,Br+"move",Ee)),q.isEnabled=!0,e&&e.type&&pe(e),F&&F(q)),q},q.disable=function(){q.isEnabled&&(Hr.filter((function(e){return e!==q&&Qr(e.target)})).length||$r(re?ae:r,"scroll",na),q.isPressed&&(q._vx.reset(),q._vy.reset(),$r(R?r:ae,Gr[1],ve,!0)),$r(re?ae:r,"scroll",ye,U),$r(r,"wheel",Ae,U),$r(r,Gr[0],pe,U),$r(ae,Gr[2],_e),$r(ae,Gr[3],_e),$r(r,"click",ue,!0),$r(r,"click",Se),$r(ae,"gesturestart",ge),$r(ae,"gestureend",me),$r(r,Br+"enter",be),$r(r,Br+"leave",Te),$r(r,Br+"move",Ee),q.isEnabled=q.isPressed=q.isDragging=!1,N&&N(q))},q.kill=function(){q.disable();var e=Hr.indexOf(q);e>=0&&Hr.splice(e,1),Wr===q&&(Wr=0)},Hr.push(q),R&&Qr(r)&&(Wr=q),q.enable(f)},t=e,(n=[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}])&&Dr(t.prototype,n),i&&Dr(t,i),e}();da.version="3.11.1",da.create=function(e){return new da(e)},da.register=fa,da.getAll=function(){return Hr.slice()},da.getById=function(e){return Hr.filter((function(t){return t.vars.id===e}))[0]},Xr()&&Rr.registerPlugin(da);var va,pa,_a,ga,ma,ya,Aa,Ea,ba,Ta,Sa,Ma,Ia,Pa,Ca,xa,Da,Ra,ka,Oa,La,Fa,Na,wa,Ba,Ua,Va,Wa,Ga,Xa,za,Ha,Za=1,Ya=Date.now,Ka=Ya(),ja=0,qa=0,Qa=function(){return Pa=1},Ja=function(){return Pa=0},$a=function(e){return e},eo=function(e){return Math.round(1e5*e)/1e5||0},to=function(){return"undefined"!=typeof window},no=function(){return va||to()&&(va=window.gsap)&&va.registerPlugin&&va},io=function(e){return!!~Aa.indexOf(e)},ro=function(e){return qr(e,"getBoundingClientRect")||(io(e)?function(){return hs.width=_a.innerWidth,hs.height=_a.innerHeight,hs}:function(){return Io(e)})},ao=function(e,t){var n=t.s,i=t.d2,r=t.d,a=t.a;return(n="scroll"+i)&&(a=qr(e,n))?a()-ro(e)()[r]:io(e)?(ma[n]||ya[n])-(_a["inner"+i]||ma["client"+i]||ya["client"+i]):e[n]-e["offset"+i]},oo=function(e,t){for(var n=0;n<ka.length;n+=3)(!t||~t.indexOf(ka[n+1]))&&e(ka[n],ka[n+1],ka[n+2])},so=function(e){return"string"==typeof e},lo=function(e){return"function"==typeof e},uo=function(e){return"number"==typeof e},co=function(e){return"object"==typeof e},ho=function(e,t,n){return e&&e.progress(t?0:1)&&n&&e.pause()},fo=function(e,t){if(e.enabled){var n=t(e);n&&n.totalTime&&(e.callbackAnimation=n)}},vo=Math.abs,po="left",_o="right",go="bottom",mo="width",yo="height",Ao="padding",Eo="margin",bo="Width",To="px",So=function(e){return _a.getComputedStyle(e)},Mo=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},Io=function(e,t){var n=t&&"matrix(1, 0, 0, 1, 0, 0)"!==So(e)[Ca]&&va.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),i=e.getBoundingClientRect();return n&&n.progress(0).kill(),i},Po=function(e,t){var n=t.d2;return e["offset"+n]||e["client"+n]||0},Co=function(e){var t,n=[],i=e.labels,r=e.duration();for(t in i)n.push(i[t]/r);return n},xo=function(e){var t=va.utils.snap(e),n=Array.isArray(e)&&e.slice(0).sort((function(e,t){return e-t}));return n?function(e,i,r){var a;if(void 0===r&&(r=.001),!i)return t(e);if(i>0){for(e-=r,a=0;a<n.length;a++)if(n[a]>=e)return n[a];return n[a-1]}for(a=n.length,e+=r;a--;)if(n[a]<=e)return n[a];return n[0]}:function(n,i,r){void 0===r&&(r=.001);var a=t(n);return!i||Math.abs(a-n)<r||a-n<0==i<0?a:t(i<0?n-e:n+e)}},Do=function(e,t,n,i){return n.split(",").forEach((function(n){return e(t,n,i)}))},Ro=function(e,t,n,i,r){return e.addEventListener(t,n,{passive:!i,capture:!!r})},ko=function(e,t,n,i){return e.removeEventListener(t,n,!!i)},Oo=function(e,t,n){return n&&n.wheelHandler&&e(t,"wheel",n)},Lo={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},Fo={toggleActions:"play",anticipatePin:0},No={top:0,left:0,center:.5,bottom:1,right:1},wo=function(e,t){if(so(e)){var n=e.indexOf("="),i=~n?+(e.charAt(n-1)+1)*parseFloat(e.substr(n+1)):0;~n&&(e.indexOf("%")>n&&(i*=t/100),e=e.substr(0,n-1)),e=i+(e in No?No[e]*t:~e.indexOf("%")?parseFloat(e)*t/100:parseFloat(e)||0)}return e},Bo=function(e,t,n,i,r,a,o,s){var l=r.startColor,u=r.endColor,c=r.fontSize,h=r.indent,f=r.fontWeight,d=ga.createElement("div"),v=io(n)||"fixed"===qr(n,"pinType"),p=-1!==e.indexOf("scroller"),_=v?ya:n,g=-1!==e.indexOf("start"),m=g?l:u,y="border-color:"+m+";font-size:"+c+";color:"+m+";font-weight:"+f+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return y+="position:"+((p||s)&&v?"fixed;":"absolute;"),(p||s||!v)&&(y+=(i===aa?_o:go)+":"+(a+parseFloat(h))+"px;"),o&&(y+="box-sizing:border-box;text-align:left;width:"+o.offsetWidth+"px;"),d._isStart=g,d.setAttribute("class","gsap-marker-"+e+(t?" marker-"+t:"")),d.style.cssText=y,d.innerText=t||0===t?e+"-"+t:e,_.children[0]?_.insertBefore(d,_.children[0]):_.appendChild(d),d._offset=d["offset"+i.op.d2],Uo(d,0,i,g),d},Uo=function(e,t,n,i){var r={display:"block"},a=n[i?"os2":"p2"],o=n[i?"p2":"os2"];e._isFlipped=i,r[n.a+"Percent"]=i?-100:0,r[n.a]=i?"1px":0,r["border"+a+bo]=1,r["border"+o+bo]=0,r[n.p]=t+"px",va.set(e,r)},Vo=[],Wo={},Go=function(){return Ya()-ja>34&&rs()},Xo=function(){(!Na||!Na.isPressed||Na.startX>ya.clientWidth)&&(Zr.cache++,Xa||(Xa=requestAnimationFrame(rs)),ja||jo("scrollStart"),ja=Ya())},zo=function(){Ua=_a.innerWidth,Ba=_a.innerHeight},Ho=function(){Zr.cache++,!Ia&&!Fa&&!ga.fullscreenElement&&!ga.webkitFullscreenElement&&(!wa||Ua!==_a.innerWidth||Math.abs(_a.innerHeight-Ba)>.25*_a.innerHeight)&&Ea.restart(!0)},Zo={},Yo=[],Ko=function e(){return ko(_s,"scrollEnd",e)||ts(!0)},jo=function(e){return Zo[e]&&Zo[e].map((function(e){return e()}))||Yo},qo=[],Qo=function(e){for(var t=0;t<qo.length;t+=5)(!e||qo[t+4]&&qo[t+4].query===e)&&(qo[t].style.cssText=qo[t+1],qo[t].getBBox&&qo[t].setAttribute("transform",qo[t+2]||""),qo[t+3].uncache=1)},Jo=function(e,t){var n;for(xa=0;xa<Vo.length;xa++)!(n=Vo[xa])||t&&n._ctx!==t||(e?n.kill(1):n.revert(!0,!0));t&&Qo(t),t||jo("revert")},$o=function(){return Zr.cache++&&Zr.forEach((function(e){return"function"==typeof e&&(e.rec=0)}))},es=0,ts=function(e,t){if(!ja||e){za=!0;var n=jo("refreshInit");Oa&&_s.sort(),t||Jo(),Vo.slice(0).forEach((function(e){return e.refresh()})),Vo.forEach((function(e){return"max"===e.vars.end&&e.setPositions(e.start,Math.max(e.start+1,ao(e.scroller,e._dir)))})),n.forEach((function(e){return e&&e.render&&e.render(-1)})),Zr.forEach((function(e){return"function"==typeof e&&e(e.rec)})),$o(),Ea.pause(),es++,za=!1,jo("refresh")}else Ro(_s,"scrollEnd",Ko)},ns=0,is=1,rs=function(){if(!za){_s.isUpdating=!0,Ha&&Ha.update(0);var e=Vo.length,t=Ya(),n=t-Ka>=50,i=e&&Vo[0].scroll();if(is=ns>i?-1:1,ns=i,n&&(ja&&!Pa&&t-ja>200&&(ja=0,jo("scrollEnd")),Sa=Ka,Ka=t),is<0){for(xa=e;xa-- >0;)Vo[xa]&&Vo[xa].update(0,n);is=1}else for(xa=0;xa<e;xa++)Vo[xa]&&Vo[xa].update(0,n);_s.isUpdating=!1}Xa=0},as=[po,"top",go,_o,"marginBottom","marginRight","marginTop","marginLeft","display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],os=as.concat([mo,yo,"boxSizing","maxWidth","maxHeight","position",Eo,Ao,"paddingTop","paddingRight","paddingBottom","paddingLeft"]),ss=function(e,t,n,i){if(!e._gsap.swappedIn){for(var r,a=as.length,o=t.style,s=e.style;a--;)o[r=as[a]]=n[r];o.position="absolute"===n.position?"absolute":"relative","inline"===n.display&&(o.display="inline-block"),s.bottom=s.right="auto",o.flexBasis=n.flexBasis||"auto",o.overflow="visible",o.boxSizing="border-box",o.width=Po(e,ra)+To,o.height=Po(e,aa)+To,o.padding=s.margin=s.top=s.left="0",us(i),s.width=s.maxWidth=n.width,s.height=s.maxHeight=n.height,s.padding=n.padding,e.parentNode!==t&&(e.parentNode.insertBefore(t,e),t.appendChild(e)),e._gsap.swappedIn=!0}},ls=/([A-Z])/g,us=function(e){if(e){var t,n,i=e.t.style,r=e.length,a=0;for((e.t._gsap||va.core.getCache(e.t)).uncache=1;a<r;a+=2)n=e[a+1],t=e[a],n?i[t]=n:i[t]&&i.removeProperty(t.replace(ls,"-$1").toLowerCase())}},cs=function(e){for(var t=os.length,n=e.style,i=[],r=0;r<t;r++)i.push(os[r],n[os[r]]);return i.t=e,i},hs={left:0,top:0},fs=function(e,t,n,i,r,a,o,s,l,u,c,h,f){lo(e)&&(e=e(s)),so(e)&&"max"===e.substr(0,3)&&(e=h+("="===e.charAt(4)?wo("0"+e.substr(3),n):0));var d,v,p,_=f?f.time():0;if(f&&f.seek(0),uo(e))o&&Uo(o,n,i,!0);else{lo(t)&&(t=t(s));var g,m,y,A,E=(e||"0").split(" ");p=oa(t)||ya,(g=Io(p)||{})&&(g.left||g.top)||"none"!==So(p).display||(A=p.style.display,p.style.display="block",g=Io(p),A?p.style.display=A:p.style.removeProperty("display")),m=wo(E[0],g[i.d]),y=wo(E[1]||"0",n),e=g[i.p]-l[i.p]-u+m+r-y,o&&Uo(o,y,i,n-y<20||o._isStart&&y>20),n-=n-y}if(a){var b=e+n,T=a._isStart;d="scroll"+i.d2,Uo(a,b,i,T&&b>20||!T&&(c?Math.max(ya[d],ma[d]):a.parentNode[d])<=b+1),c&&(l=Io(o),c&&(a.style[i.op.p]=l[i.op.p]-i.op.m-a._offset+To))}return f&&p&&(d=Io(p),f.seek(h),v=Io(p),f._caScrollDist=d[i.p]-v[i.p],e=e/f._caScrollDist*h),f&&f.seek(_),f?e:Math.round(e)},ds=/(webkit|moz|length|cssText|inset)/i,vs=function(e,t,n,i){if(e.parentNode!==t){var r,a,o=e.style;if(t===ya){for(r in e._stOrig=o.cssText,a=So(e))+r||ds.test(r)||!a[r]||"string"!=typeof o[r]||"0"===r||(o[r]=a[r]);o.top=n,o.left=i}else o.cssText=e._stOrig;va.core.getCache(e).uncache=1,t.appendChild(e)}},ps=function(e,t){var n,i,r=sa(e,t),a="_scroll"+t.p2,o=function t(o,s,l,u,c){var h=t.tween,f=s.onComplete,d={};return l=l||r(),c=u&&c||0,u=u||o-l,h&&h.kill(),n=Math.round(l),s[a]=o,s.modifiers=d,d[a]=function(e){return(e=Math.round(r()))!==n&&e!==i&&Math.abs(e-n)>3&&Math.abs(e-i)>3?(h.kill(),t.tween=0):e=l+u*h.ratio+c*h.ratio*h.ratio,i=n,n=Math.round(e)},s.onComplete=function(){t.tween=0,f&&f.call(h)},h=t.tween=va.to(e,s)};return e[a]=r,r.wheelHandler=function(){return o.tween&&o.tween.kill()&&(o.tween=0)},Ro(e,"wheel",r.wheelHandler),o},_s=function(){function e(t,n){pa||e.register(va)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),this.init(t,n)}return e.prototype.init=function(t,n){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),qa){var i,r,a,o,s,l,u,c,h,f,d,v,p,_,g,m,y,A,E,b,T,S,M,I,P,C,x,D,R,k,O,L,F,N,w,B,U,V,W,G,X,z=t=Mo(so(t)||uo(t)||t.nodeType?{trigger:t}:t,Fo),H=z.onUpdate,Z=z.toggleClass,Y=z.id,K=z.onToggle,j=z.onRefresh,q=z.scrub,Q=z.trigger,J=z.pin,$=z.pinSpacing,ee=z.invalidateOnRefresh,te=z.anticipatePin,ne=z.onScrubComplete,ie=z.onSnapComplete,re=z.once,ae=z.snap,oe=z.pinReparent,se=z.pinSpacer,le=z.containerAnimation,ue=z.fastScrollEnd,ce=z.preventOverlaps,he=t.horizontal||t.containerAnimation&&!1!==t.horizontal?ra:aa,fe=!q&&0!==q,de=oa(t.scroller||_a),ve=va.core.getCache(de),pe=io(de),_e="fixed"===("pinType"in t?t.pinType:qr(de,"pinType")||pe&&"fixed"),ge=[t.onEnter,t.onLeave,t.onEnterBack,t.onLeaveBack],me=fe&&t.toggleActions.split(" "),ye="markers"in t?t.markers:Fo.markers,Ae=pe?0:parseFloat(So(de)["border"+he.p2+bo])||0,Ee=this,be=t.onRefreshInit&&function(){return t.onRefreshInit(Ee)},Te=function(e,t,n){var i=n.d,r=n.d2,a=n.a;return(a=qr(e,"getBoundingClientRect"))?function(){return a()[i]}:function(){return(t?_a["inner"+r]:e["client"+r])||0}}(de,pe,he),Se=function(e,t){return!t||~Yr.indexOf(e)?ro(e):function(){return hs}}(de,pe),Me=0,Ie=0,Pe=sa(de,he);if(Wa(Ee),Ee._dir=he,te*=45,Ee.scroller=de,Ee.scroll=le?le.time.bind(le):Pe,o=Pe(),Ee.vars=t,n=n||t.animation,"refreshPriority"in t&&(Oa=1,-9999===t.refreshPriority&&(Ha=Ee)),ve.tweenScroll=ve.tweenScroll||{top:ps(de,aa),left:ps(de,ra)},Ee.tweenTo=i=ve.tweenScroll[he.p],Ee.scrubDuration=function(e){(O=uo(e)&&e)?k?k.duration(e):k=va.to(n,{ease:"expo",totalProgress:"+=0.001",duration:O,paused:!0,onComplete:function(){return ne&&ne(Ee)}}):(k&&k.progress(1).kill(),k=0)},n&&(n.vars.lazy=!1,n._initted||!1!==n.vars.immediateRender&&!1!==t.immediateRender&&n.render(0,!0,!0),Ee.animation=n.pause(),n.scrollTrigger=Ee,Ee.scrubDuration(q),D=0,Y||(Y=n.vars.id)),Vo.push(Ee),ae&&(co(ae)&&!ae.push||(ae={snapTo:ae}),"scrollBehavior"in ya.style&&va.set(pe?[ya,ma]:de,{scrollBehavior:"auto"}),a=lo(ae.snapTo)?ae.snapTo:"labels"===ae.snapTo?function(e){return function(t){return va.utils.snap(Co(e),t)}}(n):"labelsDirectional"===ae.snapTo?(W=n,function(e,t){return xo(Co(W))(e,t.direction)}):!1!==ae.directional?function(e,t){return xo(ae.snapTo)(e,Ya()-Ie<500?0:t.direction)}:va.utils.snap(ae.snapTo),L=ae.duration||{min:.1,max:2},L=co(L)?Ta(L.min,L.max):Ta(L,L),F=va.delayedCall(ae.delay||O/2||.1,(function(){var e=Pe(),t=Ya()-Ie<500,r=i.tween;if(!(t||Math.abs(Ee.getVelocity())<10)||r||Pa||Me===e)Ee.isActive&&Me!==e&&F.restart(!0);else{var o=(e-l)/p,s=n&&!fe?n.totalProgress():o,c=t?0:(s-R)/(Ya()-Sa)*1e3||0,h=va.utils.clamp(-o,1-o,vo(c/2)*c/.185),f=o+(!1===ae.inertia?0:h),d=Ta(0,1,a(f,Ee)),v=Math.round(l+d*p),_=ae,g=_.onStart,m=_.onInterrupt,y=_.onComplete;if(e<=u&&e>=l&&v!==e){if(r&&!r._initted&&r.data<=vo(v-e))return;!1===ae.inertia&&(h=d-o),i(v,{duration:L(vo(.185*Math.max(vo(f-s),vo(d-s))/c/.05||0)),ease:ae.ease||"power3",data:vo(v-e),onInterrupt:function(){return F.restart(!0)&&m&&m(Ee)},onComplete:function(){Ee.update(),Me=Pe(),D=R=n&&!fe?n.totalProgress():Ee.progress,ie&&ie(Ee),y&&y(Ee)}},e,h*p,v-e-h*p),g&&g(Ee,i.tween)}}})).pause()),Y&&(Wo[Y]=Ee),(V=(Q=Ee.trigger=oa(Q||J))&&Q._gsap&&Q._gsap.stRevert)&&(V=V(Ee)),J=!0===J?Q:oa(J),so(Z)&&(Z={targets:Q,className:Z}),J&&(!1===$||$===Eo||($=!(!$&&"flex"===So(J.parentNode).display)&&Ao),Ee.pin=J,!1!==t.force3D&&va.set(J,{force3D:!0}),(r=va.core.getCache(J)).spacer?_=r.pinState:(se&&((se=oa(se))&&!se.nodeType&&(se=se.current||se.nativeElement),r.spacerIsNative=!!se,se&&(r.spacerState=cs(se))),r.spacer=y=se||ga.createElement("div"),y.classList.add("pin-spacer"),Y&&y.classList.add("pin-spacer-"+Y),r.pinState=_=cs(J)),Ee.spacer=y=r.spacer,x=So(J),M=x[$+he.os2],E=va.getProperty(J),b=va.quickSetter(J,he.a,To),ss(J,y,x),m=cs(J)),ye){v=co(ye)?Mo(ye,Lo):Lo,f=Bo("scroller-start",Y,de,he,v,0),d=Bo("scroller-end",Y,de,he,v,0,f),A=f["offset"+he.op.d2];var Ce=oa(qr(de,"content")||de);c=this.markerStart=Bo("start",Y,Ce,he,v,A,0,le),h=this.markerEnd=Bo("end",Y,Ce,he,v,A,0,le),le&&(U=va.quickSetter([c,h],he.a,To)),_e||Yr.length&&!0===qr(de,"fixedMarkers")||(X=So(G=pe?ya:de).position,G.style.position="absolute"===X||"fixed"===X?X:"relative",va.set([f,d],{force3D:!0}),P=va.quickSetter(f,he.a,To),C=va.quickSetter(d,he.a,To))}if(le){var xe=le.vars.onUpdate,De=le.vars.onUpdateParams;le.eventCallback("onUpdate",(function(){Ee.update(0,0,1),xe&&xe.apply(De||[])}))}Ee.previous=function(){return Vo[Vo.indexOf(Ee)-1]},Ee.next=function(){return Vo[Vo.indexOf(Ee)+1]},Ee.revert=function(e,t){if(!t)return Ee.kill(!0);var i=!1!==e||!Ee.enabled,r=Ia;i!==Ee.isReverted&&(i&&(Ee.scroll.rec||!Ia&&!za||(Ee.scroll.rec=Pe(),za&&Pe(0)),w=Math.max(Pe(),Ee.scroll.rec||0),N=Ee.progress,B=n&&n.progress()),c&&[c,h,f,d].forEach((function(e){return e.style.display=i?"none":"block"})),i&&(Ia=1),Ee.update(i),Ia=r,J&&(i?function(e,t,n){us(n);var i=e._gsap;if(i.spacerIsNative)us(i.spacerState);else if(e._gsap.swappedIn){var r=t.parentNode;r&&(r.insertBefore(e,t),r.removeChild(t))}e._gsap.swappedIn=!1}(J,y,_):(!oe||!Ee.isActive)&&ss(J,y,So(J),I)),Ee.isReverted=i)},Ee.refresh=function(r,a){if(!Ia&&Ee.enabled||a)if(J&&r&&ja)Ro(e,"scrollEnd",Ko);else{!za&&be&&be(Ee),Ia=1,Ie=Ya(),i.tween&&(i.tween.kill(),i.tween=0),k&&k.pause(),ee&&n&&n.revert().invalidate(),Ee.isReverted||Ee.revert(!0,!0);for(var v,A,b,M,P,C,x,D,R,O,L=Te(),U=Se(),V=le?le.duration():ao(de,he),W=0,G=0,X=t.end,z=t.endTrigger||Q,H=t.start||(0!==t.start&&Q?J?"0 0":"0 100%":0),Z=Ee.pinnedContainer=t.pinnedContainer&&oa(t.pinnedContainer),Y=Q&&Math.max(0,Vo.indexOf(Ee))||0,K=Y;K--;)(C=Vo[K]).end||C.refresh(0,1)||(Ia=1),!(x=C.pin)||x!==Q&&x!==J||C.isReverted||(O||(O=[]),O.unshift(C),C.revert(!0,!0)),C!==Vo[K]&&(Y--,K--);for(lo(H)&&(H=H(Ee)),l=fs(H,Q,L,he,Pe(),c,f,Ee,U,Ae,_e,V,le)||(J?-.001:0),lo(X)&&(X=X(Ee)),so(X)&&!X.indexOf("+=")&&(~X.indexOf(" ")?X=(so(H)?H.split(" ")[0]:"")+X:(W=wo(X.substr(2),L),X=so(H)?H:l+W,z=Q)),u=Math.max(l,fs(X||(z?"100% 0":V),z,L,he,Pe()+W,h,d,Ee,U,Ae,_e,V,le))||-.001,p=u-l||(l-=.01)&&.001,W=0,K=Y;K--;)(x=(C=Vo[K]).pin)&&C.start-C._pinPush<l&&!le&&C.end>0&&(v=C.end-C.start,x!==Q&&x!==Z||uo(H)||(W+=v*(1-C.progress)),x===J&&(G+=v));if(l+=W,u+=W,Ee._pinPush=G,c&&W&&((v={})[he.a]="+="+W,Z&&(v[he.p]="-="+Pe()),va.set([c,h],v)),J)v=So(J),M=he===aa,b=Pe(),T=parseFloat(E(he.a))+G,!V&&u>1&&((pe?ya:de).style["overflow-"+he.a]="scroll"),ss(J,y,v),m=cs(J),A=Io(J,!0),D=_e&&sa(de,M?ra:aa)(),$&&((I=[$+he.os2,p+G+To]).t=y,(K=$===Ao?Po(J,he)+p+G:0)&&I.push(he.d,K+To),us(I),_e&&Pe(w)),_e&&((P={top:A.top+(M?b-l:D)+To,left:A.left+(M?D:b-l)+To,boxSizing:"border-box",position:"fixed"}).width=P.maxWidth=Math.ceil(A.width)+To,P.height=P.maxHeight=Math.ceil(A.height)+To,P.margin=P.marginTop=P.marginRight=P.marginBottom=P.marginLeft="0",P.padding=v.padding,P.paddingTop=v.paddingTop,P.paddingRight=v.paddingRight,P.paddingBottom=v.paddingBottom,P.paddingLeft=v.paddingLeft,g=function(e,t,n){for(var i,r=[],a=e.length,o=n?8:0;o<a;o+=2)i=e[o],r.push(i,i in t?t[i]:e[o+1]);return r.t=e.t,r}(_,P,oe),za&&Pe(0)),n?(R=n._initted,La(1),n.render(n.duration(),!0,!0),S=E(he.a)-T+p+G,p!==S&&_e&&g.splice(g.length-2,2),n.render(0,!0,!0),R||n.invalidate(),La(0)):S=p;else if(Q&&Pe()&&!le)for(A=Q.parentNode;A&&A!==ya;)A._pinOffset&&(l-=A._pinOffset,u-=A._pinOffset),A=A.parentNode;O&&O.forEach((function(e){return e.revert(!1,!0)})),Ee.start=l,Ee.end=u,o=s=Pe(),le||za||(o<w&&Pe(w),Ee.scroll.rec=0),Ee.revert(!1,!0),F&&(Me=-1,Ee.isActive&&Pe(l+p*N),F.restart(!0)),Ia=0,n&&fe&&(n._initted||B)&&n.progress()!==B&&n.progress(B,!0).render(n.time(),!0,!0),(N!==Ee.progress||le)&&(n&&!fe&&n.totalProgress(N,!0),Ee.progress=(o-l)/p===N?0:N,Ee.update(0,0,1)),J&&$&&(y._pinOffset=Math.round(Ee.progress*S)),j&&j(Ee)}},Ee.getVelocity=function(){return(Pe()-s)/(Ya()-Sa)*1e3||0},Ee.endAnimation=function(){ho(Ee.callbackAnimation),n&&(k?k.progress(1):n.paused()?fe||ho(n,Ee.direction<0,1):ho(n,n.reversed()))},Ee.labelToScroll=function(e){return n&&n.labels&&(l||Ee.refresh()||l)+n.labels[e]/n.duration()*p||0},Ee.getTrailing=function(e){var t=Vo.indexOf(Ee),n=Ee.direction>0?Vo.slice(0,t).reverse():Vo.slice(t+1);return(so(e)?n.filter((function(t){return t.vars.preventOverlaps===e})):n).filter((function(e){return Ee.direction>0?e.end<=l:e.start>=u}))},Ee.update=function(e,t,r){if(!le||r||e){var a,c,h,d,v,_,A,E=Ee.scroll(),I=e?0:(E-l)/p,x=I<0?0:I>1?1:I||0,O=Ee.progress;if(t&&(s=o,o=le?Pe():E,ae&&(R=D,D=n&&!fe?n.totalProgress():x)),te&&!x&&J&&!Ia&&!Za&&ja&&l<E+(E-s)/(Ya()-Sa)*te&&(x=1e-4),x!==O&&Ee.enabled){if(d=(v=(a=Ee.isActive=!!x&&x<1)!==(!!O&&O<1))||!!x!=!!O,Ee.direction=x>O?1:-1,Ee.progress=x,d&&!Ia&&(c=x&&!O?0:1===x?1:1===O?2:3,fe&&(h=!v&&"none"!==me[c+1]&&me[c+1]||me[c],A=n&&("complete"===h||"reset"===h||h in n))),ce&&(v||A)&&(A||q||!n)&&(lo(ce)?ce(Ee):Ee.getTrailing(ce).forEach((function(e){return e.endAnimation()}))),fe||(!k||Ia||Za?n&&n.totalProgress(x,!!Ia):((le||Ha&&Ha!==Ee)&&k.render(k._dp._time-k._start),k.resetTo?k.resetTo("totalProgress",x,n._tTime/n._tDur):(k.vars.totalProgress=x,k.invalidate().restart()))),J)if(e&&$&&(y.style[$+he.os2]=M),_e){if(d){if(_=!e&&x>O&&u+1>E&&E+1>=ao(de,he),oe)if(e||!a&&!_)vs(J,y);else{var L=Io(J,!0),N=E-l;vs(J,ya,L.top+(he===aa?N:0)+To,L.left+(he===aa?0:N)+To)}us(a||_?g:m),S!==p&&x<1&&a||b(T+(1!==x||_?0:S))}}else b(eo(T+S*x));ae&&!i.tween&&!Ia&&!Za&&F.restart(!0),Z&&(v||re&&x&&(x<1||!Ga))&&ba(Z.targets).forEach((function(e){return e.classList[a||re?"add":"remove"](Z.className)})),H&&!fe&&!e&&H(Ee),d&&!Ia?(fe&&(A&&("complete"===h?n.pause().totalProgress(1):"reset"===h?n.restart(!0).pause():"restart"===h?n.restart(!0):n[h]()),H&&H(Ee)),!v&&Ga||(K&&v&&fo(Ee,K),ge[c]&&fo(Ee,ge[c]),re&&(1===x?Ee.kill(!1,1):ge[c]=0),v||ge[c=1===x?1:3]&&fo(Ee,ge[c])),ue&&!a&&Math.abs(Ee.getVelocity())>(uo(ue)?ue:2500)&&(ho(Ee.callbackAnimation),k?k.progress(1):ho(n,"reverse"===h?1:!x,1))):fe&&H&&!Ia&&H(Ee)}if(C){var w=le?E/le.duration()*(le._caScrollDist||0):E;P(w+(f._isFlipped?1:0)),C(w)}U&&U(-E/le.duration()*(le._caScrollDist||0))}},Ee.enable=function(t,n){Ee.enabled||(Ee.enabled=!0,Ro(de,"resize",Ho),Ro(pe?ga:de,"scroll",Xo),be&&Ro(e,"refreshInit",be),!1!==t&&(Ee.progress=N=0,o=s=Me=Pe()),!1!==n&&Ee.refresh())},Ee.getTween=function(e){return e&&i?i.tween:k},Ee.setPositions=function(e,t){J&&(T+=e-l,S+=t-e-p),Ee.start=l=e,Ee.end=u=t,p=t-e,Ee.update()},Ee.disable=function(t,n){if(Ee.enabled&&(!1!==t&&Ee.revert(!0,!0),Ee.enabled=Ee.isActive=!1,n||k&&k.pause(),w=0,r&&(r.uncache=1),be&&ko(e,"refreshInit",be),F&&(F.pause(),i.tween&&i.tween.kill()&&(i.tween=0)),!pe)){for(var a=Vo.length;a--;)if(Vo[a].scroller===de&&Vo[a]!==Ee)return;ko(de,"resize",Ho),ko(de,"scroll",Xo)}},Ee.kill=function(e,i){Ee.disable(e,i),k&&!i&&k.kill(),Y&&delete Wo[Y];var a=Vo.indexOf(Ee);a>=0&&Vo.splice(a,1),a===xa&&is>0&&xa--,a=0,Vo.forEach((function(e){return e.scroller===Ee.scroller&&(a=1)})),a||za||(Ee.scroll.rec=0),n&&(n.scrollTrigger=null,e&&n.render(-1),i||n.kill()),c&&[c,h,f,d].forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),Ha===Ee&&(Ha=0),J&&(r&&(r.uncache=1),a=0,Vo.forEach((function(e){return e.pin===J&&a++})),a||(r.spacer=0)),t.onKill&&t.onKill(Ee)},Ee.enable(!1,!1),V&&V(Ee),n&&n.add&&!p?va.delayedCall(.01,(function(){return l||u||Ee.refresh()}))&&(p=.01)&&(l=u=0):Ee.refresh()}else this.update=this.refresh=this.kill=$a},e.register=function(t){return pa||(va=t||no(),to()&&window.document&&e.enable(),pa=qa),pa},e.defaults=function(e){if(e)for(var t in e)Fo[t]=e[t];return Fo},e.disable=function(e,t){qa=0,Vo.forEach((function(n){return n[t?"kill":"disable"](e)})),ko(_a,"wheel",Xo),ko(ga,"scroll",Xo),clearInterval(Ma),ko(ga,"touchcancel",$a),ko(ya,"touchstart",$a),Do(ko,ga,"pointerdown,touchstart,mousedown",Qa),Do(ko,ga,"pointerup,touchend,mouseup",Ja),Ea.kill(),oo(ko);for(var n=0;n<Zr.length;n+=3)Oo(ko,Zr[n],Zr[n+1]),Oo(ko,Zr[n],Zr[n+2])},e.enable=function(){if(_a=window,ga=document,ma=ga.documentElement,ya=ga.body,va&&(ba=va.utils.toArray,Ta=va.utils.clamp,Wa=va.core.context||$a,La=va.core.suppressOverwrites||$a,va.core.globals("ScrollTrigger",e),ya)){qa=1,da.register(va),e.isTouch=da.isTouch,Va=da.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),Ro(_a,"wheel",Xo),Aa=[_a,ga,ma,ya],va.matchMedia?(e.matchMedia=function(e){var t,n=va.matchMedia();for(t in e)n.add(t,e[t]);return n},va.addEventListener("matchMediaInit",(function(){return Jo()})),va.addEventListener("matchMediaRevert",(function(){return Qo()})),va.addEventListener("matchMedia",(function(){ts(0,1),jo("matchMedia")})),va.matchMedia("(orientation: portrait)",(function(){return zo(),zo}))):console.warn("Requires GSAP 3.11.0 or later"),Ro(ga,"scroll",Xo);var t,n,i=ya.style,r=i.borderTopStyle,a=va.core.Animation.prototype;for(a.revert||Object.defineProperty(a,"revert",{value:function(){return this.time(-.01,!0)}}),i.borderTopStyle="solid",t=Io(ya),aa.m=Math.round(t.top+aa.sc())||0,ra.m=Math.round(t.left+ra.sc())||0,r?i.borderTopStyle=r:i.removeProperty("border-top-style"),Ma=setInterval(Go,250),va.delayedCall(.5,(function(){return Za=0})),Ro(ga,"touchcancel",$a),Ro(ya,"touchstart",$a),Do(Ro,ga,"pointerdown,touchstart,mousedown",Qa),Do(Ro,ga,"pointerup,touchend,mouseup",Ja),Ca=va.utils.checkPrefix("transform"),os.push(Ca),pa=Ya(),Ea=va.delayedCall(.2,ts).pause(),ka=[ga,"visibilitychange",function(){var e=_a.innerWidth,t=_a.innerHeight;ga.hidden?(Da=e,Ra=t):Da===e&&Ra===t||Ho()},ga,"DOMContentLoaded",ts,_a,"load",ts,_a,"resize",Ho],oo(Ro),Vo.forEach((function(e){return e.enable(0,1)})),n=0;n<Zr.length;n+=3)Oo(ko,Zr[n],Zr[n+1]),Oo(ko,Zr[n],Zr[n+2])}},e.config=function(t){"limitCallbacks"in t&&(Ga=!!t.limitCallbacks);var n=t.syncInterval;n&&clearInterval(Ma)||(Ma=n)&&setInterval(Go,n),"ignoreMobileResize"in t&&(wa=1===e.isTouch&&t.ignoreMobileResize),"autoRefreshEvents"in t&&(oo(ko)||oo(Ro,t.autoRefreshEvents||"none"),Fa=-1===(t.autoRefreshEvents+"").indexOf("resize"))},e.scrollerProxy=function(e,t){var n=oa(e),i=Zr.indexOf(n),r=io(n);~i&&Zr.splice(i,r?6:2),t&&(r?Yr.unshift(_a,t,ya,t,ma,t):Yr.unshift(n,t))},e.clearMatchMedia=function(e){Vo.forEach((function(t){return t._ctx&&t._ctx.query===e&&t._ctx.kill(!0,!0)}))},e.isInViewport=function(e,t,n){var i=(so(e)?oa(e):e).getBoundingClientRect(),r=i[n?mo:yo]*t||0;return n?i.right-r>0&&i.left+r<_a.innerWidth:i.bottom-r>0&&i.top+r<_a.innerHeight},e.positionInViewport=function(e,t,n){so(e)&&(e=oa(e));var i=e.getBoundingClientRect(),r=i[n?mo:yo],a=null==t?r/2:t in No?No[t]*r:~t.indexOf("%")?parseFloat(t)*r/100:parseFloat(t)||0;return n?(i.left+a)/_a.innerWidth:(i.top+a)/_a.innerHeight},e.killAll=function(e){if(Vo.forEach((function(e){return"ScrollSmoother"!==e.vars.id&&e.kill()})),!0!==e){var t=Zo.killAll||[];Zo={},t.forEach((function(e){return e()}))}},e}();_s.version="3.11.1",_s.saveStyles=function(e){return e?ba(e).forEach((function(e){if(e&&e.style){var t=qo.indexOf(e);t>=0&&qo.splice(t,5),qo.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),va.core.getCache(e),Wa())}})):qo},_s.revert=function(e,t){return Jo(!e,t)},_s.create=function(e,t){return new _s(e,t)},_s.refresh=function(e){return e?Ho():(pa||_s.register())&&ts(!0)},_s.update=rs,_s.clearScrollMemory=$o,_s.maxScroll=function(e,t){return ao(e,t?ra:aa)},_s.getScrollFunc=function(e,t){return sa(oa(e),t?ra:aa)},_s.getById=function(e){return Wo[e]},_s.getAll=function(){return Vo.filter((function(e){return"ScrollSmoother"!==e.vars.id}))},_s.isScrolling=function(){return!!ja},_s.snapDirectional=xo,_s.addEventListener=function(e,t){var n=Zo[e]||(Zo[e]=[]);~n.indexOf(t)||n.push(t)},_s.removeEventListener=function(e,t){var n=Zo[e],i=n&&n.indexOf(t);i>=0&&n.splice(i,1)},_s.batch=function(e,t){var n,i=[],r={},a=t.interval||.016,o=t.batchMax||1e9,s=function(e,t){var n=[],i=[],r=va.delayedCall(a,(function(){t(n,i),n=[],i=[]})).pause();return function(e){n.length||r.restart(!0),n.push(e.trigger),i.push(e),o<=n.length&&r.progress(1)}};for(n in t)r[n]="on"===n.substr(0,2)&&lo(t[n])&&"onRefreshInit"!==n?s(0,t[n]):t[n];return lo(o)&&(o=o(),Ro(_s,"refresh",(function(){return o=t.batchMax()}))),ba(e).forEach((function(e){var t={};for(n in r)t[n]=r[n];t.trigger=e,i.push(_s.create(t))})),i};var gs,ms=function(e,t,n,i){return t>i?e(i):t<0&&e(0),n>i?(i-t)/(n-t):n<0?t/(t-n):1},ys=function e(t,n){!0===n?t.style.removeProperty("touch-action"):t.style.touchAction=!0===n?"auto":n?"pan-"+n+(da.isTouch?" pinch-zoom":""):"none",t===ma&&e(ya,n)},As={auto:1,scroll:1},Es=function(e){var t,n=e.event,i=e.target,r=e.axis,a=(n.changedTouches?n.changedTouches[0]:n).target,o=a._gsap||va.core.getCache(a),s=Ya();if(!o._isScrollT||s-o._isScrollT>2e3){for(;a&&a.scrollHeight<=a.clientHeight;)a=a.parentNode;o._isScroll=a&&!io(a)&&a!==i&&(As[(t=So(a)).overflowY]||As[t.overflowX]),o._isScrollT=s}(o._isScroll||"x"===r)&&(n.stopPropagation(),n._gsapAllow=!0)},bs=function(e,t,n,i){return da.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:t,onWheel:i=i&&Es,onPress:i,onDrag:i,onScroll:i,onEnable:function(){return n&&Ro(ga,da.eventTypes[0],Ss,!1,!0)},onDisable:function(){return ko(ga,da.eventTypes[0],Ss,!0)}})},Ts=/(input|label|select|textarea)/i,Ss=function(e){var t=Ts.test(e.target.tagName);(t||gs)&&(e._gsapAllow=!0,gs=t)},Ms=function(e){co(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var t,n,i,r,a,o,s,l,u=e,c=u.normalizeScrollX,h=u.momentum,f=u.allowNestedScroll,d=oa(e.target)||ma,v=va.core.globals().ScrollSmoother,p=v&&v.get(),_=Va&&(e.content&&oa(e.content)||p&&!1!==e.content&&!p.smooth()&&p.content()),g=sa(d,aa),m=sa(d,ra),y=1,A=(da.isTouch&&_a.visualViewport?_a.visualViewport.scale*_a.visualViewport.width:_a.outerWidth)/_a.innerWidth,E=0,b=lo(h)?function(){return h(t)}:function(){return h||2.8},T=bs(d,e.type,!0,f),S=function(){return r=!1},M=$a,I=$a,P=function(){n=ao(d,aa),I=Ta(Va?1:0,n),c&&(M=Ta(0,ao(d,ra))),i=es},C=function(){_._gsap.y=eo(parseFloat(_._gsap.y)+g.offset)+"px",_.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(_._gsap.y)+", 0, 1)",g.offset=g.cacheID=0},x=function(){P(),a.isActive()&&a.vars.scrollY>n&&(g()>n?a.progress(1)&&g(n):a.resetTo("scrollY",n))};return _&&va.set(_,{y:"+=0"}),e.ignoreCheck=function(e){return Va&&"touchmove"===e.type&&function(){if(r){requestAnimationFrame(S);var e=eo(t.deltaY/2),n=I(g.v-e);if(_&&n!==g.v+g.offset){g.offset=n-g.v;var i=eo((parseFloat(_&&_._gsap.y)||0)-g.offset);_.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+i+", 0, 1)",_._gsap.y=i+"px",g.cacheID=Zr.cache,rs()}return!0}g.offset&&C(),r=!0}()||y>1.05&&"touchstart"!==e.type||t.isGesturing||e.touches&&e.touches.length>1},e.onPress=function(){var e=y;y=eo((_a.visualViewport&&_a.visualViewport.scale||1)/A),a.pause(),e!==y&&ys(d,y>1.01||!c&&"x"),o=m(),s=g(),P(),i=es},e.onRelease=e.onGestureStart=function(e,t){if(g.offset&&C(),t){Zr.cache++;var i,r,o=b();c&&(r=(i=m())+.05*o*-e.velocityX/.227,o*=ms(m,i,r,ao(d,ra)),a.vars.scrollX=M(r)),r=(i=g())+.05*o*-e.velocityY/.227,o*=ms(g,i,r,ao(d,aa)),a.vars.scrollY=I(r),a.invalidate().duration(o).play(.01),(Va&&a.vars.scrollY>=n||i>=n-1)&&va.to({},{onUpdate:x,duration:o})}else l.restart(!0)},e.onWheel=function(){a._ts&&a.pause(),Ya()-E>1e3&&(i=0,E=Ya())},e.onChange=function(e,t,n,r,a){if(es!==i&&P(),t&&c&&m(M(r[2]===t?o+(e.startX-e.x):m()+t-r[1])),n){g.offset&&C();var l=a[2]===n,u=l?s+e.startY-e.y:g()+n-a[1],h=I(u);l&&u!==h&&(s+=h-u),g(h)}(n||t)&&rs()},e.onEnable=function(){ys(d,!c&&"x"),Ro(_a,"resize",x),T.enable()},e.onDisable=function(){ys(d,!0),ko(_a,"resize",x),T.kill()},e.lockAxis=!1!==e.lockAxis,(t=new da(e)).iOS=Va,Va&&!g()&&g(1),Va&&va.ticker.add($a),l=t._dc,a=va.to(t,{ease:"power4",paused:!0,scrollX:c?"+=0.1":"+=0",scrollY:"+=0.1",onComplete:l.vars.onComplete}),t};_s.sort=function(e){return Vo.sort(e||function(e,t){return-1e6*(e.vars.refreshPriority||0)+e.start-(t.start+-1e6*(t.vars.refreshPriority||0))})},_s.observe=function(e){return new da(e)},_s.normalizeScroll=function(e){if(void 0===e)return Na;if(!0===e&&Na)return Na.enable();if(!1===e)return Na&&Na.kill();var t=e instanceof da?e:Ms(e);return Na&&Na.target===t.target&&Na.kill(),io(t.target)&&(Na=t),t},_s.core={_getVelocityProp:la,_inputObserver:bs,_scrollers:Zr,_proxies:Yr,bridge:{ss:function(){ja||jo("scrollStart"),ja=Ya()},ref:function(){return Ia}}},no()&&va.registerPlugin(_s),we.registerPlugin(_s);var Is={y:10,opacity:0,delay:.1,stagger:.1,duration:.6,ease:"power1.out"},Ps=function(){var e=Be((function(e,t){void 0===t&&(t={});var n=t.markers,i=t.toggleClass;delete t.markers,we.from(e,Object.assign({scrollTrigger:{trigger:e,start:"60% 90%",markers:n,toggleClass:i}},Is,t))}));return e.apply(void 0,arguments)};var Cs=function(e){var t,n=e.className,i=e.children,r=Ps({toggleClass:"activated"});return h.createElement("div",{className:d()("cube-grid",(t={},t[n]=n,t)),ref:r},i,h.createElement("img",{className:"cube-skirt",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDIxMyAxMTMiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgeG1sbnM6c2VyaWY9Imh0dHA6Ly93d3cuc2VyaWYuY29tLyIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoyOyI+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLC0yODM4LC02NDcpIj4KICAgICAgICA8ZyBpZD0iQXJ0Ym9hcmQ2IiB0cmFuc2Zvcm09Im1hdHJpeCgwLjg1NDc4NywwLDAsMC42Njg0NDMsNDExLjc4MiwyMTguMTQ4KSI+CiAgICAgICAgICAgIDxyZWN0IHg9IjI4MzguMzkiIHk9IjY0Mi4wOTUiIHdpZHRoPSIyNDguNTA0IiBoZWlnaHQ9IjE2Ny44NjMiIHN0eWxlPSJmaWxsOm5vbmU7Ii8+CiAgICAgICAgICAgIDxjbGlwUGF0aCBpZD0iX2NsaXAxIj4KICAgICAgICAgICAgICAgIDxyZWN0IHg9IjI4MzguMzkiIHk9IjY0Mi4wOTUiIHdpZHRoPSIyNDguNTA0IiBoZWlnaHQ9IjE2Ny44NjMiLz4KICAgICAgICAgICAgPC9jbGlwUGF0aD4KICAgICAgICAgICAgPGcgY2xpcC1wYXRoPSJ1cmwoI19jbGlwMSkiPgogICAgICAgICAgICAgICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoMS4zMDMwNSwwLDAsMS43MzQxMywzOTAuOTM2LC0xMTgwLjQxKSI+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE4NzguMjYsMTA1MC4xNkwxOTc1LjU2LDExMDQuNzJMMjA2OS4xMiwxMDUwLjgzTDIwNjkuODIsMTE0N0wxODc4Ljc1LDExNDcuMjZMMTg3OC4yNiwxMDUwLjE2WiIvPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4K",alt:"cube"}))};function xs(){return xs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},xs.apply(this,arguments)}var Ds,Rs=function(e){return h.createElement("svg",xs({viewBox:"0 0 41 41",xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:2}},e),h.createElement("path",{style:{fill:"none"},d:"M1388.4-71.724h136.287V46.165H1388.4z",transform:"matrix(.2935 0 0 .3393 -406.62 24.342)"}),h.createElement("path",{style:{fill:"none"},d:"M2735.76 540.825h46.305v48.57h-46.305z",transform:"matrix(.77158 0 0 .71455 -2108.525 -384.377)"}),h.createElement("path",{d:"M2762.35 578.399c-.06.129.03-.051.03-.051l-.03.051Zm13.64-3.36-.98-.591.98.591Zm-34.54 0 .98-.591-.98.591Zm7.84-13.249c1.3 0 2.36.954 2.36 2.129 0 1.176-1.06 2.13-2.36 2.13-1.3 0-2.36-.954-2.36-2.13 0-1.175 1.06-2.129 2.36-2.129Zm18.86 0c1.3 0 2.36.954 2.36 2.129 0 1.176-1.06 2.13-2.36 2.13-1.3 0-2.36-.954-2.36-2.13 0-1.175 1.06-2.129 2.36-2.129Zm-9.43 0c1.3 0 2.36.954 2.36 2.129 0 1.176-1.06 2.13-2.36 2.13-1.3 0-2.36-.954-2.36-2.13 0-1.175 1.06-2.129 2.36-2.129Zm-17.27-8.991.98.592-.98-.592Zm34.54 0-.98.592.98-.592Zm-3.28-1.478c-.96-.573-2.16-.899-4-1.068-1.88-.173-4.3-.174-7.63-.174h-5.33c-3.02.001-5.25.012-7.02.174-1.84.169-3.04.495-4 1.068l-.03.014-.02.013a7.93 7.93 0 0 0-2.25 2.043l-.02.02c-.63.867-.99 1.952-1.18 3.619-.19 1.697-.19 3.877-.19 6.889v.556c0 2.728.01 4.742.19 6.334.19 1.666.55 2.752 1.18 3.618l.02.021c.6.807 1.36 1.501 2.25 2.043l.02.013-.65.885.65-.885.02.012c.84.501 1.87.813 3.34.997 1.46.182 3.28.231 5.71.243l.24.001h.02c.47.007.87.284 1.05.656l2.59 4.643c.24.436.73.63 1.19.582.37-.038.72-.232.92-.582l2.57-4.657c.18-.377.6-.64 1.08-.642l.24-.001c2.43-.012 4.25-.061 5.71-.243 1.49-.185 2.51-.501 3.36-1.009l.02-.013a7.812 7.812 0 0 0 2.25-2.043l.02-.021c.63-.866.99-1.952 1.18-3.618.19-1.698.19-3.877.19-6.89v-.555c0-2.728-.01-4.743-.19-6.334-.19-1.68-.55-2.769-1.2-3.639l-.01-.019a7.935 7.935 0 0 0-2.26-2.037l1.31-1.771.02.017c1.14.691 2.12 1.575 2.88 2.602l.02.025c.95 1.278 1.38 2.758 1.59 4.606.2 1.831.2 4.137.2 7.105v.549c0 2.706-.01 4.84-.2 6.556-.21 1.848-.64 3.328-1.59 4.607l-.02.024a10.09 10.09 0 0 1-2.9 2.619l-.03.018c-1.23.734-2.63 1.12-4.32 1.331-1.51.189-3.33.243-5.53.259l-2.29 4.127v.014c-1.31 2.34-5.02 2.335-6.32-.014l-2.29-4.141c-2.2-.016-4.01-.056-5.53-.245-1.7-.213-3.11-.603-4.35-1.349l-.02-.016a10.144 10.144 0 0 1-2.9-2.627l-.02-.03c-.94-1.272-1.36-2.743-1.57-4.577-.2-1.83-.2-4.136-.2-7.105v-.549c0-2.706.01-4.84.2-6.556.21-1.848.64-3.328 1.59-4.606l.02-.025a10.118 10.118 0 0 1 2.9-2.619l.04-.02c1.41-.84 3.04-1.223 5.06-1.41 2.03-.186 4.59-.184 7.87-.184h5.33c2.99 0 5.36.01 7.26.184 2.03.187 3.66.57 5.06 1.41l.04.02-1.31 1.771-.03-.014Z",style:{fillRule:"nonzero"},transform:"matrix(.87805 0 0 .87805 -2401.758 -478.19)"}))},ks=function(){return h.createElement(Cs,{className:"is-north"},h.createElement("div",{className:"cube-n"},h.createElement("img",{src:xr,alt:"cube"}),h.createElement(Rs,{className:"icon"})),h.createElement("img",{className:"cube-e",src:xr,alt:"cube"}),h.createElement("img",{className:"cube-s",src:xr,alt:"cube"}),h.createElement("img",{className:"cube-w",src:xr,alt:"cube"}))};function Os(){return Os=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Os.apply(this,arguments)}var Ls,Fs=function(e){return h.createElement("svg",Os({viewBox:"0 0 41 41",xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:2}},e),h.createElement("path",{style:{fill:"none"},d:"M1388.4-71.724h136.287V46.165H1388.4z",transform:"matrix(.2935 0 0 .3393 -407.406 24.367)"}),Ds||(Ds=h.createElement("path",{d:"M36.114 10.466a4.418 4.418 0 0 0-4.417-4.417H10.03a4.418 4.418 0 0 0-4.416 4.417v16.667a4.418 4.418 0 0 0 4.416 4.416h21.667a4.418 4.418 0 0 0 4.417-4.416V10.466Zm-2.167 0v16.667a2.251 2.251 0 0 1-2.25 2.25H10.03a2.251 2.251 0 0 1-2.25-2.25V10.466a2.251 2.251 0 0 1 2.25-2.25h21.667a2.251 2.251 0 0 1 2.25 2.25Zm-21.753 5.196 2.973 3.037-3.345 3.302a1.084 1.084 0 0 0 1.522 1.542l4.111-4.059a1.081 1.081 0 0 0 .014-1.528l-3.725-3.81a1.087 1.087 0 0 0-1.534-.017 1.086 1.086 0 0 0-.016 1.533Zm9.503 7.554h6.667a1.083 1.083 0 1 0 0-2.167h-6.667a1.083 1.083 0 1 0 0 2.167Z"})))},Ns=function(){return h.createElement(Cs,{className:"is-east"},h.createElement("img",{className:"cube-n",src:xr,alt:"cube"}),h.createElement("div",{className:"cube-e"},h.createElement("img",{src:xr,alt:"cube"}),h.createElement(Fs,{className:"icon"})),h.createElement("img",{className:"cube-s",src:xr,alt:"cube"}),h.createElement("img",{className:"cube-w",src:xr,alt:"cube"}))};function ws(){return ws=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ws.apply(this,arguments)}var Bs,Us=function(e){return h.createElement("svg",ws({viewBox:"0 0 41 41",xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:2}},e),h.createElement("path",{style:{fill:"none"},d:"M1388.4-71.724h136.287V46.165H1388.4z",transform:"matrix(.2935 0 0 .3393 -407.11 24.448)"}),h.createElement("path",{style:{fill:"none"},d:"M2735.76 540.825h46.305v48.57h-46.305z",transform:"matrix(.77413 0 0 .7169 -2114.45 -384.43)"}),Ls||(Ls=h.createElement("path",{d:"m4.65 18.99 16.225 19.22L37.1 18.99c.865-1.028 1.241-1.574 1.357-2.192.116-.619-.036-1.253-.476-2.5l-1.565-4.452C35.383 6.91 34.771 5.49 33.542 4.65c-1.229-.84-2.845-.941-6.108-.941H14.317c-3.263 0-4.88.102-6.108.941-1.229.84-1.841 2.26-2.874 5.196l-1.566 4.453c-.44 1.246-.59 1.88-.475 2.499.116.62.492 1.164 1.357 2.191Zm10.3-3.315 5.925 17.651L26.8 15.675H14.95Zm3.203 16.118L6.294 17.743c-.082-.098-.162-.19-.233-.271l6.747-1.6 5.345 15.92ZM35.69 17.472c-.071.083-.151.173-.233.271l-11.859 14.05 5.344-15.92 6.748 1.599ZM25.084 5.703c.427 0 .826.248.984.646l2.963 7.49 7.179 1.7c-.063-.173-.141-.373-.223-.61l-1.568-4.453c-.446-1.27-.778-2.224-1.134-2.95-.28-.568-.555-.973-.972-1.258-.417-.285-.909-.405-1.567-.477-.84-.092-1.9-.088-3.312-.088h-2.35Zm-8.417 0h-2.35c-1.412 0-2.472-.004-3.312.088-.658.072-1.15.192-1.567.477-.417.285-.693.69-.972 1.258-.356.726-.688 1.68-1.134 2.95l-1.568 4.453c-.082.237-.16.437-.223.61l7.179-1.7 2.963-7.49c.16-.374.513-.618.942-.646h.042Zm8.404 0H16.68c.12.002.24.022.358.064.542.194.818.768.614 1.284l-2.622 6.63h11.69L24.1 7.05c-.204-.516.071-1.09.614-1.284.118-.042.238-.062.358-.064Z"})))},Vs=function(){return h.createElement(Cs,{className:"is-south"},h.createElement("img",{className:"cube-n",src:xr,alt:"cube"}),h.createElement("img",{className:"cube-e",src:xr,alt:"cube"}),h.createElement("div",{className:"cube-s"},h.createElement("img",{src:xr,alt:"cube"}),h.createElement(Us,{className:"icon"})),h.createElement("img",{className:"cube-w",src:xr,alt:"cube"}))};function Ws(){return Ws=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ws.apply(this,arguments)}var Gs=function(e){return h.createElement("svg",Ws({viewBox:"0 0 41 41",xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:2}},e),h.createElement("path",{style:{fill:"none"},d:"M1388.4-71.724h136.287V46.165H1388.4z",transform:"matrix(.2935 0 0 .3393 -406.99 24.576)"}),Bs||(Bs=h.createElement("path",{d:"M19.982 5.47c-8.675 0-15.717 7.042-15.717 15.717s7.042 15.717 15.717 15.717S35.7 29.862 35.7 21.187 28.657 5.471 19.982 5.471Zm0 2.392c7.354 0 13.325 5.971 13.325 13.325 0 7.355-5.97 13.325-13.325 13.325-7.354 0-13.325-5.97-13.325-13.325 0-7.354 5.97-13.325 13.325-13.325Zm1.196 12.13v-8.2a1.197 1.197 0 0 0-2.392 0v8.968c0 .897.726 1.623 1.623 1.623h7.26a1.197 1.197 0 0 0 0-2.392h-6.491ZM7.426 4.442a11.43 11.43 0 0 0-4.189 4.19 1.196 1.196 0 0 0 2.07 1.196 9.043 9.043 0 0 1 3.315-3.315 1.196 1.196 0 0 0-1.196-2.07Zm23.917 2.07a9.043 9.043 0 0 1 3.314 3.315 1.196 1.196 0 0 0 2.07-1.196 11.442 11.442 0 0 0-4.189-4.189 1.196 1.196 0 0 0-1.196 2.07Z"})))},Xs=function(){return h.createElement(Cs,{className:"is-west"},h.createElement("img",{className:"cube-n",src:xr,alt:"cube"}),h.createElement("img",{className:"cube-e",src:xr,alt:"cube"}),h.createElement("img",{className:"cube-s",src:xr,alt:"cube"}),h.createElement("div",{className:"cube-w"},h.createElement("img",{src:xr,alt:"cube"}),h.createElement(Gs,{className:"icon"})))},zs=(0,h.forwardRef)((function(e,t){var n=e.title,i=e.texts,r=e.reverse,a=e.visual,o=(0,v.Z)();return h.createElement("div",{className:d()("visual-block",{reverse:r})},h.createElement("div",{className:"info",ref:t},h.createElement("h2",{className:"gamma"},o(n)),i),a)})),Hs=function(){var e=(0,v.Z)(),t=Ps(),n=Ps({delay:.2,stagger:.1,toggleClass:"appear"}),i=Ps({delay:.3,stagger:.1,toggleClass:"appear"}),r=Ps({delay:.3,stagger:.1,toggleClass:"appear"}),a=Ps({delay:.3,stagger:.1,toggleClass:"appear"});return h.createElement(Cr,{skin:"dark",className:"claims"},h.createElement("h1",{className:"beta",ref:t},e("claims:title")),h.createElement(zs,{ref:n,title:"claims:section1:title",visual:h.createElement(ks,null),texts:h.createElement("div",{className:"block-content"},h.createElement("span",null,e("claims:section1:text1")),h.createElement("span",null,e("claims:section1:text2")),h.createElement("span",null,e("claims:section1:text3")))}),h.createElement(zs,{ref:i,title:"claims:section2:title",reverse:!0,visual:h.createElement(Ns,null),texts:h.createElement("div",{className:"block-content"},h.createElement("span",null,e("claims:section2:text1")),h.createElement("span",null,e("claims:section2:text2")),h.createElement("span",null,e("claims:section2:text3")))}),h.createElement(zs,{ref:r,title:"claims:section3:title",visual:h.createElement(Vs,null),texts:h.createElement("div",{className:"block-content"},h.createElement("span",null,e("claims:section3:text1")),h.createElement("span",null,e("claims:section3:text2")),h.createElement("span",null,e("claims:section3:text3")))}),h.createElement(zs,{ref:a,title:"claims:section4:title",visual:h.createElement(Xs,null),reverse:!0,texts:h.createElement("div",{className:"block-content"},h.createElement("span",null,e("claims:section4:text1")),h.createElement("span",null,e("claims:section4:text2")))}))},Zs=(0,h.forwardRef)((function(e,t){var n=e.title,i=e.content,r=(0,v.Z)();return h.createElement("div",{className:d()("info-block"),ref:t},h.createElement("h2",{className:"gamma"},r(n)),i)})),Ys=function(){var e=(0,v.Z)(),t=Ps(),n=Ps({delay:.2});return h.createElement(Cr,{className:"values"},h.createElement("div",{className:"intro-heading",ref:t},h.createElement("h3",{className:"pre-title"},e("values:pretitle")),h.createElement("h1",{className:"beta"},e("values:title"))),h.createElement("div",{className:"values-block"},h.createElement(Zs,{ref:n,title:"values:value1:title",content:h.createElement(h.Fragment,null,h.createElement("p",{className:"basic-text"},e("values:value1:text1")),h.createElement("p",{className:"basic-text"},e("values:value1:text2")))}),h.createElement(Zs,{ref:n,title:"values:value2:title",content:h.createElement(h.Fragment,null,h.createElement("p",{className:"basic-text"},e("values:value2:text1")),h.createElement("p",{className:"basic-text"},e("values:value2:text2")))}),h.createElement(Zs,{ref:n,title:"values:value3:title",content:h.createElement(h.Fragment,null,h.createElement("p",{className:"basic-text"},e("values:value3:text1")),h.createElement("p",{className:"basic-text"},e("values:value3:text2")))})))},Ks=n.p+"static/sara-2bbcc970c562d7f3266f059b5d9a614a.png",js=n.p+"static/ignacio-eb900524a04be44df2eaa1c5dbbce748.jpg",qs=(0,h.forwardRef)((function(e,t){var n=e.name,i=e.position,r=e.description,a=e.image;return h.createElement("div",{className:"team-member",ref:t},h.createElement("div",{className:"team-image"},h.createElement("img",{src:a,alt:n})),h.createElement("div",{className:"team-info"},h.createElement("p",{className:"team-name"},n),h.createElement("p",{className:"team-position"},i),h.createElement("p",{className:"team-description"},r)))})),Qs=function(){var e=(0,v.Z)(),t=Ps(),n=Ps({delay:.3,stagger:.1});return h.createElement(Cr,{className:"about",id:"about"},h.createElement("div",{className:"intro-heading",ref:t},h.createElement("h3",{className:"pre-title"},e("about:pretitle")),h.createElement("h1",{className:"beta"},e("about:title"))),h.createElement("div",{className:"team"},h.createElement(qs,{ref:n,name:"Ignacio Ramos",position:e("about:position:ignacio"),description:e("about:description:ignacio"),image:js}),h.createElement(qs,{ref:n,name:"Antonio Esquembre",position:e("about:position:antonio"),description:e("about:description:antonio"),image:Ks}),h.createElement(qs,{ref:n,name:"Sara Moreno",position:e("about:position:sara"),description:e("about:description:sara"),image:Ks}),h.createElement(qs,{ref:n,name:"Juanlu García",position:e("about:position:juanlu"),description:e("about:description:juanlu"),image:Ks})),h.createElement(Mr,null))},Js=n(4349),$s=["href","external"],el=function(e){var t=e.href,n=e.external,i=We(e,$s);return h.createElement(Ge,i,(function(e){var i=e.buttonClasses,r=e.buttonContent;return h.createElement("a",{className:i,href:t,target:n?"_blank":"",rel:n?"noopener noreferrer":""},r)}))},tl=n(3675),nl=n(4581),il=(0,h.forwardRef)((function(e,t){var n,i=e.title,r=e.content,a=e.className,o=(0,v.Z)();return h.createElement("div",{className:d()("card",(n={},n[a]=a,n)),ref:t},h.createElement("h2",{className:"gamma"},o(i)),r)})),rl=function(){var e=(0,v.Z)(),t=Ps(),n=Ps({delay:.3,stagger:.1});return h.createElement(Cr,{skin:"grey",className:"contact",id:"contact"},h.createElement("h1",{className:"beta",ref:t},e("contact:title")),h.createElement("img",{src:Js.Z,alt:"pattern",className:"pattern"}),h.createElement("div",{className:"card-grid"},h.createElement(il,{ref:n,className:"w-50",title:"contact:lets-see",content:h.createElement(h.Fragment,null,h.createElement("p",{className:"basic-text"},e("contact:lets-see-text")),h.createElement(el,{href:"https://calendly.com/bonsaitech/30min",label:"action:program-meeting",external:!0}))}),h.createElement(il,{ref:n,className:"w-50",title:"contact:send-email",content:h.createElement(h.Fragment,null,h.createElement("p",{className:"basic-text"},e("contact:send-email-text")),h.createElement(el,{href:"mailto:hola@bonsaitech.io",label:"action:ask-budget"}))}),h.createElement(il,{ref:n,title:"contact:lets-chat",content:h.createElement(h.Fragment,null,h.createElement("p",{className:"basic-text"},e("contact:lets-chat-text")),h.createElement(el,{href:"#",icon:h.createElement(tl.r,null)}),h.createElement(el,{href:"#",icon:h.createElement(nl.r,null)}))})))},al=function(e){var t=e.skin,n=e.clearButton,i=e.title,r=e.text,a=e.buttonText,o=(0,v.Z)(),s=Ps();return h.createElement(Cr,{className:"cta",skin:t},h.createElement("div",{className:"cta-info",ref:s},h.createElement("h1",{className:"beta"},o(i)),h.createElement("p",{className:"cta-text"},o(r))),h.createElement("div",{className:"cta-action",ref:s},h.createElement(ze,{label:a,to:"#contact",clear:n})))};var ol=function(e){var t=e.text,n=e.author,i=e.position,r=(0,v.Z)(),a=Ps();return h.createElement(Cr,{className:"quote"},h.createElement("div",{className:"quote-info",ref:a},h.createElement("h3",{className:"quote-text"},r(t)),h.createElement("p",{className:"quote-author"},n),h.createElement("p",{className:"quote-position"},r(i))),h.createElement("div",{className:"quote-graphic",ref:a},h.createElement("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTczIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDE3MyAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTcyLjc2IDY2LjM3ODVDMTcyLjkxMSA2Ny44Njc0IDE3Mi45OCA2OS4zNzc5IDE3Mi45OCA3MC45MDQ2QzE3Mi45OCA5Ny40NzQ3IDE1Mi4yNTYgMTE5LjA0OSAxMjYuNzIxIDExOS4wNjhWOTQuOTg1MUMxMzkuNDgxIDk0Ljk2NTMgMTQ5LjgzMiA4NC4xODI5IDE0OS44MzIgNzAuOTA0NkMxNDkuODMyIDY5LjkzNzIgMTQ5Ljc3NyA2OC45ODM0IDE0OS42NjcgNjguMDQ3NkgxMDMuMTc0VjAuMTE3Njc2SDE3Mi43NlY2Ni4zNzg1WiIgZmlsbD0iYmxhY2siIGZpbGwtb3BhY2l0eT0iMC4xIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNzAuMjMxMiA2Ni4zNzg1QzcwLjM4MjMgNjcuODY3NCA3MC40NTEyIDY5LjM3NzkgNzAuNDUxMiA3MC45MDQ2QzcwLjQ1MTIgOTcuNDc0NyA0OS43Mjc2IDExOS4wNDkgMjQuMTkyNSAxMTkuMDY4Vjk0Ljk4NTFDMzYuOTUxOCA5NC45NjUzIDQ3LjMwMzUgODQuMTgyOSA0Ny4zMDM1IDcwLjkwNDZDNDcuMzAzNSA2OS45MzcyIDQ3LjI0ODUgNjguOTgzNCA0Ny4xMzg1IDY4LjA0NzZIMC42NDUwMlYwLjExNzY3Nkg3MC4yMzEyVjY2LjM3ODVaIiBmaWxsPSJibGFjayIgZmlsbC1vcGFjaXR5PSIwLjEiLz4KPC9zdmc+Cg==",alt:"Quotes"})))},sl=function(){var e=(0,v.Z)(),t=Ps();return h.createElement(Cr,{skin:"grey",className:"services",id:"services"},h.createElement("div",{className:"intro-heading",ref:t},h.createElement("h3",{className:"pre-title"},e("services:pretitle")),h.createElement("h1",{className:"beta"},e("services:title")),h.createElement("p",{className:"text"},e("services:intro-text"))),h.createElement("div",{className:"card-grid"},h.createElement(il,{ref:t,title:"services:service1:title",content:h.createElement(h.Fragment,null,h.createElement("p",{className:"basic-text"},e("services:service1:text")))}),h.createElement(il,{ref:t,title:"services:service2:title",content:h.createElement(h.Fragment,null,h.createElement("p",{className:"basic-text"},e("services:service2:text")))})),h.createElement("p",{className:"text",ref:t},e("services:contact-text",{a:function(e){return h.createElement("a",{className:"link",href:"mailto:hola@bonsaitech.io"},e)}})))},ll=function(){var e=(0,v.Z)();return h.createElement("div",{className:"map"},h.createElement("div",{className:"wrapper"},h.createElement("div",{className:"map-info-box"},h.createElement("h2",{className:"gamma"},e("map:title")),h.createElement("p",{className:"text"},e("map:address")))),h.createElement("iframe",{title:"map",src:"https://snazzymaps.com/embed/424465"}))},ul=function(){return(0,h.useEffect)((function(){window.scrollTo(0,0)}),[]),h.createElement(b,null,h.createElement(Ir,null),h.createElement(Hs,null),h.createElement(al,{title:"cta:title",text:"cta:text",buttonText:"action:start-working"}),h.createElement(sl,null),h.createElement(Qs,null),h.createElement(al,{skin:"dark",clearButton:!0,title:"cta2:title",text:"cta2:text",buttonText:"action:tell-us-your-project"}),h.createElement(Ys,null),h.createElement(ll,null),h.createElement(ol,{text:"quote:text",author:"Elías Alonso Gómez-Cornejo",position:"quote:elias-position"}),h.createElement(rl,null))}},531:function(e,t,n){"use strict";function i(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(u){return void n(u)}s.done?t(l):Promise.resolve(l).then(i,r)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,l,"next",e)}function l(e){i(o,r,a,s,l,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return r}})},4942:function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{Z:function(){return i}})},1752:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(1120);function r(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,i.Z)(e)););return e}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=r(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},a.apply(this,arguments)}}}]);
//# sourceMappingURL=2e09868498006f9ea4320bf2edfe8531dae1d3d6-e95adeb75118b9f27ad6.js.map