(self.webpackChunkbonsai_web=self.webpackChunkbonsai_web||[]).push([[653],{8483:function(e,t,n){"use strict";n.d(t,{V:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(t,n,r,a,o,s){(0,i.Z)(this,e),this.source=t,this.pointerX=n,this.pointerY=r,this.meshUnderPointer=a,this.sourceEvent=o,this.additionalData=s}return(0,r.Z)(e,null,[{key:"CreateNew",value:function(t,n,i){var r=t.getScene();return new e(t,r.pointerX,r.pointerY,r.meshUnderPointer||t,n,i)}},{key:"CreateNewFromSprite",value:function(t,n,i,r){return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer,i,r)}},{key:"CreateNewFromScene",value:function(t,n){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,n)}},{key:"CreateNewFromPrimitive",value:function(t,n,i,r){return new e(t,n.x,n.y,null,i,r)}}]),e}()},2845:function(e,t,n){"use strict";n.d(t,{l:function(){return o},o:function(){return s}});var i=n(5671),r=n(3144),a=n(7818),o=function(){function e(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7?arguments[7]:void 0;(0,i.Z)(this,e),this._isAlreadyOwned=!1,t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=r,this._instanced=u,this._divisor=c||1,n instanceof a.h?(this._data=null,this._buffer=n):(this._data=n,this._buffer=null),this.byteStride=l?o:o*Float32Array.BYTES_PER_ELEMENT,s||this.create()}return(0,r.Z)(e,[{key:"createVertexBuffer",value:function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6?arguments[6]:void 0,u=a?t:t*Float32Array.BYTES_PER_ELEMENT,l=i?a?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new s(this._engine,this,e,this._updatable,!0,l,void 0===r?this._instanced:r,u,n,void 0,void 0,!0,this._divisor||o)}},{key:"isUpdatable",value:function(){return this._updatable}},{key:"getData",value:function(){return this._data}},{key:"getBuffer",value:function(){return this._buffer}},{key:"getStrideSize",value:function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))}},{key:"_rebuild",value:function(){this._buffer=null,this.create(this._data)}},{key:"update",value:function(e){this.create(e)}},{key:"updateDirectly",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,i?t:t*Float32Array.BYTES_PER_ELEMENT,n?n*this.byteStride:void 0),this._data=0===t&&void 0===n?e:null)}},{key:"_increaseReferences",value:function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}},{key:"dispose",value:function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)}}]),e}(),s=function(){function e(t,n,r,a,s,u,l,c,h,f){var d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],v=arguments.length>11&&void 0!==arguments[11]&&arguments[11],p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,_=arguments.length>13&&void 0!==arguments[13]&&arguments[13];if((0,i.Z)(this,e),n instanceof o?(this._buffer=n,this._ownsBuffer=_):(this._buffer=new o(t,n,a,u,s,l,v),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=r,null==f){var g=this.getData();this.type=e.FLOAT,g instanceof Int8Array?this.type=e.BYTE:g instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:g instanceof Int16Array?this.type=e.SHORT:g instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:g instanceof Int32Array?this.type=e.INT:g instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=f;var m=e.GetTypeByteLength(this.type);v?(this._size=h||(u?u/m:e.DeduceStride(r)),this.byteStride=u||this._buffer.byteStride||this._size*m,this.byteOffset=c||0):(this._size=h||u||e.DeduceStride(r),this.byteStride=u?u*m:this._buffer.byteStride||this._size*m,this.byteOffset=(c||0)*m),this.normalized=d,this._instanced=void 0!==l&&l,this._instanceDivisor=l?p:0,this._computeHashCode()}return(0,r.Z)(e,[{key:"instanceDivisor",get:function(){return this._instanceDivisor},set:function(e){var t=0!=e;this._instanceDivisor=e,t!==this._instanced&&(this._instanced=t,this._computeHashCode())}},{key:"_computeHashCode",value:function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}},{key:"_rebuild",value:function(){this._buffer&&this._buffer._rebuild()}},{key:"getKind",value:function(){return this._kind}},{key:"isUpdatable",value:function(){return this._buffer.isUpdatable()}},{key:"getData",value:function(){return this._buffer.getData()}},{key:"getFloatData",value:function(t,n){var i=this.getData();if(!i)return null;var r=this.getSize()*e.GetTypeByteLength(this.type),a=t*this.getSize();if(this.type!==e.FLOAT||this.byteStride!==r){var o=new Float32Array(a);return this.forEach(a,(function(e,t){return o[t]=e})),o}if(!(i instanceof Array||i instanceof Float32Array)||0!==this.byteOffset||i.length!==a){if(i instanceof Array){var s=this.byteOffset/4;return i.slice(s,s+a)}if(i instanceof ArrayBuffer)return new Float32Array(i,this.byteOffset,a);var u=i.byteOffset+this.byteOffset;if(n){var l=new Float32Array(a),c=new Float32Array(i.buffer,u,a);return l.set(c),l}var h=u%4;return h&&(u=Math.max(0,u-h)),new Float32Array(i.buffer,u,a)}return n?i.slice():i}},{key:"getBuffer",value:function(){return this._buffer.getBuffer()}},{key:"getStrideSize",value:function(){return this.byteStride/e.GetTypeByteLength(this.type)}},{key:"getOffset",value:function(){return this.byteOffset/e.GetTypeByteLength(this.type)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t?this._size*e.GetTypeByteLength(this.type):this._size}},{key:"getIsInstanced",value:function(){return this._instanced}},{key:"getInstanceDivisor",value:function(){return this._instanceDivisor}},{key:"create",value:function(e){this._buffer.create(e)}},{key:"update",value:function(e){this._buffer.update(e)}},{key:"updateDirectly",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(e,t,void 0,n)}},{key:"dispose",value:function(){this._ownsBuffer&&this._buffer.dispose()}},{key:"forEach",value:function(t,n){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,n)}}],[{key:"DeduceStride",value:function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}},{key:"GetTypeByteLength",value:function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '".concat(t,"'"))}}},{key:"ForEach",value:function(t,n,i,r,a,o,s,u){if(t instanceof Array)for(var l=n/4,c=i/4,h=0;h<o;h+=r){for(var f=0;f<r;f++)u(t[l+f],h+f);l+=c}else for(var d=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),v=e.GetTypeByteLength(a),p=0;p<o;p+=r){for(var _=n,g=0;g<r;g++){u(e._GetFloatValue(d,a,_,s),p+g),_+=v}n+=i}}},{key:"_GetFloatValue",value:function(t,n,i,r){switch(n){case e.BYTE:var a=t.getInt8(i);return r&&(a=Math.max(a/127,-1)),a;case e.UNSIGNED_BYTE:var o=t.getUint8(i);return r&&(o/=255),o;case e.SHORT:var s=t.getInt16(i,!0);return r&&(s=Math.max(s/32767,-1)),s;case e.UNSIGNED_SHORT:var u=t.getUint16(i,!0);return r&&(u/=65535),u;case e.INT:return t.getInt32(i,!0);case e.UNSIGNED_INT:return t.getUint32(i,!0);case e.FLOAT:return t.getFloat32(i,!0);default:throw new Error("Invalid component type ".concat(n))}}}]),e}();s._Counter=0,s.BYTE=5120,s.UNSIGNED_BYTE=5121,s.SHORT=5122,s.UNSIGNED_SHORT=5123,s.INT=5124,s.UNSIGNED_INT=5125,s.FLOAT=5126,s.PositionKind="position",s.NormalKind="normal",s.TangentKind="tangent",s.UVKind="uv",s.UV2Kind="uv2",s.UV3Kind="uv3",s.UV4Kind="uv4",s.UV5Kind="uv5",s.UV6Kind="uv6",s.ColorKind="color",s.ColorInstanceKind="instanceColor",s.MatricesIndicesKind="matricesIndices",s.MatricesWeightsKind="matricesWeights",s.MatricesIndicesExtraKind="matricesIndicesExtra",s.MatricesWeightsExtraKind="matricesWeightsExtra"},7818:function(e,t,n){"use strict";n.d(t,{h:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=e._Counter++}return(0,r.Z)(e,[{key:"underlyingResource",get:function(){return null}}]),e}();a._Counter=0},7337:function(e,t,n){"use strict";n.d(t,{V:function(){return P}});var i=n(5671),r=n(3144),a=n(7326),o=n(1752),s=n(136),u=n(6215),l=n(1120),c=n(9477),h=n(9336),f=n(5934),d=n(8517),v=n(4174),p=n(6900),_=n(1396),g=n(2328),m=n(1704),y=n(5230),A=n(628),E=n(2465);function S(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,l.Z)(e);if(t){var r=(0,l.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,u.Z)(this,n)}}var P=function(e){(0,s.Z)(n,e);var t=b(n);function n(e,r,o){var s,u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return(0,i.Z)(this,n),(s=t.call(this,e,o))._position=p.P.Zero(),s._upVector=p.P.Up(),s._orthoLeft=null,s._orthoRight=null,s._orthoBottom=null,s._orthoTop=null,s.fov=.8,s.projectionPlaneTilt=0,s.minZ=1,s.maxZ=1e4,s.inertia=.9,s._mode=n.PERSPECTIVE_CAMERA,s.isIntermediate=!1,s.viewport=new A.l(0,0,1,1),s.layerMask=268435455,s.fovMode=n.FOVMODE_VERTICAL_FIXED,s.cameraRigMode=n.RIG_MODE_NONE,s.customRenderTargets=new Array,s.outputRenderTarget=null,s.onViewMatrixChangedObservable=new v.y$,s.onProjectionMatrixChangedObservable=new v.y$,s.onAfterCheckInputsObservable=new v.y$,s.onRestoreStateObservable=new v.y$,s.isRigCamera=!1,s._rigCameras=new Array,s._webvrViewMatrix=p.y3.Identity(),s._skipRendering=!1,s._projectionMatrix=new p.y3,s._postProcesses=new Array,s._activeMeshes=new f.t(256),s._globalPosition=p.P.Zero(),s._computedViewMatrix=p.y3.Identity(),s._doNotComputeProjectionMatrix=!1,s._transformMatrix=p.y3.Zero(),s._refreshFrustumPlanes=!0,s._absoluteRotation=p._f.Identity(),s._isCamera=!0,s._isLeftCamera=!1,s._isRightCamera=!1,s.getScene().addCamera((0,a.Z)(s)),u&&!s.getScene().activeCamera&&(s.getScene().activeCamera=(0,a.Z)(s)),s.position=r,s.renderPassId=s.getScene().getEngine().createRenderPassId("Camera ".concat(e)),s}return(0,r.Z)(n,[{key:"position",get:function(){return this._position},set:function(e){this._position=e}},{key:"upVector",get:function(){return this._upVector},set:function(e){this._upVector=e}},{key:"screenArea",get:function(){var e=0,t=0;if(this.mode===n.PERSPECTIVE_CAMERA)this.fovMode===n.FOVMODE_VERTICAL_FIXED?(t=2*this.minZ*Math.tan(this.fov/2),e=this.getEngine().getAspectRatio(this)*t):t=(e=2*this.minZ*Math.tan(this.fov/2))/this.getEngine().getAspectRatio(this);else{var i,r,a,o,s=this.getEngine().getRenderWidth()/2,u=this.getEngine().getRenderHeight()/2;e=(null!==(i=this.orthoRight)&&void 0!==i?i:s)-(null!==(r=this.orthoLeft)&&void 0!==r?r:-s),t=(null!==(a=this.orthoTop)&&void 0!==a?a:u)-(null!==(o=this.orthoBottom)&&void 0!==o?o:-u)}return e*t}},{key:"orthoLeft",get:function(){return this._orthoLeft},set:function(e){this._orthoLeft=e;var t,n=S(this._rigCameras);try{for(n.s();!(t=n.n()).done;){t.value.orthoLeft=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"orthoRight",get:function(){return this._orthoRight},set:function(e){this._orthoRight=e;var t,n=S(this._rigCameras);try{for(n.s();!(t=n.n()).done;){t.value.orthoRight=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"orthoBottom",get:function(){return this._orthoBottom},set:function(e){this._orthoBottom=e;var t,n=S(this._rigCameras);try{for(n.s();!(t=n.n()).done;){t.value.orthoBottom=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"orthoTop",get:function(){return this._orthoTop},set:function(e){this._orthoTop=e;var t,n=S(this._rigCameras);try{for(n.s();!(t=n.n()).done;){t.value.orthoTop=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"mode",get:function(){return this._mode},set:function(e){this._mode=e;var t,n=S(this._rigCameras);try{for(n.s();!(t=n.n()).done;){t.value.mode=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"storeState",value:function(){return this._stateStored=!0,this._storedFov=this.fov,this}},{key:"_restoreStateValues",value:function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}},{key:"restoreState",value:function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}},{key:"getClassName",value:function(){return"Camera"}},{key:"toString",value:function(e){var t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(var n=0;n<this.animations.length;n++)t+=", animation[0]: "+this.animations[n].toString(e);return t}},{key:"applyVerticalCorrection",value:function(){var e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x}},{key:"globalPosition",get:function(){return this._globalPosition}},{key:"getActiveMeshes",value:function(){return this._activeMeshes}},{key:"isActiveMesh",value:function(e){return-1!==this._activeMeshes.indexOf(e)}},{key:"isReady",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e){var t,i=S(this._postProcesses);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(r&&!r.isReady())return!1}}catch(a){i.e(a)}finally{i.f()}}return(0,o.Z)((0,l.Z)(n.prototype),"isReady",this).call(this,e)}},{key:"_initCache",value:function(){(0,o.Z)((0,l.Z)(n.prototype),"_initCache",this).call(this),this._cache.position=new p.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new p.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}},{key:"_updateCache",value:function(e){e||(0,o.Z)((0,l.Z)(n.prototype),"_updateCache",this).call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}},{key:"_isSynchronized",value:function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}},{key:"_isSynchronizedViewMatrix",value:function(){return!!(0,o.Z)((0,l.Z)(n.prototype),"_isSynchronized",this).call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}},{key:"_isSynchronizedProjectionMatrix",value:function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var t=this.getEngine();return e=this.mode===n.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight()}},{key:"attachControl",value:function(e,t){}},{key:"detachControl",value:function(e){}},{key:"update",value:function(){this._checkInputs(),this.cameraRigMode!==n.RIG_MODE_NONE&&this._updateRigCameras()}},{key:"_checkInputs",value:function(){this.onAfterCheckInputsObservable.notifyObservers(this)}},{key:"rigCameras",get:function(){return this._rigCameras}},{key:"rigPostProcess",get:function(){return this._rigPostProcess}},{key:"_getFirstPostProcess",value:function(){for(var e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null}},{key:"_cascadePostProcessesToRigCams",value:function(){var e=this._getFirstPostProcess();e&&e.markTextureDirty();for(var t=0,n=this._rigCameras.length;t<n;t++){var i=this._rigCameras[t],r=i._rigPostProcess;if(r)"pass"===r.getEffectName()&&(i.isIntermediate=0===this._postProcesses.length),i._postProcesses=this._postProcesses.slice(0).concat(r),r.markTextureDirty();else i._postProcesses=this._postProcesses.slice(0)}}},{key:"attachPostProcess",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(g.Y.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))}},{key:"detachPostProcess",value:function(e){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}},{key:"getWorldMatrix",value:function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}},{key:"_getViewMatrix",value:function(){return p.y3.Identity()}},{key:"getViewMatrix",value:function(e){return!e&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}},{key:"freezeProjectionMatrix",value:function(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)}},{key:"unfreezeProjectionMatrix",value:function(){this._doNotComputeProjectionMatrix=!1}},{key:"getProjectionMatrix",value:function(e){if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var t=this.getEngine(),i=this.getScene();if(this.mode===n.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=t.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1);var r,a=t.useReverseDepthBuffer;r=i.useRightHandedSystem?p.y3.PerspectiveFovRHToRef:p.y3.PerspectiveFovLHToRef,r(this.fov,t.getAspectRatio(this),a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===n.FOVMODE_VERTICAL_FIXED,t.isNDCHalfZRange,this.projectionPlaneTilt,t.useReverseDepthBuffer)}else{var o,s,u,l,c,h,f,d,v=t.getRenderWidth()/2,_=t.getRenderHeight()/2;if(i.useRightHandedSystem)p.y3.OrthoOffCenterRHToRef(null!==(o=this.orthoLeft)&&void 0!==o?o:-v,null!==(s=this.orthoRight)&&void 0!==s?s:v,null!==(u=this.orthoBottom)&&void 0!==u?u:-_,null!==(l=this.orthoTop)&&void 0!==l?l:_,this.minZ,this.maxZ,this._projectionMatrix,t.isNDCHalfZRange);else p.y3.OrthoOffCenterLHToRef(null!==(c=this.orthoLeft)&&void 0!==c?c:-v,null!==(h=this.orthoRight)&&void 0!==h?h:v,null!==(f=this.orthoBottom)&&void 0!==f?f:-_,null!==(d=this.orthoTop)&&void 0!==d?d:_,this.minZ,this.maxZ,this._projectionMatrix,t.isNDCHalfZRange);this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}},{key:"getTransformationMatrix",value:function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}},{key:"_updateFrustumPlanes",value:function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?E.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=E.i.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}},{key:"isInFrustum",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),t&&this.rigCameras.length>0){var n=!1;return this.rigCameras.forEach((function(t){t._updateFrustumPlanes(),n=n||e.isInFrustum(t._frustumPlanes)})),n}return e.isInFrustum(this._frustumPlanes)}},{key:"isCompletelyInFrustum",value:function(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)}},{key:"getForwardRay",value:function(){throw(0,y.S)("Ray")}},{key:"getForwardRayToRef",value:function(e){throw(0,y.S)("Ray")}},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var i=this._rigCameras.pop();i&&i.dispose()}if(this._parentContainer){var r=this._parentContainer.cameras.indexOf(this);r>-1&&this._parentContainer.cameras.splice(r,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==n.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else for(var a=this._postProcesses.length;--a>=0;){var s=this._postProcesses[a];s&&s.dispose(this)}for(var u=this.customRenderTargets.length;--u>=0;)this.customRenderTargets[u].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),(0,o.Z)((0,l.Z)(n.prototype),"dispose",this).call(this,e,t)}},{key:"isLeftCamera",get:function(){return this._isLeftCamera}},{key:"isRightCamera",get:function(){return this._isRightCamera}},{key:"leftCamera",get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]}},{key:"rightCamera",get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]}},{key:"getLeftTarget",value:function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}},{key:"getRightTarget",value:function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}},{key:"setCameraRigMode",value:function(e,t){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){var i=this._rigCameras.pop();i&&i.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=t.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=d.w1.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==n.RIG_MODE_NONE){var r=this.createRigCamera(this.name+"_L",0);r&&(r._isLeftCamera=!0);var a=this.createRigCamera(this.name+"_R",1);a&&(a._isRightCamera=!0),r&&a&&(this._rigCameras.push(r),this._rigCameras.push(a))}this._setRigMode(t),this._cascadePostProcessesToRigCams(),this.update()}}},{key:"_setRigMode",value:function(e){}},{key:"_getVRProjectionMatrix",value:function(){return p.y3.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}},{key:"_updateCameraRotationMatrix",value:function(){}},{key:"_updateWebVRCameraRotationMatrix",value:function(){}},{key:"_getWebVRProjectionMatrix",value:function(){return p.y3.Identity()}},{key:"_getWebVRViewMatrix",value:function(){return p.y3.Identity()}},{key:"setCameraRigParameter",value:function(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=d.w1.ToRadians(t/.0637))}},{key:"createRigCamera",value:function(e,t){return null}},{key:"_updateRigCameras",value:function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===n.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}},{key:"_setupInputs",value:function(){}},{key:"serialize",value:function(){var e=h.p4.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),h.p4.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}},{key:"clone",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=h.p4.Clone(n.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return i.name=e,i.parent=t,this.onClonedObservable.notifyObservers(i),i}},{key:"getDirection",value:function(e){var t=p.P.Zero();return this.getDirectionToRef(e,t),t}},{key:"absoluteRotation",get:function(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}},{key:"getDirectionToRef",value:function(e,t){p.P.TransformNormalToRef(e,this.getWorldMatrix(),t)}},{key:"computeWorldMatrix",value:function(){return this.getWorldMatrix()}}],[{key:"GetConstructorFromName",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=_.N.Construct(e,t,i,{interaxial_distance:r,isStereoscopicSideBySide:a});return o||function(){return n._CreateDefaultParsedCamera(t,i)}}},{key:"Parse",value:function(e,t){var i=e.type,r=n.GetConstructorFromName(i,e.name,t,e.interaxial_distance,e.isStereoscopicSideBySide),a=h.p4.Parse(r,e,t);if(void 0!==e.parentId&&(a._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(a._waitingParentInstanceIndex=e.parentInstanceIndex),a.inputs&&(a.inputs.parse(e),a._setupInputs()),e.upVector&&(a.upVector=p.P.FromArray(e.upVector)),a.setPosition&&(a.position.copyFromFloats(0,0,0),a.setPosition(p.P.FromArray(e.position))),e.target&&a.setTarget&&a.setTarget(p.P.FromArray(e.target)),e.cameraRigMode){var o=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};a.setCameraRigMode(e.cameraRigMode,o)}if(e.animations){for(var s=0;s<e.animations.length;s++){var u=e.animations[s],l=(0,m.q)("BABYLON.Animation");l&&a.animations.push(l.Parse(u))}_.N.ParseAnimationRanges(a,e,t)}return e.autoAnimate&&t.beginAnimation(a,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&a.setEnabled(e.isEnabled),a}}]),n}(_.N);P._CreateDefaultParsedCamera=function(e,t){throw(0,y.S)("UniversalCamera")},P.PERSPECTIVE_CAMERA=0,P.ORTHOGRAPHIC_CAMERA=1,P.FOVMODE_VERTICAL_FIXED=0,P.FOVMODE_HORIZONTAL_FIXED=1,P.RIG_MODE_NONE=0,P.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,P.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,P.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,P.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,P.RIG_MODE_STEREOSCOPIC_INTERLACED=14,P.RIG_MODE_VR=20,P.RIG_MODE_WEBVR=21,P.RIG_MODE_CUSTOM=22,P.ForceAttachControlToAlwaysPreventDefault=!1,(0,c.gn)([(0,h.hd)("position")],P.prototype,"_position",void 0),(0,c.gn)([(0,h.hd)("upVector")],P.prototype,"_upVector",void 0),(0,c.gn)([(0,h.qC)()],P.prototype,"orthoLeft",null),(0,c.gn)([(0,h.qC)()],P.prototype,"orthoRight",null),(0,c.gn)([(0,h.qC)()],P.prototype,"orthoBottom",null),(0,c.gn)([(0,h.qC)()],P.prototype,"orthoTop",null),(0,c.gn)([(0,h.qC)()],P.prototype,"fov",void 0),(0,c.gn)([(0,h.qC)()],P.prototype,"projectionPlaneTilt",void 0),(0,c.gn)([(0,h.qC)()],P.prototype,"minZ",void 0),(0,c.gn)([(0,h.qC)()],P.prototype,"maxZ",void 0),(0,c.gn)([(0,h.qC)()],P.prototype,"inertia",void 0),(0,c.gn)([(0,h.qC)()],P.prototype,"mode",null),(0,c.gn)([(0,h.qC)()],P.prototype,"layerMask",void 0),(0,c.gn)([(0,h.qC)()],P.prototype,"fovMode",void 0),(0,c.gn)([(0,h.qC)()],P.prototype,"cameraRigMode",void 0),(0,c.gn)([(0,h.qC)()],P.prototype,"interaxialDistance",void 0),(0,c.gn)([(0,h.qC)()],P.prototype,"isStereoscopicSideBySide",void 0)},3541:function(e,t,n){"use strict";n.d(t,{p:function(){return s}});var i=n(5671),r=n(3144),a=n(6900),o=n(2845),s=function(){function e(){(0,i.Z)(this,e),this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}return(0,r.Z)(e,[{key:"getNormal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(o.o.NormalKind))return null;var n,i=this.pickedMesh.getIndices();if(!i)return null;if(t){var r=this.pickedMesh.getVerticesData(o.o.NormalKind),s=a.P.FromArray(r,3*i[3*this.faceId]),u=a.P.FromArray(r,3*i[3*this.faceId+1]),l=a.P.FromArray(r,3*i[3*this.faceId+2]);s=s.scale(this.bu),u=u.scale(this.bv),l=l.scale(1-this.bu-this.bv),n=new a.P(s.x+u.x+l.x,s.y+u.y+l.y,s.z+u.z+l.z)}else{var c=this.pickedMesh.getVerticesData(o.o.PositionKind),h=a.P.FromArray(c,3*i[3*this.faceId]),f=a.P.FromArray(c,3*i[3*this.faceId+1]),d=a.P.FromArray(c,3*i[3*this.faceId+2]),v=h.subtract(f),p=d.subtract(f);n=a.P.Cross(v,p)}if(e){var _=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(a.jp.Matrix[0].copyFrom(_),(_=a.jp.Matrix[0]).setTranslationFromFloats(0,0,0),_.invert(),_.transposeToRef(a.jp.Matrix[1]),_=a.jp.Matrix[1]),n=a.P.TransformNormal(n,_)}return n.normalize(),n}},{key:"getTextureCoordinates",value:function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(o.o.UVKind))return null;var e=this.pickedMesh.getIndices();if(!e)return null;var t=this.pickedMesh.getVerticesData(o.o.UVKind);if(!t)return null;var n=a.FM.FromArray(t,2*e[3*this.faceId]),i=a.FM.FromArray(t,2*e[3*this.faceId+1]),r=a.FM.FromArray(t,2*e[3*this.faceId+2]);return n=n.scale(this.bu),i=i.scale(this.bv),r=r.scale(1-this.bu-this.bv),new a.FM(n.x+i.x+r.x,n.y+i.y+r.y)}}]),e}()},6176:function(e,t,n){"use strict";n.d(t,{e:function(){return a}});var i=n(3144),r=n(5671),a=(0,i.Z)((function e(){(0,r.Z)(this,e)}));a.UseOpenGLOrientationForUV=!1},9115:function(e,t,n){"use strict";n.d(t,{j:function(){return v}});var i=n(5671),r=n(3144),a=n(8134),o=n(6900),s=n(3681),u=function(){function e(t,n,r){(0,i.Z)(this,e),this.vectors=a.B.BuildArray(8,o.P.Zero),this.center=o.P.Zero(),this.centerWorld=o.P.Zero(),this.extendSize=o.P.Zero(),this.extendSizeWorld=o.P.Zero(),this.directions=a.B.BuildArray(3,o.P.Zero),this.vectorsWorld=a.B.BuildArray(8,o.P.Zero),this.minimumWorld=o.P.Zero(),this.maximumWorld=o.P.Zero(),this.minimum=o.P.Zero(),this.maximum=o.P.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(t,n,r)}return(0,r.Z)(e,[{key:"reConstruct",value:function(e,t,n){var i=e.x,r=e.y,a=e.z,s=t.x,u=t.y,l=t.z,c=this.vectors;this.minimum.copyFromFloats(i,r,a),this.maximum.copyFromFloats(s,u,l),c[0].copyFromFloats(i,r,a),c[1].copyFromFloats(s,u,l),c[2].copyFromFloats(s,r,a),c[3].copyFromFloats(i,u,a),c[4].copyFromFloats(i,r,l),c[5].copyFromFloats(s,u,a),c[6].copyFromFloats(i,u,l),c[7].copyFromFloats(s,r,l),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=n||o.y3.IdentityReadOnly,this._update(this._worldMatrix)}},{key:"scale",value:function(t){var n=e._TmpVector3,i=this.maximum.subtractToRef(this.minimum,n[0]),r=i.length();i.normalizeFromLength(r);var a=r*t,o=i.scaleInPlace(.5*a),s=this.center.subtractToRef(o,n[1]),u=this.center.addToRef(o,n[2]);return this.reConstruct(s,u,this._worldMatrix),this}},{key:"getWorldMatrix",value:function(){return this._worldMatrix}},{key:"_update",value:function(e){var t=this.minimumWorld,n=this.maximumWorld,i=this.directions,r=this.vectorsWorld,a=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),n.copyFrom(this.maximum);for(var s=0;s<8;++s)r[s].copyFrom(a[s]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),n.setAll(-Number.MAX_VALUE);for(var u=0;u<8;++u){var l=r[u];o.P.TransformCoordinatesToRef(a[u],e,l),t.minimizeInPlace(l),n.maximizeInPlace(l)}n.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),n.addToRef(t,this.centerWorld).scaleInPlace(.5)}o.P.FromArrayToRef(e.m,0,i[0]),o.P.FromArrayToRef(e.m,4,i[1]),o.P.FromArrayToRef(e.m,8,i[2]),this._worldMatrix=e}},{key:"isInFrustum",value:function(t){return e.IsInFrustum(this.vectorsWorld,t)}},{key:"isCompletelyInFrustum",value:function(t){return e.IsCompletelyInFrustum(this.vectorsWorld,t)}},{key:"intersectsPoint",value:function(e){var t=this.minimumWorld,n=this.maximumWorld,i=t.x,r=t.y,a=t.z,o=n.x,u=n.y,l=n.z,c=e.x,h=e.y,f=e.z,d=-s.kn;return!(o-c<d||d>c-i)&&(!(u-h<d||d>h-r)&&!(l-f<d||d>f-a))}},{key:"intersectsSphere",value:function(t){return e.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)}},{key:"intersectsMinMax",value:function(e,t){var n=this.minimumWorld,i=this.maximumWorld,r=n.x,a=n.y,o=n.z,s=i.x,u=i.y,l=i.z,c=e.x,h=e.y,f=e.z,d=t.x,v=t.y,p=t.z;return!(s<c||r>d)&&(!(u<h||a>v)&&!(l<f||o>p))}},{key:"dispose",value:function(){var e,t;null===(e=this._drawWrapperFront)||void 0===e||e.dispose(),null===(t=this._drawWrapperBack)||void 0===t||t.dispose()}}],[{key:"Intersects",value:function(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)}},{key:"IntersectsSphere",value:function(t,n,i,r){var a=e._TmpVector3[0];return o.P.ClampToRef(i,t,n,a),o.P.DistanceSquared(i,a)<=r*r}},{key:"IsCompletelyInFrustum",value:function(e,t){for(var n=0;n<6;++n)for(var i=t[n],r=0;r<8;++r)if(i.dotCoordinate(e[r])<0)return!1;return!0}},{key:"IsInFrustum",value:function(e,t){for(var n=0;n<6;++n){for(var i=!0,r=t[n],a=0;a<8;++a)if(r.dotCoordinate(e[a])>=0){i=!1;break}if(i)return!1}return!0}}]),e}();u._TmpVector3=a.B.BuildArray(3,o.P.Zero);var l=function(){function e(t,n,r){(0,i.Z)(this,e),this.center=o.P.Zero(),this.centerWorld=o.P.Zero(),this.minimum=o.P.Zero(),this.maximum=o.P.Zero(),this.reConstruct(t,n,r)}return(0,r.Z)(e,[{key:"reConstruct",value:function(e,t,n){this.minimum.copyFrom(e),this.maximum.copyFrom(t);var i=o.P.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*i,this._update(n||o.y3.IdentityReadOnly)}},{key:"scale",value:function(t){var n=this.radius*t,i=e._TmpVector3,r=i[0].setAll(n),a=this.center.subtractToRef(r,i[1]),o=this.center.addToRef(r,i[2]);return this.reConstruct(a,o,this._worldMatrix),this}},{key:"getWorldMatrix",value:function(){return this._worldMatrix}},{key:"_update",value:function(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{o.P.TransformCoordinatesToRef(this.center,t,this.centerWorld);var n=e._TmpVector3[0];o.P.TransformNormalFromFloatsToRef(1,1,1,t,n),this.radiusWorld=Math.max(Math.abs(n.x),Math.abs(n.y),Math.abs(n.z))*this.radius}}},{key:"isInFrustum",value:function(e){for(var t=this.centerWorld,n=this.radiusWorld,i=0;i<6;i++)if(e[i].dotCoordinate(t)<=-n)return!1;return!0}},{key:"isCenterInFrustum",value:function(e){for(var t=this.centerWorld,n=0;n<6;n++)if(e[n].dotCoordinate(t)<0)return!1;return!0}},{key:"intersectsPoint",value:function(e){var t=o.P.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)}}],[{key:"Intersects",value:function(e,t){var n=o.P.DistanceSquared(e.centerWorld,t.centerWorld),i=e.radiusWorld+t.radiusWorld;return!(i*i<n)}},{key:"CreateFromCenterAndRadius",value:function(t,n,i){this._TmpVector3[0].copyFrom(t),this._TmpVector3[1].copyFromFloats(0,0,n),this._TmpVector3[2].copyFrom(t),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);var r=new e(this._TmpVector3[0],this._TmpVector3[2]);return r._worldMatrix=i||o.y3.Identity(),r}}]),e}();l._TmpVector3=a.B.BuildArray(3,o.P.Zero);var c={min:0,max:0},h={min:0,max:0},f=function(e,t,n){var i=o.P.Dot(t.centerWorld,e),r=Math.abs(o.P.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(o.P.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(o.P.Dot(t.directions[2],e))*t.extendSize.z;n.min=i-r,n.max=i+r},d=function(e,t,n){return f(e,t,c),f(e,n,h),!(c.min>h.max||h.min>c.max)},v=function(){function e(t,n,r){(0,i.Z)(this,e),this._isLocked=!1,this.boundingBox=new u(t,n,r),this.boundingSphere=new l(t,n,r)}return(0,r.Z)(e,[{key:"reConstruct",value:function(e,t,n){this.boundingBox.reConstruct(e,t,n),this.boundingSphere.reConstruct(e,t,n)}},{key:"minimum",get:function(){return this.boundingBox.minimum}},{key:"maximum",get:function(){return this.boundingBox.maximum}},{key:"isLocked",get:function(){return this._isLocked},set:function(e){this._isLocked=e}},{key:"update",value:function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}},{key:"centerOn",value:function(t,n){var i=e._TmpVector3[0].copyFrom(t).subtractInPlace(n),r=e._TmpVector3[1].copyFrom(t).addInPlace(n);return this.boundingBox.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this}},{key:"encapsulate",value:function(e){var t=o.P.Minimize(this.minimum,e),n=o.P.Maximize(this.maximum,e);return this.reConstruct(t,n,this.boundingBox.getWorldMatrix()),this}},{key:"encapsulateBoundingInfo",value:function(e){return this.encapsulate(e.boundingBox.centerWorld.subtract(e.boundingBox.extendSizeWorld)),this.encapsulate(e.boundingBox.centerWorld.add(e.boundingBox.extendSizeWorld)),this}},{key:"scale",value:function(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}},{key:"isInFrustum",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2===t||3===t;if(n&&this.boundingSphere.isCenterInFrustum(e))return!0;if(!this.boundingSphere.isInFrustum(e))return!1;var i=1===t||3===t;return!!i||this.boundingBox.isInFrustum(e)}},{key:"diagonalLength",get:function(){var t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,e._TmpVector3[0]).length()}},{key:"isCompletelyInFrustum",value:function(e){return this.boundingBox.isCompletelyInFrustum(e)}},{key:"_checkCollision",value:function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}},{key:"intersectsPoint",value:function(e){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e))}},{key:"intersects",value:function(e,t){if(!l.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!u.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;var n=this.boundingBox,i=e.boundingBox;return!!d(n.directions[0],n,i)&&(!!d(n.directions[1],n,i)&&(!!d(n.directions[2],n,i)&&(!!d(i.directions[0],n,i)&&(!!d(i.directions[1],n,i)&&(!!d(i.directions[2],n,i)&&(!!d(o.P.Cross(n.directions[0],i.directions[0]),n,i)&&(!!d(o.P.Cross(n.directions[0],i.directions[1]),n,i)&&(!!d(o.P.Cross(n.directions[0],i.directions[2]),n,i)&&(!!d(o.P.Cross(n.directions[1],i.directions[0]),n,i)&&(!!d(o.P.Cross(n.directions[1],i.directions[1]),n,i)&&(!!d(o.P.Cross(n.directions[1],i.directions[2]),n,i)&&(!!d(o.P.Cross(n.directions[2],i.directions[0]),n,i)&&(!!d(o.P.Cross(n.directions[2],i.directions[1]),n,i)&&!!d(o.P.Cross(n.directions[2],i.directions[2]),n,i))))))))))))))}}]),e}();v._TmpVector3=a.B.BuildArray(2,o.P.Zero)},9776:function(e,t,n){"use strict";n.d(t,{L:function(){return L}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this.children=[]}return(0,r.Z)(e,[{key:"isValid",value:function(e){return!0}},{key:"process",value:function(e,t){var n="";if(this.line){var i=this.line,r=t.processor;if(r){if(r.lineProcessor&&(i=r.lineProcessor(i,t.isFragment,t.processingContext)),r.attributeProcessor&&this.line.startsWith("attribute"))i=r.attributeProcessor(this.line,e,t.processingContext);else if(r.varyingProcessor&&this.line.startsWith("varying"))i=r.varyingProcessor(this.line,t.isFragment,e,t.processingContext);else if(r.uniformProcessor&&r.uniformRegexp&&r.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(i=r.uniformProcessor(this.line,t.isFragment,e,t.processingContext));else if(r.uniformBufferProcessor&&r.uniformBufferRegexp&&r.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(i=r.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(r.textureProcessor&&r.textureRegexp&&r.textureRegexp.test(this.line))i=r.textureProcessor(this.line,t.isFragment,e,t.processingContext);else if((r.uniformProcessor||r.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?r.uniformProcessor&&(i=r.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):r.uniformBufferProcessor&&(i=r.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,r.endOfUniformBufferProcessor&&(i=r.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}n+=i+"\r\n"}return this.children.forEach((function(i){n+=i.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),n}}]),e}();function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var u=function(){function e(){(0,i.Z)(this,e),this._lines=[]}return(0,r.Z)(e,[{key:"currentLine",get:function(){return this._lines[this.lineIndex]}},{key:"canRead",get:function(){return this.lineIndex<this._lines.length-1}},{key:"lines",set:function(e){this._lines.length=0;var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if("#"!==i[0])if(i.trim().startsWith("//"))this._lines.push(i);else for(var r=i.split(";"),a=0;a<r.length;a++){var s=r[a];(s=s.trim())&&this._lines.push(s+(a!==r.length-1?";":""))}else this._lines.push(i)}}catch(u){n.e(u)}finally{n.f()}}}]),e}(),l=n(136),c=n(6215),h=n(1120);function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}var d=function(e){(0,l.Z)(n,e);var t=f(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"process",value:function(e,t){for(var n=0;n<this.children.length;n++){var i=this.children[n];if(i.isValid(e))return i.process(e,t)}return""}}]),n}(a);function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}var p=function(e){(0,l.Z)(n,e);var t=v(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"isValid",value:function(e){return this.testExpression.isTrue(e)}}]),n}(a);function _(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var m=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"isTrue",value:function(e){return!0}}],[{key:"postfixToInfix",value:function(t){var n,i=[],r=_(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(void 0===e._OperatorPriority[a])i.push(a);else{var o=i[i.length-1],s=i[i.length-2];i.length-=2,i.push("(".concat(s).concat(a).concat(o,")"))}}}catch(u){r.e(u)}finally{r.f()}return i[i.length-1]}},{key:"infixToPostfix",value:function(t){for(var n=[],i=-1,r=function(){""!==(l=l.trim())&&(n.push(l),l="")},a=function(t){i<e._Stack.length-1&&(e._Stack[++i]=t)},o=function(){return e._Stack[i]},s=function(){return-1===i?"!!INVALID EXPRESSION!!":e._Stack[i--]},u=0,l="";u<t.length;){var c=t.charAt(u),h=u<t.length-1?t.substr(u,2):"";if("("===c)l="",a(c);else if(")"===c){for(r();-1!==i&&"("!==o();)n.push(s());s()}else if(e._OperatorPriority[h]>1){for(r();-1!==i&&e._OperatorPriority[o()]>=e._OperatorPriority[h];)n.push(s());a(h),u++}else l+=c;u++}for(r();-1!==i;)"("===o()?s():n.push(s());return n}}]),e}();function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}m._OperatorPriority={")":0,"(":1,"||":2,"&&":3},m._Stack=["","","","","","","","","","","","","","","","","","","",""];var A=function(e){(0,l.Z)(n,e);var t=y(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,i.Z)(this,n),(r=t.call(this)).define=e,r.not=a,r}return(0,r.Z)(n,[{key:"isTrue",value:function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t}}]),n}(m);function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}var S=function(e){(0,l.Z)(n,e);var t=E(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"isTrue",value:function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}}]),n}(m);function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}var b=function(e){(0,l.Z)(n,e);var t=T(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"isTrue",value:function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}}]),n}(m);function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,h.Z)(e);if(t){var r=(0,h.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,c.Z)(this,n)}}var M=function(e){(0,l.Z)(n,e);var t=P(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this)).define=e,o.operand=r,o.testValue=a,o}return(0,r.Z)(n,[{key:"isTrue",value:function(e){var t=e[this.define];void 0===t&&(t=this.define);var n=!1,i=parseInt(t),r=parseInt(this.testValue);switch(this.operand){case">":n=i>r;break;case"<":n=i<r;break;case"<=":n=i<=r;break;case">=":n=i>=r;break;case"==":n=i===r}return n}}]),n}(m),I=n(5230),C=n(2223);function x(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var D=/defined\s*?\((.+?)\)/g,k=/defined\s*?\[(.+?)\]/g,O=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,L=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"Initialize",value:function(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}},{key:"Process",value:function(e,t,n,i){var r,a=this;null!==(r=t.processor)&&void 0!==r&&r.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e));var r=a._ProcessShaderConversion(e,t,i);n(r)}))}},{key:"PreProcess",value:function(e,t,n,i){var r,a=this;null!==(r=t.processor)&&void 0!==r&&r.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e));var r=a._ApplyPreProcessing(e,t,i);n(r)}))}},{key:"Finalize",value:function(e,t,n){return n.processor&&n.processor.finalizeShaders?n.processor.finalizeShaders(e,t,n.processingContext):{vertexCode:e,fragmentCode:t}}},{key:"_ProcessPrecision",value:function(e,t){var n;if(null!==(n=t.processor)&&void 0!==n&&n.noPrecision)return e;var i=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float")),e}},{key:"_ExtractOperation",value:function(e){var t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new A(t[1].trim(),"!"===e[0]);for(var n="",i=0,r=0,a=["==",">=","<=","<",">"];r<a.length&&(n=a[r],!((i=e.indexOf(n))>-1));r++);if(-1===i)return new A(e);var o=e.substring(0,i).trim(),s=e.substring(i+n.length).trim();return new M(o,n,s)}},{key:"_BuildSubExpression",value:function(e){e=e.replace(D,"defined[$1]");var t,n=[],i=x(m.infixToPostfix(e));try{for(i.s();!(t=i.n()).done;){var r=t.value;if("||"!==r&&"&&"!==r)n.push(r);else if(n.length>=2){var a=n[n.length-1],o=n[n.length-2];n.length-=2;var s="&&"==r?new b:new S;"string"==typeof a&&(a=a.replace(k,"defined($1)")),"string"==typeof o&&(o=o.replace(k,"defined($1)")),s.leftOperand="string"==typeof o?this._ExtractOperation(o):o,s.rightOperand="string"==typeof a?this._ExtractOperation(a):a,n.push(s)}}}catch(l){i.e(l)}finally{i.f()}var u=n[n.length-1];return"string"==typeof u&&(u=u.replace(k,"defined($1)")),"string"==typeof u?this._ExtractOperation(u):u}},{key:"_BuildExpression",value:function(e,t){var n=new p,i=e.substring(0,t),r=e.substring(t);return r=r.substring(0,(r.indexOf("//")+1||r.length+1)-1).trim(),n.testExpression="#ifdef"===i?new A(r):"#ifndef"===i?new A(r,!0):this._BuildSubExpression(r),n}},{key:"_MoveCursorWithinIf",value:function(e,t,n){for(var i=e.currentLine;this._MoveCursor(e,n);){var r=(i=e.currentLine).substring(0,5).toLowerCase();if("#else"===r){var o=new a;return t.children.push(o),void this._MoveCursor(e,o)}if("#elif"===r){var s=this._BuildExpression(i,5);t.children.push(s),n=s}}}},{key:"_MoveCursor",value:function(e,t){for(;e.canRead;){e.lineIndex++;var n=e.currentLine,i=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(n);if(i&&i.length){switch(i[0]){case"#ifdef":var r=new d;t.children.push(r);var o=this._BuildExpression(n,6);r.children.push(o),this._MoveCursorWithinIf(e,r,o);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":var s=new d;t.children.push(s);var u=this._BuildExpression(n,7);s.children.push(u),this._MoveCursorWithinIf(e,s,u);break;case"#if":var l=new d,c=this._BuildExpression(n,3);t.children.push(l),l.children.push(c),this._MoveCursorWithinIf(e,l,c)}}else{var h=new a;if(h.line=n,t.children.push(h),"#"===n[0]&&"d"===n[1]){var f=n.replace(";","").split(" ");h.additionalDefineKey=f[1],3===f.length&&(h.additionalDefineValue=f[2])}}}return!1}},{key:"_EvaluatePreProcessors",value:function(e,t,n){var i=new a,r=new u;return r.lineIndex=-1,r.lines=e.split("\n"),this._MoveCursor(r,i),i.process(t,n)}},{key:"_PreparePreProcessors",value:function(e,t){var n,i,r={},a=x(e.defines);try{for(a.s();!(i=a.n()).done;){var o=i.value.replace("#define","").replace(";","").trim().split(" ");r[o[0]]=o.length>1?o[1]:""}}catch(s){a.e(s)}finally{a.f()}return(null===(n=e.processor)||void 0===n?void 0:n.shaderLanguage)===C.x.GLSL&&(r.GL_ES="true"),r.__VERSION__=e.version,r[e.platformName]="true",t._getGlobalDefines(r),r}},{key:"_ProcessShaderConversion",value:function(e,t,n){var i=this._ProcessPrecision(e,t);if(!t.processor)return i;if(t.processor.shaderLanguage===C.x.GLSL&&-1!==i.indexOf("#version 3"))return i.replace("#version 300 es","");var r=t.defines,a=this._PreparePreProcessors(t,n);return t.processor.preProcessor&&(i=t.processor.preProcessor(i,r,t.isFragment,t.processingContext)),i=this._EvaluatePreProcessors(i,a,t),t.processor.postProcessor&&(i=t.processor.postProcessor(i,r,t.isFragment,t.processingContext,n)),n._features.needShaderCodeInlining&&(i=n.inlineShaderCode(i)),i}},{key:"_ApplyPreProcessing",value:function(e,t,n){var i,r,a=e,o=t.defines,s=this._PreparePreProcessors(t,n);return null!==(i=t.processor)&&void 0!==i&&i.preProcessor&&(a=t.processor.preProcessor(a,o,t.isFragment,t.processingContext)),a=this._EvaluatePreProcessors(a,s,t),null!==(r=t.processor)&&void 0!==r&&r.postProcessor&&(a=t.processor.postProcessor(a,o,t.isFragment,t.processingContext,n)),n._features.needShaderCodeInlining&&(a=n.inlineShaderCode(a)),a}},{key:"_ProcessIncludes",value:function(t,n,i){for(var r=this,a=O.exec(t),o=new String(t),s=!1,u=function(){var u=a[1];if(-1!==u.indexOf("__decl__")&&(u=u.replace(/__decl__/,""),n.supportsUniformBuffers&&(u=(u=u.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),u+="Declaration"),!n.includesShadersStore[u]){var l=n.shadersRepository+"ShadersInclude/"+u+".fx";return e._FileToolsLoadFile(l,(function(e){n.includesShadersStore[u]=e,r._ProcessIncludes(o,n,i)})),{v:void 0}}var c=n.includesShadersStore[u];if(a[2])for(var h=a[3].split(","),f=0;f<h.length;f+=2){var d=new RegExp(h[f],"g"),v=h[f+1];c=c.replace(d,v)}if(a[4]){var p=a[5];if(-1!==p.indexOf("..")){var _=p.split(".."),g=parseInt(_[0]),m=parseInt(_[1]),y=c.slice(0);c="",isNaN(m)&&(m=n.indexParameters[_[1]]);for(var A=g;A<m;A++)n.supportsUniformBuffers||(y=y.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),c+=y.replace(/\{X\}/g,A.toString())+"\n"}else n.supportsUniformBuffers||(c=c.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),c=c.replace(/\{X\}/g,p)}o=o.replace(a[0],c),s=s||c.indexOf("#include<")>=0||c.indexOf("#include <")>=0,a=O.exec(t)};null!=a;){var l=u();if("object"==typeof l)return l.v}s?this._ProcessIncludes(o.toString(),n,i):i(o)}},{key:"_FileToolsLoadFile",value:function(e,t,n,i,r,a){throw(0,I.S)("FileTools")}}]),e}()},938:function(e,t,n){"use strict";n.d(t,{C:function(){return o}});var i=n(5671),r=n(3144),a=n(2223),o=function(){function e(){(0,i.Z)(this,e),this.shaderLanguage=a.x.GLSL}return(0,r.Z)(e,[{key:"attributeProcessor",value:function(e){return e.replace("attribute","in")}},{key:"varyingProcessor",value:function(e,t){return e.replace("varying",t?"in":"out")}},{key:"postProcessor",value:function(e,t,n){var i=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),n)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(i?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e}}]),e}()},6431:function(e,t,n){"use strict";n.d(t,{B:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;if((0,i.Z)(this,e),this._MSAARenderBuffer=null,this._context=n,!t&&!(t=n.createTexture()))throw new Error("Unable to create webGL texture");this.set(t)}return(0,r.Z)(e,[{key:"underlyingResource",get:function(){return this._webGLTexture}},{key:"setUsage",value:function(){}},{key:"set",value:function(e){this._webGLTexture=e}},{key:"reset",value:function(){this._webGLTexture=null,this._MSAARenderBuffer=null}},{key:"release",value:function(){this._MSAARenderBuffer&&(this._context.deleteRenderbuffer(this._MSAARenderBuffer),this._MSAARenderBuffer=null),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}]),e}()},8099:function(e,t,n){"use strict";n.d(t,{y:function(){return u}});var i=n(5671),r=n(3144);function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var s=["Int2","Int","Int3","Int4","Vector2","Vector3","Vector4","Float2","Float","Float3","Float4","Quaternion","Color3","Color4","DirectColor4"],u=function(){function e(){var t=this;(0,i.Z)(this,e),this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null;var n=[],r=function(){n.length=0,Array.prototype.push.apply(n,arguments),n[0]=this._uniforms[n[0]]},a=function(e){var i=s.includes(e.substring(3))&&"FloatN";if(i){var a=t["_cache".concat(i)];return function(){var t=this.engine[e];r.apply(this,arguments),a.apply(this,arguments)&&(t.apply(this.engine,n)||(this._valueCache[arguments[0]]=null))}}return function(){var t=this.engine[e];r.apply(this,arguments),void 0!==arguments[1]&&(this._valueCache[arguments[0]]=null,t.apply(this.engine,n))}};["Int?","IntArray?","Array?","Float?","Matrices","Matrix3x3","Matrix2x2"].forEach((function(e){var n="set".concat(e);t[n]||(n.endsWith("?")?["",2,3,4].forEach((function(e){t[n.slice(0,-1)+e]=t[n.slice(0,-1)+e]||a(n.slice(0,-1)+e).bind(t)})):t[n]=t[n]||a(n).bind(t))}))}return(0,r.Z)(e,[{key:"isAsync",get:function(){return this.isParallelCompiled}},{key:"isReady",get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))}},{key:"_handlesSpectorRebuildCallback",value:function(e){e&&this.program&&e(this.program)}},{key:"_fillEffectInformation",value:function(e,t,n,i,r,o,s,u){var l,c=this.engine;if(c.supportsUniformBuffers)for(var h in t)e.bindUniformBlock(h,t[h]);for(this.engine.getUniforms(this,n).forEach((function(e,t){i[n[t]]=e})),this._uniforms=i,l=0;l<r.length;l++){null==e.getUniform(r[l])&&(r.splice(l,1),l--)}r.forEach((function(e,t){o[e]=t}));var f,d=a(c.getAttributes(this,s));try{for(d.s();!(f=d.n()).done;){var v=f.value;u.push(v)}}catch(p){d.e(p)}finally{d.f()}}},{key:"dispose",value:function(){this._uniforms={}}},{key:"_cacheMatrix",value:function(e,t){var n=this._valueCache[e],i=t.updateFlag;return(void 0===n||n!==i)&&(this._valueCache[e]=i,!0)}},{key:"_cacheFloatN",value:function(e,t,n,i,r){var a=this._valueCache[arguments[0]];if(!a||a.length!==arguments.length-1)return a=Array.prototype.slice.call(arguments,1),this._valueCache[arguments[0]]=a,!0;for(var o=!1,s=0;s<a.length;++s)a[s]!==arguments[s+1]&&(a[s]=arguments[s+1],o=!0);return o}},{key:"_cacheFloat2",value:function(e,t,n){return this._cacheFloatN(e,t,n)}},{key:"_cacheFloat3",value:function(e,t,n,i){return this._cacheFloatN(e,t,n,i)}},{key:"_cacheFloat4",value:function(e,t,n,i,r){return this._cacheFloatN(e,t,n,i,r)}},{key:"setMatrix",value:function(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null))}},{key:"setVector2",value:function(e,t){this.setFloat2(e,t.x,t.y)}},{key:"setVector3",value:function(e,t){this.setFloat3(e,t.x,t.y,t.z)}},{key:"setVector4",value:function(e,t){this.setFloat4(e,t.x,t.y,t.z,t.w)}},{key:"setQuaternion",value:function(e,t){this.setFloat4(e,t.x,t.y,t.z,t.w)}},{key:"setColor3",value:function(e,t){this.setFloat3(e,t.r,t.g,t.b)}},{key:"setColor4",value:function(e,t,n){this.setFloat4(e,t.r,t.g,t.b,n)}},{key:"setDirectColor4",value:function(e,t){this.setFloat4(e,t.r,t.g,t.b,t.a)}},{key:"_getVertexShaderCode",value:function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}},{key:"_getFragmentShaderCode",value:function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}]),e}()},970:function(e,t,n){"use strict";n.d(t,{f:function(){return o}});var i=n(5671),r=n(3144),a=n(2223),o=function(){function e(){(0,i.Z)(this,e),this.shaderLanguage=a.x.GLSL}return(0,r.Z)(e,[{key:"postProcessor",value:function(e,t,n,i,r){if(!r.getCaps().drawBuffersExtension){e=e.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")}return e}}]),e}()},2977:function(e,t,n){"use strict";n.d(t,{D:function(){return I}});var i=n(5671),r=n(3144),a=n(7326),o=n(1752),s=n(136),u=n(6215),l=n(1120),c=n(4174),h=n(1889),f=n(5092),d=n(4198),v=n(5230),p=n(4796),_=n(2786),g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;(0,i.Z)(this,e),this._enabled=!0,this._rollingFrameTime=new m(t)}return(0,r.Z)(e,[{key:"sampleFrame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.F.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){var t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}}},{key:"averageFrameTime",get:function(){return this._rollingFrameTime.average}},{key:"averageFrameTimeVariance",get:function(){return this._rollingFrameTime.variance}},{key:"instantaneousFrameTime",get:function(){return this._rollingFrameTime.history(0)}},{key:"averageFPS",get:function(){return 1e3/this._rollingFrameTime.average}},{key:"instantaneousFPS",get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e}},{key:"isSaturated",get:function(){return this._rollingFrameTime.isSaturated()}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this._lastFrameTimeMs=null}},{key:"isEnabled",get:function(){return this._enabled}},{key:"reset",value:function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}]),e}(),m=function(){function e(t){(0,i.Z)(this,e),this._samples=new Array(t),this.reset()}return(0,r.Z)(e,[{key:"add",value:function(e){var t;if(this.isSaturated()){var n=this._samples[this._pos];t=n-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(n-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length}},{key:"history",value:function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]}},{key:"isSaturated",value:function(){return this._sampleCount>=this._samples.length}},{key:"reset",value:function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}},{key:"_wrapPosition",value:function(e){var t=this._samples.length;return(e%t+t)%t}}]),e}(),y=n(2864),A=n(2628),E=n(2328),S=n(6431);function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;switch(e){case 3:var r=(ArrayBuffer,new Int8Array(t));return i&&r.set(new Int8Array(i)),r;case 0:var a=(ArrayBuffer,new Uint8Array(t));return i&&a.set(new Uint8Array(i)),a;case 4:var o=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(n?t/2:t);return i&&o.set(new Int16Array(i)),o;case 5:case 8:case 9:case 10:case 2:var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(n?t/2:t);return i&&s.set(new Uint16Array(i)),s;case 6:var u=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(n?t/4:t);return i&&u.set(new Int32Array(i)),u;case 7:case 11:case 12:case 13:case 14:case 15:var l=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(n?t/4:t);return i&&l.set(new Uint32Array(i)),l;case 1:var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(n?t/4:t);return i&&c.set(new Float32Array(i)),c}var h=(ArrayBuffer,new Uint8Array(t));return i&&h.set(new Uint8Array(i)),h}function b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,l.Z)(e);if(t){var r=(0,l.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,u.Z)(this,n)}}p.B.prototype.setAlphaConstants=function(e,t,n,i){this._alphaState.setAlphaBlendConstants(e,t,n,i)},p.B.prototype.setAlphaMode=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}},p.B.prototype.getAlphaMode=function(){return this._alphaMode},p.B.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=e}},p.B.prototype.getAlphaEquation=function(){return this._alphaEquation},p.B.prototype._readTexturePixelsSync=function(e,t,n){var i,r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,f=this._gl;if(!f)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var d=f.createFramebuffer();if(!d)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=d}(f.bindFramebuffer(f.FRAMEBUFFER,this._dummyFramebuffer),a>-1)?f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_CUBE_MAP_POSITIVE_X+a,null===(i=e._hardwareTexture)||void 0===i?void 0:i.underlyingResource,o):f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,null===(r=e._hardwareTexture)||void 0===r?void 0:r.underlyingResource,o);var v=void 0!==e.type?this._getWebGLTextureType(e.type):f.UNSIGNED_BYTE;if(l)s||(s=T(e.type,4*t*n));else if(v===f.UNSIGNED_BYTE)s||(s=new Uint8Array(4*t*n)),v=f.UNSIGNED_BYTE;else s||(s=new Float32Array(4*t*n)),v=f.FLOAT;return u&&this.flushFramebuffer(),f.readPixels(c,h,t,n,f.RGBA,v,s),f.bindFramebuffer(f.FRAMEBUFFER,this._currentFramebuffer),s},p.B.prototype._readTexturePixels=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(e,t,n,i,r,a,o,s,u,l))},p.B.prototype.updateDynamicIndexBuffer=function(e,t){var n;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),n=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},p.B.prototype.updateDynamicVertexBuffer=function(e,t,n,i){this.bindArrayBuffer(e),void 0===n&&(n=0);var r=t.byteLength||t.length;void 0===i||i>=r&&0===n?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(n,n+i)):(t=t instanceof ArrayBuffer?new Uint8Array(t,n,i):new Uint8Array(t.buffer,t.byteOffset+n,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()};var I=function(e){(0,s.Z)(n,e);var t=M(n);function n(e,r,o){var s,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if((0,i.Z)(this,n),(s=t.call(this,e,r,o,l)).enableOfflineSupport=!1,s.disableManifestCheck=!1,s.disableContextMenu=!0,s.scenes=new Array,s._virtualScenes=new Array,s.onNewSceneAddedObservable=new c.y$,s.postProcesses=new Array,s.isPointerLock=!1,s.onResizeObservable=new c.y$,s.onCanvasBlurObservable=new c.y$,s.onCanvasFocusObservable=new c.y$,s.onCanvasPointerOutObservable=new c.y$,s.onBeginFrameObservable=new c.y$,s.customAnimationFrameRequester=null,s.onEndFrameObservable=new c.y$,s.onBeforeShaderCompilationObservable=new c.y$,s.onAfterShaderCompilationObservable=new c.y$,s._deterministicLockstep=!1,s._lockstepMaxSteps=4,s._timeStep=1/60,s._fps=60,s._deltaTime=0,s._drawCalls=new y.z,s.canvasTabIndex=1,s.disablePerformanceMonitorInBackground=!1,s._performanceMonitor=new g,s._compatibilityMode=!0,s.currentRenderPassId=0,s._renderPassNames=["main"],n.Instances.push((0,a.Z)(s)),!e)return(0,u.Z)(s);if(s._features.supportRenderPasses=!0,o=s._creationOptions,e.getContext){var h=e;if(s._sharedInit(h,!!o.doNotHandleTouchAction,o.audioEngine),(0,f.CG)()){var d=document;s._onFullscreenChange=function(){void 0!==d.fullscreen?s.isFullscreen=d.fullscreen:void 0!==d.mozFullScreen?s.isFullscreen=d.mozFullScreen:void 0!==d.webkitIsFullScreen?s.isFullscreen=d.webkitIsFullScreen:void 0!==d.msIsFullScreen&&(s.isFullscreen=d.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&h&&n._RequestPointerlock(h)},document.addEventListener("fullscreenchange",s._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",s._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",s._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",s._onFullscreenChange,!1),s._onPointerLockChange=function(){s.isPointerLock=d.mozPointerLockElement===h||d.webkitPointerLockElement===h||d.msPointerLockElement===h||d.pointerLockElement===h},document.addEventListener("pointerlockchange",s._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",s._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",s._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",s._onPointerLockChange,!1),!n.audioEngine&&o.audioEngine&&n.AudioEngineFactory&&(n.audioEngine=n.AudioEngineFactory(s.getRenderingCanvas(),s.getAudioContext(),s.getAudioDestination()))}s._connectVREvents(),s.enableOfflineSupport=void 0!==n.OfflineProviderFactory,s._deterministicLockstep=!!o.deterministicLockstep,s._lockstepMaxSteps=o.lockstepMaxSteps||0,s._timeStep=o.timeStep||1/60}return s._prepareVRComponent(),o.autoEnableWebVR&&s.initWebVR(),s}return(0,r.Z)(n,[{key:"_createImageBitmapFromSource",value:function(e,t){var n=this;return new Promise((function(i,r){var a=new Image;a.onload=function(){a.decode().then((function(){n.createImageBitmap(a,t).then((function(e){i(e)}))}))},a.onerror=function(){r("Error loading image ".concat(a.src))},a.src=e}))}},{key:"createImageBitmap",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return createImageBitmap(e,t)}))},{key:"resizeImageBitmap",value:function(e,t,n){var i=this.createCanvas(t,n).getContext("2d");if(!i)throw new Error("Unable to get 2d context for resizeImageBitmap");return i.drawImage(e,0,0),i.getImageData(0,0,t,n).data}},{key:"_supportsHardwareTextureRescaling",get:function(){return!!n._RescalePostProcessFactory}},{key:"performanceMonitor",get:function(){return this._performanceMonitor}},{key:"compatibilityMode",get:function(){return this._compatibilityMode},set:function(e){this._compatibilityMode=!0}},{key:"getInputElement",value:function(){return this._renderingCanvas}},{key:"_sharedInit",value:function(e,t,i){var r=this;if((0,o.Z)((0,l.Z)(n.prototype),"_sharedInit",this).call(this,e,t,i),this._onCanvasFocus=function(){r.onCanvasFocusObservable.notifyObservers(r)},this._onCanvasBlur=function(){r.onCanvasBlurObservable.notifyObservers(r)},this._onCanvasContextMenu=function(e){r.disableContextMenu&&e.preventDefault()},e.addEventListener("focus",this._onCanvasFocus),e.addEventListener("blur",this._onCanvasBlur),e.addEventListener("contextmenu",this._onCanvasContextMenu),this._onBlur=function(){r.disablePerformanceMonitorInBackground&&r._performanceMonitor.disable(),r._windowIsBackground=!0},this._onFocus=function(){r.disablePerformanceMonitorInBackground&&r._performanceMonitor.enable(),r._windowIsBackground=!1},this._onCanvasPointerOut=function(t){document.elementFromPoint(t.clientX,t.clientY)!==e&&r.onCanvasPointerOutObservable.notifyObservers(t)},(0,f.CG)()){var a=this.getHostWindow();a&&(a.addEventListener("blur",this._onBlur),a.addEventListener("focus",this._onFocus))}e.addEventListener("pointerout",this._onCanvasPointerOut),t||this._disableTouchAction(),!n.audioEngine&&i&&n.AudioEngineFactory&&(n.audioEngine=n.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination()))}},{key:"getAspectRatio",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.viewport;return this.getRenderWidth(t)*n.width/(this.getRenderHeight(t)*n.height)}},{key:"getScreenAspectRatio",value:function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)}},{key:"getRenderingCanvasClientRect",value:function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null}},{key:"getInputElementClientRect",value:function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null}},{key:"isDeterministicLockStep",value:function(){return this._deterministicLockstep}},{key:"getLockstepMaxSteps",value:function(){return this._lockstepMaxSteps}},{key:"getTimeStep",value:function(){return 1e3*this._timeStep}},{key:"generateMipMapsForCubemap",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.generateMipMaps){var n=this._gl;this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,e,!0),n.generateMipmap(n.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null)}}},{key:"getDepthWrite",value:function(){return this._depthCullingState.depthMask}},{key:"setDepthWrite",value:function(e){this._depthCullingState.depthMask=e}},{key:"getStencilBuffer",value:function(){return this._stencilState.stencilTest}},{key:"setStencilBuffer",value:function(e){this._stencilState.stencilTest=e}},{key:"getStencilMask",value:function(){return this._stencilState.stencilMask}},{key:"setStencilMask",value:function(e){this._stencilState.stencilMask=e}},{key:"getStencilFunction",value:function(){return this._stencilState.stencilFunc}},{key:"getStencilFunctionReference",value:function(){return this._stencilState.stencilFuncRef}},{key:"getStencilFunctionMask",value:function(){return this._stencilState.stencilFuncMask}},{key:"setStencilFunction",value:function(e){this._stencilState.stencilFunc=e}},{key:"setStencilFunctionReference",value:function(e){this._stencilState.stencilFuncRef=e}},{key:"setStencilFunctionMask",value:function(e){this._stencilState.stencilFuncMask=e}},{key:"getStencilOperationFail",value:function(){return this._stencilState.stencilOpStencilFail}},{key:"getStencilOperationDepthFail",value:function(){return this._stencilState.stencilOpDepthFail}},{key:"getStencilOperationPass",value:function(){return this._stencilState.stencilOpStencilDepthPass}},{key:"setStencilOperationFail",value:function(e){this._stencilState.stencilOpStencilFail=e}},{key:"setStencilOperationDepthFail",value:function(e){this._stencilState.stencilOpDepthFail=e}},{key:"setStencilOperationPass",value:function(e){this._stencilState.stencilOpStencilDepthPass=e}},{key:"setDitheringState",value:function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}},{key:"setRasterizerState",value:function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}},{key:"getDepthFunction",value:function(){return this._depthCullingState.depthFunc}},{key:"setDepthFunction",value:function(e){this._depthCullingState.depthFunc=e}},{key:"setDepthFunctionToGreater",value:function(){this.setDepthFunction(516)}},{key:"setDepthFunctionToGreaterOrEqual",value:function(){this.setDepthFunction(518)}},{key:"setDepthFunctionToLess",value:function(){this.setDepthFunction(513)}},{key:"setDepthFunctionToLessOrEqual",value:function(){this.setDepthFunction(515)}},{key:"cacheStencilState",value:function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()}},{key:"restoreStencilState",value:function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)}},{key:"setDirectViewport",value:function(e,t,n,i){var r=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,n,i),r}},{key:"scissorClear",value:function(e,t,n,i,r){this.enableScissor(e,t,n,i),this.clear(r,!0,!0,!0),this.disableScissor()}},{key:"enableScissor",value:function(e,t,n,i){var r=this._gl;r.enable(r.SCISSOR_TEST),r.scissor(e,t,n,i)}},{key:"disableScissor",value:function(){var e=this._gl;e.disable(e.SCISSOR_TEST)}},{key:"_reportDrawCall",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._drawCalls.addCount(e,!1)}},{key:"initWebVR",value:function(){throw(0,v.S)("WebVRCamera")}},{key:"_prepareVRComponent",value:function(){}},{key:"_connectVREvents",value:function(e,t){}},{key:"_submitVRFrame",value:function(){}},{key:"disableVR",value:function(){}},{key:"isVRPresenting",value:function(){return!1}},{key:"_requestVRFrame",value:function(){}},{key:"_loadFileAsync",value:function(e,t,n){var i=this;return new Promise((function(r,a){i._loadFile(e,(function(e){r(e)}),void 0,t,n,(function(e,t){a(t)}))}))}},{key:"getVertexShaderSource",value:function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null}},{key:"getFragmentShaderSource",value:function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null}},{key:"setDepthStencilTexture",value:function(e,t,n,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),n&&n.depthStencilTexture?this._setTexture(e,n,!1,!0,i):this._setTexture(e,null,void 0,void 0,i))}},{key:"setTextureFromPostProcess",value:function(e,t,n){var i,r,a=null;t&&(t._textures.data[t._currentRenderTextureInd]?a=t._textures.data[t._currentRenderTextureInd]:t._forcedOutputTexture&&(a=t._forcedOutputTexture)),this._bindTexture(e,null!==(i=null===(r=a)||void 0===r?void 0:r.texture)&&void 0!==i?i:null,n)}},{key:"setTextureFromPostProcessOutput",value:function(e,t,n){var i,r;this._bindTexture(e,null!==(i=null==t||null===(r=t._outputTexture)||void 0===r?void 0:r.texture)&&void 0!==i?i:null,n)}},{key:"_rebuildBuffers",value:function(){var e,t=b(this.scenes);try{for(t.s();!(e=t.n()).done;){var i=e.value;i.resetCachedMaterial(),i._rebuildGeometries(),i._rebuildTextures()}}catch(u){t.e(u)}finally{t.f()}var r,a=b(this._virtualScenes);try{for(a.s();!(r=a.n()).done;){var s=r.value;s.resetCachedMaterial(),s._rebuildGeometries(),s._rebuildTextures()}}catch(u){a.e(u)}finally{a.f()}(0,o.Z)((0,l.Z)(n.prototype),"_rebuildBuffers",this).call(this)}},{key:"_renderFrame",value:function(){for(var e=0;e<this._activeRenderLoops.length;e++){(0,this._activeRenderLoops[e])()}}},{key:"_renderLoop",value:function(){if(!this._contextWasLost){var e=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1}},{key:"_renderViews",value:function(){return!1}},{key:"switchFullscreen",value:function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)}},{key:"enterFullscreen",value:function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&n._RequestFullscreen(this._renderingCanvas))}},{key:"exitFullscreen",value:function(){this.isFullscreen&&n._ExitFullscreen()}},{key:"enterPointerlock",value:function(){this._renderingCanvas&&n._RequestPointerlock(this._renderingCanvas)}},{key:"exitPointerlock",value:function(){n._ExitPointerlock()}},{key:"beginFrame",value:function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),(0,o.Z)((0,l.Z)(n.prototype),"beginFrame",this).call(this)}},{key:"endFrame",value:function(){(0,o.Z)((0,l.Z)(n.prototype),"endFrame",this).call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isVRPresenting()||(0,o.Z)((0,l.Z)(n.prototype),"resize",this).call(this,e)}},{key:"setSize",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(!(0,o.Z)((0,l.Z)(n.prototype),"setSize",this).call(this,e,t,i))return!1;if(this.scenes){for(var r=0;r<this.scenes.length;r++)for(var a=this.scenes[r],s=0;s<a.cameras.length;s++){var u=a.cameras[s];u._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}},{key:"_deletePipelineContext",value:function(e){var t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),(0,o.Z)((0,l.Z)(n.prototype),"_deletePipelineContext",this).call(this,e)}},{key:"createShaderProgram",value:function(e,t,i,r,a){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;a=a||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var u=(0,o.Z)((0,l.Z)(n.prototype),"createShaderProgram",this).call(this,e,t,i,r,a,s);return this.onAfterShaderCompilationObservable.notifyObservers(this),u}},{key:"_createShaderProgram",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=i.createProgram();if(e.program=a,!a)throw new Error("Unable to create program");if(i.attachShader(a,t),i.attachShader(a,n),this.webGLVersion>1&&r){var o=this.createTransformFeedback();this.bindTransformFeedback(o),this.setTranformFeedbackVaryings(a,r),e.transformFeedback=o}return i.linkProgram(a),this.webGLVersion>1&&r&&this.bindTransformFeedback(null),e.context=i,e.vertexShader=t,e.fragmentShader=n,e.isParallelCompiled||this._finalizePipelineContext(e),a}},{key:"_releaseTexture",value:function(e){(0,o.Z)((0,l.Z)(n.prototype),"_releaseTexture",this).call(this,e)}},{key:"_releaseRenderTargetWrapper",value:function(e){(0,o.Z)((0,l.Z)(n.prototype),"_releaseRenderTargetWrapper",this).call(this,e),this.scenes.forEach((function(t){t.postProcesses.forEach((function(t){t._outputTexture===e&&(t._outputTexture=null)})),t.cameras.forEach((function(t){t._postProcesses.forEach((function(t){t&&t._outputTexture===e&&(t._outputTexture=null)}))}))}))}},{key:"getRenderPassNames",value:function(){return this._renderPassNames}},{key:"getCurrentRenderPassName",value:function(){return this._renderPassNames[this.currentRenderPassId]}},{key:"createRenderPassId",value:function(e){var t=++n._RenderPassIdCounter;return this._renderPassNames[t]=null!=e?e:"NONAME",t}},{key:"releaseRenderPassId",value:function(e){this._renderPassNames[e]=void 0;for(var t=0;t<this.scenes.length;++t)for(var n=this.scenes[t],i=0;i<n.meshes.length;++i){var r=n.meshes[i];if(r.subMeshes)for(var a=0;a<r.subMeshes.length;++a){r.subMeshes[a]._removeDrawWrapper(e)}}}},{key:"_rescaleTexture",value:function(e,t,i,r,a){var o=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var s=this.createRenderTargetTexture({width:t.width,height:t.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&n._RescalePostProcessFactory&&(this._rescalePostProcess=n._RescalePostProcessFactory(this)),this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled((function(){o._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};var n=i;n||(n=o.scenes[o.scenes.length-1]),n.postProcessManager.directRender([o._rescalePostProcess],s,!0),o._bindTextureDirectly(o._gl.TEXTURE_2D,t,!0),o._gl.copyTexImage2D(o._gl.TEXTURE_2D,0,r,0,0,t.width,t.height,0),o.unBindFramebuffer(s),s.dispose(),a&&a()}))}},{key:"getFps",value:function(){return this._fps}},{key:"getDeltaTime",value:function(){return this._deltaTime}},{key:"_measureFps",value:function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}},{key:"wrapWebGLTexture",value:function(e){var t=new S.B(e,this._gl),n=new h.l(this,h.S.Unknown,!0);return n._hardwareTexture=t,n.isReady=!0,n}},{key:"_uploadImageToTexture",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=this._gl,a=this._getWebGLTextureType(e.type),o=this._getInternalFormat(e.format),s=this._getRGBABufferInternalSizedFormat(e.type,o),u=e.isCube?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D;this._bindTextureDirectly(u,e,!0),this._unpackFlipY(e.invertY);var l=r.TEXTURE_2D;e.isCube&&(l=r.TEXTURE_CUBE_MAP_POSITIVE_X+n),r.texImage2D(l,i,s,o,a,t),this._bindTextureDirectly(u,null,!0)}},{key:"updateTextureComparisonFunction",value:function(e,t){if(1!==this.webGLVersion){var n=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,t),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}else E.Y.Error("WebGL 1 does not support texture comparison.")}},{key:"createInstancesBuffer",value:function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var n=new A.M(t);return n.capacity=e,this.bindArrayBuffer(n),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),n.references=1,n}},{key:"deleteInstancesBuffer",value:function(e){this._gl.deleteBuffer(e)}},{key:"_clientWaitAsync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=this._gl;return new Promise((function(r,a){!function o(){var s=i.clientWaitSync(e,t,0);s!=i.WAIT_FAILED?s!=i.TIMEOUT_EXPIRED?r():setTimeout(o,n):a()}()}))}},{key:"_readPixelsAsync",value:function(e,t,n,i,r,a,o){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var s=this._gl,u=s.createBuffer();s.bindBuffer(s.PIXEL_PACK_BUFFER,u),s.bufferData(s.PIXEL_PACK_BUFFER,o.byteLength,s.STREAM_READ),s.readPixels(e,t,n,i,r,a,0),s.bindBuffer(s.PIXEL_PACK_BUFFER,null);var l=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);return l?(s.flush(),this._clientWaitAsync(l,0,10).then((function(){return s.deleteSync(l),s.bindBuffer(s.PIXEL_PACK_BUFFER,u),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,o),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),s.deleteBuffer(u),o}))):null}},{key:"dispose",value:function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();1===n.Instances.length&&n.audioEngine&&(n.audioEngine.dispose(),n.audioEngine=null),this.disableVR(),(0,f.CG)()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._renderingCanvas.removeEventListener("contextmenu",this._onCanvasContextMenu)),(0,f.n5)()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),(0,o.Z)((0,l.Z)(n.prototype),"dispose",this).call(this);var e=n.Instances.indexOf(this);e>=0&&n.Instances.splice(e,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}},{key:"_disableTouchAction",value:function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none",this._renderingCanvas.style.webkitTapHighlightColor="transparent")}},{key:"displayLoadingUI",value:function(){if((0,f.CG)()){var e=this.loadingScreen;e&&e.displayLoadingUI()}}},{key:"hideLoadingUI",value:function(){if((0,f.CG)()){var e=this._loadingScreen;e&&e.hideLoadingUI()}}},{key:"loadingScreen",get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=n.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e}},{key:"loadingUIText",set:function(e){this.loadingScreen.loadingUIText=e}},{key:"loadingUIBackgroundColor",set:function(e){this.loadingScreen.loadingUIBackgroundColor=e}},{key:"createVideoElement",value:function(e){return document.createElement("video")}},{key:"getFontOffset",value:function(e){var t=document.createElement("span");t.innerHTML="Hg",t.setAttribute("style","font: ".concat(e," !important"));var n=document.createElement("div");n.style.display="inline-block",n.style.width="1px",n.style.height="0px",n.style.verticalAlign="bottom";var i=document.createElement("div");i.style.whiteSpace="nowrap",i.appendChild(t),i.appendChild(n),document.body.appendChild(i);var r=0,a=0;try{a=n.getBoundingClientRect().top-t.getBoundingClientRect().top,n.style.verticalAlign="baseline",r=n.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(i)}return{ascent:r,height:a,descent:a-r}}}],[{key:"NpmPackage",get:function(){return p.B.NpmPackage}},{key:"Version",get:function(){return p.B.Version}},{key:"Instances",get:function(){return d.l.Instances}},{key:"LastCreatedEngine",get:function(){return d.l.LastCreatedEngine}},{key:"LastCreatedScene",get:function(){return d.l.LastCreatedScene}},{key:"MarkAllMaterialsAsDirty",value:function(e,t){for(var i=0;i<n.Instances.length;i++)for(var r=n.Instances[i],a=0;a<r.scenes.length;a++)r.scenes[a].markAllMaterialsAsDirty(e,t)}},{key:"DefaultLoadingScreenFactory",value:function(e){throw(0,v.S)("LoadingScreen")}},{key:"_RequestPointerlock",value:function(e){e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&(e.requestPointerLock(),e.focus())}},{key:"_ExitPointerlock",value:function(){var e=document;document.exitPointerLock=document.exitPointerLock||e.msExitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()}},{key:"_RequestFullscreen",value:function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)}},{key:"_ExitFullscreen",value:function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()}}]),n}(p.B);I.ALPHA_DISABLE=0,I.ALPHA_ADD=1,I.ALPHA_COMBINE=2,I.ALPHA_SUBTRACT=3,I.ALPHA_MULTIPLY=4,I.ALPHA_MAXIMIZED=5,I.ALPHA_ONEONE=6,I.ALPHA_PREMULTIPLIED=7,I.ALPHA_PREMULTIPLIED_PORTERDUFF=8,I.ALPHA_INTERPOLATE=9,I.ALPHA_SCREENMODE=10,I.DELAYLOADSTATE_NONE=0,I.DELAYLOADSTATE_LOADED=1,I.DELAYLOADSTATE_LOADING=2,I.DELAYLOADSTATE_NOTLOADED=4,I.NEVER=512,I.ALWAYS=519,I.LESS=513,I.EQUAL=514,I.LEQUAL=515,I.GREATER=516,I.GEQUAL=518,I.NOTEQUAL=517,I.KEEP=7680,I.REPLACE=7681,I.INCR=7682,I.DECR=7683,I.INVERT=5386,I.INCR_WRAP=34055,I.DECR_WRAP=34056,I.TEXTURE_CLAMP_ADDRESSMODE=0,I.TEXTURE_WRAP_ADDRESSMODE=1,I.TEXTURE_MIRROR_ADDRESSMODE=2,I.TEXTUREFORMAT_ALPHA=0,I.TEXTUREFORMAT_LUMINANCE=1,I.TEXTUREFORMAT_LUMINANCE_ALPHA=2,I.TEXTUREFORMAT_RGB=4,I.TEXTUREFORMAT_RGBA=5,I.TEXTUREFORMAT_RED=6,I.TEXTUREFORMAT_R=6,I.TEXTUREFORMAT_RG=7,I.TEXTUREFORMAT_RED_INTEGER=8,I.TEXTUREFORMAT_R_INTEGER=8,I.TEXTUREFORMAT_RG_INTEGER=9,I.TEXTUREFORMAT_RGB_INTEGER=10,I.TEXTUREFORMAT_RGBA_INTEGER=11,I.TEXTURETYPE_UNSIGNED_BYTE=0,I.TEXTURETYPE_UNSIGNED_INT=0,I.TEXTURETYPE_FLOAT=1,I.TEXTURETYPE_HALF_FLOAT=2,I.TEXTURETYPE_BYTE=3,I.TEXTURETYPE_SHORT=4,I.TEXTURETYPE_UNSIGNED_SHORT=5,I.TEXTURETYPE_INT=6,I.TEXTURETYPE_UNSIGNED_INTEGER=7,I.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,I.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,I.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,I.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,I.TEXTURETYPE_UNSIGNED_INT_24_8=12,I.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,I.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,I.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,I.TEXTURE_NEAREST_SAMPLINGMODE=1,I.TEXTURE_BILINEAR_SAMPLINGMODE=2,I.TEXTURE_TRILINEAR_SAMPLINGMODE=3,I.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,I.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,I.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,I.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,I.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,I.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,I.TEXTURE_NEAREST_LINEAR=7,I.TEXTURE_NEAREST_NEAREST=1,I.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,I.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,I.TEXTURE_LINEAR_LINEAR=2,I.TEXTURE_LINEAR_NEAREST=12,I.TEXTURE_EXPLICIT_MODE=0,I.TEXTURE_SPHERICAL_MODE=1,I.TEXTURE_PLANAR_MODE=2,I.TEXTURE_CUBIC_MODE=3,I.TEXTURE_PROJECTION_MODE=4,I.TEXTURE_SKYBOX_MODE=5,I.TEXTURE_INVCUBIC_MODE=6,I.TEXTURE_EQUIRECTANGULAR_MODE=7,I.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,I.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,I.SCALEMODE_FLOOR=1,I.SCALEMODE_NEAREST=2,I.SCALEMODE_CEILING=3,I._RescalePostProcessFactory=null,I._RenderPassIdCounter=0},4198:function(e,t,n){"use strict";n.d(t,{l:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"LastCreatedEngine",get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}},{key:"LastCreatedScene",get:function(){return this._LastCreatedScene}}]),e}();a.Instances=new Array,a._LastCreatedScene=null,a.UseFallbackTexture=!0,a.FallbackTexture=""},6196:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"SetMatrixPrecision",value:function(t){if(e.MatrixTrackPrecisionChange=!1,t&&!e.MatrixUse64Bits&&e.MatrixTrackedMatrices)for(var n=0;n<e.MatrixTrackedMatrices.length;++n){var i=e.MatrixTrackedMatrices[n],r=i._m;i._m=new Array(16);for(var a=0;a<16;++a)i._m[a]=r[a]}e.MatrixUse64Bits=t,e.MatrixCurrentType=e.MatrixUse64Bits?Array:Float32Array,e.MatrixTrackedMatrices=null}}]),e}();a.MatrixUse64Bits=!1,a.MatrixTrackPrecisionChange=!0,a.MatrixCurrentType=Float32Array,a.MatrixTrackedMatrices=[]},8084:function(e,t,n){"use strict";n.d(t,{v:function(){return o}});var i=n(5671),r=n(3144),a=n(2223),o=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"GetShadersRepository",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.x.GLSL;return t===a.x.GLSL?e.ShadersRepository:e.ShadersRepositoryWGSL}},{key:"GetShadersStore",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.x.GLSL;return t===a.x.GLSL?e.ShadersStore:e.ShadersStoreWGSL}},{key:"GetIncludesShadersStore",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.x.GLSL;return t===a.x.GLSL?e.IncludesShadersStore:e.IncludesShadersStoreWGSL}}]),e}();o.ShadersRepository="src/Shaders/",o.ShadersStore={},o.IncludesShadersStore={},o.ShadersRepositoryWGSL="src/ShadersWGSL/",o.ShadersStoreWGSL={},o.IncludesShadersStoreWGSL={}},1187:function(e,t,n){"use strict";n.d(t,{G:function(){return o}});var i,r=n(3144),a=n(5671);!function(e){e[e.PointerMove=0]="PointerMove",e[e.PointerDown=1]="PointerDown",e[e.PointerUp=2]="PointerUp"}(i||(i={}));var o=(0,r.Z)((function e(){(0,a.Z)(this,e)}));o.DOM_DELTA_PIXEL=0,o.DOM_DELTA_LINE=1,o.DOM_DELTA_PAGE=2},3531:function(e,t,n){"use strict";n.d(t,{NG:function(){return c},OG:function(){return l},WZ:function(){return h}});var i=n(136),r=n(6215),a=n(1120),o=n(3144),s=n(5671);function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,a.Z)(e);if(t){var o=(0,a.Z)(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return(0,r.Z)(this,n)}}var l=(0,o.Z)((function e(){(0,s.Z)(this,e)}));l.KEYDOWN=1,l.KEYUP=2;var c=(0,o.Z)((function e(t,n){(0,s.Z)(this,e),this.type=t,this.event=n})),h=function(e){(0,i.Z)(n,e);var t=u(n);function n(e,i){var r;return(0,s.Z)(this,n),(r=t.call(this,e,i)).type=e,r.event=i,r.skipOnKeyboardObservable=!1,r}return(0,o.Z)(n,[{key:"skipOnPointerObservable",get:function(){return this.skipOnKeyboardObservable},set:function(e){this.skipOnKeyboardObservable=e}}]),n}(c)},3365:function(e,t,n){"use strict";n.d(t,{FV:function(){return f},R5:function(){return d},kD:function(){return c}});var i=n(136),r=n(6215),a=n(1120),o=n(3144),s=n(5671),u=n(6900);function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,a.Z)(e);if(t){var o=(0,a.Z)(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return(0,r.Z)(this,n)}}var c=(0,o.Z)((function e(){(0,s.Z)(this,e)}));c.POINTERDOWN=1,c.POINTERUP=2,c.POINTERMOVE=4,c.POINTERWHEEL=8,c.POINTERPICK=16,c.POINTERTAP=32,c.POINTERDOUBLETAP=64;var h=(0,o.Z)((function e(t,n){(0,s.Z)(this,e),this.type=t,this.event=n})),f=function(e){(0,i.Z)(n,e);var t=l(n);function n(e,i,r,a){var o;return(0,s.Z)(this,n),(o=t.call(this,e,i)).ray=null,o.originalPickingInfo=null,o.skipOnPointerObservable=!1,o.localPosition=new u.FM(r,a),o}return(0,o.Z)(n)}(h),d=function(e){(0,i.Z)(n,e);var t=l(n);function n(e,i,r){var a;return(0,s.Z)(this,n),(a=t.call(this,e,i)).pickInfo=r,a}return(0,o.Z)(n)}(h)},8983:function(e,t,n){"use strict";n.d(t,{$:function(){return U}});var i=n(5671),r=n(3144),a=n(3365),o=function(){function e(){(0,i.Z)(this,e),this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return(0,r.Z)(e,null,[{key:"HasTriggers",get:function(){for(var t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t))return!0;return!1}},{key:"HasPickTriggers",get:function(){for(var t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t)){var n=parseInt(t);if(n>=1&&n<=7)return!0}return!1}},{key:"HasSpecificTrigger",value:function(t){for(var n in e.Triggers){if(Object.prototype.hasOwnProperty.call(e.Triggers,n))if(parseInt(n)===t)return!0}return!1}}]),e}();o.Triggers={};var s,u,l,c,h,f,d,v=n(3541),p=n(6900),_=n(8483),g=n(3531);!function(e){e[e.Generic=0]="Generic",e[e.Keyboard=1]="Keyboard",e[e.Mouse=2]="Mouse",e[e.Touch=3]="Touch",e[e.DualShock=4]="DualShock",e[e.Xbox=5]="Xbox",e[e.Switch=6]="Switch",e[e.DualSense=7]="DualSense"}(s||(s={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.Move=12]="Move"}(u||(u={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.DeltaHorizontal=10]="DeltaHorizontal",e[e.DeltaVertical=11]="DeltaVertical"}(l||(l={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(c||(c={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Create=8]="Create",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(h||(h={})),function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.LT=6]="LT",e[e.RT=7]="RT",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.LStickXAxis=17]="LStickXAxis",e[e.LStickYAxis=18]="LStickYAxis",e[e.RStickXAxis=19]="RStickXAxis",e[e.RStickYAxis=20]="RStickYAxis"}(f||(f={})),function(e){e[e.B=0]="B",e[e.A=1]="A",e[e.Y=2]="Y",e[e.X=3]="X",e[e.L=4]="L",e[e.R=5]="R",e[e.ZL=6]="ZL",e[e.ZR=7]="ZR",e[e.Minus=8]="Minus",e[e.Plus=9]="Plus",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.Capture=17]="Capture",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(d||(d={}));var m=n(4174),y=n(1187),A=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"CreateDeviceEvent",value:function(e,t,n,i,r,a){switch(e){case s.Keyboard:return this._CreateKeyboardEvent(n,i,r,a);case s.Mouse:if(n===u.MouseWheelX||n===u.MouseWheelY||n===u.MouseWheelZ)return this._CreateWheelEvent(e,t,n,i,r,a);case s.Touch:return this._CreatePointerEvent(e,t,n,i,r,a);default:throw"Unable to generate event for device ".concat(s[e])}}},{key:"_CreatePointerEvent",value:function(e,t,n,i,r,a){var o=this._CreateMouseEvent(e,t,n,i,r,a);return e===s.Mouse?(o.deviceType=s.Mouse,o.pointerId=1,o.pointerType="mouse"):(o.deviceType=s.Touch,o.pointerId=t,o.pointerType="touch"),n===u.Move?o.type="pointermove":n>=u.LeftClick&&n<=u.RightClick&&(o.type=1===i?"pointerdown":"pointerup",o.button=n-2),o}},{key:"_CreateWheelEvent",value:function(e,t,n,i,r,a){var o=this._CreateMouseEvent(e,t,n,i,r,a);switch(o.type="wheel",o.deltaMode=y.G.DOM_DELTA_PIXEL,o.deltaX=0,o.deltaY=0,o.deltaZ=0,n){case u.MouseWheelX:o.deltaX=i;break;case u.MouseWheelY:o.deltaY=i;break;case u.MouseWheelZ:o.deltaZ=i}return o}},{key:"_CreateMouseEvent",value:function(e,t,n,i,r,a){var o=this._CreateEvent(a),s=r.pollInput(e,t,u.Horizontal),c=r.pollInput(e,t,u.Vertical);return a?(o.movementX=0,o.movementY=0,o.offsetX=o.movementX-a.getBoundingClientRect().x,o.offsetY=o.movementY-a.getBoundingClientRect().y):(o.movementX=r.pollInput(e,t,l.DeltaHorizontal),o.movementY=r.pollInput(e,t,l.DeltaVertical),o.offsetX=0,o.offsetY=0),this._CheckNonCharacterKeys(o,r),o.clientX=s,o.clientY=c,o.x=s,o.y=c,o.deviceType=e,o.deviceSlot=t,o.inputIndex=n,o}},{key:"_CreateKeyboardEvent",value:function(e,t,n,i){var r=this._CreateEvent(i);return this._CheckNonCharacterKeys(r,n),r.deviceType=s.Keyboard,r.deviceSlot=0,r.inputIndex=e,r.type=1===t?"keydown":"keyup",r.key=String.fromCharCode(e),r.keyCode=e,r}},{key:"_CheckNonCharacterKeys",value:function(e,t){var n=t.isDeviceAvailable(s.Keyboard),i=n&&1===t.pollInput(s.Keyboard,0,18),r=n&&1===t.pollInput(s.Keyboard,0,17),a=n&&(1===t.pollInput(s.Keyboard,0,91)||1===t.pollInput(s.Keyboard,0,92)||1===t.pollInput(s.Keyboard,0,93)),o=n&&1===t.pollInput(s.Keyboard,0,16);e.altKey=i,e.ctrlKey=r,e.metaKey=a,e.shiftKey=o}},{key:"_CreateEvent",value:function(e){var t={preventDefault:function(){}};return t.target=e,t}}]),e}(),E=function(){function e(t,n,r){var a=this;(0,i.Z)(this,e),this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(t,n,(function(e,t,n,i){var o=A.CreateDeviceEvent(e,t,n,i,a);r(e,t,o)})):this._createDummyNativeInput()}return(0,r.Z)(e,[{key:"pollInput",value:function(e,t,n){return this._nativeInput.pollInput(e,t,n)}},{key:"isDeviceAvailable",value:function(e){return e===s.Mouse||e===s.Touch}},{key:"dispose",value:function(){this._nativeInput.dispose()}},{key:"_createDummyNativeInput",value:function(){return{pollInput:function(){return 0},isDeviceAvailable:function(){return!1},dispose:function(){}}}}]),e}(),S=n(5092),T=n(8517);function b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var M=Object.keys(u).length/2,I=function(){function e(t,n,r,a){var o=this;(0,i.Z)(this,e),this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=T.w1.IsSafari(),this._usingMacOS=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=function(e){},this._keyboardUpEvent=function(e){},this._keyboardBlurEvent=function(e){},this._pointerMoveEvent=function(e){},this._pointerDownEvent=function(e){},this._pointerUpEvent=function(e){},this._pointerCancelEvent=function(e){},this._pointerWheelEvent=function(e){},this._pointerBlurEvent=function(e){},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=S.MZ.IsNavigatorAvailable()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=function(e){},this._gamepadDisconnectedEvent=function(e){},this._eventPrefix=T.w1.GetPointerPrefix(t),this._engine=t,this._onDeviceConnected=n,this._onDeviceDisconnected=r,this._onInputChanged=a,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=function(){o._enableEvents()})}return(0,r.Z)(e,[{key:"pollInput",value:function(e,t,n){var i=this._inputs[e][t];if(!i)throw"Unable to find device ".concat(s[e]);e>=s.DualShock&&e<=s.DualSense&&this._updateDevice(e,t,n);var r=i[n];if(void 0===r)throw"Unable to find input ".concat(n," for device ").concat(s[e]," in slot ").concat(t);return n===u.Move&&T.w1.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),r}},{key:"isDeviceAvailable",value:function(e){return void 0!==this._inputs[e]}},{key:"dispose",value:function(){this._onDeviceConnected=function(){},this._onDeviceDisconnected=function(){},this._onInputChanged=function(){},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}},{key:"_enableEvents",value:function(){var e=null==this?void 0:this._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs){var t,n=b(this._inputs);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i)for(var r in i){var a=i[+r];if(a)for(var o=0;o<a.length;o++)a[o]=0}}}catch(s){n.e(s)}finally{n.f()}}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}},{key:"_disableEvents",value:function(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}},{key:"_checkForConnectedDevices",value:function(){if(navigator.getGamepads){var e,t=b(navigator.getGamepads());try{for(t.s();!(e=t.n()).done;){var n=e.value;n&&this._addGamePad(n)}}catch(i){t.e(i)}finally{t.f()}}"function"==typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(s.Mouse,0,0,0)}},{key:"_addGamePad",value:function(e){var t=this._getGamepadDeviceType(e.id),n=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,n,e.buttons.length+e.axes.length),this._gamepads[n]=t}},{key:"_addPointerDevice",value:function(e,t,n,i){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,M);var r=this._inputs[e][t];r[0]=n,r[1]=i}},{key:"_registerDevice",value:function(e,t,n){if(void 0===t)throw"Unable to register device ".concat(s[e]," to undefined slot.");if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){var i=new Array(n);i.fill(0),this._inputs[e][t]=i,this._onDeviceConnected(e,t)}}},{key:"_unregisterDevice",value:function(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))}},{key:"_handleKeyActions",value:function(){var e=this;this._keyboardDownEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(s.Keyboard,0,255));var n=e._inputs[s.Keyboard][0];if(n){n[t.keyCode]=1;var i=t;i.inputIndex=t.keyCode,e._usingMacOS&&t.metaKey&&"Meta"!==t.key&&(e._metaKeys.includes(t.keyCode)||e._metaKeys.push(t.keyCode)),e._onInputChanged(s.Keyboard,0,i)}},this._keyboardUpEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(s.Keyboard,0,255));var n=e._inputs[s.Keyboard][0];if(n){n[t.keyCode]=0;var i=t;if(i.inputIndex=t.keyCode,e._usingMacOS&&"Meta"===t.key&&e._metaKeys.length>0){var r,a=b(e._metaKeys);try{for(a.s();!(r=a.n()).done;){var o=r.value,u=A.CreateDeviceEvent(s.Keyboard,0,o,0,e,e._elementToAttachTo);n[o]=0,e._onInputChanged(s.Keyboard,0,u)}}catch(l){a.e(l)}finally{a.f()}e._metaKeys.splice(0,e._metaKeys.length)}e._onInputChanged(s.Keyboard,0,i)}},this._keyboardBlurEvent=function(){if(e._keyboardActive){for(var t=e._inputs[s.Keyboard][0],n=0;n<t.length;n++)if(0!==t[n]){t[n]=0;var i=A.CreateDeviceEvent(s.Keyboard,0,n,0,e,e._elementToAttachTo);e._onInputChanged(s.Keyboard,0,i)}e._usingMacOS&&e._metaKeys.splice(0,e._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}},{key:"_handlePointerActions",value:function(){var e=this;this._maxTouchPoints=S.MZ.IsNavigatorAvailable()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(var t=0;t<this._maxTouchPoints;t++)this._activeTouchIds[t]=-1;this._pointerMoveEvent=function(t){var n=e._getPointerType(t),i=n===s.Mouse?0:e._activeTouchIds.indexOf(t.pointerId);e._inputs[n]||(e._inputs[n]={}),e._inputs[n][i]||e._addPointerDevice(n,i,t.clientX,t.clientY);var r=e._inputs[n][i];if(r){var a=t;a.inputIndex=u.Move,void 0===t.movementX&&(t.movementX=t.mozMovementX||t.webkitMovementX||t.msMovementX||t.clientX-r[u.Horizontal]),void 0===t.movementY&&(t.movementY=t.mozMovementY||t.webkitMovementY||t.msMovementY||t.clientY-r[u.Vertical]),r[u.Horizontal]=t.clientX,r[u.Vertical]=t.clientY,e._onInputChanged(n,i,a),e._usingSafari||-1===t.button||(a.inputIndex=t.button+2,r[t.button+2]=r[t.button+2]?0:1,e._onInputChanged(n,i,a))}},this._pointerDownEvent=function(t){var n=e._getPointerType(t),i=n===s.Mouse?0:t.pointerId;if(n===s.Touch){var r=e._activeTouchIds.indexOf(-1);if(!(r>=0))return void T.w1.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(e._maxTouchPoints));i=r,e._activeTouchIds[r]=t.pointerId}e._inputs[n]||(e._inputs[n]={}),e._inputs[n][i]?n===s.Touch&&e._onDeviceConnected(n,i):e._addPointerDevice(n,i,t.clientX,t.clientY);var a=e._inputs[n][i];if(a){var o=a[u.Horizontal],l=a[u.Vertical];if(n===s.Mouse){if(-1===e._mouseId&&(void 0===t.pointerId?e._mouseId=e._isUsingFirefox?0:1:e._mouseId=t.pointerId),!document.pointerLockElement)try{e._elementToAttachTo.setPointerCapture(e._mouseId)}catch(h){}}else if(t.pointerId&&!document.pointerLockElement)try{e._elementToAttachTo.setPointerCapture(t.pointerId)}catch(h){}a[u.Horizontal]=t.clientX,a[u.Vertical]=t.clientY,a[t.button+2]=1;var c=t;c.inputIndex=t.button+2,e._onInputChanged(n,i,c),o===t.clientX&&l===t.clientY||(c.inputIndex=u.Move,void 0===t.movementX&&(t.movementX=t.mozMovementX||t.webkitMovementX||t.msMovementX||t.clientX-a[u.Horizontal]),void 0===t.movementY&&(t.movementY=t.mozMovementY||t.webkitMovementY||t.msMovementY||t.clientY-a[u.Vertical]),e._onInputChanged(n,i,c))}},this._pointerUpEvent=function(t){var n,i=e._getPointerType(t),r=i===s.Mouse?0:e._activeTouchIds.indexOf(t.pointerId);if(i===s.Touch){if(-1===r)return;e._activeTouchIds[r]=-1}var a=null===(n=e._inputs[i])||void 0===n?void 0:n[r];if(a&&0!==a[t.button+2]){var o,l,c,h,f=a[u.Horizontal],d=a[u.Vertical];a[u.Horizontal]=t.clientX,a[u.Vertical]=t.clientY,a[t.button+2]=0;var v=t;f===t.clientX&&d===t.clientY||(v.inputIndex=u.Move,void 0===t.movementX&&(t.movementX=t.mozMovementX||t.webkitMovementX||t.msMovementX||t.clientX-a[u.Horizontal]),void 0===t.movementY&&(t.movementY=t.mozMovementY||t.webkitMovementY||t.msMovementY||t.clientY-a[u.Vertical]),e._onInputChanged(i,r,v)),v.inputIndex=t.button+2,i===s.Mouse&&e._mouseId>=0&&null!==(o=(l=e._elementToAttachTo).hasPointerCapture)&&void 0!==o&&o.call(l,e._mouseId)?e._elementToAttachTo.releasePointerCapture(e._mouseId):t.pointerId&&null!==(c=(h=e._elementToAttachTo).hasPointerCapture)&&void 0!==c&&c.call(h,t.pointerId)&&e._elementToAttachTo.releasePointerCapture(t.pointerId),e._onInputChanged(i,r,v),i===s.Touch&&e._onDeviceDisconnected(i,r)}},this._pointerCancelEvent=function(t){if("mouse"===t.pointerType){var n,i,r=e._inputs[s.Mouse][0];e._mouseId>=0&&null!==(n=(i=e._elementToAttachTo).hasPointerCapture)&&void 0!==n&&n.call(i,e._mouseId)&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var a=u.LeftClick;a<=u.BrowserForward;a++)if(1===r[a]){r[a]=0;var o=A.CreateDeviceEvent(s.Mouse,0,a,0,e,e._elementToAttachTo);e._onInputChanged(s.Mouse,0,o)}}else{var l,c,h=e._activeTouchIds.indexOf(t.pointerId);null!==(l=(c=e._elementToAttachTo).hasPointerCapture)&&void 0!==l&&l.call(c,t.pointerId)&&e._elementToAttachTo.releasePointerCapture(t.pointerId),e._inputs[s.Touch][h][u.LeftClick]=0;var f=A.CreateDeviceEvent(s.Touch,h,u.LeftClick,0,e,e._elementToAttachTo);e._onInputChanged(s.Touch,h,f),e._activeTouchIds[h]=-1,e._onDeviceDisconnected(s.Touch,h)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";var n=!1,i=function(){};try{var r=Object.defineProperty({},"passive",{get:function(){n=!0}});this._elementToAttachTo.addEventListener("test",i,r),this._elementToAttachTo.removeEventListener("test",i,r)}catch(a){}this._pointerBlurEvent=function(){if(e.isDeviceAvailable(s.Mouse)){var t,n,i=e._inputs[s.Mouse][0];e._mouseId>=0&&null!==(t=(n=e._elementToAttachTo).hasPointerCapture)&&void 0!==t&&t.call(n,e._mouseId)&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var r=u.LeftClick;r<=u.BrowserForward;r++)if(1===i[r]){i[r]=0;var a=A.CreateDeviceEvent(s.Mouse,0,r,0,e,e._elementToAttachTo);e._onInputChanged(s.Mouse,0,a)}}if(e.isDeviceAvailable(s.Touch))for(var o=e._inputs[s.Touch],l=0;l<e._activeTouchIds.length;l++){var c,h,f,d=e._activeTouchIds[l];if(null!==(c=(h=e._elementToAttachTo).hasPointerCapture)&&void 0!==c&&c.call(h,d)&&e._elementToAttachTo.releasePointerCapture(d),-1!==d&&1===(null===(f=o[l])||void 0===f?void 0:f[u.LeftClick])){o[l][u.LeftClick]=0;var v=A.CreateDeviceEvent(s.Touch,l,u.LeftClick,0,e,e._elementToAttachTo);e._onInputChanged(s.Touch,l,v),e._activeTouchIds[l]=-1,e._onDeviceDisconnected(s.Touch,l)}}},this._pointerWheelEvent=function(t){var n=s.Mouse;e._inputs[n]||(e._inputs[n]=[]),e._inputs[n][0]||(e._pointerActive=!0,e._registerDevice(n,0,M));var i=e._inputs[n][0];if(i){i[u.MouseWheelX]=t.deltaX||0,i[u.MouseWheelY]=t.deltaY||t.wheelDelta||0,i[u.MouseWheelZ]=t.deltaZ||0;var r=t;0!==i[u.MouseWheelX]&&(r.inputIndex=u.MouseWheelX,e._onInputChanged(n,0,r)),0!==i[u.MouseWheelY]&&(r.inputIndex=u.MouseWheelY,e._onInputChanged(n,0,r)),0!==i[u.MouseWheelZ]&&(r.inputIndex=u.MouseWheelZ,e._onInputChanged(n,0,r))}},this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!n&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((function(){if(e.isDeviceAvailable(s.Mouse)){var t=e._inputs[s.Mouse][0];t[u.MouseWheelX]=0,t[u.MouseWheelY]=0,t[u.MouseWheelZ]=0}}))}},{key:"_handleGamepadActions",value:function(){var e=this;this._gamepadConnectedEvent=function(t){e._addGamePad(t.gamepad)},this._gamepadDisconnectedEvent=function(t){if(e._gamepads){var n=e._getGamepadDeviceType(t.gamepad.id),i=t.gamepad.index;e._unregisterDevice(n,i),delete e._gamepads[i]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}},{key:"_updateDevice",value:function(e,t,n){var i=navigator.getGamepads()[t];if(i&&e===this._gamepads[t]){var r=this._inputs[e][t];n>=i.buttons.length?r[n]=i.axes[n-i.buttons.length].valueOf():r[n]=i.buttons[n].value}}},{key:"_getGamepadDeviceType",value:function(e){return-1!==e.indexOf("054c")?-1!==e.indexOf("0ce6")?s.DualSense:s.DualShock:-1!==e.indexOf("Xbox One")||-1!==e.search("Xbox 360")||-1!==e.search("xinput")?s.Xbox:-1!==e.indexOf("057e")?s.Switch:s.Generic}},{key:"_getPointerType",value:function(e){var t=s.Mouse;return("touch"===e.pointerType||"pen"===e.pointerType||e.touches)&&(t=s.Touch),t}}]),e}(),C=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,i.Z)(this,e),this.deviceType=n,this.deviceSlot=r,this.onInputChangedObservable=new m.y$,this._deviceInputSystem=t}return(0,r.Z)(e,[{key:"getInput",value:function(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)}}]),e}();function x(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var D=function(){function e(t){var n=this;(0,i.Z)(this,e),this._registeredManagers=new Array,this._refCount=0,this.registerManager=function(e){for(var t=0;t<n._devices.length;t++){var i=n._devices[t];for(var r in i){var a=+r;e._addDevice(new C(n._deviceInputSystem,t,a))}}n._registeredManagers.push(e)},this.unregisterManager=function(e){var t=n._registeredManagers.indexOf(e);t>-1&&n._registeredManagers.splice(t,1)};var r=Object.keys(s).length/2;this._devices=new Array(r);var a=function(e,t){n._devices[e]||(n._devices[e]=new Array),n._devices[e][t]||(n._devices[e][t]=t);var i,r=x(n._registeredManagers);try{for(r.s();!(i=r.n()).done;){var a=i.value,o=new C(n._deviceInputSystem,e,t);a._addDevice(o)}}catch(s){r.e(s)}finally{r.f()}},o=function(e,t){var i;null!==(i=n._devices[e])&&void 0!==i&&i[t]&&delete n._devices[e][t];var r,a=x(n._registeredManagers);try{for(a.s();!(r=a.n()).done;){r.value._removeDevice(e,t)}}catch(o){a.e(o)}finally{a.f()}},u=function(e,t,i){if(i){var r,a=x(n._registeredManagers);try{for(a.s();!(r=a.n()).done;){r.value._onInputChanged(e,t,i)}}catch(o){a.e(o)}finally{a.f()}}};"undefined"!=typeof _native?this._deviceInputSystem=new E(a,o,u):this._deviceInputSystem=new I(t,a,o,u)}return(0,r.Z)(e,[{key:"dispose",value:function(){this._deviceInputSystem.dispose()}}]),e}();function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var L=function(){function e(t){var n=this;(0,i.Z)(this,e);var r=Object.keys(s).length/2;this._devices=new Array(r),this._firstDevice=new Array(r),this._engine=t,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new D(t)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new m.y$((function(e){var t,i=k(n._devices);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(r){var a,o=k(r);try{for(o.s();!(a=o.n()).done;){var s=a.value;s&&n.onDeviceConnectedObservable.notifyObserver(e,s)}}catch(u){o.e(u)}finally{o.f()}}}}catch(u){i.e(u)}finally{i.f()}})),this.onDeviceDisconnectedObservable=new m.y$,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=t.onDisposeObservable.add((function(){n.dispose()}))}return(0,r.Z)(e,[{key:"getDeviceSource",value:function(e,t){if(void 0===t){if(void 0===this._firstDevice[e])return null;t=this._firstDevice[e]}return this._devices[e]&&void 0!==this._devices[e][t]?this._devices[e][t]:null}},{key:"getDeviceSources",value:function(e){return this._devices[e]?this._devices[e].filter((function(e){return!!e})):[]}},{key:"dispose",value:function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)}},{key:"_addDevice",value:function(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)}},{key:"_removeDevice",value:function(e,t){var n,i,r=null===(n=this._devices[e])||void 0===n?void 0:n[t];this.onDeviceDisconnectedObservable.notifyObservers(r),null!==(i=this._devices[e])&&void 0!==i&&i[t]&&delete this._devices[e][t],this._updateFirstDevices(e)}},{key:"_onInputChanged",value:function(e,t,n){var i,r;null===(i=this._devices[e])||void 0===i||null===(r=i[t])||void 0===r||r.onInputChangedObservable.notifyObservers(n)}},{key:"_updateFirstDevices",value:function(e){switch(e){case s.Keyboard:case s.Mouse:this._firstDevice[e]=0;break;case s.Touch:case s.DualSense:case s.DualShock:case s.Xbox:case s.Switch:case s.Generic:delete this._firstDevice[e];var t=this._devices[e];if(t)for(var n=0;n<t.length;n++)if(t[n]){this._firstDevice[e]=n;break}}}}]),e}(),F=n(4198);function N(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var B=function(){function e(){(0,i.Z)(this,e),this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return(0,r.Z)(e,[{key:"singleClick",get:function(){return this._singleClick},set:function(e){this._singleClick=e}},{key:"doubleClick",get:function(){return this._doubleClick},set:function(e){this._doubleClick=e}},{key:"hasSwiped",get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e}},{key:"ignore",get:function(){return this._ignore},set:function(e){this._ignore=e}}]),e}(),U=function(){function e(t){(0,i.Z)(this,e),this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new p.FM(0,0),this._previousStartingPointerPosition=new p.FM(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._deviceSourceManager=null,this._scene=t||F.l.LastCreatedScene,this._scene}return(0,r.Z)(e,[{key:"meshUnderPointer",get:function(){return this._pointerOverMesh}},{key:"getMeshUnderPointerByPointerId",value:function(e){return this._meshUnderPointerId[e]||null}},{key:"unTranslatedPointer",get:function(){return new p.FM(this._unTranslatedPointerX,this._unTranslatedPointerY)}},{key:"pointerX",get:function(){return this._pointerX},set:function(e){this._pointerX=e}},{key:"pointerY",get:function(){return this._pointerY},set:function(e){this._pointerY=e}},{key:"_updatePointerPosition",value:function(e){var t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}},{key:"_processPointerMove",value:function(e,t){var n=this._scene,i=n.getEngine(),r=i.getInputElement();r&&(r.tabIndex=i.canvasTabIndex,n.doNotHandleCursors||(r.style.cursor=n.defaultCursor));var o=!!(e&&e.hit&&e.pickedMesh);if(o){if(n.setPointerOverMesh(e.pickedMesh,t.pointerId,e),!n.doNotHandleCursors&&r&&this._pointerOverMesh){var s=this._pointerOverMesh._getActionManagerForTrigger();s&&s.hasPointerTriggers&&(r.style.cursor=s.hoverCursor||n.hoverCursor)}}else n.setPointerOverMesh(null,t.pointerId,e);var l,c=N(n._pointerMoveStage);try{for(c.s();!(l=c.n()).done;){e=l.value.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,o,r)}}catch(d){c.e(d)}finally{c.f()}if(e){var h=t.inputIndex>=u.MouseWheelX&&t.inputIndex<=u.MouseWheelZ?a.kD.POINTERWHEEL:a.kD.POINTERMOVE;if(n.onPointerMove&&n.onPointerMove(t,e,h),n.onPointerObservable.hasObservers()){var f=new a.R5(h,t,e);this._setRayOnPointerInfo(f),n.onPointerObservable.notifyObservers(f,h)}}}},{key:"_setRayOnPointerInfo",value:function(e){var t=this._scene;e.pickInfo&&!e.pickInfo._pickingUnavailable&&(e.pickInfo.ray||(e.pickInfo.ray=t.createPickingRay(e.event.offsetX,e.event.offsetY,p.y3.Identity(),t.activeCamera)))}},{key:"_checkPrePointerObservable",value:function(e,t,n){var i=this._scene,r=new a.FV(n,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(r.originalPickingInfo=e,r.ray=e.ray,e.originMesh&&(r.nearInteractionPickingInfo=e)),i.onPrePointerObservable.notifyObservers(r,n),!!r.skipOnPointerObservable}},{key:"simulatePointerMove",value:function(e,t){var n=new PointerEvent("pointermove",t);n.inputIndex=u.Move,this._checkPrePointerObservable(e,n,a.kD.POINTERMOVE)||this._processPointerMove(e,n)}},{key:"simulatePointerDown",value:function(e,t){var n=new PointerEvent("pointerdown",t);n.inputIndex=n.button+2,this._checkPrePointerObservable(e,n,a.kD.POINTERDOWN)||this._processPointerDown(e,n)}},{key:"_processPointerDown",value:function(t,n){var i=this,r=this._scene;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var o=t.pickedMesh._getActionManagerForTrigger();if(o){if(o.hasPickTriggers)switch(o.processTrigger(5,_.V.CreateNew(t.pickedMesh,n)),n.button){case 0:o.processTrigger(2,_.V.CreateNew(t.pickedMesh,n));break;case 1:o.processTrigger(4,_.V.CreateNew(t.pickedMesh,n));break;case 2:o.processTrigger(3,_.V.CreateNew(t.pickedMesh,n))}o.hasSpecificTrigger(8)&&window.setTimeout((function(){var t=r.pick(i._unTranslatedPointerX,i._unTranslatedPointerY,(function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===i._pickedDownMesh}),!1,r.cameraToUseForPointers);t&&t.hit&&t.pickedMesh&&o&&0!==i._totalPointersPressed&&Date.now()-i._startingPointerTime>e.LongPressDelay&&!i._isPointerSwiping()&&(i._startingPointerTime=0,o.processTrigger(8,_.V.CreateNew(t.pickedMesh,n)))}),e.LongPressDelay)}}else{var s,u=N(r._pointerDownStage);try{for(u.s();!(s=u.n()).done;){t=s.value.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,n,!1)}}catch(h){u.e(h)}finally{u.f()}}if(t){var l=a.kD.POINTERDOWN;if(r.onPointerDown&&r.onPointerDown(n,t,l),r.onPointerObservable.hasObservers()){var c=new a.R5(l,n,t);this._setRayOnPointerInfo(c),r.onPointerObservable.notifyObservers(c,l)}}}},{key:"_isPointerSwiping",value:function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>e.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>e.DragMovementThreshold}},{key:"simulatePointerUp",value:function(e,t,n){var i=new PointerEvent("pointerup",t);i.inputIndex=u.Move;var r=new B;n?r.doubleClick=!0:r.singleClick=!0,this._checkPrePointerObservable(e,i,a.kD.POINTERUP)||this._processPointerUp(e,i,r)}},{key:"_processPointerUp",value:function(e,t,n){var i=this._scene;if(e&&e.hit&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(i.onPointerPick&&i.onPointerPick(t,e),n.singleClick&&!n.ignore&&i.onPointerObservable.hasObservers())){var r=a.kD.POINTERPICK,o=new a.R5(r,t,e);this._setRayOnPointerInfo(o),i.onPointerObservable.notifyObservers(o,r)}var s=e.pickedMesh._getActionManagerForTrigger();if(s&&!n.ignore){s.processTrigger(7,_.V.CreateNew(e.pickedMesh,t,e)),!n.hasSwiped&&n.singleClick&&s.processTrigger(1,_.V.CreateNew(e.pickedMesh,t,e));var u=e.pickedMesh._getActionManagerForTrigger(6);n.doubleClick&&u&&u.processTrigger(6,_.V.CreateNew(e.pickedMesh,t,e))}}else if(!n.ignore){var l,c=N(i._pointerUpStage);try{for(c.s();!(l=c.n()).done;){e=l.value.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,n.doubleClick)}}catch(p){c.e(p)}finally{c.f()}}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var h=this._pickedDownMesh._getActionManagerForTrigger(16);h&&h.processTrigger(16,_.V.CreateNew(this._pickedDownMesh,t))}var f=0;if(i.onPointerObservable.hasObservers()){if(!n.ignore&&!n.hasSwiped&&(n.singleClick&&i.onPointerObservable.hasSpecificMask(a.kD.POINTERTAP)?f=a.kD.POINTERTAP:n.doubleClick&&i.onPointerObservable.hasSpecificMask(a.kD.POINTERDOUBLETAP)&&(f=a.kD.POINTERDOUBLETAP),f)){var d=new a.R5(f,t,e);this._setRayOnPointerInfo(d),i.onPointerObservable.notifyObservers(d,f)}if(!n.ignore){f=a.kD.POINTERUP;var v=new a.R5(f,t,e);this._setRayOnPointerInfo(v),i.onPointerObservable.notifyObservers(v,f)}}i.onPointerUp&&!n.ignore&&i.onPointerUp(t,e,f)}},{key:"isPointerCaptured",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[e]}},{key:"attachControl",value:function(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=this._scene,h=c.getEngine();l||(l=h.getInputElement()),this._alreadyAttached&&this.detachControl(),l&&(this._alreadyAttachedTo=l),this._deviceSourceManager=new L(h),this._initActionManager=function(e){if(!t._meshPickProceed){var n=c.skipPointerUpPicking?null:c.pick(t._unTranslatedPointerX,t._unTranslatedPointerY,c.pointerUpPredicate,!1,c.cameraToUseForPointers);t._currentPickResult=n,n&&(e=n.hit&&n.pickedMesh?n.pickedMesh._getActionManagerForTrigger():null),t._meshPickProceed=!0}return e},this._delayedSimpleClick=function(n,i,r){(Date.now()-t._previousStartingPointerTime>e.DoubleClickDelay&&!t._doubleClickOccured||n!==t._previousButtonPressed)&&(t._doubleClickOccured=!1,i.singleClick=!0,i.ignore=!1,r(i,t._currentPickResult))},this._initClickEvent=function(n,i,r,s){var u=new B;t._currentPickResult=null;var l=null,c=n.hasSpecificMask(a.kD.POINTERPICK)||i.hasSpecificMask(a.kD.POINTERPICK)||n.hasSpecificMask(a.kD.POINTERTAP)||i.hasSpecificMask(a.kD.POINTERTAP)||n.hasSpecificMask(a.kD.POINTERDOUBLETAP)||i.hasSpecificMask(a.kD.POINTERDOUBLETAP);!c&&o&&(l=t._initActionManager(l,u))&&(c=l.hasPickTriggers);var h=!1;if(c){var f=r.button;if(u.hasSwiped=t._isPointerSwiping(),!u.hasSwiped){var d=!e.ExclusiveDoubleClickMode;d||(d=!n.hasSpecificMask(a.kD.POINTERDOUBLETAP)&&!i.hasSpecificMask(a.kD.POINTERDOUBLETAP))&&!o.HasSpecificTrigger(6)&&(l=t._initActionManager(l,u))&&(d=!l.hasSpecificTrigger(6)),d?(Date.now()-t._previousStartingPointerTime>e.DoubleClickDelay||f!==t._previousButtonPressed)&&(u.singleClick=!0,s(u,t._currentPickResult),h=!0):(t._previousDelayedSimpleClickTimeout=t._delayedSimpleClickTimeout,t._delayedSimpleClickTimeout=window.setTimeout(t._delayedSimpleClick.bind(t,f,u,s),e.DoubleClickDelay));var v=n.hasSpecificMask(a.kD.POINTERDOUBLETAP)||i.hasSpecificMask(a.kD.POINTERDOUBLETAP);!v&&o.HasSpecificTrigger(6)&&(l=t._initActionManager(l,u))&&(v=l.hasSpecificTrigger(6)),v&&(f===t._previousButtonPressed&&Date.now()-t._previousStartingPointerTime<e.DoubleClickDelay&&!t._doubleClickOccured?(u.hasSwiped||t._isPointerSwiping()?(t._doubleClickOccured=!1,t._previousStartingPointerTime=t._startingPointerTime,t._previousStartingPointerPosition.x=t._startingPointerPosition.x,t._previousStartingPointerPosition.y=t._startingPointerPosition.y,t._previousButtonPressed=f,e.ExclusiveDoubleClickMode?(t._previousDelayedSimpleClickTimeout&&clearTimeout(t._previousDelayedSimpleClickTimeout),t._previousDelayedSimpleClickTimeout=t._delayedSimpleClickTimeout,s(u,t._previousPickResult)):s(u,t._currentPickResult)):(t._previousStartingPointerTime=0,t._doubleClickOccured=!0,u.doubleClick=!0,u.ignore=!1,e.ExclusiveDoubleClickMode&&t._previousDelayedSimpleClickTimeout&&clearTimeout(t._previousDelayedSimpleClickTimeout),t._previousDelayedSimpleClickTimeout=t._delayedSimpleClickTimeout,s(u,t._currentPickResult)),h=!0):(t._doubleClickOccured=!1,t._previousStartingPointerTime=t._startingPointerTime,t._previousStartingPointerPosition.x=t._startingPointerPosition.x,t._previousStartingPointerPosition.y=t._startingPointerPosition.y,t._previousButtonPressed=f))}}h||s(u,t._currentPickResult)},this._onPointerMove=function(e){if(void 0===e.pointerId&&(e.pointerId=0),t._updatePointerPosition(e),!t._checkPrePointerObservable(null,e,e.inputIndex>=u.MouseWheelX&&e.inputIndex<=u.MouseWheelZ?a.kD.POINTERWHEEL:a.kD.POINTERMOVE)&&(c.cameraToUseForPointers||c.activeCamera))if(c.skipPointerMovePicking)t._processPointerMove(new v.p,e);else{c.pointerMovePredicate||(c.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||c.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!c.cameraToUseForPointers||0!=(c.cameraToUseForPointers.layerMask&e.layerMask))});var n=c.pick(t._unTranslatedPointerX,t._unTranslatedPointerY,c.pointerMovePredicate,!1,c.cameraToUseForPointers,c.pointerMoveTrianglePredicate);t._processPointerMove(n,e)}},this._onPointerDown=function(e){var n;(t._totalPointersPressed++,t._pickedDownMesh=null,t._meshPickProceed=!1,void 0===e.pointerId&&(e.pointerId=0),t._updatePointerPosition(e),c.preventDefaultOnPointerDown&&l&&(e.preventDefault(),l.focus()),t._startingPointerPosition.x=t._pointerX,t._startingPointerPosition.y=t._pointerY,t._startingPointerTime=Date.now(),t._checkPrePointerObservable(null,e,a.kD.POINTERDOWN))||(c.cameraToUseForPointers||c.activeCamera)&&(t._pointerCaptures[e.pointerId]=!0,c.pointerDownPredicate||(c.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!c.cameraToUseForPointers||0!=(c.cameraToUseForPointers.layerMask&e.layerMask))}),t._pickedDownMesh=null,n=c.skipPointerDownPicking?new v.p:c.pick(t._unTranslatedPointerX,t._unTranslatedPointerY,c.pointerDownPredicate,!1,c.cameraToUseForPointers),t._processPointerDown(n,e))},this._onPointerUp=function(e){0!==t._totalPointersPressed&&(t._totalPointersPressed--,t._pickedUpMesh=null,t._meshPickProceed=!1,void 0===e.pointerId&&(e.pointerId=0),t._updatePointerPosition(e),c.preventDefaultOnPointerUp&&l&&(e.preventDefault(),l.focus()),t._initClickEvent(c.onPrePointerObservable,c.onPointerObservable,e,(function(n,i){if(c.onPrePointerObservable.hasObservers()&&!n.ignore){if(!n.hasSwiped){if(n.singleClick&&c.onPrePointerObservable.hasSpecificMask(a.kD.POINTERTAP)&&t._checkPrePointerObservable(null,e,a.kD.POINTERTAP))return;if(n.doubleClick&&c.onPrePointerObservable.hasSpecificMask(a.kD.POINTERDOUBLETAP)&&t._checkPrePointerObservable(null,e,a.kD.POINTERDOUBLETAP))return}if(t._checkPrePointerObservable(null,e,a.kD.POINTERUP))return}t._pointerCaptures[e.pointerId]=!1,(c.cameraToUseForPointers||c.activeCamera)&&(c.pointerUpPredicate||(c.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!c.cameraToUseForPointers||0!=(c.cameraToUseForPointers.layerMask&e.layerMask))}),!t._meshPickProceed&&(o&&o.HasTriggers||c.onPointerObservable.hasObservers())&&t._initActionManager(null,n),i||(i=t._currentPickResult),t._processPointerUp(i,e,n),t._previousPickResult=t._currentPickResult)})))},this._onKeyDown=function(e){var t=g.OG.KEYDOWN;if(c.onPreKeyboardObservable.hasObservers()){var n=new g.WZ(t,e);if(c.onPreKeyboardObservable.notifyObservers(n,t),n.skipOnKeyboardObservable)return}if(c.onKeyboardObservable.hasObservers()){var i=new g.NG(t,e);c.onKeyboardObservable.notifyObservers(i,t)}c.actionManager&&c.actionManager.processTrigger(14,_.V.CreateNewFromScene(c,e))},this._onKeyUp=function(e){var t=g.OG.KEYUP;if(c.onPreKeyboardObservable.hasObservers()){var n=new g.WZ(t,e);if(c.onPreKeyboardObservable.notifyObservers(n,t),n.skipOnKeyboardObservable)return}if(c.onKeyboardObservable.hasObservers()){var i=new g.NG(t,e);c.onKeyboardObservable.notifyObservers(i,t)}c.actionManager&&c.actionManager.processTrigger(15,_.V.CreateNewFromScene(c,e))},this._deviceSourceManager.onDeviceConnectedObservable.add((function(e){e.deviceType===s.Mouse?e.onInputChangedObservable.add((function(a){a.inputIndex===u.LeftClick||a.inputIndex===u.MiddleClick||a.inputIndex===u.RightClick||a.inputIndex===u.BrowserBack||a.inputIndex===u.BrowserForward?i&&1===e.getInput(a.inputIndex)?t._onPointerDown(a):n&&0===e.getInput(a.inputIndex)&&t._onPointerUp(a):r&&(a.inputIndex===u.Move?t._onPointerMove(a):a.inputIndex!==u.MouseWheelX&&a.inputIndex!==u.MouseWheelY&&a.inputIndex!==u.MouseWheelZ||t._onPointerMove(a))})):e.deviceType===s.Touch?e.onInputChangedObservable.add((function(a){a.inputIndex===u.LeftClick&&(i&&1===e.getInput(a.inputIndex)?t._onPointerDown(a):n&&0===e.getInput(a.inputIndex)&&t._onPointerUp(a)),r&&a.inputIndex===u.Move&&t._onPointerMove(a)})):e.deviceType===s.Keyboard&&e.onInputChangedObservable.add((function(e){"keydown"===e.type?t._onKeyDown(e):"keyup"===e.type&&t._onKeyUp(e)}))})),this._alreadyAttached=!0}},{key:"detachControl",value:function(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}},{key:"setPointerOverMesh",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(this._meshUnderPointerId[t]!==e){var i,r=this._meshUnderPointerId[t];r&&(i=r._getActionManagerForTrigger(10))&&i.processTrigger(10,_.V.CreateNew(r,void 0,{pointerId:t})),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,(i=e._getActionManagerForTrigger(9))&&i.processTrigger(9,_.V.CreateNew(e,void 0,{pointerId:t,pickResult:n}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null)}}},{key:"getPointerOverMesh",value:function(){return this._pointerOverMesh}},{key:"_invalidateMesh",value:function(e){for(var t in this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null),this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]}}]),e}();U.DragMovementThreshold=10,U.LongPressDelay=500,U.DoubleClickDelay=300,U.ExclusiveDoubleClickMode=!1},1221:function(e,t,n){"use strict";n.d(t,{m:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"CompareLightsPriority",value:function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority}}]),e}();a.FALLOFF_DEFAULT=0,a.FALLOFF_PHYSICAL=1,a.FALLOFF_GLTF=2,a.FALLOFF_STANDARD=3,a.LIGHTMAP_DEFAULT=0,a.LIGHTMAP_SPECULAR=1,a.LIGHTMAP_SHADOWSONLY=2,a.INTENSITYMODE_AUTOMATIC=0,a.INTENSITYMODE_LUMINOUSPOWER=1,a.INTENSITYMODE_LUMINOUSINTENSITY=2,a.INTENSITYMODE_ILLUMINANCE=3,a.INTENSITYMODE_LUMINANCE=4,a.LIGHTTYPEID_POINTLIGHT=0,a.LIGHTTYPEID_DIRECTIONALLIGHT=1,a.LIGHTTYPEID_SPOTLIGHT=2,a.LIGHTTYPEID_HEMISPHERICLIGHT=3},6639:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"ForceFullSceneLoadingForIncremental",get:function(){return e._ForceFullSceneLoadingForIncremental},set:function(t){e._ForceFullSceneLoadingForIncremental=t}},{key:"ShowLoadingScreen",get:function(){return e._ShowLoadingScreen},set:function(t){e._ShowLoadingScreen=t}},{key:"loggingLevel",get:function(){return e._LoggingLevel},set:function(t){e._LoggingLevel=t}},{key:"CleanBoneMatrixWeights",get:function(){return e._CleanBoneMatrixWeights},set:function(t){e._CleanBoneMatrixWeights=t}}]),e}();a._ForceFullSceneLoadingForIncremental=!1,a._ShowLoadingScreen=!0,a._CleanBoneMatrixWeights=!1,a._LoggingLevel=0},1889:function(e,t,n){"use strict";n.d(t,{l:function(){return f},S:function(){return i}});var i,r=n(5671),a=n(3144),o=n(136),s=n(6215),u=n(1120),l=n(4174),c=function(){function e(){(0,r.Z)(this,e),this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}return(0,a.Z)(e,[{key:"wrapU",get:function(){return this._cachedWrapU},set:function(e){this._cachedWrapU=e}},{key:"wrapV",get:function(){return this._cachedWrapV},set:function(e){this._cachedWrapV=e}},{key:"wrapR",get:function(){return this._cachedWrapR},set:function(e){this._cachedWrapR=e}},{key:"anisotropicFilteringLevel",get:function(){return this._cachedAnisotropicFilteringLevel},set:function(e){this._cachedAnisotropicFilteringLevel=e}},{key:"comparisonFunction",get:function(){return this._comparisonFunction},set:function(e){this._comparisonFunction=e}},{key:"useMipMaps",get:function(){return this._useMipMaps},set:function(e){this._useMipMaps=e}},{key:"setParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=n,this._cachedAnisotropicFilteringLevel=i,this.samplingMode=r,this._comparisonFunction=a,this}},{key:"compareSampler",value:function(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}}]),e}();function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,u.Z)(e);if(t){var r=(0,u.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,s.Z)(this,n)}}!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.DepthStencil=12]="DepthStencil",e[e.CubeRawRGBD=13]="CubeRawRGBD",e[e.Depth=14]="Depth"}(i||(i={}));var f=function(e){(0,o.Z)(n,e);var t=h(n);function n(e,a){var o,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,r.Z)(this,n),(o=t.call(this)).isReady=!1,o.isCube=!1,o.is3D=!1,o.is2DArray=!1,o.isMultiview=!1,o.url="",o.generateMipMaps=!1,o.samples=0,o.type=-1,o.format=-1,o.onLoadedObservable=new l.y$,o.onErrorObservable=new l.y$,o.onRebuildCallback=null,o.width=0,o.height=0,o.depth=0,o.baseWidth=0,o.baseHeight=0,o.baseDepth=0,o.invertY=!1,o._invertVScale=!1,o._associatedChannel=-1,o._source=i.Unknown,o._buffer=null,o._bufferView=null,o._bufferViewArray=null,o._bufferViewArrayArray=null,o._size=0,o._extension="",o._files=null,o._workingCanvas=null,o._workingContext=null,o._cachedCoordinatesMode=null,o._isDisabled=!1,o._compression=null,o._sphericalPolynomial=null,o._sphericalPolynomialPromise=null,o._sphericalPolynomialComputed=!1,o._lodGenerationScale=0,o._lodGenerationOffset=0,o._useSRGBBuffer=!1,o._lodTextureHigh=null,o._lodTextureMid=null,o._lodTextureLow=null,o._isRGBD=!1,o._linearSpecularLOD=!1,o._irradianceTexture=null,o._hardwareTexture=null,o._maxLodLevel=null,o._references=1,o._gammaSpace=null,o._engine=e,o._source=a,o._uniqueId=n._Counter++,s||(o._hardwareTexture=e._createHardwareTexture()),o}return(0,a.Z)(n,[{key:"useMipMaps",get:function(){return this.generateMipMaps},set:function(e){this.generateMipMaps=e}},{key:"uniqueId",get:function(){return this._uniqueId}},{key:"getEngine",value:function(){return this._engine}},{key:"source",get:function(){return this._source}},{key:"incrementReferences",value:function(){this._references++}},{key:"updateSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,e,t,n),this.width=e,this.height=t,this.depth=n,this.baseWidth=e,this.baseHeight=t,this.baseDepth=n,this._size=e*t*n}},{key:"_rebuild",value:function(){var e,t=this;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){var n=this.onRebuildCallback(this),r=function(e){e._swapAndDie(t,!1),t.isReady=n.isReady};n.isAsync?n.proxy.then(r):r(n.proxy)}else{var a;switch(this.source){case i.Temp:break;case i.Url:return void(a=this._engine.createTexture(null!==(e=this._originalUrl)&&void 0!==e?e:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){a._swapAndDie(t,!1),t.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case i.Raw:(a=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer))._swapAndDie(this,!1),this.isReady=!0;break;case i.Raw3D:(a=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case i.Raw2DArray:(a=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case i.Dynamic:(a=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case i.Cube:return void(a=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){a._swapAndDie(t,!1),t.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer));case i.CubeRaw:(a=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this,!1),this.isReady=!0;break;case i.CubeRawRGBD:return;case i.CubePrefiltered:return void((a=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(e){e&&e._swapAndDie(t,!1),t.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}}}},{key:"_swapAndDie",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(t=this._hardwareTexture)||void 0===t||t.setUsage(e._source,this.generateMipMaps,this.isCube,this.width,this.height),e._hardwareTexture=this._hardwareTexture,n&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var i=this._engine.getLoadedTexturesCache(),r=i.indexOf(this);-1!==r&&i.splice(r,1),-1===(r=i.indexOf(e))&&i.push(e)}},{key:"dispose",value:function(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null)}}]),n}(c);f._Counter=0},8618:function(e,t,n){"use strict";n.d(t,{q:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,i.Z)(this,e),this.effect=null,this.defines=null,this.drawContext=t.createDrawContext(),n&&(this.materialContext=t.createMaterialContext())}return(0,r.Z)(e,[{key:"setEffect",value:function(e,t){var n,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(this.effect=e,void 0!==t&&(this.defines=t),i)&&(null===(n=this.drawContext)||void 0===n||n.reset())}},{key:"dispose",value:function(){var e;null===(e=this.drawContext)||void 0===e||e.dispose()}}],[{key:"IsWrapper",value:function(e){return void 0===e.getPipelineContext}},{key:"GetEffect",value:function(e){return void 0===e.getPipelineContext?e.effect:e}}]),e}()},8977:function(e,t,n){"use strict";n.d(t,{Q:function(){return v}});var i=n(885),r=n(5671),a=n(3144),o=n(4174),s=n(5092),u=n(2328),l=n(9776),c=n(8084),h=n(2223);function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var v=function(){function e(t,n,i){var a=this,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,_=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,g=arguments.length>9?arguments[9]:void 0,m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:h.x.GLSL;(0,r.Z)(this,e),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new o.y$,this.onErrorObservable=new o.y$,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._wasPreviouslyUsingInstances=null,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=t,this._key=m;var A,E,S=void 0,T=null;if(n.attributes){var b,P,M,I=n;if(this._engine=i,this._attributesNames=I.attributes,this._uniformsNames=I.uniformsNames.concat(I.samplers),this._samplerList=I.samplers.slice(),this.defines=I.defines,this.onError=I.onError,this.onCompiled=I.onCompiled,this._fallbacks=I.fallbacks,this._indexParameters=I.indexParameters,this._transformFeedbackVaryings=I.transformFeedbackVaryings||null,this._multiTarget=!!I.multiTarget,this._shaderLanguage=null!==(b=I.shaderLanguage)&&void 0!==b?b:h.x.GLSL,I.uniformBuffersNames){this._uniformBuffersNamesList=I.uniformBuffersNames.slice();for(var C=0;C<I.uniformBuffersNames.length;C++)this._uniformBuffersNames[I.uniformBuffersNames[C]]=C}T=null!==(P=I.processFinalCode)&&void 0!==P?P:null,S=null!==(M=I.processCodeAfterIncludes)&&void 0!==M?M:void 0}else this._engine=f,this.defines=null==d?"":d,this._uniformsNames=i.concat(u),this._samplerList=u?u.slice():[],this._attributesNames=n,this._uniformBuffersNamesList=[],this._shaderLanguage=y,this.onError=_,this.onCompiled=p,this._indexParameters=g,this._fallbacks=v;this._attributeLocationByName={},this.uniqueId=e._UniqueIdSeed++;var x=(0,s.CG)()?this._engine.getHostDocument():null;t.vertexSource?A="source:"+t.vertexSource:t.vertexElement?(A=x?x.getElementById(t.vertexElement):null)||(A=t.vertexElement):A=t.vertex||t,t.fragmentSource?E="source:"+t.fragmentSource:t.fragmentElement?(E=x?x.getElementById(t.fragmentElement):null)||(E=t.fragmentElement):E=t.fragment||t,this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);var R={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:c.v.GetShadersRepository(this._shaderLanguage),includesShadersStore:c.v.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:S},D=[void 0,void 0],k=function(){if(D[0]&&D[1]){R.isFragment=!0;var e=D[0],n=D[1];l.L.Process(n,R,(function(n){T&&(n=T("fragment",n));var i=l.L.Finalize(e,n,R);a._useFinalCode(i.vertexCode,i.fragmentCode,t)}),a._engine)}};this._loadShader(A,"Vertex","",(function(e){l.L.Initialize(R),l.L.Process(e,R,(function(t){a._rawVertexSourceCode=e,T&&(t=T("vertex",t)),D[0]=t,k()}),a._engine)})),this._loadShader(E,"Fragment","Pixel",(function(e){a._rawFragmentSourceCode=e,D[1]=e,k()}));var O=function(e){return function(){if(this._pipelineContext){var t=this._pipelineContext[e];t.apply(this._pipelineContext,arguments)}return this}};["Int?","IntArray?","Array?","Color?","Vector?","Float?","Matrices","Matrix","Matrix3x3","Matrix2x2","Quaternion","DirectColor4"].forEach((function(e){var t="set".concat(e);t.endsWith("?")?["",2,3,4].forEach((function(e){a[t.slice(0,-1)+e]=a[t.slice(0,-1)+e]||O(t.slice(0,-1)+e).bind(a)})):a[t]=a[t]||O(t).bind(a)}))}return(0,a.Z)(e,[{key:"onBindObservable",get:function(){return this._onBindObservable||(this._onBindObservable=new o.y$),this._onBindObservable}},{key:"_useFinalCode",value:function(e,t,n){if(n){var i=n.vertexElement||n.vertex||n.spectorName||n,r=n.fragmentElement||n.fragment||n.spectorName||n;this._vertexSourceCode=(this._shaderLanguage===h.x.WGSL?"//":"")+"#define SHADER_NAME vertex:"+i+"\n"+e,this._fragmentSourceCode=(this._shaderLanguage===h.x.WGSL?"//":"")+"#define SHADER_NAME fragment:"+r+"\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()}},{key:"key",get:function(){return this._key}},{key:"isReady",value:function(){try{return this._isReadyInternal()}catch(e){return!1}}},{key:"_isReadyInternal",value:function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady}},{key:"getEngine",value:function(){return this._engine}},{key:"getPipelineContext",value:function(){return this._pipelineContext}},{key:"getAttributesNames",value:function(){return this._attributesNames}},{key:"getAttributeLocation",value:function(e){return this._attributes[e]}},{key:"getAttributeLocationByName",value:function(e){return this._attributeLocationByName[e]}},{key:"getAttributesCount",value:function(){return this._attributes.length}},{key:"getUniformIndex",value:function(e){return this._uniformsNames.indexOf(e)}},{key:"getUniform",value:function(e){return this._uniforms[e]}},{key:"getSamplers",value:function(){return this._samplerList}},{key:"getUniformNames",value:function(){return this._uniformsNames}},{key:"getUniformBuffersNames",value:function(){return this._uniformBuffersNamesList}},{key:"getIndexParameters",value:function(){return this._indexParameters}},{key:"getCompilationError",value:function(){return this._compilationError}},{key:"allFallbacksProcessed",value:function(){return this._allFallbacksProcessed}},{key:"executeWhenCompiled",value:function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add((function(t){e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){t._checkIsReady(null)}),16))}},{key:"_checkIsReady",value:function(e){var t=this;try{if(this._isReadyInternal())return}catch(n){return void this._processCompilationErrors(n,e)}this._isDisposed||setTimeout((function(){t._checkIsReady(e)}),16)}},{key:"_loadShader",value:function(e,t,n,i){if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return void i((0,s.v)(e));if("source:"!==e.substr(0,7))if("base64:"!==e.substr(0,7)){var r,a=c.v.GetShadersStore(this._shaderLanguage);if(a[e+t+"Shader"])i(a[e+t+"Shader"]);else if(n&&a[e+n+"Shader"])i(a[e+n+"Shader"]);else r="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:c.v.GetShadersRepository(this._shaderLanguage)+e,this._engine._loadFile(r+"."+t.toLowerCase()+".fx",i)}else{i(window.atob(e.substr(7)))}else i(e.substr(7))}},{key:"vertexSourceCode",get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(e=null===(t=this._pipelineContext)||void 0===t?void 0:t._getVertexShaderCode())&&void 0!==e?e:this._vertexSourceCode}},{key:"fragmentSourceCode",get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(e=null===(t=this._pipelineContext)||void 0===t?void 0:t._getFragmentShaderCode())&&void 0!==e?e:this._fragmentSourceCode}},{key:"rawVertexSourceCode",get:function(){return this._rawVertexSourceCode}},{key:"rawFragmentSourceCode",get:function(){return this._rawFragmentSourceCode}},{key:"_rebuildProgram",value:function(e,t,n,i){var r=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){i&&i(t)},this.onCompiled=function(){var e=r.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);r._pipelineContext._handlesSpectorRebuildCallback(n)},this._fallbacks=null,this._prepareEffect()}},{key:"_prepareEffect",value:function(){var e=this,t=this._attributesNames,n=this.defines,i=this._pipelineContext;this._isReady=!1;try{var r=this._engine;this._pipelineContext=r.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;var a=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?r._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,a,null,this._transformFeedbackVaryings,this._key):r._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,a,n,this._transformFeedbackVaryings,this._key),r._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(e._attributes=[],e._pipelineContext._fillEffectInformation(e,e._uniformBuffersNames,e._uniformsNames,e._uniforms,e._samplerList,e._samplers,t,e._attributes),t)for(var n=0;n<t.length;n++){var a=t[n];e._attributeLocationByName[a]=e._attributes[n]}r.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),i&&e.getEngine()._deletePipelineContext(i)})),this._pipelineContext.isAsync&&this._checkIsReady(i)}catch(o){this._processCompilationErrors(o,i)}}},{key:"_getShaderCodeAndErrorLine",value:function(e,t,n){var i=n?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,r=null;if(t&&e){var a=t.match(i);if(a&&2===a.length){var o=parseInt(a[1]),s=e.split("\n",-1);s.length>=o&&(r="Offending line [".concat(o,"] in ").concat(n?"fragment":"vertex"," code: ").concat(s[o-1]))}}return[e,r]}},{key:"_processCompilationErrors",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=t.message;var a=this._attributesNames,o=this._fallbacks;if(u.Y.Error("Unable to compile effect:"),u.Y.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),u.Y.Error("Attributes: "+a.map((function(e){return" "+e}))),u.Y.Error("Defines:\r\n"+this.defines),e.LogShaderCodeOnCompilationError){var s,l,c=null,h=null,f=null;if(null!==(s=this._pipelineContext)&&void 0!==s&&s._getVertexShaderCode()){var d=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),v=(0,i.Z)(d,2);f=v[0],c=v[1],f&&(u.Y.Error("Vertex code:"),u.Y.Error(f))}if(null!==(l=this._pipelineContext)&&void 0!==l&&l._getFragmentShaderCode()){var p,_=this._getShaderCodeAndErrorLine(null===(p=this._pipelineContext)||void 0===p?void 0:p._getFragmentShaderCode(),this._compilationError,!0),g=(0,i.Z)(_,2);f=g[0],h=g[1],f&&(u.Y.Error("Fragment code:"),u.Y.Error(f))}c&&u.Y.Error(c),h&&u.Y.Error(h)}u.Y.Error("Error: "+this._compilationError);var m=function(){n.onError&&n.onError(n,n._compilationError),n.onErrorObservable.notifyObservers(n)};r&&(this._pipelineContext=r,this._isReady=!0,m()),o?(this._pipelineContext=null,o.hasMoreFallbacks?(this._allFallbacksProcessed=!1,u.Y.Error("Trying next fallback."),this.defines=o.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,m(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,r||m())}},{key:"isSupported",get:function(){return""===this._compilationError}},{key:"_bindTexture",value:function(e,t){this._engine._bindTexture(this._samplers[e],t,e)}},{key:"setTexture",value:function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}},{key:"setDepthStencilTexture",value:function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)}},{key:"setTextureArray",value:function(e,t){var n=e+"Ex";if(-1===this._samplerList.indexOf(n+"0")){for(var i=this._samplerList.indexOf(e),r=1;r<t.length;r++){var a=n+(r-1).toString();this._samplerList.splice(i+r,0,a)}var o,s=0,u=f(this._samplerList);try{for(u.s();!(o=u.n()).done;){var l=o.value;this._samplers[l]=s,s+=1}}catch(c){u.e(c)}finally{u.f()}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}},{key:"setTextureFromPostProcess",value:function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)}},{key:"setTextureFromPostProcessOutput",value:function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)}},{key:"bindUniformBuffer",value:function(t,n){var i=this._uniformBuffersNames[n];void 0===i||e._BaseCache[i]===t&&this._engine._features.useUBOBindingCache||(e._BaseCache[i]=t,this._engine.bindUniformBufferBase(t,i,n))}},{key:"bindUniformBlock",value:function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}},{key:"setFloatArray",value:function(e,t){return this._pipelineContext.setArray(e,t),this}},{key:"setFloatArray2",value:function(e,t){return this._pipelineContext.setArray2(e,t),this}},{key:"setFloatArray3",value:function(e,t){return this._pipelineContext.setArray3(e,t),this}},{key:"setFloatArray4",value:function(e,t){return this._pipelineContext.setArray4(e,t),this}},{key:"setBool",value:function(e,t){return this._pipelineContext.setInt(e,t?1:0),this}},{key:"dispose",value:function(){var e;null===(e=this._pipelineContext)||void 0===e||e.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0}}],[{key:"ShadersRepository",get:function(){return c.v.ShadersRepository},set:function(e){c.v.ShadersRepository=e}},{key:"RegisterShader",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.x.GLSL;t&&(c.v.GetShadersStore(i)["".concat(e,"PixelShader")]=t),n&&(c.v.GetShadersStore(i)["".concat(e,"VertexShader")]=n)}},{key:"ResetCache",value:function(){e._BaseCache={}}}]),e}();v.LogShaderCodeOnCompilationError=!0,v._UniqueIdSeed=0,v._BaseCache={},v.ShadersStore=c.v.ShadersStore,v.IncludesShadersStore=c.v.IncludesShadersStore},7823:function(e,t,n){"use strict";n.d(t,{$:function(){return h}});var i=n(3144),r=n(5671),a=n(9477),o=n(9336),s=n(4174),u=n(8517),l=n(7046),c=(n(4771),function(){function e(){(0,r.Z)(this,e),this._dirty=!0,this._tempColor=new l.HE(0,0,0,0),this._globalCurve=new l.HE(0,0,0,0),this._highlightsCurve=new l.HE(0,0,0,0),this._midtonesCurve=new l.HE(0,0,0,0),this._shadowsCurve=new l.HE(0,0,0,0),this._positiveCurve=new l.HE(0,0,0,0),this._negativeCurve=new l.HE(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return(0,i.Z)(e,[{key:"globalHue",get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0}},{key:"globalDensity",get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0}},{key:"globalSaturation",get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0}},{key:"globalExposure",get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0}},{key:"highlightsHue",get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0}},{key:"highlightsDensity",get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0}},{key:"highlightsSaturation",get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0}},{key:"highlightsExposure",get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0}},{key:"midtonesHue",get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0}},{key:"midtonesDensity",get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0}},{key:"midtonesSaturation",get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0}},{key:"midtonesExposure",get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0}},{key:"shadowsHue",get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0}},{key:"shadowsDensity",get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0}},{key:"shadowsSaturation",get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0}},{key:"shadowsExposure",get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0}},{key:"getClassName",value:function(){return"ColorCurves"}},{key:"_getColorGradingDataToRef",value:function(t,n,i,r,a){null!=t&&(t=e._Clamp(t,0,360),n=e._Clamp(n,-100,100),i=e._Clamp(i,-100,100),r=e._Clamp(r,-100,100),n=e._ApplyColorGradingSliderNonlinear(n),n*=.5,r=e._ApplyColorGradingSliderNonlinear(r),n<0&&(n*=-1,t=(t+180)%360),e._FromHSBToRef(t,n,50+.25*r,a),a.scaleToRef(2,a),a.a=1+.01*i)}},{key:"clone",value:function(){return o.p4.Clone((function(){return new e}),this)}},{key:"serialize",value:function(){return o.p4.Serialize(this)}}],[{key:"Bind",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(n,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(i,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(r,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))}},{key:"PrepareUniforms",value:function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}},{key:"_ApplyColorGradingSliderNonlinear",value:function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100}},{key:"_FromHSBToRef",value:function(t,n,i,r){var a=e._Clamp(t,0,360),o=e._Clamp(n/100,0,1),s=e._Clamp(i/100,0,1);if(0===o)r.r=s,r.g=s,r.b=s;else{a/=60;var u=Math.floor(a),l=a-u,c=s*(1-o),h=s*(1-o*l),f=s*(1-o*(1-l));switch(u){case 0:r.r=s,r.g=f,r.b=c;break;case 1:r.r=h,r.g=s,r.b=c;break;case 2:r.r=c,r.g=s,r.b=f;break;case 3:r.r=c,r.g=h,r.b=s;break;case 4:r.r=f,r.g=c,r.b=s;break;default:r.r=s,r.g=c,r.b=h}}r.a=1}},{key:"_Clamp",value:function(e,t,n){return Math.min(Math.max(e,t),n)}},{key:"Parse",value:function(t){return o.p4.Parse((function(){return new e}),t,null,null)}}]),e}());(0,a.gn)([(0,o.qC)()],c.prototype,"_globalHue",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_globalDensity",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_globalSaturation",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_globalExposure",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_highlightsHue",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_highlightsDensity",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_highlightsSaturation",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_highlightsExposure",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_midtonesHue",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_midtonesDensity",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_midtonesSaturation",void 0),(0,a.gn)([(0,o.qC)()],c.prototype,"_midtonesExposure",void 0),o.p4._ColorCurvesParser=c.Parse;var h=function(){function e(){(0,r.Z)(this,e),this.colorCurves=new c,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new l.HE(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new s.y$}return(0,i.Z)(e,[{key:"colorCurvesEnabled",get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())}},{key:"colorGradingTexture",get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())}},{key:"colorGradingEnabled",get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())}},{key:"colorGradingWithGreenDepth",get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())}},{key:"colorGradingBGR",get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())}},{key:"exposure",get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())}},{key:"toneMappingEnabled",get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())}},{key:"toneMappingType",get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())}},{key:"contrast",get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())}},{key:"vignetteBlendMode",get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())}},{key:"vignetteEnabled",get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())}},{key:"ditheringEnabled",get:function(){return this._ditheringEnabled},set:function(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._updateParameters())}},{key:"ditheringIntensity",get:function(){return this._ditheringIntensity},set:function(e){this._ditheringIntensity!==e&&(this._ditheringIntensity=e,this._updateParameters())}},{key:"skipFinalColorClamp",get:function(){return this._skipFinalColorClamp},set:function(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())}},{key:"applyByPostProcess",get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())}},{key:"isEnabled",get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())}},{key:"_updateParameters",value:function(){this.onUpdateParameters.notifyObservers(this)}},{key:"getClassName",value:function(){return"ImageProcessingConfiguration"}},{key:"prepareDefines",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n!==this.applyByPostProcess||!this._isEnabled)return t.VIGNETTE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.DITHER=!1,t.IMAGEPROCESSING=!1,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,t.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType===e.TONEMAPPING_ACES)t.TONEMAPPING_ACES=!0;else t.TONEMAPPING_ACES=!1;t.CONTRAST=1!==this.contrast,t.EXPOSURE=1!==this.exposure,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.DITHER=this._ditheringEnabled,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,t.IMAGEPROCESSING=t.VIGNETTE||t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING||t.DITHER}},{key:"isReady",value:function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}},{key:"bind",value:function(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&c.Bind(this.colorCurves,e),this._vignetteEnabled||this._ditheringEnabled){var n=1/e.getEngine().getRenderWidth(),i=1/e.getEngine().getRenderHeight();if(e.setFloat2("vInverseScreenSize",n,i),this._ditheringEnabled&&e.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){var r=null!=t?t:i/n,a=Math.tan(.5*this.vignetteCameraFov),o=a*r,s=Math.sqrt(o*a);o=u.w1.Mix(o,s,this.vignetteStretch),a=u.w1.Mix(a,s,this.vignetteStretch),e.setFloat4("vignetteSettings1",o,a,-o*this.vignetteCentreX,-a*this.vignetteCentreY);var l=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,l)}}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);var h=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(h-1)/h,.5/h,h,this.colorGradingTexture.level)}}},{key:"clone",value:function(){return o.p4.Clone((function(){return new e}),this)}},{key:"serialize",value:function(){return o.p4.Serialize(this)}}],[{key:"PrepareUniforms",value:function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),(t.VIGNETTE||t.DITHER)&&e.push("vInverseScreenSize"),t.VIGNETTE&&(e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&c.PrepareUniforms(e),t.DITHER&&e.push("ditherIntensity")}},{key:"PrepareSamplers",value:function(e,t){t.COLORGRADING&&e.push("txColorTransform")}},{key:"Parse",value:function(t){return o.p4.Parse((function(){return new e}),t,null,null)}},{key:"VIGNETTEMODE_MULTIPLY",get:function(){return this._VIGNETTEMODE_MULTIPLY}},{key:"VIGNETTEMODE_OPAQUE",get:function(){return this._VIGNETTEMODE_OPAQUE}}]),e}();h.TONEMAPPING_STANDARD=0,h.TONEMAPPING_ACES=1,h._VIGNETTEMODE_MULTIPLY=0,h._VIGNETTEMODE_OPAQUE=1,(0,a.gn)([(0,o.N$)()],h.prototype,"colorCurves",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_colorCurvesEnabled",void 0),(0,a.gn)([(0,o.oU)("colorGradingTexture")],h.prototype,"_colorGradingTexture",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_colorGradingEnabled",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_colorGradingWithGreenDepth",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_colorGradingBGR",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_exposure",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_toneMappingEnabled",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_toneMappingType",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_contrast",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"vignetteStretch",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"vignetteCentreX",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"vignetteCentreY",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"vignetteWeight",void 0),(0,a.gn)([(0,o.XX)()],h.prototype,"vignetteColor",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"vignetteCameraFov",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_vignetteBlendMode",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_vignetteEnabled",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_ditheringEnabled",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_ditheringIntensity",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_skipFinalColorClamp",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_applyByPostProcess",void 0),(0,a.gn)([(0,o.qC)()],h.prototype,"_isEnabled",void 0),o.p4._ImageProcessingConfigurationParser=h.Parse},6556:function(e,t,n){"use strict";n.d(t,{F:function(){return S}});var i=n(4942),r=n(5671),a=n(3144),o=n(9477),s=n(9336),u=n(8517),l=n(4174),c=n(4198),h=n(65),f=n(1952),d=n(2328),v=n(3683),p=n(114),_=n(8618),g=function(){function e(){(0,r.Z)(this,e),this.reset()}return(0,a.Z)(e,[{key:"reset",value:function(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}},{key:"func",get:function(){return this._func},set:function(e){this._func=e}},{key:"funcRef",get:function(){return this._funcRef},set:function(e){this._funcRef=e}},{key:"funcMask",get:function(){return this._funcMask},set:function(e){this._funcMask=e}},{key:"opStencilFail",get:function(){return this._opStencilFail},set:function(e){this._opStencilFail=e}},{key:"opDepthFail",get:function(){return this._opDepthFail},set:function(e){this._opDepthFail=e}},{key:"opStencilDepthPass",get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass=e}},{key:"mask",get:function(){return this._mask},set:function(e){this._mask=e}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"getClassName",value:function(){return"MaterialStencilState"}},{key:"copyTo",value:function(e){s.p4.Clone((function(){return e}),this)}},{key:"serialize",value:function(){return s.p4.Serialize(this)}},{key:"parse",value:function(e,t,n){var i=this;s.p4.Parse((function(){return i}),e,t,n)}}]),e}();(0,o.gn)([(0,s.qC)()],g.prototype,"func",null),(0,o.gn)([(0,s.qC)()],g.prototype,"funcRef",null),(0,o.gn)([(0,s.qC)()],g.prototype,"funcMask",null),(0,o.gn)([(0,s.qC)()],g.prototype,"opStencilFail",null),(0,o.gn)([(0,s.qC)()],g.prototype,"opDepthFail",null),(0,o.gn)([(0,s.qC)()],g.prototype,"opStencilDepthPass",null),(0,o.gn)([(0,s.qC)()],g.prototype,"mask",null),(0,o.gn)([(0,s.qC)()],g.prototype,"enabled",null);var m=n(4071);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var S=function(){function e(t,n,i){(0,r.Z)(this,e),this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new l.y$,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new g,this._useUBO=!1,this._fillMode=e.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=function(){},this._callbackPluginEventIsReadyForSubMesh=function(){},this._callbackPluginEventPrepareDefines=function(){},this._callbackPluginEventPrepareDefinesBeforeAttributes=function(){},this._callbackPluginEventHardBindForSubMesh=function(){},this._callbackPluginEventBindForSubMesh=function(){},this._callbackPluginEventHasRenderTargetTextures=function(){},this._callbackPluginEventFillRenderTargetTextures=function(){},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=t;var a=n||c.l.LastCreatedScene;a&&(this._scene=a,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=t||u.w1.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new _.q(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._scene.useRightHandedSystem?this.sideOrientation=e.ClockWiseSideOrientation:this.sideOrientation=e.CounterClockWiseSideOrientation,this._uniformBuffer=new f.M(this._scene.getEngine(),void 0,void 0,t),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),e.OnEventObservable.notifyObservers(this,m.S.Created))}return(0,a.Z)(e,[{key:"canRenderToMRT",get:function(){return!1}},{key:"alpha",get:function(){return this._alpha},set:function(t){if(this._alpha!==t){var n=this._alpha;this._alpha=t,1!==n&&1!==t||this.markAsDirty(e.MiscDirtyFlag)}}},{key:"backFaceCulling",get:function(){return this._backFaceCulling},set:function(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(e.TextureDirtyFlag))}},{key:"cullBackFaces",get:function(){return this._cullBackFaces},set:function(t){this._cullBackFaces!==t&&(this._cullBackFaces=t,this.markAsDirty(e.TextureDirtyFlag))}},{key:"hasRenderTargetTextures",get:function(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}},{key:"onDispose",set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}},{key:"onBindObservable",get:function(){return this._onBindObservable||(this._onBindObservable=new l.y$),this._onBindObservable}},{key:"onBind",set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}},{key:"onUnBindObservable",get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new l.y$),this._onUnBindObservable}},{key:"onEffectCreatedObservable",get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new l.y$),this._onEffectCreatedObservable}},{key:"alphaMode",get:function(){return this._alphaMode},set:function(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(e.TextureDirtyFlag))}},{key:"needDepthPrePass",get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}},{key:"isPrePassCapable",get:function(){return!1}},{key:"fogEnabled",get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(e.MiscDirtyFlag))}},{key:"wireframe",get:function(){switch(this._fillMode){case e.WireFrameFillMode:case e.LineListDrawMode:case e.LineLoopDrawMode:case e.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(t){this.fillMode=t?e.WireFrameFillMode:e.TriangleFillMode}},{key:"pointsCloud",get:function(){switch(this._fillMode){case e.PointFillMode:case e.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(t){this.fillMode=t?e.PointFillMode:e.TriangleFillMode}},{key:"fillMode",get:function(){return this._fillMode},set:function(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(e.MiscDirtyFlag))}},{key:"_getDrawWrapper",value:function(){return this._drawWrapper}},{key:"_setDrawWrapper",value:function(e){this._drawWrapper=e}},{key:"toString",value:function(e){return"Name: "+this.name}},{key:"getClassName",value:function(){return"Material"}},{key:"isFrozen",get:function(){return this.checkReadyOnlyOnce}},{key:"freeze",value:function(){this.markDirty(),this.checkReadyOnlyOnce=!0}},{key:"unfreeze",value:function(){this.markDirty(),this.checkReadyOnlyOnce=!1}},{key:"isReady",value:function(e,t){return!0}},{key:"isReadyForSubMesh",value:function(e,t,n){var i=t.materialDefines;return!!i&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=i,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}},{key:"getEffect",value:function(){return this._drawWrapper.effect}},{key:"getScene",value:function(){return this._scene}},{key:"transparencyMode",get:function(){return this._transparencyMode},set:function(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===e.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}},{key:"_disableAlphaBlending",get:function(){return this._transparencyMode===e.MATERIAL_OPAQUE||this._transparencyMode===e.MATERIAL_ALPHATEST}},{key:"needAlphaBlending",value:function(){return!this._disableAlphaBlending&&this.alpha<1}},{key:"needAlphaBlendingForMesh",value:function(e){return!(this._disableAlphaBlending&&e.visibility>=1)&&(this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha)}},{key:"needAlphaTesting",value:function(){return!!this._forceAlphaTest}},{key:"_shouldTurnAlphaTestOn",value:function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}},{key:"getAlphaTestTexture",value:function(){return null}},{key:"markDirty",value:function(){var e,t=A(this.getScene().meshes);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.subMeshes){var i,r=A(n.subMeshes);try{for(r.s();!(i=r.n()).done;){var a=i.value;a.getMaterial()===this&&(a.effect&&(a.effect._wasPreviouslyReady=!1,a.effect._wasPreviouslyUsingInstances=null))}}catch(o){r.e(o)}finally{r.f()}}}}catch(o){t.e(o)}finally{t.f()}}},{key:"_preBind",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this._scene.getEngine(),r=null==n?this.sideOrientation:n,a=r===e.ClockWiseSideOrientation;return i.enableEffect(t||this._getDrawWrapper()),i.setState(this.backFaceCulling,this.zOffset,!1,a,this.cullBackFaces,this.stencil,this.zOffsetUnits),a}},{key:"bind",value:function(e,t){}},{key:"buildUniformLayout",value:function(){var e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(m.S.PrepareUniformBuffer,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}},{key:"bindForSubMesh",value:function(e,t,n){n.effect&&(this._eventInfo.subMesh=n,this._callbackPluginEventBindForSubMesh(this._eventInfo))}},{key:"bindOnlyWorldMatrix",value:function(e){}},{key:"bindView",value:function(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())}},{key:"bindViewProjection",value:function(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))}},{key:"bindEyePosition",value:function(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)}},{key:"_afterBind",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,p.G.BindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){var n=this._scene.getEngine();this._cachedDepthWriteState=n.getDepthWrite(),n.setDepthWrite(!1)}if(this.disableColorWrite){var i=this._scene.getEngine();this._cachedColorWriteState=i.getColorWrite(),i.setColorWrite(!1)}if(0!==this.depthFunction){var r=this._scene.getEngine();this._cachedDepthFunctionState=r.getDepthFunction()||0,r.setDepthFunction(this.depthFunction)}}},{key:"unbind",value:function(){(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction)&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState);this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState);this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}},{key:"getAnimatables",value:function(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(m.S.GetAnimatables,this._eventInfo),this._eventInfo.animatables}},{key:"getActiveTextures",value:function(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(m.S.GetActiveTextures,this._eventInfo),this._eventInfo.activeTextures}},{key:"hasTexture",value:function(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(m.S.HasTexture,this._eventInfo),this._eventInfo.hasTexture}},{key:"clone",value:function(e){return null}},{key:"getBindedMeshes",value:function(){var e=this;if(this.meshMap){var t=new Array;for(var n in this.meshMap){var i=this.meshMap[n];i&&t.push(i)}return t}return this._scene.meshes.filter((function(t){return t.material===e}))}},{key:"forceCompilation",value:function(e,t,n,r){var a=this,o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({clipPlane:!1,useInstances:!1},n),s=this.getScene(),u=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;!function n(){if(a._scene&&a._scene.getEngine()){var i=s.clipPlane;if(o.clipPlane&&(s.clipPlane=new v.J(0,0,0,1)),a._storeEffectOnSubMeshes){var l=!0,c=null;if(e.subMeshes){var f=new h.P(0,0,0,0,0,e,void 0,!1,!1);f.materialDefines&&(f.materialDefines._renderId=-1),a.isReadyForSubMesh(e,f,o.useInstances)||(f.effect&&f.effect.getCompilationError()&&f.effect.allFallbacksProcessed()?c=f.effect.getCompilationError():(l=!1,setTimeout(n,16)))}l&&(a.allowShaderHotSwapping=u,c&&r&&r(c),t&&t(a))}else a.isReady()?(a.allowShaderHotSwapping=u,t&&t(a)):setTimeout(n,16);o.clipPlane&&(s.clipPlane=i)}}()}},{key:"forceCompilationAsync",value:function(e,t){var n=this;return new Promise((function(i,r){n.forceCompilation(e,(function(){i()}),t,(function(e){r(e)}))}))}},{key:"markAsDirty",value:function(t){this.getScene().blockMaterialDirtyMechanism||(e._DirtyCallbackArray.length=0,t&e.TextureDirtyFlag&&e._DirtyCallbackArray.push(e._TextureDirtyCallBack),t&e.LightDirtyFlag&&e._DirtyCallbackArray.push(e._LightsDirtyCallBack),t&e.FresnelDirtyFlag&&e._DirtyCallbackArray.push(e._FresnelDirtyCallBack),t&e.AttributesDirtyFlag&&e._DirtyCallbackArray.push(e._AttributeDirtyCallBack),t&e.MiscDirtyFlag&&e._DirtyCallbackArray.push(e._MiscDirtyCallBack),t&e.PrePassDirtyFlag&&e._DirtyCallbackArray.push(e._PrePassDirtyCallBack),e._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(e._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}},{key:"resetDrawCache",value:function(){var e,t=A(this.getScene().meshes);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.subMeshes){var i,r=A(n.subMeshes);try{for(r.s();!(i=r.n()).done;){var a=i.value;a.getMaterial()===this&&a.resetDrawCache()}}catch(o){r.e(o)}finally{r.f()}}}}catch(o){t.e(o)}finally{t.f()}}},{key:"_markAllSubMeshesAsDirty",value:function(e){if(!this.getScene().blockMaterialDirtyMechanism){var t,n=A(this.getScene().meshes);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.subMeshes){var r,a=A(i.subMeshes);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.getMaterial(!1)===this){var s,u=A(o._drawWrappers);try{for(u.s();!(s=u.n()).done;){var l=s.value;l&&l.defines&&l.defines.markAllAsDirty&&(this._materialContext===l.materialContext&&e(l.defines))}}catch(c){u.e(c)}finally{u.f()}}}}catch(c){a.e(c)}finally{a.f()}}}}catch(c){n.e(c)}finally{n.f()}}}},{key:"_markScenePrePassDirty",value:function(){if(!this.getScene().blockMaterialDirtyMechanism){var e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}}},{key:"_markAllSubMeshesAsAllDirty",value:function(){this._markAllSubMeshesAsDirty(e._AllDirtyCallBack)}},{key:"_markAllSubMeshesAsImageProcessingDirty",value:function(){this._markAllSubMeshesAsDirty(e._ImageProcessingDirtyCallBack)}},{key:"_markAllSubMeshesAsTexturesDirty",value:function(){this._markAllSubMeshesAsDirty(e._TextureDirtyCallBack)}},{key:"_markAllSubMeshesAsFresnelDirty",value:function(){this._markAllSubMeshesAsDirty(e._FresnelDirtyCallBack)}},{key:"_markAllSubMeshesAsFresnelAndMiscDirty",value:function(){this._markAllSubMeshesAsDirty(e._FresnelAndMiscDirtyCallBack)}},{key:"_markAllSubMeshesAsLightsDirty",value:function(){this._markAllSubMeshesAsDirty(e._LightsDirtyCallBack)}},{key:"_markAllSubMeshesAsAttributesDirty",value:function(){this._markAllSubMeshesAsDirty(e._AttributeDirtyCallBack)}},{key:"_markAllSubMeshesAsMiscDirty",value:function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)}},{key:"_markAllSubMeshesAsPrePassDirty",value:function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)}},{key:"_markAllSubMeshesAsTexturesAndMiscDirty",value:function(){this._markAllSubMeshesAsDirty(e._TextureAndMiscDirtyCallBack)}},{key:"setPrePassRenderer",value:function(e){return!1}},{key:"dispose",value:function(e,t,n){var i=this.getScene();if(i.stopAnimation(this),i.freeProcessedMaterials(),i.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(m.S.Disposed,this._eventInfo),this._parentContainer){var r=this._parentContainer.materials.indexOf(this);r>-1&&this._parentContainer.materials.splice(r,1),this._parentContainer=null}if(!0!==n)if(this.meshMap)for(var a in this.meshMap){var o=this.meshMap[a];o&&(o.material=null,this.releaseVertexArrayObject(o,e))}else{var s,u=A(i.meshes);try{for(u.s();!(s=u.n()).done;){var l=s.value;l.material!==this||l.sourceMesh||(l.material=null,this.releaseVertexArrayObject(l,e))}}catch(c){u.e(c)}finally{u.f()}}this._uniformBuffer.dispose(),e&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()}},{key:"releaseVertexArrayObject",value:function(e,t){if(e.geometry){var n=e.geometry;if(this._storeEffectOnSubMeshes){var i,r=A(e.subMeshes);try{for(r.s();!(i=r.n()).done;){var a=i.value;n._releaseVertexArrayObject(a.effect),t&&a.effect&&a.effect.dispose()}}catch(o){r.e(o)}finally{r.f()}}else n._releaseVertexArrayObject(this._drawWrapper.effect)}}},{key:"serialize",value:function(){var e=s.p4.Serialize(this);return e.stencil=this.stencil.serialize(),e.uniqueId=this.uniqueId,e}}],[{key:"Parse",value:function(e,t,n){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return d.Y.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";var i=u.w1.Instantiate(e.customType).Parse(e,t,n);return i._loadedUniqueId=e.uniqueId,i}}]),e}();S.TriangleFillMode=0,S.WireFrameFillMode=1,S.PointFillMode=2,S.PointListDrawMode=3,S.LineListDrawMode=4,S.LineLoopDrawMode=5,S.LineStripDrawMode=6,S.TriangleStripDrawMode=7,S.TriangleFanDrawMode=8,S.ClockWiseSideOrientation=0,S.CounterClockWiseSideOrientation=1,S.TextureDirtyFlag=1,S.LightDirtyFlag=2,S.FresnelDirtyFlag=4,S.AttributesDirtyFlag=8,S.MiscDirtyFlag=16,S.PrePassDirtyFlag=32,S.AllDirtyFlag=63,S.MATERIAL_OPAQUE=0,S.MATERIAL_ALPHATEST=1,S.MATERIAL_ALPHABLEND=2,S.MATERIAL_ALPHATESTANDBLEND=3,S.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,S.MATERIAL_NORMALBLENDMETHOD_RNM=1,S.OnEventObservable=new l.y$,S._AllDirtyCallBack=function(e){return e.markAllAsDirty()},S._ImageProcessingDirtyCallBack=function(e){return e.markAsImageProcessingDirty()},S._TextureDirtyCallBack=function(e){return e.markAsTexturesDirty()},S._FresnelDirtyCallBack=function(e){return e.markAsFresnelDirty()},S._MiscDirtyCallBack=function(e){return e.markAsMiscDirty()},S._PrePassDirtyCallBack=function(e){return e.markAsPrePassDirty()},S._LightsDirtyCallBack=function(e){return e.markAsLightDirty()},S._AttributeDirtyCallBack=function(e){return e.markAsAttributesDirty()},S._FresnelAndMiscDirtyCallBack=function(e){S._FresnelDirtyCallBack(e),S._MiscDirtyCallBack(e)},S._TextureAndMiscDirtyCallBack=function(e){S._TextureDirtyCallBack(e),S._MiscDirtyCallBack(e)},S._DirtyCallbackArray=[],S._RunDirtyCallBacks=function(e){var t,n=A(S._DirtyCallbackArray);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(i){n.e(i)}finally{n.f()}},(0,o.gn)([(0,s.qC)()],S.prototype,"id",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"uniqueId",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"name",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"metadata",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"checkReadyOnEveryCall",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"checkReadyOnlyOnce",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"state",void 0),(0,o.gn)([(0,s.qC)("alpha")],S.prototype,"_alpha",void 0),(0,o.gn)([(0,s.qC)("backFaceCulling")],S.prototype,"_backFaceCulling",void 0),(0,o.gn)([(0,s.qC)("cullBackFaces")],S.prototype,"_cullBackFaces",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"sideOrientation",void 0),(0,o.gn)([(0,s.qC)("alphaMode")],S.prototype,"_alphaMode",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"_needDepthPrePass",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"disableDepthWrite",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"disableColorWrite",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"forceDepthWrite",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"depthFunction",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"separateCullingPass",void 0),(0,o.gn)([(0,s.qC)("fogEnabled")],S.prototype,"_fogEnabled",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"pointSize",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"zOffset",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"zOffsetUnits",void 0),(0,o.gn)([(0,s.qC)()],S.prototype,"pointsCloud",null),(0,o.gn)([(0,s.qC)()],S.prototype,"fillMode",null),(0,o.gn)([(0,s.qC)()],S.prototype,"transparencyMode",null)},4771:function(e,t,n){"use strict";n.d(t,{H:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(t){if((0,i.Z)(this,e),this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=t,t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&this._setDefaultValue(n)}return(0,r.Z)(e,[{key:"isDirty",get:function(){return this._isDirty}},{key:"markAsProcessed",value:function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}},{key:"markAsUnprocessed",value:function(){this._isDirty=!0}},{key:"markAllAsDirty",value:function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}},{key:"markAsImageProcessingDirty",value:function(){this._areImageProcessingDirty=!0,this._isDirty=!0}},{key:"markAsLightDirty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0}},{key:"markAsAttributesDirty",value:function(){this._areAttributesDirty=!0,this._isDirty=!0}},{key:"markAsTexturesDirty",value:function(){this._areTexturesDirty=!0,this._isDirty=!0}},{key:"markAsFresnelDirty",value:function(){this._areFresnelDirty=!0,this._isDirty=!0}},{key:"markAsMiscDirty",value:function(){this._areMiscDirty=!0,this._isDirty=!0}},{key:"markAsPrePassDirty",value:function(){this._arePrePassDirty=!0,this._isDirty=!0}},{key:"rebuild",value:function(){this._keys.length=0;for(var e=0,t=Object.keys(this);e<t.length;e++){var n=t[e];"_"!==n[0]&&this._keys.push(n)}if(this._externalProperties)for(var i in this._externalProperties)-1===this._keys.indexOf(i)&&this._keys.push(i)}},{key:"isEqual",value:function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var n=this._keys[t];if(this[n]!==e[n])return!1}return!0}},{key:"cloneTo",value:function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var n=this._keys[t];e[n]=this[n]}}},{key:"reset",value:function(){var e=this;this._keys.forEach((function(t){return e._setDefaultValue(t)}))}},{key:"_setDefaultValue",value:function(e){var t,n,i,r,a,o=null!==(t=null===(n=this._externalProperties)||void 0===n||null===(i=n[e])||void 0===i?void 0:i.type)&&void 0!==t?t:typeof this[e],s=null===(r=this._externalProperties)||void 0===r||null===(a=r[e])||void 0===a?void 0:a.default;switch(o){case"number":this[e]=null!=s?s:0;break;case"string":this[e]=null!=s?s:"";break;default:this[e]=null!=s&&s}}},{key:"toString",value:function(){for(var e="",t=0;t<this._keys.length;t++){var n=this._keys[t],i=this[n];switch(typeof i){case"number":case"string":e+="#define "+n+" "+i+"\n";break;default:i&&(e+="#define "+n+"\n")}}return e}}]),e}()},114:function(e,t,n){"use strict";n.d(t,{G:function(){return p}});var i=n(5671),r=n(3144),a=n(2328),o=n(7337),s=n(8911),u=n(4198),l=n(2845),c=n(1221),h=n(7046),f=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"BindClipPlane",value:function(e,t){if(t.clipPlane){var n=t.clipPlane;e.setFloat4("vClipPlane",n.normal.x,n.normal.y,n.normal.z,n.d)}if(t.clipPlane2){var i=t.clipPlane2;e.setFloat4("vClipPlane2",i.normal.x,i.normal.y,i.normal.z,i.d)}if(t.clipPlane3){var r=t.clipPlane3;e.setFloat4("vClipPlane3",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane4){var a=t.clipPlane4;e.setFloat4("vClipPlane4",a.normal.x,a.normal.y,a.normal.z,a.d)}if(t.clipPlane5){var o=t.clipPlane5;e.setFloat4("vClipPlane5",o.normal.x,o.normal.y,o.normal.z,o.d)}if(t.clipPlane6){var s=t.clipPlane6;e.setFloat4("vClipPlane6",s.normal.x,s.normal.y,s.normal.z,s.d)}}}]),e}();function d(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var p=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"BindSceneUniformBuffer",value:function(e,t){t.bindToEffect(e,"Scene")}},{key:"PrepareDefinesForMergedUV",value:function(e,t,n){t._needUVs=!0,t[n]=!0,e.optimizeUVAllocation&&e.getTextureMatrix().isIdentityAs3x2()?(t[n+"DIRECTUV"]=e.coordinatesIndex+1,t["MAINUV"+(e.coordinatesIndex+1)]=!0):t[n+"DIRECTUV"]=0}},{key:"BindTextureMatrix",value:function(e,t,n){var i=e.getTextureMatrix();t.updateMatrix(n+"Matrix",i)}},{key:"GetFogState",value:function(e,t){return t.fogEnabled&&e.applyFog&&t.fogMode!==s.x.FOGMODE_NONE}},{key:"PrepareDefinesForMisc",value:function(e,t,n,i,r,a,o){o._areMiscDirty&&(o.LOGARITHMICDEPTH=n,o.POINTSIZE=i,o.FOG=r&&this.GetFogState(e,t),o.NONUNIFORMSCALING=e.nonUniformScaling,o.ALPHATEST=a)}},{key:"PrepareDefinesForFrameBoundValues",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=!1,s=!1,u=!1,l=!1,c=!1,h=!1,f=!1;s=null==r?void 0!==e.clipPlane&&null!==e.clipPlane:r,u=null==r?void 0!==e.clipPlane2&&null!==e.clipPlane2:r,l=null==r?void 0!==e.clipPlane3&&null!==e.clipPlane3:r,c=null==r?void 0!==e.clipPlane4&&null!==e.clipPlane4:r,h=null==r?void 0!==e.clipPlane5&&null!==e.clipPlane5:r,f=null==r?void 0!==e.clipPlane6&&null!==e.clipPlane6:r,n.CLIPPLANE!==s&&(n.CLIPPLANE=s,o=!0),n.CLIPPLANE2!==u&&(n.CLIPPLANE2=u,o=!0),n.CLIPPLANE3!==l&&(n.CLIPPLANE3=l,o=!0),n.CLIPPLANE4!==c&&(n.CLIPPLANE4=c,o=!0),n.CLIPPLANE5!==h&&(n.CLIPPLANE5=h,o=!0),n.CLIPPLANE6!==f&&(n.CLIPPLANE6=f,o=!0),n.DEPTHPREPASS!==!t.getColorWrite()&&(n.DEPTHPREPASS=!n.DEPTHPREPASS,o=!0),n.INSTANCES!==i&&(n.INSTANCES=i,o=!0),n.INSTANCESCOLOR&&!n.INSTANCES&&(n.INSTANCESCOLOR=!1,o=!0),n.THIN_INSTANCES!==a&&(n.THIN_INSTANCES=a,o=!0),o&&n.markAsUnprocessed()}},{key:"PrepareDefinesForBones",value:function(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;var n=void 0!==t.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&n)t.BONETEXTURE=!0;else{t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!n&&void 0;var i=e.getScene().prePassRenderer;if(i&&i.enabled){var r=-1===i.excludedSkinnedMesh.indexOf(e);t.BONES_VELOCITY_ENABLED=r}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0}},{key:"PrepareDefinesForMorphTargets",value:function(e,t){var n=e.morphTargetManager;n?(t.MORPHTARGETS_UV=n.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=n.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=n.supportsNormals&&t.NORMAL,t.MORPHTARGETS=n.numInfluencers>0,t.NUM_MORPH_INFLUENCERS=n.numInfluencers,t.MORPHTARGETS_TEXTURE=n.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}},{key:"PrepareDefinesForBakedVertexAnimation",value:function(e,t){var n=e.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!(!n||!n.isEnabled)}},{key:"PrepareDefinesForAttributes",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent(l.o.NormalKind),t._needNormals&&e.isVerticesDataPresent(l.o.TangentKind)&&(t.TANGENT=!0);for(var s=1;s<=6;++s)t["UV"+s]=!!t._needUVs&&e.isVerticesDataPresent("uv".concat(1===s?"":s));if(n){var u=e.useVertexColors&&e.isVerticesDataPresent(l.o.ColorKind);t.VERTEXCOLOR=u,t.VERTEXALPHA=e.hasVertexAlpha&&u&&a}return e.isVerticesDataPresent(l.o.ColorInstanceKind)&&(e.hasInstances||e.hasThinInstances)&&(t.INSTANCESCOLOR=!0),i&&this.PrepareDefinesForBones(e,t),r&&this.PrepareDefinesForMorphTargets(e,t),o&&this.PrepareDefinesForBakedVertexAnimation(e,t),!0}},{key:"PrepareDefinesForMultiview",value:function(e,t){if(e.activeCamera){var n=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=n&&t.markAsUnprocessed()}}},{key:"PrepareDefinesForOIT",value:function(e,t,n){var i=t.ORDER_INDEPENDENT_TRANSPARENCY,r=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&n,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,i===t.ORDER_INDEPENDENT_TRANSPARENCY&&r===t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||t.markAsUnprocessed()}},{key:"PrepareDefinesForPrePass",value:function(e,t,n){var i=t.PREPASS;if(t._arePrePassDirty){var r=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&n){t.PREPASS=!0,t.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount;for(var a=0;a<r.length;a++){var o=e.prePassRenderer.getIndex(r[a].type);-1!==o?(t[r[a].define]=!0,t[r[a].index]=o):t[r[a].define]=!1}}else{t.PREPASS=!1;for(var s=0;s<r.length;s++)t[r[s].define]=!1}t.PREPASS!=i&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}}},{key:"PrepareDefinesForLight",value:function(e,t,n,i,r,a,o){switch(o.needNormals=!0,void 0===r["LIGHT"+i]&&(o.needRebuild=!0),r["LIGHT"+i]=!0,r["SPOTLIGHT"+i]=!1,r["HEMILIGHT"+i]=!1,r["POINTLIGHT"+i]=!1,r["DIRLIGHT"+i]=!1,n.prepareLightSpecificDefines(r,i),r["LIGHT_FALLOFF_PHYSICAL"+i]=!1,r["LIGHT_FALLOFF_GLTF"+i]=!1,r["LIGHT_FALLOFF_STANDARD"+i]=!1,n.falloffType){case c.m.FALLOFF_GLTF:r["LIGHT_FALLOFF_GLTF"+i]=!0;break;case c.m.FALLOFF_PHYSICAL:r["LIGHT_FALLOFF_PHYSICAL"+i]=!0;break;case c.m.FALLOFF_STANDARD:r["LIGHT_FALLOFF_STANDARD"+i]=!0}if(a&&!n.specular.equalsFloats(0,0,0)&&(o.specularEnabled=!0),r["SHADOW"+i]=!1,r["SHADOWCSM"+i]=!1,r["SHADOWCSMDEBUG"+i]=!1,r["SHADOWCSMNUM_CASCADES"+i]=!1,r["SHADOWCSMUSESHADOWMAXZ"+i]=!1,r["SHADOWCSMNOBLEND"+i]=!1,r["SHADOWCSM_RIGHTHANDED"+i]=!1,r["SHADOWPCF"+i]=!1,r["SHADOWPCSS"+i]=!1,r["SHADOWPOISSON"+i]=!1,r["SHADOWESM"+i]=!1,r["SHADOWCLOSEESM"+i]=!1,r["SHADOWCUBE"+i]=!1,r["SHADOWLOWQUALITY"+i]=!1,r["SHADOWMEDIUMQUALITY"+i]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&n.shadowEnabled){var s=n.getShadowGenerator();if(s){var u=s.getShadowMap();u&&u.renderList&&u.renderList.length>0&&(o.shadowEnabled=!0,s.prepareDefines(r,i))}}n.lightmapMode!=c.m.LIGHTMAP_DEFAULT?(o.lightmapMode=!0,r["LIGHTMAPEXCLUDED"+i]=!0,r["LIGHTMAPNOSPECULAR"+i]=n.lightmapMode==c.m.LIGHTMAP_SHADOWSONLY):(r["LIGHTMAPEXCLUDED"+i]=!1,r["LIGHTMAPNOSPECULAR"+i]=!1)}},{key:"PrepareDefinesForLights",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!n._areLightsDirty)return n._needNormals;var o=0,s={needNormals:n._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!a){var u,l=d(t.lightSources);try{for(l.s();!(u=l.n()).done;){var c=u.value;if(this.PrepareDefinesForLight(e,t,c,o,n,i,s),++o===r)break}}catch(v){l.e(v)}finally{l.f()}}n.SPECULARTERM=s.specularEnabled,n.SHADOWS=s.shadowEnabled;for(var h=o;h<r;h++)void 0!==n["LIGHT"+h]&&(n["LIGHT"+h]=!1,n["HEMILIGHT"+h]=!1,n["POINTLIGHT"+h]=!1,n["DIRLIGHT"+h]=!1,n["SPOTLIGHT"+h]=!1,n["SHADOW"+h]=!1,n["SHADOWCSM"+h]=!1,n["SHADOWCSMDEBUG"+h]=!1,n["SHADOWCSMNUM_CASCADES"+h]=!1,n["SHADOWCSMUSESHADOWMAXZ"+h]=!1,n["SHADOWCSMNOBLEND"+h]=!1,n["SHADOWCSM_RIGHTHANDED"+h]=!1,n["SHADOWPCF"+h]=!1,n["SHADOWPCSS"+h]=!1,n["SHADOWPOISSON"+h]=!1,n["SHADOWESM"+h]=!1,n["SHADOWCLOSEESM"+h]=!1,n["SHADOWCUBE"+h]=!1,n["SHADOWLOWQUALITY"+h]=!1,n["SHADOWMEDIUMQUALITY"+h]=!1);var f=e.getEngine().getCaps();return void 0===n.SHADOWFLOAT&&(s.needRebuild=!0),n.SHADOWFLOAT=s.shadowEnabled&&(f.textureFloatRender&&f.textureFloatLinearFiltering||f.textureHalfFloatRender&&f.textureHalfFloatLinearFiltering),n.LIGHTMAPEXCLUDED=s.lightmapMode,s.needRebuild&&n.rebuild(),s.needNormals}},{key:"PrepareUniformsAndSamplersForLight",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];r&&r.push("Light"+e),a||(t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),n.push("shadowSampler"+e),n.push("depthSampler"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),i&&(n.push("projectionLightSampler"+e),t.push("textureProjectionMatrix"+e)))}},{key:"PrepareUniformsAndSamplersList",value:function(e,t,n){var i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,a=null;if(e.uniformsNames){var o=e;i=o.uniformsNames,a=o.uniformBuffersNames,t=o.samplers,n=o.defines,r=o.maxSimultaneousLights||0}else i=e,t||(t=[]);for(var s=0;s<r&&n["LIGHT"+s];s++)this.PrepareUniformsAndSamplersForLight(s,i,t,n["PROJECTEDLIGHTTEXTURE"+s],a);n.NUM_MORPH_INFLUENCERS&&i.push("morphTargetInfluences"),n.BAKED_VERTEX_ANIMATION_TEXTURE&&(i.push("bakedVertexAnimationSettings"),i.push("bakedVertexAnimationTextureSizeInverted"),i.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))}},{key:"HandleFallbacksForShadows",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=0,a=0;a<n&&e["LIGHT"+a];a++)a>0&&(r=i+a,t.addFallback(r,"LIGHT"+a)),e.SHADOWS||(e["SHADOW"+a]&&t.addFallback(i,"SHADOW"+a),e["SHADOWPCF"+a]&&t.addFallback(i,"SHADOWPCF"+a),e["SHADOWPCSS"+a]&&t.addFallback(i,"SHADOWPCSS"+a),e["SHADOWPOISSON"+a]&&t.addFallback(i,"SHADOWPOISSON"+a),e["SHADOWESM"+a]&&t.addFallback(i,"SHADOWESM"+a),e["SHADOWCLOSEESM"+a]&&t.addFallback(i,"SHADOWCLOSEESM"+a));return r++}},{key:"PrepareAttributesForMorphTargetsInfluencers",value:function(e,t,n){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=n,this.PrepareAttributesForMorphTargets(e,t,this._TmpMorphInfluencers)}},{key:"PrepareAttributesForMorphTargets",value:function(e,t,n){var i=n.NUM_MORPH_INFLUENCERS;if(i>0&&u.l.LastCreatedEngine){var r=u.l.LastCreatedEngine.getCaps().maxVertexAttribs,o=t.morphTargetManager;if(null!=o&&o.isUsingTextureForTargets)return;for(var s=o&&o.supportsNormals&&n.NORMAL,c=o&&o.supportsTangents&&n.TANGENT,h=o&&o.supportsUVs&&n.UV1,f=0;f<i;f++)e.push(l.o.PositionKind+f),s&&e.push(l.o.NormalKind+f),c&&e.push(l.o.TangentKind+f),h&&e.push(l.o.UVKind+"_"+f),e.length>r&&a.Y.Error("Cannot add more vertex attributes for mesh "+t.name)}}},{key:"PrepareAttributesForBakedVertexAnimation",value:function(e,t,n){n.BAKED_VERTEX_ANIMATION_TEXTURE&&n.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")}},{key:"PrepareAttributesForBones",value:function(e,t,n,i){n.NUM_BONE_INFLUENCERS>0&&(i.addCPUSkinningFallback(0,t),e.push(l.o.MatricesIndicesKind),e.push(l.o.MatricesWeightsKind),n.NUM_BONE_INFLUENCERS>4&&(e.push(l.o.MatricesIndicesExtraKind),e.push(l.o.MatricesWeightsExtraKind)))}},{key:"PrepareAttributesForInstances",value:function(e,t){(t.INSTANCES||t.THIN_INSTANCES)&&this.PushAttributesForInstances(e,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&e.push(l.o.ColorInstanceKind)}},{key:"PushAttributesForInstances",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),t&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))}},{key:"BindLightProperties",value:function(e,t,n){e.transferToEffect(t,n+"")}},{key:"BindLight",value:function(e,t,n,i,r){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];e._bindLight(t,n,i,r,a)}},{key:"BindLights",value:function(e,t,n,i){for(var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,a=Math.min(t.lightSources.length,r),o=0;o<a;o++){var s=t.lightSources[o];this.BindLight(s,o,e,n,"boolean"==typeof i?i:i.SPECULARTERM,t.receiveShadows)}}},{key:"BindFogParameters",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.fogEnabled&&t.applyFog&&e.fogMode!==s.x.FOGMODE_NONE&&(n.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),i?(e.fogColor.toLinearSpaceToRef(this._TempFogColor),n.setColor3("vFogColor",this._TempFogColor)):n.setColor3("vFogColor",e.fogColor))}},{key:"BindBonesParameters",value:function(t,n,i){if(n&&t&&(t.computeBonesUsingShaders&&n._bonesComputationForcedToCPU&&(t.computeBonesUsingShaders=!1),t.useBones&&t.computeBonesUsingShaders&&t.skeleton)){var r=t.skeleton;if(r.isUsingTextureForMatrices&&n.getUniformIndex("boneTextureWidth")>-1){var a=r.getTransformMatrixTexture(t);n.setTexture("boneSampler",a),n.setFloat("boneTextureWidth",4*(r.bones.length+1))}else{var o=r.getTransformMatrices(t);o&&(n.setMatrices("mBones",o),i&&t.getScene().prePassRenderer&&t.getScene().prePassRenderer.getIndex(2)&&(i.previousBones[t.uniqueId]||(i.previousBones[t.uniqueId]=o.slice()),n.setMatrices("mPreviousBones",i.previousBones[t.uniqueId]),e._CopyBonesTransformationMatrices(o,i.previousBones[t.uniqueId])))}}}},{key:"_CopyBonesTransformationMatrices",value:function(e,t){return t.set(e),t}},{key:"BindMorphTargetParameters",value:function(e,t){var n=e.morphTargetManager;e&&n&&t.setFloatArray("morphTargetInfluences",n.influences)}},{key:"BindLogDepth",value:function(e,t,n){if(!e||e.LOGARITHMICDEPTH){var i=n.activeCamera;i.mode===o.V.ORTHOGRAPHIC_CAMERA&&a.Y.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(i.maxZ+1)/Math.LN2))}}},{key:"BindClipPlane",value:function(e,t){f.BindClipPlane(e,t)}}]),e}();p._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},p._TempFogColor=h.Wo.Black()},4071:function(e,t,n){"use strict";var i;n.d(t,{S:function(){return i}}),function(e){e[e.Created=1]="Created",e[e.Disposed=2]="Disposed",e[e.GetDefineNames=4]="GetDefineNames",e[e.PrepareUniformBuffer=8]="PrepareUniformBuffer",e[e.IsReadyForSubMesh=16]="IsReadyForSubMesh",e[e.PrepareDefines=32]="PrepareDefines",e[e.BindForSubMesh=64]="BindForSubMesh",e[e.PrepareEffect=128]="PrepareEffect",e[e.GetAnimatables=256]="GetAnimatables",e[e.GetActiveTextures=512]="GetActiveTextures",e[e.HasTexture=1024]="HasTexture",e[e.FillRenderTargetTextures=2048]="FillRenderTargetTextures",e[e.HasRenderTargetTextures=4096]="HasRenderTargetTextures",e[e.HardBindForSubMesh=8192]="HardBindForSubMesh"}(i||(i={}))},2402:function(e,t,n){"use strict";n.d(t,{G:function(){return p}});var i=n(2982),r=n(5671),a=n(3144),o=n(7326),s=n(1752),u=n(136),l=n(6215),c=n(1120),h=n(6556),f=n(7032),d=n(1704);function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,c.Z)(e);if(t){var r=(0,c.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,l.Z)(this,n)}}var p=function(e){(0,u.Z)(n,e);var t=v(n);function n(e,i){var a;return(0,r.Z)(this,n),(a=t.call(this,e,i,!0))._waitingSubMaterialsUniqueIds=[],a.getScene().multiMaterials.push((0,o.Z)(a)),a.subMaterials=new Array,a._storeEffectOnSubMeshes=!0,a}return(0,a.Z)(n,[{key:"subMaterials",get:function(){return this._subMaterials},set:function(e){this._subMaterials=e,this._hookArray(e)}},{key:"getChildren",value:function(){return this.subMaterials}},{key:"_hookArray",value:function(e){var t=this,n=e.push;e.push=function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];var o=n.apply(e,r);return t._markAllSubMeshesAsTexturesDirty(),o};var i=e.splice;e.splice=function(n,r){var a=i.apply(e,[n,r]);return t._markAllSubMeshesAsTexturesDirty(),a}}},{key:"getSubMaterial",value:function(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]}},{key:"getActiveTextures",value:function(){var e;return(e=(0,s.Z)((0,c.Z)(n.prototype),"getActiveTextures",this).call(this)).concat.apply(e,(0,i.Z)(this.subMaterials.map((function(e){return e?e.getActiveTextures():[]}))))}},{key:"hasTexture",value:function(e){if((0,s.Z)((0,c.Z)(n.prototype),"hasTexture",this).call(this,e))return!0;for(var t=0;t<this.subMaterials.length;t++){var i;if(null!==(i=this.subMaterials[t])&&void 0!==i&&i.hasTexture(e))return!0}return!1}},{key:"getClassName",value:function(){return"MultiMaterial"}},{key:"isReadyForSubMesh",value:function(e,t,n){for(var i=0;i<this.subMaterials.length;i++){var r=this.subMaterials[i];if(r){if(r._storeEffectOnSubMeshes){if(!r.isReadyForSubMesh(e,t,n))return!1;continue}if(!r.isReady(e))return!1}}return!0}},{key:"clone",value:function(e,t){for(var i=new n(e,this.getScene()),r=0;r<this.subMaterials.length;r++){var a=null,o=this.subMaterials[r];a=t&&o?o.clone(e+"-"+o.name):this.subMaterials[r],i.subMaterials.push(a)}return i}},{key:"serialize",value:function(){var e={};e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,f.$&&(e.tags=f.$.GetTags(this)),e.materialsUniqueIds=[],e.materials=[];for(var t=0;t<this.subMaterials.length;t++){var n=this.subMaterials[t];n?(e.materialsUniqueIds.push(n.uniqueId),e.materials.push(n.id)):(e.materialsUniqueIds.push(null),e.materials.push(null))}return e}},{key:"dispose",value:function(e,t,i){var r=this.getScene();if(r){if(i)for(var a=0;a<this.subMaterials.length;a++){var o=this.subMaterials[a];o&&o.dispose(e,t)}var u=r.multiMaterials.indexOf(this);u>=0&&r.multiMaterials.splice(u,1),(0,s.Z)((0,c.Z)(n.prototype),"dispose",this).call(this,e,t)}}}],[{key:"ParseMultiMaterial",value:function(e,t){var i=new n(e.name,t);return i.id=e.id,i._loadedUniqueId=e.uniqueId,f.$&&f.$.AddTagsTo(i,e.tags),e.materialsUniqueIds?i._waitingSubMaterialsUniqueIds=e.materialsUniqueIds:e.materials.forEach((function(e){return i.subMaterials.push(t.getLastMaterialById(e))})),i}}]),n}(h.F);(0,d.H)("BABYLON.MultiMaterial",p)},2223:function(e,t,n){"use strict";var i;n.d(t,{x:function(){return i}}),function(e){e[e.GLSL=0]="GLSL",e[e.WGSL=1]="WGSL"}(i||(i={}))},1952:function(e,t,n){"use strict";n.d(t,{M:function(){return l}});var i=n(5671),r=n(3144),a=n(2328),o=n(8517),s=n(4796),u=n(2628);s.B.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");var n=new u.M(t);return this.bindUniformBuffer(n),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},s.B.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");var n=new u.M(t);return this.bindUniformBuffer(n),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},s.B.prototype.updateUniformBuffer=function(e,t,n,i){this.bindUniformBuffer(e),void 0===n&&(n=0),void 0===i?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,n,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,n,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(n,n+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(n,n+i)),this.bindUniformBuffer(null)},s.B.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},s.B.prototype.bindUniformBufferBase=function(e,t,n){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},s.B.prototype.bindUniformBlock=function(e,t,n){var i=e.program,r=this._gl.getUniformBlockIndex(i,t);4294967295!==r&&this._gl.uniformBlockBinding(i,r,n)};var l=function(){function e(t,n,r,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,i.Z)(this,e),this._valueCache={},this._engine=t,this._noUBO=!t.supportsUniformBuffers||o,this._dynamic=r,this._name=null!=a?a:"no-name",this._data=n||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform)}return(0,r.Z)(e,[{key:"useUbo",get:function(){return!this._noUBO}},{key:"isSync",get:function(){return!this._needSync}},{key:"isDynamic",value:function(){return void 0!==this._dynamic}},{key:"getData",value:function(){return this._bufferData}},{key:"getBuffer",value:function(){return this._buffer}},{key:"_fillAlignment",value:function(e){var t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){var n=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var i=this._uniformLocationPointer-n,r=0;r<i;r++)this._data.push(0)}}},{key:"addUniform",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[e]){var i;if(n>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:n},16==t)t*=n;else{var r=4-t,a=r*n;t=t*n+a}i=[];for(var o=0;o<t;o++)i.push(0)}else{if(t instanceof Array)t=(i=t).length;else{i=[];for(var s=0;s<t;s++)i.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(var u=0;u<t;u++)this._data.push(i[u]);this._needSync=!0}}},{key:"addMatrix",value:function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))}},{key:"addFloat2",value:function(e,t,n){var i=[t,n];this.addUniform(e,i)}},{key:"addFloat3",value:function(e,t,n,i){var r=[t,n,i];this.addUniform(e,r)}},{key:"addColor3",value:function(e,t){var n=[t.r,t.g,t.b];this.addUniform(e,n)}},{key:"addColor4",value:function(e,t,n){var i=[t.r,t.g,t.b,n];this.addUniform(e,i)}},{key:"addVector3",value:function(e,t){var n=[t.x,t.y,t.z];this.addUniform(e,n)}},{key:"addMatrix3x3",value:function(e){this.addUniform(e,12)}},{key:"addMatrix2x2",value:function(e){this.addUniform(e,8)}},{key:"create",value:function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}},{key:"_rebuild",value:function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}},{key:"_numBuffers",get:function(){return this._buffers.length}},{key:"_indexBuffer",get:function(){return this._bufferIndex}},{key:"name",get:function(){return this._name}},{key:"_buffersEqual",value:function(e,t){for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}},{key:"_copyBuffer",value:function(e,t){for(var n=0;n<e.length;++n)t[n]=e[n]}},{key:"update",value:function(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(e._UpdatedUbosInFrame[this._name]||(e._UpdatedUbosInFrame[this._name]=0),e._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}},{key:"_createNewBuffer",value:function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}},{key:"_checkNewFrame",value:function(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}},{key:"updateUniform",value:function(e,t,n){this._checkNewFrame();var i=this._uniformLocations[e];if(void 0===i){if(this._buffer)return void a.Y.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,n),i=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(var r=0;r<n;r++)this._bufferData[i+r]=t[r];else{for(var s=!1,u=0;u<n;u++)(16===n&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[i+u]!==o.w1.FloatRound(t[u]))&&(s=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[i+u]=t[u]);this._needSync=this._needSync||s}}},{key:"updateUniformArray",value:function(e,t,n){this._checkNewFrame();var i=this._uniformLocations[e];if(void 0!==i){this._buffer||this.create();var r=this._uniformArraySizes[e];if(this._dynamic)for(var s=0;s<n;s++)this._bufferData[i+s]=t[s];else{for(var u=!1,l=0,c=0,h=0;h<n;h++)if(this._bufferData[i+4*c+l]!==o.w1.FloatRound(t[h])&&(u=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[i+4*c+l]=t[h]),++l===r.strideSize){for(;l<4;l++)this._bufferData[i+4*c+l]=0;l=0,c++}this._needSync=this._needSync||u}}else a.Y.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform.")}},{key:"_cacheMatrix",value:function(e,t){this._checkNewFrame();var n=this._valueCache[e],i=t.updateFlag;return(void 0===n||n!==i)&&(this._valueCache[e]=i,!0)}},{key:"_updateMatrix3x3ForUniform",value:function(t,n){for(var i=0;i<3;i++)e._TempBuffer[4*i]=n[3*i],e._TempBuffer[4*i+1]=n[3*i+1],e._TempBuffer[4*i+2]=n[3*i+2],e._TempBuffer[4*i+3]=0;this.updateUniform(t,e._TempBuffer,12)}},{key:"_updateMatrix3x3ForEffect",value:function(e,t){this._currentEffect.setMatrix3x3(e,t)}},{key:"_updateMatrix2x2ForEffect",value:function(e,t){this._currentEffect.setMatrix2x2(e,t)}},{key:"_updateMatrix2x2ForUniform",value:function(t,n){for(var i=0;i<2;i++)e._TempBuffer[4*i]=n[2*i],e._TempBuffer[4*i+1]=n[2*i+1],e._TempBuffer[4*i+2]=0,e._TempBuffer[4*i+3]=0;this.updateUniform(t,e._TempBuffer,8)}},{key:"_updateFloatForEffect",value:function(e,t){this._currentEffect.setFloat(e,t)}},{key:"_updateFloatForUniform",value:function(t,n){e._TempBuffer[0]=n,this.updateUniform(t,e._TempBuffer,1)}},{key:"_updateFloat2ForEffect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(e+i,t,n)}},{key:"_updateFloat2ForUniform",value:function(t,n,i){e._TempBuffer[0]=n,e._TempBuffer[1]=i,this.updateUniform(t,e._TempBuffer,2)}},{key:"_updateFloat3ForEffect",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(e+r,t,n,i)}},{key:"_updateFloat3ForUniform",value:function(t,n,i,r){e._TempBuffer[0]=n,e._TempBuffer[1]=i,e._TempBuffer[2]=r,this.updateUniform(t,e._TempBuffer,3)}},{key:"_updateFloat4ForEffect",value:function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(e+a,t,n,i,r)}},{key:"_updateFloat4ForUniform",value:function(t,n,i,r,a){e._TempBuffer[0]=n,e._TempBuffer[1]=i,e._TempBuffer[2]=r,e._TempBuffer[3]=a,this.updateUniform(t,e._TempBuffer,4)}},{key:"_updateFloatArrayForEffect",value:function(e,t){this._currentEffect.setFloatArray(e,t)}},{key:"_updateFloatArrayForUniform",value:function(e,t){this.updateUniformArray(e,t,t.length)}},{key:"_updateArrayForEffect",value:function(e,t){this._currentEffect.setArray(e,t)}},{key:"_updateArrayForUniform",value:function(e,t){this.updateUniformArray(e,t,t.length)}},{key:"_updateIntArrayForEffect",value:function(e,t){this._currentEffect.setIntArray(e,t)}},{key:"_updateIntArrayForUniform",value:function(t,n){e._TempBufferInt32View.set(n),this.updateUniformArray(t,e._TempBuffer,n.length)}},{key:"_updateMatrixForEffect",value:function(e,t){this._currentEffect.setMatrix(e,t)}},{key:"_updateMatrixForUniform",value:function(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.toArray(),16)}},{key:"_updateMatricesForEffect",value:function(e,t){this._currentEffect.setMatrices(e,t)}},{key:"_updateMatricesForUniform",value:function(e,t){this.updateUniform(e,t,t.length)}},{key:"_updateVector3ForEffect",value:function(e,t){this._currentEffect.setVector3(e,t)}},{key:"_updateVector3ForUniform",value:function(t,n){e._TempBuffer[0]=n.x,e._TempBuffer[1]=n.y,e._TempBuffer[2]=n.z,this.updateUniform(t,e._TempBuffer,3)}},{key:"_updateVector4ForEffect",value:function(e,t){this._currentEffect.setVector4(e,t)}},{key:"_updateVector4ForUniform",value:function(t,n){e._TempBuffer[0]=n.x,e._TempBuffer[1]=n.y,e._TempBuffer[2]=n.z,e._TempBuffer[3]=n.w,this.updateUniform(t,e._TempBuffer,4)}},{key:"_updateColor3ForEffect",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(e+n,t)}},{key:"_updateColor3ForUniform",value:function(t,n){e._TempBuffer[0]=n.r,e._TempBuffer[1]=n.g,e._TempBuffer[2]=n.b,this.updateUniform(t,e._TempBuffer,3)}},{key:"_updateColor4ForEffect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(e+i,t,n)}},{key:"_updateDirectColor4ForEffect",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(e+n,t)}},{key:"_updateColor4ForUniform",value:function(t,n,i){e._TempBuffer[0]=n.r,e._TempBuffer[1]=n.g,e._TempBuffer[2]=n.b,e._TempBuffer[3]=i,this.updateUniform(t,e._TempBuffer,4)}},{key:"_updateDirectColor4ForUniform",value:function(t,n){e._TempBuffer[0]=n.r,e._TempBuffer[1]=n.g,e._TempBuffer[2]=n.b,e._TempBuffer[3]=n.a,this.updateUniform(t,e._TempBuffer,4)}},{key:"_updateIntForEffect",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(e+n,t)}},{key:"_updateIntForUniform",value:function(t,n){e._TempBufferInt32View[0]=n,this.updateUniform(t,e._TempBuffer,1)}},{key:"_updateInt2ForEffect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(e+i,t,n)}},{key:"_updateInt2ForUniform",value:function(t,n,i){e._TempBufferInt32View[0]=n,e._TempBufferInt32View[1]=i,this.updateUniform(t,e._TempBuffer,2)}},{key:"_updateInt3ForEffect",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(e+r,t,n,i)}},{key:"_updateInt3ForUniform",value:function(t,n,i,r){e._TempBufferInt32View[0]=n,e._TempBufferInt32View[1]=i,e._TempBufferInt32View[2]=r,this.updateUniform(t,e._TempBuffer,3)}},{key:"_updateInt4ForEffect",value:function(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(e+a,t,n,i,r)}},{key:"_updateInt4ForUniform",value:function(t,n,i,r,a){e._TempBufferInt32View[0]=n,e._TempBufferInt32View[1]=i,e._TempBufferInt32View[2]=r,e._TempBufferInt32View[3]=a,this.updateUniform(t,e._TempBuffer,4)}},{key:"setTexture",value:function(e,t){this._currentEffect.setTexture(e,t)}},{key:"updateUniformDirectly",value:function(e,t){this.updateUniform(e,t,t.length),this.update()}},{key:"bindToEffect",value:function(e,t){this._currentEffect=e,this._currentEffectName=t}},{key:"bindUniformBuffer",value:function(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}},{key:"unbindEffect",value:function(){this._currentEffect=void 0,this._currentEffectName=void 0}},{key:"setDataBuffer",value:function(e){if(!this._buffers)return this._buffer===e;for(var t=0;t<this._buffers.length;++t){if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}},{key:"dispose",value:function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(var n=0;n<this._buffers.length;++n){var i=this._buffers[n][0];this._engine._releaseBuffer(i)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}}]),e}();l._UpdatedUbosInFrame={},l._MAX_UNIFORM_SIZE=256,l._TempBuffer=new Float32Array(l._MAX_UNIFORM_SIZE),l._TempBufferInt32View=new Uint32Array(l._TempBuffer.buffer)},7702:function(e,t,n){"use strict";n.d(t,{RD:function(){return u},T:function(){return i}});var i,r=n(3144),a=n(5671),o=n(6900);!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD",e[e.BONE=2]="BONE"}(i||(i={}));var s,u=(0,r.Z)((function e(){(0,a.Z)(this,e)}));u.X=new o.P(1,0,0),u.Y=new o.P(0,1,0),u.Z=new o.P(0,0,1),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(s||(s={}))},7046:function(e,t,n){"use strict";n.d(t,{HE:function(){return c},Wo:function(){return l},zZ:function(){return h}});var i=n(5671),r=n(3144),a=n(5602),o=n(3681),s=n(8134),u=n(1704),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,i.Z)(this,e),this.r=t,this.g=n,this.b=r}return(0,r.Z)(e,[{key:"toString",value:function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}},{key:"getClassName",value:function(){return"Color3"}},{key:"getHashCode",value:function(){var e=255*this.r|0;return e=397*(e=397*e^(255*this.g|0))^(255*this.b|0)}},{key:"toArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this}},{key:"fromArray",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.FromArrayToRef(t,n,this),this}},{key:"toColor4",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new c(this.r,this.g,this.b,e)}},{key:"asArray",value:function(){return[this.r,this.g,this.b]}},{key:"toLuminance",value:function(){return.3*this.r+.59*this.g+.11*this.b}},{key:"multiply",value:function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)}},{key:"multiplyToRef",value:function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this}},{key:"equals",value:function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b}},{key:"equalsFloats",value:function(e,t,n){return this.r===e&&this.g===t&&this.b===n}},{key:"scale",value:function(t){return new e(this.r*t,this.g*t,this.b*t)}},{key:"scaleInPlace",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"scaleToRef",value:function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this}},{key:"scaleAndAddToRef",value:function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this}},{key:"clampToRef",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;return n.r=a.R.Clamp(this.r,e,t),n.g=a.R.Clamp(this.g,e,t),n.b=a.R.Clamp(this.b,e,t),this}},{key:"add",value:function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)}},{key:"addToRef",value:function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this}},{key:"subtract",value:function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)}},{key:"subtractToRef",value:function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this}},{key:"clone",value:function(){return new e(this.r,this.g,this.b)}},{key:"copyFrom",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copyFromFloats",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"set",value:function(e,t,n){return this.copyFromFloats(e,t,n)}},{key:"toHexString",value:function(){var e=Math.round(255*this.r),t=Math.round(255*this.g),n=Math.round(255*this.b);return"#"+a.R.ToHex(e)+a.R.ToHex(t)+a.R.ToHex(n)}},{key:"toLinearSpace",value:function(){var t=new e;return this.toLinearSpaceToRef(t),t}},{key:"toHSV",value:function(){var t=new e;return this.toHSVToRef(t),t}},{key:"toHSVToRef",value:function(e){var t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),a=Math.min(t,n,i),o=0,s=0,u=r,l=r-a;0!==r&&(s=l/r),r!=a&&(r==t?(o=(n-i)/l,n<i&&(o+=6)):r==n?o=(i-t)/l+2:r==i&&(o=(t-n)/l+4),o*=60),e.r=o,e.g=s,e.b=u}},{key:"toLinearSpaceToRef",value:function(e){return e.r=Math.pow(this.r,o.Nn),e.g=Math.pow(this.g,o.Nn),e.b=Math.pow(this.b,o.Nn),this}},{key:"toGammaSpace",value:function(){var t=new e;return this.toGammaSpaceToRef(t),t}},{key:"toGammaSpaceToRef",value:function(e){return e.r=Math.pow(this.r,o.zp),e.g=Math.pow(this.g,o.zp),e.b=Math.pow(this.b,o.zp),this}}],[{key:"HSVtoRGBToRef",value:function(e,t,n,i){var r=n*t,a=e/60,o=r*(1-Math.abs(a%2-1)),s=0,u=0,l=0;a>=0&&a<=1?(s=r,u=o):a>=1&&a<=2?(s=o,u=r):a>=2&&a<=3?(u=r,l=o):a>=3&&a<=4?(u=o,l=r):a>=4&&a<=5?(s=o,l=r):a>=5&&a<=6&&(s=r,l=o);var c=n-r;i.set(s+c,u+c,l+c)}},{key:"FromHSV",value:function(t,n,i){var r=new e(0,0,0);return e.HSVtoRGBToRef(t,n,i,r),r}},{key:"FromHexString",value:function(t){if("#"!==t.substring(0,1)||7!==t.length)return new e(0,0,0);var n=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16);return e.FromInts(n,i,r)}},{key:"FromArray",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new e(t[n],t[n+1],t[n+2])}},{key:"FromArrayToRef",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;n.r=e[t],n.g=e[t+1],n.b=e[t+2]}},{key:"FromInts",value:function(t,n,i){return new e(t/255,n/255,i/255)}},{key:"Lerp",value:function(t,n,i){var r=new e(0,0,0);return e.LerpToRef(t,n,i,r),r}},{key:"LerpToRef",value:function(e,t,n,i){i.r=e.r+(t.r-e.r)*n,i.g=e.g+(t.g-e.g)*n,i.b=e.b+(t.b-e.b)*n}},{key:"Hermite",value:function(t,n,i,r,a){var o=a*a,s=a*o,u=2*s-3*o+1,l=-2*s+3*o,c=s-2*o+a,h=s-o;return new e(t.r*u+i.r*l+n.r*c+r.r*h,t.g*u+i.g*l+n.g*c+r.g*h,t.b*u+i.b*l+n.b*c+r.b*h)}},{key:"Hermite1stDerivative",value:function(t,n,i,r,a){var o=e.Black();return this.Hermite1stDerivativeToRef(t,n,i,r,a,o),o}},{key:"Hermite1stDerivativeToRef",value:function(e,t,n,i,r,a){var o=r*r;a.r=6*(o-r)*e.r+(3*o-4*r+1)*t.r+6*(-o+r)*n.r+(3*o-2*r)*i.r,a.g=6*(o-r)*e.g+(3*o-4*r+1)*t.g+6*(-o+r)*n.g+(3*o-2*r)*i.g,a.b=6*(o-r)*e.b+(3*o-4*r+1)*t.b+6*(-o+r)*n.b+(3*o-2*r)*i.b}},{key:"Red",value:function(){return new e(1,0,0)}},{key:"Green",value:function(){return new e(0,1,0)}},{key:"Blue",value:function(){return new e(0,0,1)}},{key:"Black",value:function(){return new e(0,0,0)}},{key:"BlackReadOnly",get:function(){return e._BlackReadOnly}},{key:"White",value:function(){return new e(1,1,1)}},{key:"Purple",value:function(){return new e(.5,0,.5)}},{key:"Magenta",value:function(){return new e(1,0,1)}},{key:"Yellow",value:function(){return new e(1,1,0)}},{key:"Gray",value:function(){return new e(.5,.5,.5)}},{key:"Teal",value:function(){return new e(0,1,1)}},{key:"Random",value:function(){return new e(Math.random(),Math.random(),Math.random())}}]),e}();l._BlackReadOnly=l.Black();var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,i.Z)(this,e),this.r=t,this.g=n,this.b=r,this.a=a}return(0,r.Z)(e,[{key:"addInPlace",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}},{key:"asArray",value:function(){return[this.r,this.g,this.b,this.a]}},{key:"toArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this}},{key:"fromArray",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.FromArrayToRef(t,n,this),this}},{key:"equals",value:function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}},{key:"add",value:function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}},{key:"subtract",value:function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}},{key:"subtractToRef",value:function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this}},{key:"scale",value:function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)}},{key:"scaleInPlace",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}},{key:"scaleToRef",value:function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this}},{key:"scaleAndAddToRef",value:function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this}},{key:"clampToRef",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;return n.r=a.R.Clamp(this.r,e,t),n.g=a.R.Clamp(this.g,e,t),n.b=a.R.Clamp(this.b,e,t),n.a=a.R.Clamp(this.a,e,t),this}},{key:"multiply",value:function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}},{key:"multiplyToRef",value:function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t}},{key:"toString",value:function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}},{key:"getClassName",value:function(){return"Color4"}},{key:"getHashCode",value:function(){var e=255*this.r|0;return e=397*(e=397*(e=397*e^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)}},{key:"clone",value:function(){return new e(this.r,this.g,this.b,this.a)}},{key:"copyFrom",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}},{key:"copyFromFloats",value:function(e,t,n,i){return this.r=e,this.g=t,this.b=n,this.a=i,this}},{key:"set",value:function(e,t,n,i){return this.copyFromFloats(e,t,n,i)}},{key:"toHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Math.round(255*this.r),n=Math.round(255*this.g),i=Math.round(255*this.b);if(e)return"#"+a.R.ToHex(t)+a.R.ToHex(n)+a.R.ToHex(i);var r=Math.round(255*this.a);return"#"+a.R.ToHex(t)+a.R.ToHex(n)+a.R.ToHex(i)+a.R.ToHex(r)}},{key:"toLinearSpace",value:function(){var t=new e;return this.toLinearSpaceToRef(t),t}},{key:"toLinearSpaceToRef",value:function(e){return e.r=Math.pow(this.r,o.Nn),e.g=Math.pow(this.g,o.Nn),e.b=Math.pow(this.b,o.Nn),e.a=this.a,this}},{key:"toGammaSpace",value:function(){var t=new e;return this.toGammaSpaceToRef(t),t}},{key:"toGammaSpaceToRef",value:function(e){return e.r=Math.pow(this.r,o.zp),e.g=Math.pow(this.g,o.zp),e.b=Math.pow(this.b,o.zp),e.a=this.a,this}}],[{key:"FromHexString",value:function(t){if("#"!==t.substring(0,1)||9!==t.length&&7!==t.length)return new e(0,0,0,0);var n=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16),a=9===t.length?parseInt(t.substring(7,9),16):255;return e.FromInts(n,i,r,a)}},{key:"Lerp",value:function(t,n,i){var r=new e(0,0,0,0);return e.LerpToRef(t,n,i,r),r}},{key:"LerpToRef",value:function(e,t,n,i){i.r=e.r+(t.r-e.r)*n,i.g=e.g+(t.g-e.g)*n,i.b=e.b+(t.b-e.b)*n,i.a=e.a+(t.a-e.a)*n}},{key:"Hermite",value:function(t,n,i,r,a){var o=a*a,s=a*o,u=2*s-3*o+1,l=-2*s+3*o,c=s-2*o+a,h=s-o;return new e(t.r*u+i.r*l+n.r*c+r.r*h,t.g*u+i.g*l+n.g*c+r.g*h,t.b*u+i.b*l+n.b*c+r.b*h,t.a*u+i.a*l+n.a*c+r.a*h)}},{key:"Hermite1stDerivative",value:function(t,n,i,r,a){var o=new e;return this.Hermite1stDerivativeToRef(t,n,i,r,a,o),o}},{key:"Hermite1stDerivativeToRef",value:function(e,t,n,i,r,a){var o=r*r;a.r=6*(o-r)*e.r+(3*o-4*r+1)*t.r+6*(-o+r)*n.r+(3*o-2*r)*i.r,a.g=6*(o-r)*e.g+(3*o-4*r+1)*t.g+6*(-o+r)*n.g+(3*o-2*r)*i.g,a.b=6*(o-r)*e.b+(3*o-4*r+1)*t.b+6*(-o+r)*n.b+(3*o-2*r)*i.b,a.a=6*(o-r)*e.a+(3*o-4*r+1)*t.a+6*(-o+r)*n.a+(3*o-2*r)*i.a}},{key:"FromColor3",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new e(t.r,t.g,t.b,n)}},{key:"FromArray",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new e(t[n],t[n+1],t[n+2],t[n+3])}},{key:"FromArrayToRef",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;n.r=e[t],n.g=e[t+1],n.b=e[t+2],n.a=e[t+3]}},{key:"FromInts",value:function(t,n,i,r){return new e(t/255,n/255,i/255,r/255)}},{key:"CheckColors4",value:function(e,t){if(e.length===3*t){for(var n=[],i=0;i<e.length;i+=3){var r=i/3*4;n[r]=e[i],n[r+1]=e[i+1],n[r+2]=e[i+2],n[r+3]=1}return n}return e}}]),e}(),h=(0,r.Z)((function e(){(0,i.Z)(this,e)}));h.Color3=s.B.BuildArray(3,l.Black),h.Color4=s.B.BuildArray(3,(function(){return new c(0,0,0,0)})),(0,u.H)("BABYLON.Color3",l),(0,u.H)("BABYLON.Color4",c)},3681:function(e,t,n){"use strict";n.d(t,{Nn:function(){return r},kn:function(){return a},zp:function(){return i}});var i=1/2.2,r=2.2,a=(Math.sqrt(5),.001)},2465:function(e,t,n){"use strict";n.d(t,{i:function(){return o}});var i=n(5671),r=n(3144),a=n(3683),o=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"GetPlanes",value:function(t){for(var n=[],i=0;i<6;i++)n.push(new a.J(0,0,0,0));return e.GetPlanesToRef(t,n),n}},{key:"GetNearPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]+n[2],t.normal.y=n[7]+n[6],t.normal.z=n[11]+n[10],t.d=n[15]+n[14],t.normalize()}},{key:"GetFarPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]-n[2],t.normal.y=n[7]-n[6],t.normal.z=n[11]-n[10],t.d=n[15]-n[14],t.normalize()}},{key:"GetLeftPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]+n[0],t.normal.y=n[7]+n[4],t.normal.z=n[11]+n[8],t.d=n[15]+n[12],t.normalize()}},{key:"GetRightPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]-n[0],t.normal.y=n[7]-n[4],t.normal.z=n[11]-n[8],t.d=n[15]-n[12],t.normalize()}},{key:"GetTopPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]-n[1],t.normal.y=n[7]-n[5],t.normal.z=n[11]-n[9],t.d=n[15]-n[13],t.normalize()}},{key:"GetBottomPlaneToRef",value:function(e,t){var n=e.m;t.normal.x=n[3]+n[1],t.normal.y=n[7]+n[5],t.normal.z=n[11]+n[9],t.d=n[15]+n[13],t.normalize()}},{key:"GetPlanesToRef",value:function(t,n){e.GetNearPlaneToRef(t,n[0]),e.GetFarPlaneToRef(t,n[1]),e.GetLeftPlaneToRef(t,n[2]),e.GetRightPlaneToRef(t,n[3]),e.GetTopPlaneToRef(t,n[4]),e.GetBottomPlaneToRef(t,n[5])}}]),e}()},7721:function(e,t,n){"use strict";n.d(t,{k:function(){return c},y:function(){return l}});var i=n(5671),r=n(3144),a=n(9477),o=n(6900),s=n(9336),u=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"extractMinAndMaxIndexed",value:function(e,t,n,i,r,a){for(var o=n;o<n+i;o++){var s=3*t[o],u=e[s],l=e[s+1],c=e[s+2];r.minimizeInPlaceFromFloats(u,l,c),a.maximizeInPlaceFromFloats(u,l,c)}}},{key:"extractMinAndMax",value:function(e,t,n,i,r,a){for(var o=t,s=t*i;o<t+n;o++,s+=i){var u=e[s],l=e[s+1],c=e[s+2];r.minimizeInPlaceFromFloats(u,l,c),a.maximizeInPlaceFromFloats(u,l,c)}}}]),e}();function l(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return u.extractMinAndMaxIndexed(e,t,n,i,a,s),r&&(a.x-=a.x*r.x+r.y,a.y-=a.y*r.x+r.y,a.z-=a.z*r.x+r.y,s.x+=s.x*r.x+r.y,s.y+=s.y*r.x+r.y,s.z+=s.z*r.x+r.y),{minimum:a,maximum:s}}function c(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4?arguments[4]:void 0,a=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return r||(r=3),u.extractMinAndMax(e,t,n,r,a,s),i&&(a.x-=a.x*i.x+i.y,a.y-=a.y*i.x+i.y,a.z-=a.z*i.x+i.y,s.x+=s.x*i.x+i.y,s.y+=s.y*i.x+i.y,s.z+=s.z*i.x+i.y),{minimum:a,maximum:s}}(0,a.gn)([s.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0],r=t[1];return!Array.isArray(i)&&!Array.isArray(r)}))],u,"extractMinAndMaxIndexed",null),(0,a.gn)([s.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];return!Array.isArray(i)}))],u,"extractMinAndMax",null)},3683:function(e,t,n){"use strict";n.d(t,{J:function(){return o}});var i=n(5671),r=n(3144),a=n(6900),o=function(){function e(t,n,r,o){(0,i.Z)(this,e),this.normal=new a.P(t,n,r),this.d=o}return(0,r.Z)(e,[{key:"asArray",value:function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}},{key:"clone",value:function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)}},{key:"getClassName",value:function(){return"Plane"}},{key:"getHashCode",value:function(){var e=this.normal.getHashCode();return e=397*e^(0|this.d)}},{key:"normalize",value:function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}},{key:"transform",value:function(t){var n=e._TmpMatrix;t.invertToRef(n);var i=n.m,r=this.normal.x,a=this.normal.y,o=this.normal.z,s=this.d;return new e(r*i[0]+a*i[1]+o*i[2]+s*i[3],r*i[4]+a*i[5]+o*i[6]+s*i[7],r*i[8]+a*i[9]+o*i[10]+s*i[11],r*i[12]+a*i[13]+o*i[14]+s*i[15])}},{key:"dotCoordinate",value:function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}},{key:"copyFromPoints",value:function(e,t,n){var i,r=t.x-e.x,a=t.y-e.y,o=t.z-e.z,s=n.x-e.x,u=n.y-e.y,l=n.z-e.z,c=a*l-o*u,h=o*s-r*l,f=r*u-a*s,d=Math.sqrt(c*c+h*h+f*f);return i=0!==d?1/d:0,this.normal.x=c*i,this.normal.y=h*i,this.normal.z=f*i,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}},{key:"isFrontFacingTo",value:function(e,t){return a.P.Dot(this.normal,e)<=t}},{key:"signedDistanceTo",value:function(e){return a.P.Dot(e,this.normal)+this.d}}],[{key:"FromArray",value:function(t){return new e(t[0],t[1],t[2],t[3])}},{key:"FromPoints",value:function(t,n,i){var r=new e(0,0,0,0);return r.copyFromPoints(t,n,i),r}},{key:"FromPositionAndNormal",value:function(t,n){var i=new e(0,0,0,0);return n.normalize(),i.normal=n,i.d=-(n.x*t.x+n.y*t.y+n.z*t.z),i}},{key:"SignedDistanceToPlaneFromPositionAndNormal",value:function(e,t,n){var i=-(t.x*e.x+t.y*e.y+t.z*e.z);return a.P.Dot(n,t)+i}}]),e}();o._TmpMatrix=a.y3.Identity()},5602:function(e,t,n){"use strict";n.d(t,{R:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"WithinEpsilon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(e-t)<=n}},{key:"ToHex",value:function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()}},{key:"Sign",value:function(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1}},{key:"Clamp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(t,e))}},{key:"Log2",value:function(e){return Math.log(e)*Math.LOG2E}},{key:"ILog2",value:function(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;var t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t}},{key:"Repeat",value:function(e,t){return e-Math.floor(e/t)*t}},{key:"Normalize",value:function(e,t,n){return(e-t)/(n-t)}},{key:"Denormalize",value:function(e,t,n){return e*(n-t)+t}},{key:"DeltaAngle",value:function(t,n){var i=e.Repeat(n-t,360);return i>180&&(i-=360),i}},{key:"PingPong",value:function(t,n){var i=e.Repeat(t,2*n);return n-Math.abs(i-n)}},{key:"SmoothStep",value:function(t,n,i){var r=e.Clamp(i);return n*(r=-2*r*r*r+3*r*r)+t*(1-r)}},{key:"MoveTowards",value:function(t,n,i){return Math.abs(n-t)<=i?n:t+e.Sign(n-t)*i}},{key:"MoveTowardsAngle",value:function(t,n,i){var r=e.DeltaAngle(t,n),a=0;return-i<r&&r<i?a=n:(n=t+r,a=e.MoveTowards(t,n,i)),a}},{key:"Lerp",value:function(e,t,n){return e+(t-e)*n}},{key:"LerpAngle",value:function(t,n,i){var r=e.Repeat(n-t,360);return r>180&&(r-=360),t+r*e.Clamp(i)}},{key:"InverseLerp",value:function(t,n,i){return t!=n?e.Clamp((i-t)/(n-t)):0}},{key:"Hermite",value:function(e,t,n,i,r){var a=r*r,o=r*a;return e*(2*o-3*a+1)+n*(-2*o+3*a)+t*(o-2*a+r)+i*(o-a)}},{key:"Hermite1stDerivative",value:function(e,t,n,i,r){var a=r*r;return 6*(a-r)*e+(3*a-4*r+1)*t+6*(-a+r)*n+(3*a-2*r)*i}},{key:"RandomRange",value:function(e,t){return e===t?e:Math.random()*(t-e)+e}},{key:"RangeToPercent",value:function(e,t,n){return(e-t)/(n-t)}},{key:"PercentToRange",value:function(e,t,n){return(n-t)*e+t}},{key:"NormalizeRadians",value:function(t){return t-=e.TwoPi*Math.floor((t+Math.PI)/e.TwoPi)}},{key:"HCF",value:function(t,n){var i=t%n;return 0===i?n:e.HCF(n,i)}}]),e}();a.TwoPi=2*Math.PI},628:function(e,t,n){"use strict";n.d(t,{l:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(t,n,r,a){(0,i.Z)(this,e),this.x=t,this.y=n,this.width=r,this.height=a}return(0,r.Z)(e,[{key:"toGlobal",value:function(t,n){return new e(this.x*t,this.y*n,this.width*t,this.height*n)}},{key:"toGlobalToRef",value:function(e,t,n){return n.x=this.x*e,n.y=this.y*t,n.width=this.width*e,n.height=this.height*t,this}},{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}}]),e}()},2628:function(e,t,n){"use strict";n.d(t,{M:function(){return l}});var i=n(5671),r=n(3144),a=n(136),o=n(6215),s=n(1120);function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,s.Z)(e);if(t){var r=(0,s.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,o.Z)(this,n)}}var l=function(e){(0,a.Z)(n,e);var t=u(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this))._buffer=e,r}return(0,r.Z)(n,[{key:"underlyingResource",get:function(){return this._buffer}}]),n}(n(7818).h)},9370:function(e,t,n){"use strict";n.d(t,{x:function(){return k}});var i=n(7326),r=n(1752),a=n(136),o=n(6215),s=n(1120),u=n(3144),l=n(5671),c=n(4174),h=n(8911),f=n(6900),d=n(2977),v=n(2845),p=n(4527),_=n(2668),g=n(3541),m=n(9115),y=n(1952),A=(0,u.Z)((function e(){(0,l.Z)(this,e),this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new f.P(0,0,0),this._diffPositionForCollisions=new f.P(0,0,0),this._collisionResponse=!0})),E=n(5230),S=n(7721),T=n(7046),b=n(3681),P=n(7702),M=n(1704);function I(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,s.Z)(e);if(t){var r=(0,s.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,o.Z)(this,n)}}var R=(0,u.Z)((function e(){(0,l.Z)(this,e),this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=f.P.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1})),D=(0,u.Z)((function e(){(0,l.Z)(this,e),this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new R,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._meshCollisionData=new A,this._enableDistantPicking=!1})),k=function(e){(0,a.Z)(n,e);var t=x(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch((0,l.Z)(this,n),(r=t.call(this,e,a,!1))._internalAbstractMeshDataInfo=new D,r._waitingMaterialId=null,r.cullingStrategy=n.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,r.onCollideObservable=new c.y$,r.onCollisionPositionChangeObservable=new c.y$,r.onMaterialChangedObservable=new c.y$,r.definedFacingForward=!0,r._occlusionQuery=null,r._renderingGroup=null,r.alphaIndex=Number.MAX_VALUE,r.isVisible=!0,r.isPickable=!0,r.isNearPickable=!1,r.isNearGrabbable=!1,r.showSubMeshesBoundingBox=!1,r.isBlocker=!1,r.enablePointerMoveEvents=!1,r.outlineColor=T.Wo.Red(),r.outlineWidth=.02,r.overlayColor=T.Wo.Red(),r.overlayAlpha=.5,r.useOctreeForRenderingSelection=!0,r.useOctreeForPicking=!0,r.useOctreeForCollisions=!0,r.alwaysSelectAsActiveMesh=!1,r.doNotSyncBoundingInfo=!1,r.actionManager=null,r.ellipsoid=new f.P(.5,1,.5),r.ellipsoidOffset=new f.P(0,0,0),r.edgesWidth=1,r.edgesColor=new T.HE(1,0,0,1),r._edgesRenderer=null,r._masterMesh=null,r._boundingInfo=null,r._boundingInfoIsDirty=!0,r._renderId=0,r._intersectionsInProgress=new Array,r._unIndexed=!1,r._lightSources=new Array,r._waitingData={lods:null,actions:null,freezeWorldMatrix:null},r._bonesTransformMatrices=null,r._transformMatrixTexture=null,r.onRebuildObservable=new c.y$,r._onCollisionPositionChange=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.subtractToRef(r._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,r._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),r._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>d.D.CollisionsEpsilon&&r.position.addInPlace(r._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),n&&r.onCollideObservable.notifyObservers(n),r.onCollisionPositionChangeObservable.notifyObservers(r.position)},(a=r.getScene()).addMesh((0,i.Z)(r)),r._resyncLightSources(),r._uniformBuffer=new y.M(r.getScene().getEngine(),void 0,void 0,e,!r.getScene().getEngine().isWebGPU),r._buildUniformLayout(),a.performancePriority){case h.a.Aggressive:r.doNotSyncBoundingInfo=!0;case h.a.Intermediate:r.alwaysSelectAsActiveMesh=!0,r.isPickable=!1}return r}return(0,u.Z)(n,[{key:"facetNb",get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb}},{key:"partitioningSubdivisions",get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e}},{key:"partitioningBBoxRatio",get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e}},{key:"mustDepthSortFacets",get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e}},{key:"facetDepthSortFrom",get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e}},{key:"collisionRetryCount",get:function(){return this._internalAbstractMeshDataInfo._collisionRetryCount},set:function(e){this._internalAbstractMeshDataInfo._collisionRetryCount=e}},{key:"isFacetDataEnabled",get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}},{key:"morphTargetManager",get:function(){return this._internalAbstractMeshDataInfo._morphTargetManager},set:function(e){this._internalAbstractMeshDataInfo._morphTargetManager!==e&&(this._internalAbstractMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())}},{key:"bakedVertexAnimationManager",get:function(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager},set:function(e){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==e&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=e,this._markSubMeshesAsAttributesDirty())}},{key:"_syncGeometryWithMorphTargetManager",value:function(){}},{key:"_updateNonUniformScalingState",value:function(e){return!!(0,r.Z)((0,s.Z)(n.prototype),"_updateNonUniformScalingState",this).call(this,e)&&(this._markSubMeshesAsMiscDirty(),!0)}},{key:"onCollide",set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)}},{key:"onCollisionPositionChange",set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)}},{key:"visibility",get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(e){if(this._internalAbstractMeshDataInfo._visibility!==e){var t=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=e,(1===t&&1!==e||1!==t&&1===e)&&this._markSubMeshesAsMiscDirty()}}},{key:"renderingGroupId",get:function(){return this._internalAbstractMeshDataInfo._renderingGroupId},set:function(e){this._internalAbstractMeshDataInfo._renderingGroupId=e}},{key:"material",get:function(){return this._internalAbstractMeshDataInfo._material},set:function(e){this._internalAbstractMeshDataInfo._material!==e&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))}},{key:"getMaterialForRenderPass",value:function(e){var t;return null===(t=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===t?void 0:t[e]}},{key:"setMaterialForRenderPass",value:function(e,t){this.resetDrawCache(e),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[e]=t}},{key:"receiveShadows",get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())}},{key:"hasVertexAlpha",get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}},{key:"useVertexColors",get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())}},{key:"computeBonesUsingShaders",get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}},{key:"numBoneInfluencers",get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())}},{key:"applyFog",get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())}},{key:"enableDistantPicking",get:function(){return this._internalAbstractMeshDataInfo._enableDistantPicking},set:function(e){this._internalAbstractMeshDataInfo._enableDistantPicking=e}},{key:"layerMask",get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())}},{key:"collisionMask",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(e)?-1:e}},{key:"collisionResponse",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=e}},{key:"collisionGroup",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(e)?-1:e}},{key:"surroundingMeshes",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=e}},{key:"lightSources",get:function(){return this._lightSources}},{key:"_positions",get:function(){return null}},{key:"skeleton",get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(e){var t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}},{key:"_buildUniformLayout",value:function(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}},{key:"transferToEffect",value:function(e){var t=this._uniformBuffer;t.updateMatrix("world",e),t.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),t.update()}},{key:"getMeshUniformBuffer",value:function(){return this._uniformBuffer}},{key:"getClassName",value:function(){return"AbstractMesh"}},{key:"toString",value:function(e){var t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var n=this._internalAbstractMeshDataInfo._skeleton;return n&&(t+=", skeleton: "+n.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t}},{key:"_getEffectiveParent",value:function(){return this._masterMesh&&this.billboardMode!==_.Y.BILLBOARDMODE_NONE?this._masterMesh:(0,r.Z)((0,s.Z)(n.prototype),"_getEffectiveParent",this).call(this)}},{key:"_getActionManagerForTrigger",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}},{key:"_rebuild",value:function(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes){var e,t=I(this.subMeshes);try{for(t.s();!(e=t.n()).done;){var n=e.value;n._rebuild()}}catch(i){t.e(i)}finally{t.f()}}}},{key:"_resyncLightSources",value:function(){this._lightSources.length=0;var e,t=I(this.getScene().lights);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isEnabled()&&(n.canAffectMesh(this)&&this._lightSources.push(n))}}catch(i){t.e(i)}finally{t.f()}this._markSubMeshesAsLightDirty()}},{key:"_resyncLightSource",value:function(e){var t=e.isEnabled()&&e.canAffectMesh(this),n=this._lightSources.indexOf(e),i=!1;if(-1===n){if(!t)return;this._lightSources.push(e)}else{if(t)return;i=!0,this._lightSources.splice(n,1)}this._markSubMeshesAsLightDirty(i)}},{key:"_unBindEffect",value:function(){var e,t=I(this.subMeshes);try{for(t.s();!(e=t.n()).done;){e.value.setEffect(null)}}catch(n){t.e(n)}finally{t.f()}}},{key:"_removeLightSource",value:function(e,t){var n=this._lightSources.indexOf(e);-1!==n&&(this._lightSources.splice(n,1),this._markSubMeshesAsLightDirty(t))}},{key:"_markSubMeshesAsDirty",value:function(e){if(this.subMeshes){var t,n=I(this.subMeshes);try{for(n.s();!(t=n.n()).done;)for(var i=t.value,r=0;r<i._drawWrappers.length;++r){var a=i._drawWrappers[r];a&&a.defines&&a.defines.markAllAsDirty&&e(a.defines)}}catch(o){n.e(o)}finally{n.f()}}}},{key:"_markSubMeshesAsLightDirty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((function(t){return t.markAsLightDirty(e)}))}},{key:"_markSubMeshesAsAttributesDirty",value:function(){this._markSubMeshesAsDirty((function(e){return e.markAsAttributesDirty()}))}},{key:"_markSubMeshesAsMiscDirty",value:function(){this._markSubMeshesAsDirty((function(e){return e.markAsMiscDirty()}))}},{key:"markAsDirty",value:function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}},{key:"resetDrawCache",value:function(e){if(this.subMeshes){var t,n=I(this.subMeshes);try{for(n.s();!(t=n.n()).done;){t.value.resetDrawCache(e)}}catch(i){n.e(i)}finally{n.f()}}}},{key:"isBlocked",get:function(){return!1}},{key:"getLOD",value:function(e){return this}},{key:"getTotalVertices",value:function(){return 0}},{key:"getTotalIndices",value:function(){return 0}},{key:"getIndices",value:function(){return null}},{key:"getVerticesData",value:function(e){return null}},{key:"setVerticesData",value:function(e,t,n,i){return this}},{key:"updateVerticesData",value:function(e,t,n,i){return this}},{key:"setIndices",value:function(e,t){return this}},{key:"isVerticesDataPresent",value:function(e){return!1}},{key:"getBoundingInfo",value:function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}},{key:"setBoundingInfo",value:function(e){return this._boundingInfo=e,this}},{key:"hasBoundingInfo",get:function(){return null!==this._boundingInfo}},{key:"buildBoundingInfo",value:function(e,t,n){return this._boundingInfo=new m.j(e,t,n),this._boundingInfo}},{key:"normalizeToUnitCube",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;return(0,r.Z)((0,s.Z)(n.prototype),"normalizeToUnitCube",this).call(this,e,t,i)}},{key:"useBones",get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(v.o.MatricesIndicesKind)&&this.isVerticesDataPresent(v.o.MatricesWeightsKind)}},{key:"_preActivate",value:function(){}},{key:"_preActivateForIntermediateRendering",value:function(e){}},{key:"_activate",value:function(e,t){return this._renderId=e,!0}},{key:"_postActivate",value:function(){}},{key:"_freeze",value:function(){}},{key:"_unFreeze",value:function(){}},{key:"getWorldMatrix",value:function(){return this._masterMesh&&this.billboardMode===_.Y.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():(0,r.Z)((0,s.Z)(n.prototype),"getWorldMatrix",this).call(this)}},{key:"_getWorldMatrixDeterminant",value:function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():(0,r.Z)((0,s.Z)(n.prototype),"_getWorldMatrixDeterminant",this).call(this)}},{key:"isAnInstance",get:function(){return!1}},{key:"hasInstances",get:function(){return!1}},{key:"hasThinInstances",get:function(){return!1}},{key:"movePOV",value:function(e,t,n){return this.position.addInPlace(this.calcMovePOV(e,t,n)),this}},{key:"calcMovePOV",value:function(e,t,n){var i=new f.y3;(this.rotationQuaternion?this.rotationQuaternion:f._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(i);var r=f.P.Zero(),a=this.definedFacingForward?-1:1;return f.P.TransformCoordinatesFromFloatsToRef(e*a,t,n*a,i,r),r}},{key:"rotatePOV",value:function(e,t,n){return this.rotation.addInPlace(this.calcRotatePOV(e,t,n)),this}},{key:"calcRotatePOV",value:function(e,t,n){var i=this.definedFacingForward?1:-1;return new f.P(e*i,t,n*i)}},{key:"refreshBoundingInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(e,t),null),this}},{key:"_refreshBoundingInfo",value:function(e,t){if(e){var n=(0,S.k)(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new m.j(n.minimum,n.maximum)}if(this.subMeshes)for(var i=0;i<this.subMeshes.length;i++)this.subMeshes[i].refreshBoundingInfo(e);this._updateBoundingInfo()}},{key:"_getData",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.o.PositionKind;if((i=null!==(e=i)&&void 0!==e?e:this.getVerticesData(r).slice())&&n&&this.morphTargetManager)for(var a=0,o=0,s=0;s<i.length;s++){for(var u=0;u<this.morphTargetManager.numTargets;u++){var l=this.morphTargetManager.getTarget(u),c=l.influence;if(c>0){var h=l.getPositions();h&&(i[s]+=(h[s]-i[s])*c)}}if(a++,r===v.o.PositionKind&&this._positions&&3===a){a=0;var d=3*o;this._positions[o++].copyFromFloats(i[d],i[d+1],i[d+2])}}if(i&&t&&this.skeleton){var p=this.getVerticesData(v.o.MatricesIndicesKind),_=this.getVerticesData(v.o.MatricesWeightsKind);if(_&&p)for(var g=this.numBoneInfluencers>4,m=g?this.getVerticesData(v.o.MatricesIndicesExtraKind):null,y=g?this.getVerticesData(v.o.MatricesWeightsExtraKind):null,A=this.skeleton.getTransformMatrices(this),E=f.jp.Vector3[0],S=f.jp.Matrix[0],T=f.jp.Matrix[1],b=0,P=0;P<i.length;P+=3,b+=4){S.reset();var M=void 0,I=void 0;for(M=0;M<4;M++)(I=_[b+M])>0&&(f.y3.FromFloat32ArrayToRefScaled(A,Math.floor(16*p[b+M]),I,T),S.addToSelf(T));if(g)for(M=0;M<4;M++)(I=y[b+M])>0&&(f.y3.FromFloat32ArrayToRefScaled(A,Math.floor(16*m[b+M]),I,T),S.addToSelf(T));r===v.o.NormalKind?f.P.TransformNormalFromFloatsToRef(i[P],i[P+1],i[P+2],S,E):f.P.TransformCoordinatesFromFloatsToRef(i[P],i[P+1],i[P+2],S,E),E.toArray(i,P),r===v.o.PositionKind&&this._positions&&this._positions[P/3].copyFrom(E)}}return i}},{key:"getNormalsData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData(e,t,null,v.o.NormalKind)}},{key:"getPositionData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;return this._getData(e,t,n,v.o.PositionKind)}},{key:"_getPositionData",value:function(e,t){var n=this.getVerticesData(v.o.PositionKind);if(this._internalAbstractMeshDataInfo._positions&&(this._internalAbstractMeshDataInfo._positions=null),n&&(e&&this.skeleton||t&&this.morphTargetManager)){if(n=n.slice(),this._generatePointsArray(),this._positions){var i=this._positions;this._internalAbstractMeshDataInfo._positions=new Array(i.length);for(var r=0;r<i.length;r++){var a;this._internalAbstractMeshDataInfo._positions[r]=(null===(a=i[r])||void 0===a?void 0:a.clone())||new f.P}}return this.getPositionData(e,t,n)}return n}},{key:"_updateBoundingInfo",value:function(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new m.j(f.P.Zero(),f.P.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}},{key:"_updateSubMeshesBoundingInfo",value:function(e){if(!this.subMeshes)return this;for(var t=this.subMeshes.length,n=0;n<t;n++){var i=this.subMeshes[n];(t>1||!i.IsGlobal)&&i.updateBoundingInfo(e)}return this}},{key:"_afterComputeWorldMatrix",value:function(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}},{key:"isInFrustum",value:function(e){return this.getBoundingInfo().isInFrustum(e,this.cullingStrategy)}},{key:"isCompletelyInFrustum",value:function(e){return this.getBoundingInfo().isCompletelyInFrustum(e)}},{key:"intersectsMesh",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,i=this.getBoundingInfo(),r=e.getBoundingInfo();if(i.intersects(r,t))return!0;if(n){var a,o=I(this.getChildMeshes());try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.intersectsMesh(e,t,!0))return!0}}catch(u){o.e(u)}finally{o.f()}}return!1}},{key:"intersectsPoint",value:function(e){return this.getBoundingInfo().intersectsPoint(e)}},{key:"checkCollisions",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=e}},{key:"collider",get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}},{key:"moveWithCollisions",value:function(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);var t=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=t.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,e,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}},{key:"_collideForSubMesh",value:function(e,t,n){var i;if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var r=e.verticesStart,a=e.verticesStart+e.verticesCount,o=r;o<a;o++)e._lastColliderWorldVertices.push(f.P.TransformCoordinates(this._positions[o],t))}return n._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this,this._shouldConvertRHS(),7===(null===(i=e.getMaterial())||void 0===i?void 0:i.fillMode)),this}},{key:"_processCollisionsForSubMeshes",value:function(e,t){for(var n=this._scene.getCollidingSubMeshCandidates(this,e),i=n.length,r=0;r<i;r++){var a=n.data[r];i>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}return this}},{key:"_shouldConvertRHS",value:function(){return!1}},{key:"_checkCollision",value:function(e){if(!this.getBoundingInfo()._checkCollision(e))return this;var t=f.jp.Matrix[0],n=f.jp.Matrix[1];return f.y3.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,n),this._processCollisionsForSubMeshes(e,n),this}},{key:"_generatePointsArray",value:function(){return!1}},{key:"intersects",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=new g.p,s="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,u=this.getBoundingInfo();if(!this.subMeshes)return o;if(!(a||e.intersectsSphere(u.boundingSphere,s)&&e.intersectsBox(u.boundingBox,s)))return o;if(i)return o.hit=!a,o.pickedMesh=a?null:this,o.distance=a?0:f.P.Distance(e.origin,u.boundingSphere.center),o.subMeshId=0,o;if(!this._generatePointsArray())return o;for(var l=null,c=this._scene.getIntersectingSubMeshCandidates(this,e),h=c.length,d=!1,v=0;v<h;v++){var p=c.data[v],_=p.getMaterial();if(_&&(7==_.fillMode||0==_.fillMode||1==_.fillMode||2==_.fillMode||4==_.fillMode)){d=!0;break}}if(!d)return o.hit=!0,o.pickedMesh=this,o.distance=f.P.Distance(e.origin,u.boundingSphere.center),o.subMeshId=-1,o;for(var m=0;m<h;m++){var y=c.data[m];if(!(h>1)||y.canIntersects(e)){var A=y.intersects(e,this._positions,this.getIndices(),t,n);if(A&&(t||!l||A.distance<l.distance)&&((l=A).subMeshId=m,t))break}}if(l){var E=null!=r?r:this.getWorldMatrix(),S=f.jp.Vector3[0],T=f.jp.Vector3[1];f.P.TransformCoordinatesToRef(e.origin,E,S),e.direction.scaleToRef(l.distance,T);var b=f.P.TransformNormal(T,E),P=b.addInPlace(S);return o.hit=!0,o.distance=f.P.Distance(S,P),o.pickedPoint=P,o.pickedMesh=this,o.bu=l.bu||0,o.bv=l.bv||0,o.subMeshFaceId=l.faceId,o.faceId=l.faceId+c.data[l.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),o.subMeshId=l.subMeshId,o}return o}},{key:"clone",value:function(e,t,n){return null}},{key:"releaseSubMeshes",value:function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this}},{key:"dispose",value:function(e){var t,i=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),t=0;t<this._intersectionsInProgress.length;t++){var o=this._intersectionsInProgress[t],u=o._intersectionsInProgress.indexOf(this);o._intersectionsInProgress.splice(u,1)}this._intersectionsInProgress.length=0;var l=this.getScene().lights;l.forEach((function(e){var t=e.includedOnlyMeshes.indexOf(i);-1!==t&&e.includedOnlyMeshes.splice(t,1),-1!==(t=e.excludedMeshes.indexOf(i))&&e.excludedMeshes.splice(t,1);var n=e.getShadowGenerator();if(n){var r=n.getShadowMap();r&&r.renderList&&-1!==(t=r.renderList.indexOf(i))&&r.renderList.splice(t,1)}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var c=this.getScene().getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,c.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),c.wipeCaches(),this.getScene().removeMesh(this),this._parentContainer){var h=this._parentContainer.meshes.indexOf(this);h>-1&&this._parentContainer.meshes.splice(h,1),this._parentContainer=null}if(a&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(t=0;t<this.getScene().particleSystems.length;t++)this.getScene().particleSystems[t].emitter===this&&(this.getScene().particleSystems[t].dispose(),t--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),(0,r.Z)((0,s.Z)(n.prototype),"dispose",this).call(this,e,a)}},{key:"addChild",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.setParent(this,t),this}},{key:"removeChild",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.setParent(null,t),this}},{key:"_initFacetData",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=new Array),e.facetPositions||(e.facetPositions=new Array),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(var t=0;t<e.facetNb;t++)e.facetNormals[t]=f.P.Zero(),e.facetPositions[t]=f.P.Zero();return e.facetDataEnabled=!0,this}},{key:"updateFacetData",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();var t=this.getVerticesData(v.o.PositionKind),n=this.getIndices(),i=this.getVerticesData(v.o.NormalKind),r=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,n instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(n);else if(n instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(n);else{for(var a=!1,o=0;o<n.length;o++)if(n[o]>65535){a=!0;break}e.depthSortedIndices=a?new Uint32Array(n):new Uint16Array(n)}if(e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!e.facetDepthSortFrom){var s=this.getScene().activeCamera;e.facetDepthSortFrom=s?s.position:f.P.Zero()}e.depthSortedFacets=[];for(var u=0;u<e.facetNb;u++){var l={ind:3*u,sqDistance:0};e.depthSortedFacets.push(l)}e.invertedMatrix=f.y3.Identity(),e.facetDepthSortOrigin=f.P.Zero()}e.bbSize.x=r.maximum.x-r.minimum.x>b.kn?r.maximum.x-r.minimum.x:b.kn,e.bbSize.y=r.maximum.y-r.minimum.y>b.kn?r.maximum.y-r.minimum.y:b.kn,e.bbSize.z=r.maximum.z-r.minimum.z>b.kn?r.maximum.z-r.minimum.z:b.kn;var c=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(c=c>e.bbSize.z?c:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/c),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/c),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/c),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=r,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),f.P.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,i&&p.x.ComputeNormals(t,n,i,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);for(var h=e.depthSortedIndices.length/3|0,d=0;d<h;d++){var _=e.depthSortedFacets[d].ind;e.depthSortedIndices[3*d]=n[_],e.depthSortedIndices[3*d+1]=n[_+1],e.depthSortedIndices[3*d+2]=n[_+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this}},{key:"getFacetLocalNormals",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals}},{key:"getFacetLocalPositions",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions}},{key:"getFacetLocalPartitioning",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning}},{key:"getFacetPosition",value:function(e){var t=f.P.Zero();return this.getFacetPositionToRef(e,t),t}},{key:"getFacetPositionToRef",value:function(e,t){var n=this.getFacetLocalPositions()[e],i=this.getWorldMatrix();return f.P.TransformCoordinatesToRef(n,i,t),this}},{key:"getFacetNormal",value:function(e){var t=f.P.Zero();return this.getFacetNormalToRef(e,t),t}},{key:"getFacetNormalToRef",value:function(e,t){var n=this.getFacetLocalNormals()[e];return f.P.TransformNormalToRef(n,this.getWorldMatrix(),t),this}},{key:"getFacetsAtLocalCoordinates",value:function(e,t,n){var i=this.getBoundingInfo(),r=this._internalAbstractMeshDataInfo._facetData,a=Math.floor((e-i.minimum.x*r.partitioningBBoxRatio)*r.subDiv.X*r.partitioningBBoxRatio/r.bbSize.x),o=Math.floor((t-i.minimum.y*r.partitioningBBoxRatio)*r.subDiv.Y*r.partitioningBBoxRatio/r.bbSize.y),s=Math.floor((n-i.minimum.z*r.partitioningBBoxRatio)*r.subDiv.Z*r.partitioningBBoxRatio/r.bbSize.z);return a<0||a>r.subDiv.max||o<0||o>r.subDiv.max||s<0||s>r.subDiv.max?null:r.facetPartitioning[a+r.subDiv.max*o+r.subDiv.max*r.subDiv.max*s]}},{key:"getClosestFacetAtCoordinates",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=this.getWorldMatrix(),s=f.jp.Matrix[5];o.invertToRef(s);var u=f.jp.Vector3[8];f.P.TransformCoordinatesFromFloatsToRef(e,t,n,s,u);var l=this.getClosestFacetAtLocalCoordinates(u.x,u.y,u.z,i,r,a);return i&&f.P.TransformCoordinatesFromFloatsToRef(i.x,i.y,i.z,o,i),l}},{key:"getClosestFacetAtLocalCoordinates",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=null,s=0,u=0,l=0,c=0,h=0,f=0,d=0,v=0,p=this.getFacetLocalPositions(),_=this.getFacetLocalNormals(),g=this.getFacetsAtLocalCoordinates(e,t,n);if(!g)return null;for(var m,y,A,E=Number.MAX_VALUE,S=E,T=0;T<g.length;T++)y=_[m=g[T]],c=(e-(A=p[m]).x)*y.x+(t-A.y)*y.y+(n-A.z)*y.z,(!r||r&&a&&c>=0||r&&!a&&c<=0)&&(c=y.x*A.x+y.y*A.y+y.z*A.z,h=-(y.x*e+y.y*t+y.z*n-c)/(y.x*y.x+y.y*y.y+y.z*y.z),(S=(s=(f=e+y.x*h)-e)*s+(u=(d=t+y.y*h)-t)*u+(l=(v=n+y.z*h)-n)*l)<E&&(E=S,o=m,i&&(i.x=f,i.y=d,i.z=v)));return o}},{key:"getFacetDataParameters",value:function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}},{key:"disableFacetData",value:function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=new Array,e.facetNormals=new Array,e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this}},{key:"updateIndices",value:function(e,t){return this}},{key:"createNormals",value:function(e){var t,n=this.getVerticesData(v.o.PositionKind),i=this.getIndices();return t=this.isVerticesDataPresent(v.o.NormalKind)?this.getVerticesData(v.o.NormalKind):[],p.x.ComputeNormals(n,i,t,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(v.o.NormalKind,t,e),this}},{key:"alignWithNormal",value:function(e,t){t||(t=P.RD.Y);var n=f.jp.Vector3[0],i=f.jp.Vector3[1];return f.P.CrossToRef(t,e,i),f.P.CrossToRef(e,i,n),this.rotationQuaternion?f._f.RotationQuaternionFromAxisToRef(n,e,i,this.rotationQuaternion):f.P.RotationFromAxisToRef(n,e,i,this.rotation),this}},{key:"_checkOcclusionQuery",value:function(){return!1}},{key:"disableEdgesRendering",value:function(){throw(0,E.S)("EdgesRenderer")}},{key:"enableEdgesRendering",value:function(e,t,n){throw(0,E.S)("EdgesRenderer")}},{key:"getConnectedParticleSystems",value:function(){var e=this;return this._scene.particleSystems.filter((function(t){return t.emitter===e}))}}],[{key:"BILLBOARDMODE_NONE",get:function(){return _.Y.BILLBOARDMODE_NONE}},{key:"BILLBOARDMODE_X",get:function(){return _.Y.BILLBOARDMODE_X}},{key:"BILLBOARDMODE_Y",get:function(){return _.Y.BILLBOARDMODE_Y}},{key:"BILLBOARDMODE_Z",get:function(){return _.Y.BILLBOARDMODE_Z}},{key:"BILLBOARDMODE_ALL",get:function(){return _.Y.BILLBOARDMODE_ALL}},{key:"BILLBOARDMODE_USE_POSITION",get:function(){return _.Y.BILLBOARDMODE_USE_POSITION}}]),n}(_.Y);k.OCCLUSION_TYPE_NONE=0,k.OCCLUSION_TYPE_OPTIMISTIC=1,k.OCCLUSION_TYPE_STRICT=2,k.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,k.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,k.CULLINGSTRATEGY_STANDARD=0,k.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,k.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,k.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,M.H)("BABYLON.AbstractMesh",k)},7662:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var i=n(5671),r=n(3144),a=n(6900),o=n(7046),s=n(4527),u=n(2845),l=n(65),c=n(6639),h=n(9115),f=n(8517),d=n(7032),v=n(7721),p=n(4198),_=n(6176);function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var y=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,i.Z)(this,e),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=n||p.l.LastCreatedScene,this._scene&&(this.id=t,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=a,r?this.setAllVerticesData(r,a):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0)))}return(0,r.Z)(e,[{key:"boundingBias",get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)}},{key:"meshes",get:function(){return this._meshes}},{key:"extend",get:function(){return this._extend}},{key:"getScene",value:function(){return this._scene}},{key:"getEngine",value:function(){return this._engine}},{key:"isReady",value:function(){return 1===this.delayLoadState||0===this.delayLoadState}},{key:"doNotSerialize",get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0}},{key:"_rebuild",value:function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),this._vertexBuffers){this._vertexBuffers[e]._rebuild()}}},{key:"setAllVerticesData",value:function(e,t){e.applyToGeometry(this,t),this._notifyUpdate()}},{key:"setVerticesData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;n&&Array.isArray(t)&&(t=new Float32Array(t));var r=new u.o(this._engine,t,e,n,0===this._meshes.length,i);this.setVerticesBuffer(r)}},{key:"removeVerticesData",value:function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}},{key:"setVerticesBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.getKind();this._vertexBuffers[i]&&n&&this._vertexBuffers[i].dispose(),e._buffer&&e._buffer._increaseReferences(),this._vertexBuffers[i]=e;var r=this._meshes,a=r.length;if(i===u.o.PositionKind){var o=e.getData();null!=t?this._totalVertices=t:null!=o&&(this._totalVertices=o.length/(e.type===u.o.BYTE?e.byteStride:e.byteStride/4)),this._updateExtend(o),this._resetPointsArrayCache();for(var s=0;s<a;s++){var l=r[s];l.buildBoundingInfo(this._extend.minimum,this._extend.maximum),l._createGlobalSubMesh(l.isUnIndexed),l.computeWorldMatrix(!0),l.synchronizeInstances()}}this._notifyUpdate(i)}},{key:"updateVerticesDataDirectly",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,n,i),this._notifyUpdate(e))}},{key:"updateVerticesData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.getVertexBuffer(e);i&&(i.update(t),e===u.o.PositionKind&&this._updateBoundingInfo(n,t),this._notifyUpdate(e))}},{key:"_updateBoundingInfo",value:function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e){var n,i=g(this._meshes);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.hasBoundingInfo?r.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):r.buildBoundingInfo(this._extend.minimum,this._extend.maximum);var a,o=g(r.subMeshes);try{for(o.s();!(a=o.n()).done;){a.value.refreshBoundingInfo()}}catch(s){o.e(s)}finally{o.f()}}}catch(s){i.e(s)}finally{i.f()}}}},{key:"_bind",value:function(e,t,n,i){if(e){void 0===t&&(t=this._indexBuffer);var r=this.getVertexBuffers();if(r)if(t==this._indexBuffer&&(this._vertexArrayObjects||i)){var a=i||this._vertexArrayObjects;a[e.key]||(a[e.key]=this._engine.recordVertexArrayObject(r,t,e,n)),this._engine.bindVertexArrayObject(a[e.key],t)}else this._engine.bindBuffers(r,t,e,n)}}},{key:"getTotalVertices",value:function(){return this.isReady()?this._totalVertices:0}},{key:"getVerticesData",value:function(e,t,n){var i=this.getVertexBuffer(e);return i?i.getFloatData(this._totalVertices,n||t&&1!==this._meshes.length):null}},{key:"isVertexBufferUpdatable",value:function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()}},{key:"getVertexBuffer",value:function(e){return this.isReady()?this._vertexBuffers[e]:null}},{key:"getVertexBuffers",value:function(){return this.isReady()?this._vertexBuffers:null}},{key:"isVerticesDataPresent",value:function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}},{key:"getVerticesDataKinds",value:function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t}},{key:"updateIndices",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){var i=e.length!==this._indices.length;if(n||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),i){var r,a=g(this._meshes);try{for(a.s();!(r=a.n()).done;){var o=r.value;o._createGlobalSubMesh(!0)}}catch(s){a.e(s)}finally{a.f()}}}else this.setIndices(e,null,!0)}},{key:"setIndices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,this._indexBufferIsUpdatable=n,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,n)),null!=t&&(this._totalVertices=t);var i,r=g(this._meshes);try{for(r.s();!(i=r.n()).done;){var a=i.value;a._createGlobalSubMesh(!0),a.synchronizeInstances()}}catch(o){r.e(o)}finally{r.f()}this._notifyUpdate()}},{key:"getTotalIndices",value:function(){return this.isReady()?this._indices.length:0}},{key:"getIndices",value:function(e,t){if(!this.isReady())return null;var n=this._indices;return t||e&&1!==this._meshes.length?n.slice():n}},{key:"getIndexBuffer",value:function(){return this.isReady()?this._indexBuffer:null}},{key:"_releaseVertexArrayObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])}},{key:"releaseForMesh",value:function(e,t){var n=this._meshes,i=n.indexOf(e);-1!==i&&(n.splice(i,1),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject(),e._geometry=null,0===n.length&&t&&this.dispose())}},{key:"applyToMesh",value:function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject();var n=this._meshes;e._geometry=this,e._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),n.push(e),this.isReady()?this._applyToMesh(e):this._boundingInfo&&e.setBoundingInfo(this._boundingInfo)}}},{key:"_updateExtend",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!e&&!(e=this.getVerticesData(u.o.PositionKind)))return;this._extend=(0,v.k)(e,0,this._totalVertices,this.boundingBias,3)}}},{key:"_applyToMesh",value:function(e){var t=this._meshes.length;for(var n in this._vertexBuffers)1===t&&this._vertexBuffers[n].create(),n===u.o.PositionKind&&(this._extend||this._updateExtend(),e.buildBoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(e.isUnIndexed),e._updateBoundingInfo());1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()}},{key:"_notifyUpdate",value:function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e),this._vertexArrayObjects&&this._disposeVertexArrayObjects();var t,n=g(this._meshes);try{for(n.s();!(t=n.n()).done;){t.value._markSubMeshesAsAttributesDirty()}}catch(i){n.e(i)}finally{n.f()}}},{key:"load",value:function(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))}},{key:"_queueLoad",value:function(e,t){var n=this;this.delayLoadingFile&&(e.addPendingData(this),e._loadFile(this.delayLoadingFile,(function(i){if(n._delayLoadingFunction){n._delayLoadingFunction(JSON.parse(i),n),n.delayLoadState=1,n._delayInfo=[],e.removePendingData(n);for(var r=n._meshes,a=r.length,o=0;o<a;o++)n._applyToMesh(r[o]);t&&t()}}),void 0,!0))}},{key:"toLeftHanded",value:function(){var e=this.getIndices(!1);if(null!=e&&e.length>0){for(var t=0;t<e.length;t+=3){var n=e[t+0];e[t+0]=e[t+2],e[t+2]=n}this.setIndices(e)}var i=this.getVerticesData(u.o.PositionKind,!1);if(null!=i&&i.length>0){for(var r=0;r<i.length;r+=3)i[r+2]=-i[r+2];this.setVerticesData(u.o.PositionKind,i,!1)}var a=this.getVerticesData(u.o.NormalKind,!1);if(null!=a&&a.length>0){for(var o=0;o<a.length;o+=3)a[o+2]=-a[o+2];this.setVerticesData(u.o.NormalKind,a,!1)}}},{key:"_resetPointsArrayCache",value:function(){this._positions=null}},{key:"_generatePointsArray",value:function(){if(this._positions)return!0;var e=this.getVerticesData(u.o.PositionKind);if(!e||0===e.length)return!1;for(var t=3*this._positionsCache.length,n=this._positionsCache.length;t<e.length;t+=3,++n)this._positionsCache[n]=a.P.FromArray(e,t);for(var i=0,r=0;i<e.length;i+=3,++r)this._positionsCache[r].set(e[0+i],e[1+i],e[2+i]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0}},{key:"isDisposed",value:function(){return this._isDisposed}},{key:"_disposeVertexArrayObjects",value:function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={};for(var t=this._meshes,n=t.length,i=0;i<n;i++)t[i]._invalidateInstanceVertexArrayObject()}}},{key:"dispose",value:function(){var e,t=this._meshes,n=t.length;for(e=0;e<n;e++)this.releaseForMesh(t[e]);for(var i in this._meshes.length=0,this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[i].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){var r=this._parentContainer.geometries.indexOf(this);r>-1&&this._parentContainer.geometries.splice(r,1),this._parentContainer=null}this._isDisposed=!0}},{key:"copy",value:function(t){var n=new s.x;n.indices=[];var i=this.getIndices();if(i)for(var r=0;r<i.length;r++)n.indices.push(i[r]);var a,o=!1,u=!1;for(a in this._vertexBuffers){var l=this.getVerticesData(a);if(l&&(l instanceof Float32Array?n.set(new Float32Array(l),a):n.set(l.slice(0),a),!u)){var c=this.getVertexBuffer(a);c&&(u=!(o=c.isUpdatable()))}}var f=new e(t,this._scene,n,o);for(a in f.delayLoadState=this.delayLoadState,f.delayLoadingFile=this.delayLoadingFile,f._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)f._delayInfo=f._delayInfo||[],f._delayInfo.push(a);return f._boundingInfo=new h.j(this._extend.minimum,this._extend.maximum),f}},{key:"serialize",value:function(){var e={};return e.id=this.id,e.uniqueId=this.uniqueId,e.updatable=this._updatable,d.$&&d.$.HasTags(this)&&(e.tags=d.$.GetTags(this)),e}},{key:"_toNumberArray",value:function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)}},{key:"clearCachedData",value:function(){for(var e in this._indices=[],this._resetPointsArrayCache(),this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,e)&&(this._vertexBuffers[e]._buffer._data=null)}},{key:"serializeVerticeData",value:function(){var e=this.serialize();return this.isVerticesDataPresent(u.o.PositionKind)&&(e.positions=this._toNumberArray(this.getVerticesData(u.o.PositionKind)),this.isVertexBufferUpdatable(u.o.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(u.o.NormalKind)&&(e.normals=this._toNumberArray(this.getVerticesData(u.o.NormalKind)),this.isVertexBufferUpdatable(u.o.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(u.o.TangentKind)&&(e.tangents=this._toNumberArray(this.getVerticesData(u.o.TangentKind)),this.isVertexBufferUpdatable(u.o.TangentKind)&&(e.tangents._updatable=!0)),this.isVerticesDataPresent(u.o.UVKind)&&(e.uvs=this._toNumberArray(this.getVerticesData(u.o.UVKind)),this.isVertexBufferUpdatable(u.o.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(u.o.UV2Kind)&&(e.uv2s=this._toNumberArray(this.getVerticesData(u.o.UV2Kind)),this.isVertexBufferUpdatable(u.o.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(u.o.UV3Kind)&&(e.uv3s=this._toNumberArray(this.getVerticesData(u.o.UV3Kind)),this.isVertexBufferUpdatable(u.o.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(u.o.UV4Kind)&&(e.uv4s=this._toNumberArray(this.getVerticesData(u.o.UV4Kind)),this.isVertexBufferUpdatable(u.o.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(u.o.UV5Kind)&&(e.uv5s=this._toNumberArray(this.getVerticesData(u.o.UV5Kind)),this.isVertexBufferUpdatable(u.o.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(u.o.UV6Kind)&&(e.uv6s=this._toNumberArray(this.getVerticesData(u.o.UV6Kind)),this.isVertexBufferUpdatable(u.o.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(u.o.ColorKind)&&(e.colors=this._toNumberArray(this.getVerticesData(u.o.ColorKind)),this.isVertexBufferUpdatable(u.o.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(u.o.MatricesIndicesKind)&&(e.matricesIndices=this._toNumberArray(this.getVerticesData(u.o.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(u.o.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(u.o.MatricesWeightsKind)&&(e.matricesWeights=this._toNumberArray(this.getVerticesData(u.o.MatricesWeightsKind)),this.isVertexBufferUpdatable(u.o.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this._toNumberArray(this.getIndices()),e}}],[{key:"CreateGeometryForMesh",value:function(t){var n=new e(e.RandomId(),t.getScene());return n.applyToMesh(t),n}},{key:"ExtractFromMesh",value:function(e,t){var n=e._geometry;return n?n.copy(t):null}},{key:"RandomId",value:function(){return f.w1.RandomId()}},{key:"_GetGeometryByLoadedUniqueId",value:function(e,t){for(var n=0;n<t.geometries.length;n++)if(t.geometries[n]._loadedUniqueId===e)return t.geometries[n];return null}},{key:"_ImportGeometry",value:function(t,n){var i=n.getScene(),r=t.geometryUniqueId,a=t.geometryId;if(r||a){var s=r?this._GetGeometryByLoadedUniqueId(r,i):i.getGeometryById(a);s&&s.applyToMesh(n)}else if(t instanceof ArrayBuffer){var c=n._binaryInfo;if(c.positionsAttrDesc&&c.positionsAttrDesc.count>0){var h=new Float32Array(t,c.positionsAttrDesc.offset,c.positionsAttrDesc.count);n.setVerticesData(u.o.PositionKind,h,!1)}if(c.normalsAttrDesc&&c.normalsAttrDesc.count>0){var f=new Float32Array(t,c.normalsAttrDesc.offset,c.normalsAttrDesc.count);n.setVerticesData(u.o.NormalKind,f,!1)}if(c.tangetsAttrDesc&&c.tangetsAttrDesc.count>0){var d=new Float32Array(t,c.tangetsAttrDesc.offset,c.tangetsAttrDesc.count);n.setVerticesData(u.o.TangentKind,d,!1)}if(c.uvsAttrDesc&&c.uvsAttrDesc.count>0){var v=new Float32Array(t,c.uvsAttrDesc.offset,c.uvsAttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var p=1;p<v.length;p+=2)v[p]=1-v[p];n.setVerticesData(u.o.UVKind,v,!1)}if(c.uvs2AttrDesc&&c.uvs2AttrDesc.count>0){var g=new Float32Array(t,c.uvs2AttrDesc.offset,c.uvs2AttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var m=1;m<g.length;m+=2)g[m]=1-g[m];n.setVerticesData(u.o.UV2Kind,g,!1)}if(c.uvs3AttrDesc&&c.uvs3AttrDesc.count>0){var y=new Float32Array(t,c.uvs3AttrDesc.offset,c.uvs3AttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var A=1;A<y.length;A+=2)y[A]=1-y[A];n.setVerticesData(u.o.UV3Kind,y,!1)}if(c.uvs4AttrDesc&&c.uvs4AttrDesc.count>0){var E=new Float32Array(t,c.uvs4AttrDesc.offset,c.uvs4AttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var S=1;S<E.length;S+=2)E[S]=1-E[S];n.setVerticesData(u.o.UV4Kind,E,!1)}if(c.uvs5AttrDesc&&c.uvs5AttrDesc.count>0){var T=new Float32Array(t,c.uvs5AttrDesc.offset,c.uvs5AttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var b=1;b<T.length;b+=2)T[b]=1-T[b];n.setVerticesData(u.o.UV5Kind,T,!1)}if(c.uvs6AttrDesc&&c.uvs6AttrDesc.count>0){var P=new Float32Array(t,c.uvs6AttrDesc.offset,c.uvs6AttrDesc.count);if(_.e.UseOpenGLOrientationForUV)for(var M=1;M<P.length;M+=2)P[M]=1-P[M];n.setVerticesData(u.o.UV6Kind,P,!1)}if(c.colorsAttrDesc&&c.colorsAttrDesc.count>0){var I=new Float32Array(t,c.colorsAttrDesc.offset,c.colorsAttrDesc.count);n.setVerticesData(u.o.ColorKind,I,!1,c.colorsAttrDesc.stride)}if(c.matricesIndicesAttrDesc&&c.matricesIndicesAttrDesc.count>0){for(var C=new Int32Array(t,c.matricesIndicesAttrDesc.offset,c.matricesIndicesAttrDesc.count),x=[],R=0;R<C.length;R++){var D=C[R];x.push(255&D),x.push((65280&D)>>8),x.push((16711680&D)>>16),x.push(D>>24&255)}n.setVerticesData(u.o.MatricesIndicesKind,x,!1)}if(c.matricesIndicesExtraAttrDesc&&c.matricesIndicesExtraAttrDesc.count>0){for(var k=new Int32Array(t,c.matricesIndicesExtraAttrDesc.offset,c.matricesIndicesExtraAttrDesc.count),O=[],L=0;L<k.length;L++){var F=k[L];O.push(255&F),O.push((65280&F)>>8),O.push((16711680&F)>>16),O.push(F>>24&255)}n.setVerticesData(u.o.MatricesIndicesExtraKind,O,!1)}if(c.matricesWeightsAttrDesc&&c.matricesWeightsAttrDesc.count>0){var N=new Float32Array(t,c.matricesWeightsAttrDesc.offset,c.matricesWeightsAttrDesc.count);n.setVerticesData(u.o.MatricesWeightsKind,N,!1)}if(c.indicesAttrDesc&&c.indicesAttrDesc.count>0){var w=new Int32Array(t,c.indicesAttrDesc.offset,c.indicesAttrDesc.count);n.setIndices(w,null)}if(c.subMeshesAttrDesc&&c.subMeshesAttrDesc.count>0){var B=new Int32Array(t,c.subMeshesAttrDesc.offset,5*c.subMeshesAttrDesc.count);n.subMeshes=[];for(var U=0;U<c.subMeshesAttrDesc.count;U++){var V=B[5*U+0],G=B[5*U+1],W=B[5*U+2],X=B[5*U+3],H=B[5*U+4];l.P.AddToMesh(V,G,W,X,H,n)}}}else if(t.positions&&t.normals&&t.indices){if(n.setVerticesData(u.o.PositionKind,t.positions,t.positions._updatable),n.setVerticesData(u.o.NormalKind,t.normals,t.normals._updatable),t.tangents&&n.setVerticesData(u.o.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&n.setVerticesData(u.o.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&n.setVerticesData(u.o.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&n.setVerticesData(u.o.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&n.setVerticesData(u.o.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&n.setVerticesData(u.o.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&n.setVerticesData(u.o.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&n.setVerticesData(u.o.ColorKind,o.HE.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,n.setVerticesData(u.o.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{for(var z=[],Z=0;Z<t.matricesIndices.length;Z++){var K=t.matricesIndices[Z];z.push(255&K),z.push((65280&K)>>8),z.push((16711680&K)>>16),z.push(K>>24&255)}n.setVerticesData(u.o.MatricesIndicesKind,z,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,n.setVerticesData(u.o.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{for(var Y=[],q=0;q<t.matricesIndicesExtra.length;q++){var j=t.matricesIndicesExtra[q];Y.push(255&j),Y.push((65280&j)>>8),Y.push((16711680&j)>>16),Y.push(j>>24&255)}n.setVerticesData(u.o.MatricesIndicesExtraKind,Y,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(e._CleanMatricesWeights(t,n),n.setVerticesData(u.o.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&n.setVerticesData(u.o.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),n.setIndices(t.indices,null)}if(t.subMeshes){n.subMeshes=[];for(var Q=0;Q<t.subMeshes.length;Q++){var $=t.subMeshes[Q];l.P.AddToMesh($.materialIndex,$.verticesStart,$.verticesCount,$.indexStart,$.indexCount,n)}}n._shouldGenerateFlatShading&&(n.convertToFlatShadedMesh(),n._shouldGenerateFlatShading=!1),n.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(n)}},{key:"_CleanMatricesWeights",value:function(e,t){var n=.001;if(c.Z.CleanBoneMatrixWeights){var i=0;if(e.skeletonId>-1){var r=t.getScene().getLastSkeletonById(e.skeletonId);if(r){i=r.bones.length;for(var a=t.getVerticesData(u.o.MatricesIndicesKind),o=t.getVerticesData(u.o.MatricesIndicesExtraKind),s=e.matricesWeights,l=e.matricesWeightsExtra,h=e.numBoneInfluencer,f=s.length,d=0;d<f;d+=4){for(var v=0,p=-1,_=0;_<4;_++){var g=s[d+_];v+=g,g<n&&p<0&&(p=_)}if(l)for(var m=0;m<4;m++){var y=l[d+m];v+=y,y<n&&p<0&&(p=m+4)}if((p<0||p>h-1)&&(p=h-1),v>n){for(var A=1/v,E=0;E<4;E++)s[d+E]*=A;if(l)for(var S=0;S<4;S++)l[d+S]*=A}else p>=4?(l[d+p-4]=1-v,o[d+p-4]=i):(s[d+p]=1-v,a[d+p]=i)}t.setVerticesData(u.o.MatricesIndicesKind,a),e.matricesWeightsExtra&&t.setVerticesData(u.o.MatricesIndicesExtraKind,o)}}}}},{key:"Parse",value:function(t,n,i){var r=new e(t.id,n,void 0,t.updatable);return r._loadedUniqueId=t.uniqueId,d.$&&d.$.AddTagsTo(r,t.tags),t.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+t.delayLoadingFile,r._boundingInfo=new h.j(a.P.FromArray(t.boundingBoxMinimum),a.P.FromArray(t.boundingBoxMaximum)),r._delayInfo=[],t.hasUVs&&r._delayInfo.push(u.o.UVKind),t.hasUVs2&&r._delayInfo.push(u.o.UV2Kind),t.hasUVs3&&r._delayInfo.push(u.o.UV3Kind),t.hasUVs4&&r._delayInfo.push(u.o.UV4Kind),t.hasUVs5&&r._delayInfo.push(u.o.UV5Kind),t.hasUVs6&&r._delayInfo.push(u.o.UV6Kind),t.hasColors&&r._delayInfo.push(u.o.ColorKind),t.hasMatricesIndices&&r._delayInfo.push(u.o.MatricesIndicesKind),t.hasMatricesWeights&&r._delayInfo.push(u.o.MatricesWeightsKind),r._delayLoadingFunction=s.x.ImportVertexData):s.x.ImportVertexData(t,r),n.pushGeometry(r,!0),r}}]),e}()},4527:function(e,t,n){"use strict";n.d(t,{x:function(){return y}});var i=n(885),r=n(5671),a=n(3144),o=n(4687),s=n.n(o),u=n(9477),l=n(6900),c=n(2845),h=n(5230),f=n(7046),d=n(2328),v=n(9336),p=n(5203),_=n(8298);function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var y=function(){function e(){(0,r.Z)(this,e),this._applyTo=(0,p.vp)(this._applyToCoroutine.bind(this))}return(0,a.Z)(e,[{key:"set",value:function(e,t){switch(e.length||d.Y.Warn("Setting vertex data kind '".concat(t,"' with an empty array")),t){case c.o.PositionKind:this.positions=e;break;case c.o.NormalKind:this.normals=e;break;case c.o.TangentKind:this.tangents=e;break;case c.o.UVKind:this.uvs=e;break;case c.o.UV2Kind:this.uvs2=e;break;case c.o.UV3Kind:this.uvs3=e;break;case c.o.UV4Kind:this.uvs4=e;break;case c.o.UV5Kind:this.uvs5=e;break;case c.o.UV6Kind:this.uvs6=e;break;case c.o.ColorKind:this.colors=e;break;case c.o.MatricesIndicesKind:this.matricesIndices=e;break;case c.o.MatricesWeightsKind:this.matricesWeights=e;break;case c.o.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case c.o.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}}},{key:"applyToMesh",value:function(e,t){return this._applyTo(e,t,!1),this}},{key:"applyToGeometry",value:function(e,t){return this._applyTo(e,t,!1),this}},{key:"updateMesh",value:function(e){return this._update(e),this}},{key:"updateGeometry",value:function(e){return this._update(e),this}},{key:"_applyToCoroutine",value:s().mark((function e(t){var n,i,r=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]&&r[1],i=r.length>2?r[2]:void 0,!this.positions){e.next=7;break}if(t.setVerticesData(c.o.PositionKind,this.positions,n),!i){e.next=7;break}return void(e.next=7);case 7:if(!this.normals){e.next=12;break}if(t.setVerticesData(c.o.NormalKind,this.normals,n),!i){e.next=12;break}return void(e.next=12);case 12:if(!this.tangents){e.next=17;break}if(t.setVerticesData(c.o.TangentKind,this.tangents,n),!i){e.next=17;break}return void(e.next=17);case 17:if(!this.uvs){e.next=22;break}if(t.setVerticesData(c.o.UVKind,this.uvs,n),!i){e.next=22;break}return void(e.next=22);case 22:if(!this.uvs2){e.next=27;break}if(t.setVerticesData(c.o.UV2Kind,this.uvs2,n),!i){e.next=27;break}return void(e.next=27);case 27:if(!this.uvs3){e.next=32;break}if(t.setVerticesData(c.o.UV3Kind,this.uvs3,n),!i){e.next=32;break}return void(e.next=32);case 32:if(!this.uvs4){e.next=37;break}if(t.setVerticesData(c.o.UV4Kind,this.uvs4,n),!i){e.next=37;break}return void(e.next=37);case 37:if(!this.uvs5){e.next=42;break}if(t.setVerticesData(c.o.UV5Kind,this.uvs5,n),!i){e.next=42;break}return void(e.next=42);case 42:if(!this.uvs6){e.next=47;break}if(t.setVerticesData(c.o.UV6Kind,this.uvs6,n),!i){e.next=47;break}return void(e.next=47);case 47:if(!this.colors){e.next=52;break}if(t.setVerticesData(c.o.ColorKind,this.colors,n),!i){e.next=52;break}return void(e.next=52);case 52:if(!this.matricesIndices){e.next=57;break}if(t.setVerticesData(c.o.MatricesIndicesKind,this.matricesIndices,n),!i){e.next=57;break}return void(e.next=57);case 57:if(!this.matricesWeights){e.next=62;break}if(t.setVerticesData(c.o.MatricesWeightsKind,this.matricesWeights,n),!i){e.next=62;break}return void(e.next=62);case 62:if(!this.matricesIndicesExtra){e.next=67;break}if(t.setVerticesData(c.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,n),!i){e.next=67;break}return void(e.next=67);case 67:if(!this.matricesWeightsExtra){e.next=72;break}if(t.setVerticesData(c.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,n),!i){e.next=72;break}return void(e.next=72);case 72:if(!this.indices){e.next=79;break}if(t.setIndices(this.indices,null,n),!i){e.next=77;break}return void(e.next=77);case 77:e.next=80;break;case 79:t.setIndices([],null);case 80:return e.abrupt("return",this);case 81:case"end":return e.stop()}}),e,this)}))},{key:"_update",value:function(e,t,n){return this.positions&&e.updateVerticesData(c.o.PositionKind,this.positions,t,n),this.normals&&e.updateVerticesData(c.o.NormalKind,this.normals,t,n),this.tangents&&e.updateVerticesData(c.o.TangentKind,this.tangents,t,n),this.uvs&&e.updateVerticesData(c.o.UVKind,this.uvs,t,n),this.uvs2&&e.updateVerticesData(c.o.UV2Kind,this.uvs2,t,n),this.uvs3&&e.updateVerticesData(c.o.UV3Kind,this.uvs3,t,n),this.uvs4&&e.updateVerticesData(c.o.UV4Kind,this.uvs4,t,n),this.uvs5&&e.updateVerticesData(c.o.UV5Kind,this.uvs5,t,n),this.uvs6&&e.updateVerticesData(c.o.UV6Kind,this.uvs6,t,n),this.colors&&e.updateVerticesData(c.o.ColorKind,this.colors,t,n),this.matricesIndices&&e.updateVerticesData(c.o.MatricesIndicesKind,this.matricesIndices,t,n),this.matricesWeights&&e.updateVerticesData(c.o.MatricesWeightsKind,this.matricesWeights,t,n),this.matricesIndicesExtra&&e.updateVerticesData(c.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,n),this.matricesWeightsExtra&&e.updateVerticesData(c.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,n),this.indices&&e.setIndices(this.indices,null),this}},{key:"transform",value:function(t){var n=t.determinant()<0;return this.positions&&e._TransformVector3Coordinates(this.positions,t),this.normals&&e._TransformVector3Normals(this.normals,t),this.tangents&&e._TransformVector4Normals(this.tangents,t),n&&this.indices&&e._FlipFaces(this.indices),this}},{key:"merge",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Array.isArray(e)?e.map((function(e){return[e,void 0]})):[[e,void 0]];return(0,p.s3)(this._mergeCoroutine(void 0,i,t,!1,n))}},{key:"_mergeCoroutine",value:s().mark((function t(n,r){var a,o,u,l,h,f,d,v,p,_,m,y,A,E,S,T,b,P,M,I,C,x,R,D,k=this,O=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l=O.length>2&&void 0!==O[2]&&O[2],h=O.length>3?O[3]:void 0,f=O.length>4?O[4]:void 0,this._validate(),d=r.map((function(e){return e[0]})),v=g(d),t.prev=6,v.s();case 8:if((p=v.n()).done){t.next=15;break}if((_=p.value)._validate(),!this.normals==!_.normals&&!this.tangents==!_.tangents&&!this.uvs==!_.uvs&&!this.uvs2==!_.uvs2&&!this.uvs3==!_.uvs3&&!this.uvs4==!_.uvs4&&!this.uvs5==!_.uvs5&&!this.uvs6==!_.uvs6&&!this.colors==!_.colors&&!this.matricesIndices==!_.matricesIndices&&!this.matricesWeights==!_.matricesWeights&&!this.matricesIndicesExtra==!_.matricesIndicesExtra&&!this.matricesWeightsExtra==!_.matricesWeightsExtra){t.next=13;break}throw new Error("Cannot merge vertex data that do not have the same set of attributes");case 13:t.next=8;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(6),v.e(t.t0);case 20:return t.prev=20,v.f(),t.finish(20);case 23:if(m=d.reduce((function(e,t){var n,i;return e+(null!==(n=null===(i=t.indices)||void 0===i?void 0:i.length)&&void 0!==n?n:0)}),null!==(a=null===(o=this.indices)||void 0===o?void 0:o.length)&&void 0!==a?a:0),y=f||d.some((function(e){return e.indices===k.indices})),A=y?null===(u=this.indices)||void 0===u?void 0:u.slice():this.indices,!(m>0)){t.next=54;break}T=null!==(E=null===(S=A)||void 0===S?void 0:S.length)&&void 0!==E?E:0,A||(A=new Array(m)),A.length!==m&&(Array.isArray(A)?A.length=m:((b=l||A instanceof Uint32Array?new Uint32Array(m):new Uint16Array(m)).set(A),A=b),n&&n.determinant()<0&&e._FlipFaces(A,0,T)),P=this.positions?this.positions.length/3:0,M=g(r),t.prev=32,M.s();case 34:if((I=M.n()).done){t.next=46;break}if(C=(0,i.Z)(I.value,2),x=C[0],R=C[1],!x.indices){t.next=44;break}for(D=0;D<x.indices.length;D++)A[T+D]=x.indices[D]+P;if(R&&R.determinant()<0&&e._FlipFaces(A,T,x.indices.length),P+=x.positions.length/3,T+=x.indices.length,!h){t.next=44;break}return void(t.next=44);case 44:t.next=34;break;case 46:t.next=51;break;case 48:t.prev=48,t.t1=t.catch(32),M.e(t.t1);case 51:return t.prev=51,M.f(),t.finish(51);case 54:if(this.indices=A,this.positions=e._MergeElement(c.o.PositionKind,this.positions,n,r.map((function(e){return[e[0].positions,e[1]]}))),!h){t.next=59;break}return void(t.next=59);case 59:if(this.normals=e._MergeElement(c.o.NormalKind,this.normals,n,r.map((function(e){return[e[0].normals,e[1]]}))),!h){t.next=63;break}return void(t.next=63);case 63:if(this.tangents=e._MergeElement(c.o.TangentKind,this.tangents,n,r.map((function(e){return[e[0].tangents,e[1]]}))),!h){t.next=67;break}return void(t.next=67);case 67:if(this.uvs=e._MergeElement(c.o.UVKind,this.uvs,n,r.map((function(e){return[e[0].uvs,e[1]]}))),!h){t.next=71;break}return void(t.next=71);case 71:if(this.uvs2=e._MergeElement(c.o.UV2Kind,this.uvs2,n,r.map((function(e){return[e[0].uvs2,e[1]]}))),!h){t.next=75;break}return void(t.next=75);case 75:if(this.uvs3=e._MergeElement(c.o.UV3Kind,this.uvs3,n,r.map((function(e){return[e[0].uvs3,e[1]]}))),!h){t.next=79;break}return void(t.next=79);case 79:if(this.uvs4=e._MergeElement(c.o.UV4Kind,this.uvs4,n,r.map((function(e){return[e[0].uvs4,e[1]]}))),!h){t.next=83;break}return void(t.next=83);case 83:if(this.uvs5=e._MergeElement(c.o.UV5Kind,this.uvs5,n,r.map((function(e){return[e[0].uvs5,e[1]]}))),!h){t.next=87;break}return void(t.next=87);case 87:if(this.uvs6=e._MergeElement(c.o.UV6Kind,this.uvs6,n,r.map((function(e){return[e[0].uvs6,e[1]]}))),!h){t.next=91;break}return void(t.next=91);case 91:if(this.colors=e._MergeElement(c.o.ColorKind,this.colors,n,r.map((function(e){return[e[0].colors,e[1]]}))),!h){t.next=95;break}return void(t.next=95);case 95:if(this.matricesIndices=e._MergeElement(c.o.MatricesIndicesKind,this.matricesIndices,n,r.map((function(e){return[e[0].matricesIndices,e[1]]}))),!h){t.next=99;break}return void(t.next=99);case 99:if(this.matricesWeights=e._MergeElement(c.o.MatricesWeightsKind,this.matricesWeights,n,r.map((function(e){return[e[0].matricesWeights,e[1]]}))),!h){t.next=103;break}return void(t.next=103);case 103:if(this.matricesIndicesExtra=e._MergeElement(c.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,n,r.map((function(e){return[e[0].matricesIndicesExtra,e[1]]}))),!h){t.next=107;break}return void(t.next=107);case 107:return this.matricesWeightsExtra=e._MergeElement(c.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,n,r.map((function(e){return[e[0].matricesWeightsExtra,e[1]]}))),t.abrupt("return",this);case 109:case"end":return t.stop()}}),t,this,[[6,17,20,23],[32,48,51,54]])}))},{key:"_validate",value:function(){if(!this.positions)throw new _.LH("Positions are required",_.SM.MeshInvalidPositionsError);var e=function(e,t){var n=c.o.DeduceStride(e);if(t.length%n!=0)throw new Error("The "+e+"s array count must be a multiple of "+n);return t.length/n},t=e(c.o.PositionKind,this.positions),n=function(n,i){var r=e(n,i);if(r!==t)throw new Error("The "+n+"s element count ("+r+") does not match the positions count ("+t+")")};this.normals&&n(c.o.NormalKind,this.normals),this.tangents&&n(c.o.TangentKind,this.tangents),this.uvs&&n(c.o.UVKind,this.uvs),this.uvs2&&n(c.o.UV2Kind,this.uvs2),this.uvs3&&n(c.o.UV3Kind,this.uvs3),this.uvs4&&n(c.o.UV4Kind,this.uvs4),this.uvs5&&n(c.o.UV5Kind,this.uvs5),this.uvs6&&n(c.o.UV6Kind,this.uvs6),this.colors&&n(c.o.ColorKind,this.colors),this.matricesIndices&&n(c.o.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&n(c.o.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&n(c.o.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&n(c.o.MatricesWeightsExtraKind,this.matricesWeightsExtra)}},{key:"serialize",value:function(){var e={};return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e}}],[{key:"_TransformVector3Coordinates",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length,r=l.jp.Vector3[0],a=l.jp.Vector3[1],o=n;o<n+i;o+=3)l.P.FromArrayToRef(e,o,r),l.P.TransformCoordinatesToRef(r,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z}},{key:"_TransformVector3Normals",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length,r=l.jp.Vector3[0],a=l.jp.Vector3[1],o=n;o<n+i;o+=3)l.P.FromArrayToRef(e,o,r),l.P.TransformNormalToRef(r,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z}},{key:"_TransformVector4Normals",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length,r=l.jp.Vector4[0],a=l.jp.Vector4[1],o=n;o<n+i;o+=4)l.Lt.FromArrayToRef(e,o,r),l.Lt.TransformNormalToRef(r,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z,e[o+3]=a.w}},{key:"_FlipFaces",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,i=t;i<t+n;i+=3){var r=e[i+1];e[i+1]=e[i+2],e[i+2]=r}}},{key:"_MergeElement",value:function(t,n,r,a){var o=a.filter((function(e){return null!==e[0]&&void 0!==e[0]}));if(!n&&0==o.length)return n;if(!n)return this._MergeElement(t,o[0][0],o[0][1],o.slice(1));var s=o.reduce((function(e,t){return e+t[0].length}),n.length),u=t===c.o.PositionKind?e._TransformVector3Coordinates:t===c.o.NormalKind?e._TransformVector3Normals:t===c.o.TangentKind?e._TransformVector4Normals:function(){};if(n instanceof Float32Array){var l=new Float32Array(s);l.set(n),r&&u(l,r,0,n.length);var h,f=n.length,d=g(o);try{for(d.s();!(h=d.n()).done;){var v=(0,i.Z)(h.value,2),p=v[0],_=v[1];l.set(p,f),_&&u(l,_,f,p.length),f+=p.length}}catch(I){d.e(I)}finally{d.f()}return l}for(var m=new Array(s),y=0;y<n.length;y++)m[y]=n[y];r&&u(m,r,0,n.length);var A,E=n.length,S=g(o);try{for(S.s();!(A=S.n()).done;){for(var T=(0,i.Z)(A.value,2),b=T[0],P=T[1],M=0;M<b.length;M++)m[E+M]=b[M];P&&u(m,P,E,b.length),E+=b.length}}catch(I){S.e(I)}finally{S.f()}return m}},{key:"ExtractFromMesh",value:function(t,n,i){return e._ExtractFrom(t,n,i)}},{key:"ExtractFromGeometry",value:function(t,n,i){return e._ExtractFrom(t,n,i)}},{key:"_ExtractFrom",value:function(t,n,i){var r=new e;return t.isVerticesDataPresent(c.o.PositionKind)&&(r.positions=t.getVerticesData(c.o.PositionKind,n,i)),t.isVerticesDataPresent(c.o.NormalKind)&&(r.normals=t.getVerticesData(c.o.NormalKind,n,i)),t.isVerticesDataPresent(c.o.TangentKind)&&(r.tangents=t.getVerticesData(c.o.TangentKind,n,i)),t.isVerticesDataPresent(c.o.UVKind)&&(r.uvs=t.getVerticesData(c.o.UVKind,n,i)),t.isVerticesDataPresent(c.o.UV2Kind)&&(r.uvs2=t.getVerticesData(c.o.UV2Kind,n,i)),t.isVerticesDataPresent(c.o.UV3Kind)&&(r.uvs3=t.getVerticesData(c.o.UV3Kind,n,i)),t.isVerticesDataPresent(c.o.UV4Kind)&&(r.uvs4=t.getVerticesData(c.o.UV4Kind,n,i)),t.isVerticesDataPresent(c.o.UV5Kind)&&(r.uvs5=t.getVerticesData(c.o.UV5Kind,n,i)),t.isVerticesDataPresent(c.o.UV6Kind)&&(r.uvs6=t.getVerticesData(c.o.UV6Kind,n,i)),t.isVerticesDataPresent(c.o.ColorKind)&&(r.colors=t.getVerticesData(c.o.ColorKind,n,i)),t.isVerticesDataPresent(c.o.MatricesIndicesKind)&&(r.matricesIndices=t.getVerticesData(c.o.MatricesIndicesKind,n,i)),t.isVerticesDataPresent(c.o.MatricesWeightsKind)&&(r.matricesWeights=t.getVerticesData(c.o.MatricesWeightsKind,n,i)),t.isVerticesDataPresent(c.o.MatricesIndicesExtraKind)&&(r.matricesIndicesExtra=t.getVerticesData(c.o.MatricesIndicesExtraKind,n,i)),t.isVerticesDataPresent(c.o.MatricesWeightsExtraKind)&&(r.matricesWeightsExtra=t.getVerticesData(c.o.MatricesWeightsExtraKind,n,i)),r.indices=t.getIndices(n,i),r}},{key:"CreateRibbon",value:function(e){throw(0,h.S)("ribbonBuilder")}},{key:"CreateBox",value:function(e){throw(0,h.S)("boxBuilder")}},{key:"CreateTiledBox",value:function(e){throw(0,h.S)("tiledBoxBuilder")}},{key:"CreateTiledPlane",value:function(e){throw(0,h.S)("tiledPlaneBuilder")}},{key:"CreateSphere",value:function(e){throw(0,h.S)("sphereBuilder")}},{key:"CreateCylinder",value:function(e){throw(0,h.S)("cylinderBuilder")}},{key:"CreateTorus",value:function(e){throw(0,h.S)("torusBuilder")}},{key:"CreateLineSystem",value:function(e){throw(0,h.S)("linesBuilder")}},{key:"CreateDashedLines",value:function(e){throw(0,h.S)("linesBuilder")}},{key:"CreateGround",value:function(e){throw(0,h.S)("groundBuilder")}},{key:"CreateTiledGround",value:function(e){throw(0,h.S)("groundBuilder")}},{key:"CreateGroundFromHeightMap",value:function(e){throw(0,h.S)("groundBuilder")}},{key:"CreatePlane",value:function(e){throw(0,h.S)("planeBuilder")}},{key:"CreateDisc",value:function(e){throw(0,h.S)("discBuilder")}},{key:"CreatePolygon",value:function(e,t,n,i,r,a,o){throw(0,h.S)("polygonBuilder")}},{key:"CreateIcoSphere",value:function(e){throw(0,h.S)("icoSphereBuilder")}},{key:"CreatePolyhedron",value:function(e){throw(0,h.S)("polyhedronBuilder")}},{key:"CreateCapsule",value:function(){arguments.length>0&&void 0!==arguments[0]||l.P.Up();throw(0,h.S)("capsuleBuilder")}},{key:"CreateTorusKnot",value:function(e){throw(0,h.S)("torusKnotBuilder")}},{key:"ComputeNormals",value:function(e,t,n,i){var r=0,a=0,o=0,s=0,u=0,c=0,h=0,f=0,d=0,v=0,p=0,_=0,g=0,m=0,y=0,A=0,E=0,S=0,T=0,b=0,P=!1,M=!1,I=!1,C=!1,x=1,R=0,D=null;i&&(P=!!i.facetNormals,M=!!i.facetPositions,I=!!i.facetPartitioning,x=!0===i.useRightHandedSystem?-1:1,R=i.ratio||0,C=!!i.depthSort,D=i.distanceTo,C&&void 0===D&&(D=l.P.Zero()));var k=0,O=0,L=0,F=0;for(I&&i&&i.bbSize&&(k=i.subDiv.X*R/i.bbSize.x,O=i.subDiv.Y*R/i.bbSize.y,L=i.subDiv.Z*R/i.bbSize.z,F=i.subDiv.max*i.subDiv.max,i.facetPartitioning.length=0),r=0;r<e.length;r++)n[r]=0;var N=t.length/3|0;for(r=0;r<N;r++){if(g=(_=3*t[3*r])+1,m=_+2,A=(y=3*t[3*r+1])+1,E=y+2,T=(S=3*t[3*r+2])+1,b=S+2,a=e[_]-e[y],o=e[g]-e[A],s=e[m]-e[E],u=e[S]-e[y],c=e[T]-e[A],f=x*(o*(h=e[b]-e[E])-s*c),d=x*(s*u-a*h),v=x*(a*c-o*u),f/=p=0===(p=Math.sqrt(f*f+d*d+v*v))?1:p,d/=p,v/=p,P&&i&&(i.facetNormals[r].x=f,i.facetNormals[r].y=d,i.facetNormals[r].z=v),M&&i&&(i.facetPositions[r].x=(e[_]+e[y]+e[S])/3,i.facetPositions[r].y=(e[g]+e[A]+e[T])/3,i.facetPositions[r].z=(e[m]+e[E]+e[b])/3),I&&i){var w=Math.floor((i.facetPositions[r].x-i.bInfo.minimum.x*R)*k),B=Math.floor((i.facetPositions[r].y-i.bInfo.minimum.y*R)*O),U=Math.floor((i.facetPositions[r].z-i.bInfo.minimum.z*R)*L),V=Math.floor((e[_]-i.bInfo.minimum.x*R)*k),G=Math.floor((e[g]-i.bInfo.minimum.y*R)*O),W=Math.floor((e[m]-i.bInfo.minimum.z*R)*L),X=Math.floor((e[y]-i.bInfo.minimum.x*R)*k),H=Math.floor((e[A]-i.bInfo.minimum.y*R)*O),z=Math.floor((e[E]-i.bInfo.minimum.z*R)*L),Z=Math.floor((e[S]-i.bInfo.minimum.x*R)*k),K=Math.floor((e[T]-i.bInfo.minimum.y*R)*O),Y=Math.floor((e[b]-i.bInfo.minimum.z*R)*L),q=V+i.subDiv.max*G+F*W,j=X+i.subDiv.max*H+F*z,Q=Z+i.subDiv.max*K+F*Y,$=w+i.subDiv.max*B+F*U;i.facetPartitioning[$]=i.facetPartitioning[$]?i.facetPartitioning[$]:new Array,i.facetPartitioning[q]=i.facetPartitioning[q]?i.facetPartitioning[q]:new Array,i.facetPartitioning[j]=i.facetPartitioning[j]?i.facetPartitioning[j]:new Array,i.facetPartitioning[Q]=i.facetPartitioning[Q]?i.facetPartitioning[Q]:new Array,i.facetPartitioning[q].push(r),j!=q&&i.facetPartitioning[j].push(r),Q!=j&&Q!=q&&i.facetPartitioning[Q].push(r),$!=q&&$!=j&&$!=Q&&i.facetPartitioning[$].push(r)}if(C&&i&&i.facetPositions){var J=i.depthSortedFacets[r];J.ind=3*r,J.sqDistance=l.P.DistanceSquared(i.facetPositions[r],D)}n[_]+=f,n[g]+=d,n[m]+=v,n[y]+=f,n[A]+=d,n[E]+=v,n[S]+=f,n[T]+=d,n[b]+=v}for(r=0;r<n.length/3;r++)f=n[3*r],d=n[3*r+1],v=n[3*r+2],f/=p=0===(p=Math.sqrt(f*f+d*d+v*v))?1:p,d/=p,v/=p,n[3*r]=f,n[3*r+1]=d,n[3*r+2]=v}},{key:"_ComputeSides",value:function(t,n,i,r,a,o,s){var u,c,h=i.length,f=r.length;switch(t=t||e.DEFAULTSIDE){case e.FRONTSIDE:break;case e.BACKSIDE:for(u=0;u<h;u+=3){var d=i[u];i[u]=i[u+2],i[u+2]=d}for(c=0;c<f;c++)r[c]=-r[c];break;case e.DOUBLESIDE:for(var v=n.length,p=v/3,_=0;_<v;_++)n[v+_]=n[_];for(u=0;u<h;u+=3)i[u+h]=i[u+2]+p,i[u+1+h]=i[u+1]+p,i[u+2+h]=i[u]+p;for(c=0;c<f;c++)r[f+c]=-r[c];var g=a.length,m=0;for(m=0;m<g;m++)a[m+g]=a[m];for(o=o||new l.Lt(0,0,1,1),s=s||new l.Lt(0,0,1,1),m=0,u=0;u<g/2;u++)a[m]=o.x+(o.z-o.x)*a[m],a[m+1]=o.y+(o.w-o.y)*a[m+1],a[m+g]=s.x+(s.z-s.x)*a[m+g],a[m+g+1]=s.y+(s.w-s.y)*a[m+g+1],m+=2}}},{key:"ImportVertexData",value:function(t,n){var i=new e,r=t.positions;r&&i.set(r,c.o.PositionKind);var a=t.normals;a&&i.set(a,c.o.NormalKind);var o=t.tangents;o&&i.set(o,c.o.TangentKind);var s=t.uvs;s&&i.set(s,c.o.UVKind);var u=t.uv2s;u&&i.set(u,c.o.UV2Kind);var l=t.uv3s;l&&i.set(l,c.o.UV3Kind);var h=t.uv4s;h&&i.set(h,c.o.UV4Kind);var d=t.uv5s;d&&i.set(d,c.o.UV5Kind);var v=t.uv6s;v&&i.set(v,c.o.UV6Kind);var p=t.colors;p&&i.set(f.HE.CheckColors4(p,r.length/3),c.o.ColorKind);var _=t.matricesIndices;_&&i.set(_,c.o.MatricesIndicesKind);var g=t.matricesWeights;g&&i.set(g,c.o.MatricesWeightsKind);var m=t.indices;m&&(i.indices=m),n.setAllVerticesData(i,t.updatable)}}]),e}();y.FRONTSIDE=0,y.BACKSIDE=1,y.DOUBLESIDE=2,y.DEFAULTSIDE=0,(0,u.gn)([v.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];return!Array.isArray(i)}))],y,"_TransformVector3Coordinates",null),(0,u.gn)([v.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];return!Array.isArray(i)}))],y,"_TransformVector3Normals",null),(0,u.gn)([v.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];return!Array.isArray(i)}))],y,"_TransformVector4Normals",null),(0,u.gn)([v.G6.filter((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];return!Array.isArray(i)}))],y,"_FlipFaces",null)},9609:function(e,t,n){"use strict";n.d(t,{g:function(){return a}});var i=n(3144),r=n(5671),a=(0,i.Z)((function e(t,n){(0,r.Z)(this,e),this.distanceOrScreenCoverage=t,this.mesh=n}))},65:function(e,t,n){"use strict";n.d(t,{P:function(){return f}});var i=n(5671),r=n(3144),a=n(2845),o=(0,r.Z)((function e(t,n,r){(0,i.Z)(this,e),this.bu=t,this.bv=n,this.distance=r,this.faceId=0,this.subMeshId=0})),s=n(9115),u=n(7721),l=n(8618);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var f=function(){function e(t,n,r,a,o,s,u){var l=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];(0,i.Z)(this,e),this.materialIndex=t,this.verticesStart=n,this.verticesCount=r,this.indexStart=a,this.indexCount=o,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=s,this._renderingMesh=u||s,c&&s.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=s.subMeshes.length-1,l&&(this.refreshBoundingInfo(),s.computeWorldMatrix(!0))}return(0,r.Z)(e,[{key:"materialDefines",get:function(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(e=this._getDrawWrapper())||void 0===e?void 0:e.defines},set:function(e){var t;(null!==(t=this._mainDrawWrapperOverride)&&void 0!==t?t:this._getDrawWrapper(void 0,!0)).defines=e}},{key:"_getDrawWrapper",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=null!==(t=e)&&void 0!==t?t:this._engine.currentRenderPassId;var i=this._drawWrappers[e];return!i&&n&&(this._drawWrappers[e]=i=new l.q(this._mesh.getScene().getEngine())),i}},{key:"_removeDrawWrapper",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n&&(null===(t=this._drawWrappers[e])||void 0===t||t.dispose());this._drawWrappers[e]=void 0}},{key:"effect",get:function(){var e,t;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:null!==(e=null===(t=this._getDrawWrapper())||void 0===t?void 0:t.effect)&&void 0!==e?e:null}},{key:"_drawWrapper",get:function(){var e;return null!==(e=this._mainDrawWrapperOverride)&&void 0!==e?e:this._getDrawWrapper(void 0,!0)}},{key:"_drawWrapperOverride",get:function(){return this._mainDrawWrapperOverride}},{key:"_setMainDrawWrapperOverride",value:function(e){this._mainDrawWrapperOverride=e}},{key:"setEffect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=this._drawWrapper;r.setEffect(e,t,i),void 0!==n&&(r.materialContext=n),e||(r.defines=null,r.materialContext=void 0)}},{key:"resetDrawCache",value:function(e){if(this._drawWrappers){if(void 0!==e)return void this._removeDrawWrapper(e);var t,n=c(this._drawWrappers);try{for(n.s();!(t=n.n()).done;){var i=t.value;null==i||i.dispose()}}catch(r){n.e(r)}finally{n.f()}}this._drawWrappers=[]}},{key:"IsGlobal",get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}},{key:"getBoundingInfo",value:function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo}},{key:"setBoundingInfo",value:function(e){return this._boundingInfo=e,this}},{key:"getMesh",value:function(){return this._mesh}},{key:"getRenderingMesh",value:function(){return this._renderingMesh}},{key:"getReplacementMesh",value:function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}},{key:"getEffectiveMesh",value:function(){var e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh}},{key:"getMaterial",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=null!==(e=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))&&void 0!==e?e:this._renderingMesh.material;if(!n)return t?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(n)){var i=n.getSubMaterial(this.materialIndex);return this._currentMaterial!==i&&(this._currentMaterial=i,this.resetDrawCache()),i}return n}},{key:"_isMultiMaterial",value:function(e){return void 0!==e.getSubMaterial}},{key:"refreshBoundingInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(a.o.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var t,n=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===n.length){var i=this._renderingMesh.getBoundingInfo();t={minimum:i.minimum.clone(),maximum:i.maximum.clone()}}else t=(0,u.y)(e,n,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new s.j(t.minimum,t.maximum),this}},{key:"_checkCollision",value:function(e){return this.getBoundingInfo()._checkCollision(e)}},{key:"updateBoundingInfo",value:function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this}},{key:"isInFrustum",value:function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)}},{key:"isCompletelyInFrustum",value:function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)}},{key:"render",value:function(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}},{key:"_getLinesIndexBuffer",value:function(e,t){if(!this._linesIndexBuffer){for(var n=[],i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)n.push(e[i],e[i+1],e[i+1],e[i+2],e[i+2],e[i]);this._linesIndexBuffer=t.createIndexBuffer(n),this._linesIndexCount=n.length}return this._linesIndexBuffer}},{key:"canIntersects",value:function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)}},{key:"intersects",value:function(e,t,n,i,r){var a=this.getMaterial();if(!a)return null;var o=3,s=!1;switch(a.fillMode){case 3:case 5:case 6:case 8:return null;case 7:o=1,s=!0}return 4===a.fillMode?n.length?this._intersectLines(e,t,n,this._mesh.intersectionThreshold,i):this._intersectUnIndexedLines(e,t,n,this._mesh.intersectionThreshold,i):!n.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,n,i,r):this._intersectTriangles(e,t,n,o,s,i,r)}},{key:"_intersectLines",value:function(e,t,n,i,r){for(var a=null,s=this.indexStart;s<this.indexStart+this.indexCount;s+=2){var u=t[n[s]],l=t[n[s+1]],c=e.intersectionSegment(u,l,i);if(!(c<0)&&((r||!a||c<a.distance)&&((a=new o(null,null,c)).faceId=s/2,r)))break}return a}},{key:"_intersectUnIndexedLines",value:function(e,t,n,i,r){for(var a=null,s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=2){var u=t[s],l=t[s+1],c=e.intersectionSegment(u,l,i);if(!(c<0)&&((r||!a||c<a.distance)&&((a=new o(null,null,c)).faceId=s/2,r)))break}return a}},{key:"_intersectTriangles",value:function(e,t,n,i,r,a,o){for(var s=null,u=-1,l=this.indexStart;l<this.indexStart+this.indexCount-(3-i);l+=i){u++;var c=n[l],h=n[l+1],f=n[l+2];if(r&&4294967295===f)l+=2;else{var d=t[c],v=t[h],p=t[f];if(d&&v&&p&&(!o||o(d,v,p,e))){var _=e.intersectsTriangle(d,v,p);if(_){if(_.distance<0)continue;if((a||!s||_.distance<s.distance)&&((s=_).faceId=u,a))break}}}}return s}},{key:"_intersectUnIndexedTriangles",value:function(e,t,n,i,r){for(var a=null,o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=3){var s=t[o],u=t[o+1],l=t[o+2];if(!r||r(s,u,l,e)){var c=e.intersectsTriangle(s,u,l);if(c){if(c.distance<0)continue;if((i||!a||c.distance<a.distance)&&((a=c).faceId=o/3,i))break}}}return a}},{key:"_rebuild",value:function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}},{key:"clone",value:function(t,n){var i=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,n,!1);if(!this.IsGlobal){var r=this.getBoundingInfo();if(!r)return i;i._boundingInfo=new s.j(r.minimum,r.maximum)}return i}},{key:"dispose",value:function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1),this.resetDrawCache()}},{key:"getClassName",value:function(){return"SubMesh"}}],[{key:"AddToMesh",value:function(t,n,i,r,a,o,s){var u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];return new e(t,n,i,r,a,o,s,u)}},{key:"CreateFromIndices",value:function(t,n,i,r,a){for(var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=Number.MAX_VALUE,u=-Number.MAX_VALUE,l=a||r,c=l.getIndices(),h=n;h<n+i;h++){var f=c[h];f<s&&(s=f),f>u&&(u=f)}return new e(t,s,u-s+1,n,i,r,a,o)}}]),e}()},2668:function(e,t,n){"use strict";n.d(t,{Y:function(){return y}});var i=n(5671),r=n(3144),a=n(7326),o=n(1752),s=n(136),u=n(6215),l=n(1120),c=n(9477),h=n(9336),f=n(4174),d=n(6900),v=n(1396),p=n(7702);function _(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,l.Z)(e);if(t){var r=(0,l.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,u.Z)(this,n)}}var y=function(e){(0,s.Z)(n,e);var t=m(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,i.Z)(this,n),(r=t.call(this,e,o))._forward=new d.P(0,0,1),r._up=new d.P(0,1,0),r._right=new d.P(1,0,0),r._position=d.P.Zero(),r._rotation=d.P.Zero(),r._rotationQuaternion=null,r._scaling=d.P.One(),r._transformToBoneReferal=null,r._isAbsoluteSynced=!1,r._billboardMode=n.BILLBOARDMODE_NONE,r._preserveParentRotationForBillboard=!1,r.scalingDeterminant=1,r._infiniteDistance=!1,r.ignoreNonUniformScaling=!1,r.reIntegrateRotationIntoRotationQuaternion=!1,r._poseMatrix=null,r._localMatrix=d.y3.Zero(),r._usePivotMatrix=!1,r._absolutePosition=d.P.Zero(),r._absoluteScaling=d.P.Zero(),r._absoluteRotationQuaternion=d._f.Identity(),r._pivotMatrix=d.y3.Identity(),r._postMultiplyPivotMatrix=!1,r._isWorldMatrixFrozen=!1,r._indexInSceneTransformNodesArray=-1,r.onAfterWorldMatrixUpdateObservable=new f.y$,r._nonUniformScaling=!1,s&&r.getScene().addTransformNode((0,a.Z)(r)),r}return(0,r.Z)(n,[{key:"billboardMode",get:function(){return this._billboardMode},set:function(e){this._billboardMode!==e&&(this._billboardMode=e)}},{key:"preserveParentRotationForBillboard",get:function(){return this._preserveParentRotationForBillboard},set:function(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e)}},{key:"infiniteDistance",get:function(){return this._infiniteDistance},set:function(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)}},{key:"getClassName",value:function(){return"TransformNode"}},{key:"position",get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0}},{key:"isUsingPivotMatrix",value:function(){return this._usePivotMatrix}},{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0}},{key:"scaling",get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0}},{key:"rotationQuaternion",get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0}},{key:"forward",get:function(){return d.P.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}},{key:"up",get:function(){return d.P.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}},{key:"right",get:function(){return d.P.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}},{key:"updatePoseMatrix",value:function(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)}},{key:"getPoseMatrix",value:function(){return this._poseMatrix||(this._poseMatrix=d.y3.Identity()),this._poseMatrix}},{key:"_isSynchronized",value:function(){var e=this._cache;return this._billboardMode===e.billboardMode&&this._billboardMode===n.BILLBOARDMODE_NONE&&(!e.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}},{key:"_initCache",value:function(){(0,o.Z)((0,l.Z)(n.prototype),"_initCache",this).call(this);var e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1}},{key:"absolutePosition",get:function(){return this.getAbsolutePosition()}},{key:"absoluteScaling",get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}},{key:"absoluteRotationQuaternion",get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}},{key:"setPreTransformMatrix",value:function(e){return this.setPivotMatrix(e,!1)}},{key:"setPivotMatrix",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=d.y3.Invert(this._pivotMatrix)),this}},{key:"getPivotMatrix",value:function(){return this._pivotMatrix}},{key:"instantiateHierarchy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);i&&n&&n(this,i);var r,a=_(this.getChildTransformNodes(!0));try{for(a.s();!(r=a.n()).done;){var o=r.value;o.instantiateHierarchy(i,t,n)}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"freezeWorldMatrix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?t?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||d._f.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}},{key:"unfreezeWorldMatrix",value:function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}},{key:"isWorldMatrixFrozen",get:function(){return this._isWorldMatrixFrozen}},{key:"getAbsolutePosition",value:function(){return this.computeWorldMatrix(),this._absolutePosition}},{key:"setAbsolutePosition",value:function(e){if(!e)return this;var t,n,i;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],n=arguments[1],i=arguments[2]}else t=e.x,n=e.y,i=e.z;if(this.parent){var r=d.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(r),d.P.TransformCoordinatesFromFloatsToRef(t,n,i,r,this.position)}else this.position.x=t,this.position.y=n,this.position.z=i;return this._absolutePosition.copyFrom(e),this}},{key:"setPositionWithLocalVector",value:function(e){return this.computeWorldMatrix(),this.position=d.P.TransformNormal(e,this._localMatrix),this}},{key:"getPositionExpressedInLocalSpace",value:function(){this.computeWorldMatrix();var e=d.jp.Matrix[0];return this._localMatrix.invertToRef(e),d.P.TransformNormal(this.position,e)}},{key:"locallyTranslate",value:function(e){return this.computeWorldMatrix(!0),this.position=d.P.TransformCoordinates(e,this._localMatrix),this}},{key:"lookAt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:p.T.LOCAL,o=n._LookAtVectorCache,s=a===p.T.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(s,o),this.setDirection(o,t,i,r),a===p.T.WORLD&&this.parent)if(this.rotationQuaternion){var u=d.jp.Matrix[0];this.rotationQuaternion.toRotationMatrix(u);var l=d.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(l),l.invert(),u.multiplyToRef(l,u),this.rotationQuaternion.fromRotationMatrix(u)}else{var c=d.jp.Quaternion[0];d._f.FromEulerVectorToRef(this.rotation,c);var h=d.jp.Matrix[0];c.toRotationMatrix(h);var f=d.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.invert(),h.multiplyToRef(f,h),c.fromRotationMatrix(h),c.toEulerAnglesToRef(this.rotation)}return this}},{key:"getDirection",value:function(e){var t=d.P.Zero();return this.getDirectionToRef(e,t),t}},{key:"getDirectionToRef",value:function(e,t){return d.P.TransformNormalToRef(e,this.getWorldMatrix(),t),this}},{key:"setDirection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=-Math.atan2(e.z,e.x)+Math.PI/2,a=Math.sqrt(e.x*e.x+e.z*e.z),o=-Math.atan2(e.y,a);return this.rotationQuaternion?d._f.RotationYawPitchRollToRef(r+t,o+n,i,this.rotationQuaternion):(this.rotation.x=o+n,this.rotation.y=r+t,this.rotation.z=i),this}},{key:"setPivotPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.T.LOCAL;0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var n=this.getWorldMatrix();if(t==p.T.WORLD){var i=d.jp.Matrix[0];n.invertToRef(i),e=d.P.TransformCoordinates(e,i)}return this.setPivotMatrix(d.y3.Translation(-e.x,-e.y,-e.z),!0)}},{key:"getPivotPoint",value:function(){var e=d.P.Zero();return this.getPivotPointToRef(e),e}},{key:"getPivotPointToRef",value:function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this}},{key:"getAbsolutePivotPoint",value:function(){var e=d.P.Zero();return this.getAbsolutePivotPointToRef(e),e}},{key:"getAbsolutePivotPointToRef",value:function(e){return this.getPivotPointToRef(e),d.P.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this}},{key:"markAsDirty",value:function(e){if(this._isDirty)return this;if(this._children){var t,i=_(this._children);try{for(i.s();!(t=i.n()).done;){t.value.markAsDirty(e)}}catch(r){i.e(r)}finally{i.f()}}return(0,o.Z)((0,l.Z)(n.prototype),"markAsDirty",this).call(this,e)}},{key:"setParent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e&&!this.parent)return this;var i=d.jp.Quaternion[0],r=d.jp.Vector3[0],a=d.jp.Vector3[1],o=d.jp.Matrix[1];d.y3.IdentityToRef(o);var s=d.jp.Matrix[0];this.computeWorldMatrix(!0);var u=this.rotationQuaternion;return u||(u=n._TmpRotation,d._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,u)),d.y3.ComposeToRef(this.scaling,u,this.position,s),this.parent&&s.multiplyToRef(this.parent.computeWorldMatrix(!0),s),e&&(e.computeWorldMatrix(!0).invertToRef(o),s.multiplyToRef(o,s)),s.decompose(a,i,r,t?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(a),this.position.copyFrom(r),this.parent=e,this}},{key:"nonUniformScaling",get:function(){return this._nonUniformScaling}},{key:"_updateNonUniformScalingState",value:function(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)}},{key:"attachToBone",value:function(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(),e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}},{key:"detachFromBone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=e?this._currentParentWhenAttachingToBone:null,this):(e&&(this.parent=this._currentParentWhenAttachingToBone),this)}},{key:"rotate",value:function(e,t,i){var r;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&i!==p.T.LOCAL){if(this.parent){var a=d.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(a),e=d.P.TransformNormal(e,a)}(r=d._f.RotationAxisToRef(e,t,n._RotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else r=d._f.RotationAxisToRef(e,t,n._RotationAxisCache),this.rotationQuaternion.multiplyToRef(r,this.rotationQuaternion);return this}},{key:"rotateAround",value:function(e,t,n){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=d._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var i=d.jp.Vector3[0],r=d.jp.Vector3[1],a=d.jp.Vector3[2],o=d.jp.Quaternion[0],s=d.jp.Matrix[0],u=d.jp.Matrix[1],l=d.jp.Matrix[2],c=d.jp.Matrix[3];return e.subtractToRef(this.position,i),d.y3.TranslationToRef(i.x,i.y,i.z,s),d.y3.TranslationToRef(-i.x,-i.y,-i.z,u),d.y3.RotationAxisToRef(t,n,l),u.multiplyToRef(l,c),c.multiplyToRef(s,c),c.decompose(r,o,a),this.position.addInPlace(a),o.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}},{key:"translate",value:function(e,t,n){var i=e.scale(t);if(n&&n!==p.T.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(i));else{var r=this.getPositionExpressedInLocalSpace().add(i);this.setPositionWithLocalVector(r)}return this}},{key:"addRotation",value:function(e,t,n){var i;this.rotationQuaternion?i=this.rotationQuaternion:(i=d.jp.Quaternion[1],d._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,i));var r=d.jp.Quaternion[0];return d._f.RotationYawPitchRollToRef(t,e,n,r),i.multiplyInPlace(r),this.rotationQuaternion||i.toEulerAnglesToRef(this.rotation),this}},{key:"_getEffectiveParent",value:function(){return this.parent}},{key:"computeWorldMatrix",value:function(e){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var t=this.getScene().getRenderId();if(!this._isDirty&&!e&&(this._currentRenderId===t||this.isSynchronized()))return this._currentRenderId=t,this._worldMatrix;var i=this.getScene().activeCamera,r=0!=(this._billboardMode&n.BILLBOARDMODE_USE_POSITION),a=this._billboardMode!==n.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;this._updateCache();var o=this._cache;o.pivotMatrixUpdated=!1,o.billboardMode=this.billboardMode,o.infiniteDistance=this.infiniteDistance,o.parent=this._parentNode,this._currentRenderId=t,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var s,u=this._getEffectiveParent(),l=n._TmpScaling,c=this._position;if(this._infiniteDistance&&!this.parent&&i){var h=i.getWorldMatrix(),f=new d.P(h.m[12],h.m[13],h.m[14]);(c=n._TmpTranslation).copyFromFloats(this._position.x+f.x,this._position.y+f.y,this._position.z+f.z)}(l.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion)?(this._rotationQuaternion._isDirty=!1,s=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(d._f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(s=n._TmpRotation,d._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,s));if(this._usePivotMatrix){var v=d.jp.Matrix[1];d.y3.ScalingToRef(l.x,l.y,l.z,v);var p=d.jp.Matrix[0];s.toRotationMatrix(p),this._pivotMatrix.multiplyToRef(v,d.jp.Matrix[4]),d.jp.Matrix[4].multiplyToRef(p,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(c.x,c.y,c.z)}else d.y3.ComposeToRef(l,s,c,this._localMatrix);if(u&&u.getWorldMatrix){if(e&&u.computeWorldMatrix(e),a){this._transformToBoneReferal?u.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),d.jp.Matrix[7]):d.jp.Matrix[7].copyFrom(u.getWorldMatrix());var _=d.jp.Vector3[5],g=d.jp.Vector3[6];d.jp.Matrix[7].decompose(g,void 0,_),d.y3.ScalingToRef(g.x,g.y,g.z,d.jp.Matrix[7]),d.jp.Matrix[7].setTranslation(_),d.P.TransformNormalToRef(this._position,u.getWorldMatrix(),_),this._localMatrix.setTranslation(_),this._localMatrix.multiplyToRef(d.jp.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(u.getWorldMatrix(),d.jp.Matrix[6]),d.jp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(u.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(a&&i&&this.billboardMode&&!r){var m=d.jp.Vector3[0];if(this._worldMatrix.getTranslationToRef(m),d.jp.Matrix[1].copyFrom(i.getViewMatrix()),d.jp.Matrix[1].setTranslationFromFloats(0,0,0),d.jp.Matrix[1].invertToRef(d.jp.Matrix[0]),(this.billboardMode&n.BILLBOARDMODE_ALL)!==n.BILLBOARDMODE_ALL){d.jp.Matrix[0].decompose(void 0,d.jp.Quaternion[0],void 0);var y=d.jp.Vector3[1];d.jp.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&n.BILLBOARDMODE_X)!==n.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&n.BILLBOARDMODE_Y)!==n.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&n.BILLBOARDMODE_Z)!==n.BILLBOARDMODE_Z&&(y.z=0),d.y3.RotationYawPitchRollToRef(y.y,y.x,y.z,d.jp.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(d.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(d.jp.Vector3[0])}else if(a&&i&&this.billboardMode&&r){var A=d.jp.Vector3[0];this._worldMatrix.getTranslationToRef(A);var E=i.globalPosition;this._worldMatrix.invertToRef(d.jp.Matrix[1]);var S=d.jp.Vector3[1];d.P.TransformCoordinatesToRef(E,d.jp.Matrix[1],S),S.normalize();var T=-Math.atan2(S.z,S.x)+Math.PI/2,b=Math.sqrt(S.x*S.x+S.z*S.z),P=-Math.atan2(S.y,b);if(d._f.RotationYawPitchRollToRef(T,P,0,d.jp.Quaternion[0]),(this.billboardMode&n.BILLBOARDMODE_ALL)!==n.BILLBOARDMODE_ALL){var M=d.jp.Vector3[1];d.jp.Quaternion[0].toEulerAnglesToRef(M),(this.billboardMode&n.BILLBOARDMODE_X)!==n.BILLBOARDMODE_X&&(M.x=0),(this.billboardMode&n.BILLBOARDMODE_Y)!==n.BILLBOARDMODE_Y&&(M.y=0),(this.billboardMode&n.BILLBOARDMODE_Z)!==n.BILLBOARDMODE_Z&&(M.z=0),d.y3.RotationYawPitchRollToRef(M.y,M.x,M.z,d.jp.Matrix[0])}else d.y3.FromQuaternionToRef(d.jp.Quaternion[0],d.jp.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(d.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(d.jp.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):u&&u._nonUniformScaling?this._updateNonUniformScalingState(u._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=d.y3.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}},{key:"resetLocalMatrix",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.computeWorldMatrix(),e)for(var t=this.getChildren(),n=0;n<t.length;++n){var i=t[n];if(i){i.computeWorldMatrix();var r=d.jp.Matrix[0];i._localMatrix.multiplyToRef(this._localMatrix,r);var a=d.jp.Quaternion[0];r.decompose(i.scaling,a,i.position),i.rotationQuaternion?i.rotationQuaternion.copyFrom(a):a.toEulerAnglesToRef(i.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=d._f.Identity()),this._worldMatrix=d.y3.Identity()}},{key:"_afterComputeWorldMatrix",value:function(){}},{key:"registerAfterWorldMatrixUpdate",value:function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this}},{key:"unregisterAfterWorldMatrixUpdate",value:function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this}},{key:"getPositionInCameraSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e||(e=this.getScene().activeCamera),d.P.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())}},{key:"getDistanceToCamera",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()}},{key:"clone",value:function(e,t,i){var r=this,a=h.p4.Clone((function(){return new n(e,r.getScene())}),this);if(a.name=e,a.id=e,t&&(a.parent=t),!i)for(var o=this.getDescendants(!0),s=0;s<o.length;s++){var u=o[s];u.clone&&u.clone(e+"."+u.name,a)}return a}},{key:"serialize",value:function(e){var t=h.p4.Serialize(this,e);return t.type=this.getClassName(),t.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),t}},{key:"getChildTransformNodes",value:function(e,t){var i=[];return this._getDescendants(i,e,(function(e){return(!t||t(e))&&e instanceof n})),i}},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){var i=this._parentContainer.transformNodes.indexOf(this);i>-1&&this._parentContainer.transformNodes.splice(i,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),e){var r,a=this.getChildTransformNodes(!0),s=_(a);try{for(s.s();!(r=s.n()).done;){var u=r.value;u.parent=null,u.computeWorldMatrix(!0)}}catch(c){s.e(c)}finally{s.f()}}(0,o.Z)((0,l.Z)(n.prototype),"dispose",this).call(this,e,t)}},{key:"normalizeToUnitCube",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,i=null,r=null;t&&(this.rotationQuaternion?(r=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(i=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var a=this.getHierarchyBoundingVectors(e,n),o=a.max.subtract(a.min),s=Math.max(o.x,o.y,o.z);if(0===s)return this;var u=1/s;return this.scaling.scaleInPlace(u),t&&(this.rotationQuaternion&&r?this.rotationQuaternion.copyFrom(r):this.rotation&&i&&this.rotation.copyFrom(i)),this}},{key:"_syncAbsoluteScalingAndRotation",value:function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}],[{key:"Parse",value:function(e,t,i){var r=h.p4.Parse((function(){return new n(e.name,t)}),e,t,i);return e.localMatrix?r.setPreTransformMatrix(d.y3.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(d.y3.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),r._waitingParsedUniqueId=e.uniqueId,void 0!==e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),r}}]),n}(v.N);y.BILLBOARDMODE_NONE=0,y.BILLBOARDMODE_X=1,y.BILLBOARDMODE_Y=2,y.BILLBOARDMODE_Z=4,y.BILLBOARDMODE_ALL=7,y.BILLBOARDMODE_USE_POSITION=128,y._TmpRotation=d._f.Zero(),y._TmpScaling=d.P.Zero(),y._TmpTranslation=d.P.Zero(),y._LookAtVectorCache=new d.P(0,0,0),y._RotationAxisCache=new d._f,(0,c.gn)([(0,h.hd)("position")],y.prototype,"_position",void 0),(0,c.gn)([(0,h.hd)("rotation")],y.prototype,"_rotation",void 0),(0,c.gn)([(0,h.mv)("rotationQuaternion")],y.prototype,"_rotationQuaternion",void 0),(0,c.gn)([(0,h.hd)("scaling")],y.prototype,"_scaling",void 0),(0,c.gn)([(0,h.qC)("billboardMode")],y.prototype,"_billboardMode",void 0),(0,c.gn)([(0,h.qC)()],y.prototype,"scalingDeterminant",void 0),(0,c.gn)([(0,h.qC)("infiniteDistance")],y.prototype,"_infiniteDistance",void 0),(0,c.gn)([(0,h.qC)()],y.prototype,"ignoreNonUniformScaling",void 0),(0,c.gn)([(0,h.qC)()],y.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},8134:function(e,t,n){"use strict";n.d(t,{B:function(){return a},M:function(){return s}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"BuildArray",value:function(e,t){for(var n=[],i=0;i<e;++i)n.push(t());return n}},{key:"BuildTuple",value:function(t,n){return e.BuildArray(t,n)}}]),e}();var o=["push","splice","pop","shift","unshift"];function s(e,t){var n=o.map((function(n){return function(e,t,n){var i=e[t];if("function"!=typeof i)return null;var r=function i(){var r=e.length,a=i.previous.apply(e,arguments);return n(t,r),a};return i.next=r,r.previous=i,e[t]=r,function(){var n=r.previous;if(n){var i=r.next;i?(n.next=i,i.previous=n):(n.next=void 0,e[t]=n),r.next=void 0,r.previous=void 0}}}(e,n,t)}));return function(){n.forEach((function(e){null==e||e()}))}}},505:function(e,t,n){"use strict";n.d(t,{D:function(){return o}});var i=n(5671),r=n(3144),a=n(5092),o=function(){function e(t,n){(0,i.Z)(this,e),e.IsAvailable&&(this._observer=new window.ComputePressureObserver(t,n))}return(0,r.Z)(e,[{key:"observe",value:function(e){var t,n;(null===(t=this._observer)||void 0===t?void 0:t.observe)&&(null===(n=this._observer)||void 0===n||n.observe(e).catch((function(){})))}},{key:"unobserve",value:function(e){try{var t,n;(null===(t=this._observer)||void 0===t?void 0:t.unobserve)&&(null===(n=this._observer)||void 0===n||n.unobserve(e))}catch(i){}}}],[{key:"IsAvailable",get:function(){var e,t;return(0,a.CG)()&&"ComputePressureObserver"in window&&(null===(e=window.ComputePressureObserver)||void 0===e||null===(t=e.supportedSources)||void 0===t?void 0:t.includes("cpu"))}}]),e}()},5203:function(e,t,n){"use strict";function i(e,t,n){try{var i=e.next();i.done?t(i):i.value?i.value.then((function(){i.value=void 0,t(i)}),n):t(i)}catch(r){n(r)}}function r(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return function(n,r,a){var o=performance.now();void 0===e||o-e>t?(e=o,setTimeout((function(){i(n,r,a)}),0)):i(n,r,a)}}function a(e,t,n,i,r){!function a(){var o,s=function(e){e.done?n(e.value):void 0===o?o=!0:a()};do{o=void 0,r&&r.aborted?i(new Error("Aborted")):t(e,s,i),void 0===o&&(o=!1)}while(o)}()}function o(e,t){var n;return a(e,i,(function(e){return n=e}),(function(e){throw e}),t),n}function s(e,t,n){return new Promise((function(i,r){a(e,t,i,r,n)}))}function u(e,t){return function(){return o(e.apply(void 0,arguments),t)}}n.d(t,{KO:function(){return r},s3:function(){return o},sM:function(){return s},vp:function(){return u}})},9336:function(e,t,n){"use strict";n.d(t,{G6:function(){return I},N$:function(){return T},QC:function(){return A},RR:function(){return S},XX:function(){return b},hd:function(){return E},mv:function(){return P},n9:function(){return m},oU:function(){return g},p4:function(){return M},qC:function(){return _},qQ:function(){return y},wz:function(){return p}});var i=n(5671),r=n(3144),a=n(7032),o=n(6900),s=n(5230),u=n(7046),l={},c={},h=function(e,t,n){var i=e();a.$&&a.$.AddTagsTo(i,t.tags);var r=f(i);for(var o in r){var s=r[o],u=t[o],l=s.type;if(null!=u&&("uniqueId"!==o||M.AllowLoadingUniqueId))switch(l){case 0:case 6:case 11:i[o]=u;break;case 1:i[o]=n||u.isRenderTarget?u:u.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:i[o]=n?u:u.clone()}}return i};function f(e){var t=e.getClassName();if(c[t])return c[t];c[t]={};for(var n=c[t],i=e,r=t;r;){var a=l[r];for(var o in a)n[o]=a[o];var s=void 0,u=!1;do{if(!(s=Object.getPrototypeOf(i)).getClassName){u=!0;break}if(s.getClassName()!==r)break;i=s}while(s);if(u)break;r=s.getClassName(),i=s}return n}function d(e,t){return function(n,i){var r=function(e){var t=e.getClassName();return l[t]||(l[t]={}),l[t]}(n);r[i]||(r[i]={type:e,sourceName:t})}}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(n,i){var r=t||"_"+i;Object.defineProperty(n,i,{get:function(){return this[r]},set:function(t){"function"==typeof this.equals&&this.equals(t)||this[r]!==t&&(this[r]=t,n[e].apply(this))},enumerable:!0,configurable:!0})}}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return v(e,t)}function _(e){return d(0,e)}function g(e){return d(1,e)}function m(e){return d(2,e)}function y(e){return d(3,e)}function A(e){return d(4,e)}function E(e){return d(5,e)}function S(e){return d(6,e)}function T(e){return d(7,e)}function b(e){return d(8,e)}function P(e){return d(10,e)}var M=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"AppendSerializedAnimations",value:function(e,t){if(e.animations){t.animations=[];for(var n=0;n<e.animations.length;n++){var i=e.animations[n];t.animations.push(i.serialize())}}}},{key:"Serialize",value:function(t,n){n||(n={}),a.$&&(n.tags=a.$.GetTags(t));var i=f(t);for(var r in i){var o=i[r],s=o.sourceName||r,u=o.type,l=t[r];if(null!=l&&("uniqueId"!==r||e.AllowLoadingUniqueId))switch(u){case 0:n[s]=l;break;case 1:case 3:case 7:case 9:n[s]=l.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:n[s]=l.asArray();break;case 6:case 11:n[s]=l.id}}return n}},{key:"Parse",value:function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=t();r||(r=""),a.$&&a.$.AddTagsTo(s,n.tags);var l=f(s);for(var c in l){var h=l[c],d=n[h.sourceName||c],v=h.type;if(null!=d&&("uniqueId"!==c||e.AllowLoadingUniqueId)){var p=s;switch(v){case 0:p[c]=d;break;case 1:i&&(p[c]=e._TextureParser(d,i,r));break;case 2:p[c]=u.Wo.FromArray(d);break;case 3:p[c]=e._FresnelParametersParser(d);break;case 4:p[c]=o.FM.FromArray(d);break;case 5:p[c]=o.P.FromArray(d);break;case 6:i&&(p[c]=i.getLastMeshById(d));break;case 7:p[c]=e._ColorCurvesParser(d);break;case 8:p[c]=u.HE.FromArray(d);break;case 9:p[c]=e._ImageProcessingConfigurationParser(d);break;case 10:p[c]=o._f.FromArray(d);break;case 11:i&&(p[c]=i.getCameraById(d));break;case 12:p[c]=o.y3.FromArray(d)}}}return s}},{key:"Clone",value:function(e,t){return h(e,t,!1)}},{key:"Instanciate",value:function(e,t){return h(e,t,!0)}}]),e}();function I(e,t,n,i){var r=n.value;n.value=function(){var n=r;if("undefined"!=typeof _native&&_native[t]){var a=_native[t];n=i?function(){return i.apply(void 0,arguments)?a.apply(void 0,arguments):r.apply(void 0,arguments)}:a}return e[t]=n,n.apply(void 0,arguments)}}M.AllowLoadingUniqueId=!1,M._ImageProcessingConfigurationParser=function(e){throw(0,s.S)("ImageProcessingConfiguration")},M._FresnelParametersParser=function(e){throw(0,s.S)("FresnelParameters")},M._ColorCurvesParser=function(e){throw(0,s.S)("ColorCurves")},M._TextureParser=function(e,t,n){throw(0,s.S)("Texture")},I.filter=function(e){return function(t,n,i){return I(t,n,i,e)}}},3192:function(e,t,n){"use strict";n.d(t,{j:function(){return l}});var i=n(5671),r=n(3144),a=n(2328);function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var u=function(e,t){return e?e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(t):e.clone?e.clone():null:null};var l=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"DeepCopy",value:function(e,t,n,i){var r,s=function(e){var t=[];do{Object.getOwnPropertyNames(e).forEach((function(e){-1===t.indexOf(e)&&t.push(e)}))}while(e=Object.getPrototypeOf(e));return t}(e),l=o(s);try{for(l.s();!(r=l.n()).done;){var c=r.value;if(("_"!==c[0]||i&&-1!==i.indexOf(c))&&!(c.endsWith("Observable")||n&&-1!==n.indexOf(c))){var h=e[c],f=typeof h;if("function"!==f)try{if("object"===f)if(h instanceof Array){if(t[c]=[],h.length>0)if("object"==typeof h[0])for(var d=0;d<h.length;d++){var v=u(h[d],t);-1===t[c].indexOf(v)&&t[c].push(v)}else t[c]=h.slice(0)}else t[c]=u(h,t);else t[c]=h}catch(p){a.Y.Warn(p.message)}}}}catch(_){l.e(_)}finally{l.f()}}}]),e}()},5230:function(e,t,n){"use strict";function i(e){return"".concat(e," needs to be imported before as it contains a side-effect required by your code.")}n.d(t,{S:function(){return i}})},5092:function(e,t,n){"use strict";function i(){return"undefined"!=typeof window}function r(){return"undefined"!=typeof navigator}function a(){return"undefined"!=typeof document}function o(e){for(var t="",n=e.firstChild;n;)3===n.nodeType&&(t+=n.textContent),n=n.nextSibling;return t}n.d(t,{CG:function(){return i},MZ:function(){return s},n5:function(){return a},up:function(){return r},v:function(){return o}});var s={IsWindowObjectExist:i,IsNavigatorAvailable:r,IsDocumentAvailable:a,GetDOMTextContent:o}},8298:function(e,t,n){"use strict";n.d(t,{GU:function(){return c},LH:function(){return f},SM:function(){return h}});var i=n(7326),r=n(3144),a=n(5671),o=n(136),s=n(6215),u=n(1120);function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,u.Z)(e);if(t){var r=(0,u.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,s.Z)(this,n)}}var c=function(e){(0,o.Z)(n,e);var t=l(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n)}((0,n(2407).Z)(Error));c._setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e};var h={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},f=function(e){(0,o.Z)(n,e);var t=l(n);function n(e,r,o){var s;return(0,a.Z)(this,n),(s=t.call(this,e)).errorCode=r,s.innerError=o,s.name="RuntimeError",c._setPrototypeOf((0,i.Z)(s),n.prototype),s}return(0,r.Z)(n)}(c)},562:function(e,t,n){"use strict";n.d(t,{$K:function(){return U},rN:function(){return x},VL:function(){return w},vP:function(){return L},r6:function(){return k},Ip:function(){return O},FV:function(){return F},$M:function(){return D}});var i=n(4942),r=n(3144),a=n(5671),o=n(7326),s=n(136),u=n(6215),l=n(1120),c=n(8628),h=n(5092),f=n(4174),d=(0,r.Z)((function e(){(0,a.Z)(this,e)}));d.FilesToLoad={};var v=function(){function e(){(0,a.Z)(this,e)}return(0,r.Z)(e,null,[{key:"ExponentialBackoff",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(n,i,r){return 0!==i.status||r>=e||-1!==n.indexOf("file:")?-1:Math.pow(2,r)*t}}}]),e}(),p=n(8298),_=n(2399),g=n(9776),m=n(4796),y=n(4198),A=n(2328),E=n(8370);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,l.Z)(e);if(t){var r=(0,l.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,u.Z)(this,n)}}var P=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),M=function(e){(0,s.Z)(n,e);var t=b(n);function n(e,i){var r;return(0,a.Z)(this,n),(r=t.call(this,e,p.SM.LoadFileError)).name="LoadFileError",p.GU._setPrototypeOf((0,o.Z)(r),n.prototype),i instanceof c.g?r.request=i:r.file=i,r}return(0,r.Z)(n)}(p.LH),I=function(e){(0,s.Z)(n,e);var t=b(n);function n(e,i){var r;return(0,a.Z)(this,n),(r=t.call(this,e,p.SM.RequestFileError)).request=i,r.name="RequestFileError",p.GU._setPrototypeOf((0,o.Z)(r),n.prototype),r}return(0,r.Z)(n)}(p.LH),C=function(e){(0,s.Z)(n,e);var t=b(n);function n(e,i){var r;return(0,a.Z)(this,n),(r=t.call(this,e,p.SM.ReadFileError)).file=i,r.name="ReadFileError",p.GU._setPrototypeOf((0,o.Z)(r),n.prototype),r}return(0,r.Z)(n)}(p.LH),x={DefaultRetryStrategy:v.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:function(e){return e}},R=function(e){return e=e.replace(/#/gm,"%23")},D=function(e,t){if((!e||0!==e.indexOf("data:"))&&x.CorsBehavior)if("string"==typeof x.CorsBehavior||x.CorsBehavior instanceof String)t.crossOrigin=x.CorsBehavior;else{var n=x.CorsBehavior(e);n&&(t.crossOrigin=n)}},k=function(e,t,n,i){var r,a,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=arguments.length>5?arguments[5]:void 0,u=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?"undefined"!=typeof Blob&&"undefined"!=typeof URL?(a=URL.createObjectURL(new Blob([e],{type:o})),u=!0):a="data:".concat(o,";base64,")+(0,_.Gh)(e):e instanceof Blob?(a=URL.createObjectURL(e),u=!0):(a=R(e),a=x.PreprocessUrl(e));var l=y.l.LastCreatedEngine,c=function(t){if(n){var i=a||e.toString();n("Error while trying to load image: ".concat(0===i.indexOf("http")||i.length<=128?i:i.slice(0,128)+"..."),t)}};if("undefined"==typeof Image||null!==(r=null==l?void 0:l._features.forceBitmapOverHTMLImageElement)&&void 0!==r&&r)return L(a,(function(i){l.createImageBitmap(new Blob([i],{type:o}),T({premultiplyAlpha:"none"},s)).then((function(e){t(e),u&&URL.revokeObjectURL(a)})).catch((function(t){n&&n("Error while trying to load image: "+e,t)}))}),void 0,i||void 0,!0,(function(e,t){c(t)})),null;var h=new Image;D(a,h);var f=function e(){h.removeEventListener("load",e),h.removeEventListener("error",v),t(h),u&&h.src&&URL.revokeObjectURL(h.src)},v=function e(t){h.removeEventListener("load",f),h.removeEventListener("error",e),c(t),u&&h.src&&URL.revokeObjectURL(h.src)};h.addEventListener("load",f),h.addEventListener("error",v);var p="blob:"===a.substring(0,5),g="data:"===a.substring(0,5),m=function(){p||g?h.src=a:L(a,(function(e,t,n){var i=new Blob([e],{type:!o&&n?n:o}),r=URL.createObjectURL(i);u=!0,h.src=r}),void 0,i||void 0,!0,(function(e,t){c(t)}))},A=function(){i&&i.loadImage(a,h)};if(!p&&!g&&i&&i.enableTexturesOffline)i.open(A,m);else{if(-1!==a.indexOf("file:")){var E=decodeURIComponent(a.substring(5).toLowerCase());if(d.FilesToLoad[E]&&"undefined"!=typeof URL){try{var S;try{S=URL.createObjectURL(d.FilesToLoad[E])}catch(b){S=URL.createObjectURL(d.FilesToLoad[E])}h.src=S,u=!0}catch(P){h.src=""}return h}}m()}return h},O=function(e,t,n,i,r){var a=new FileReader,o={onCompleteObservable:new f.y$,abort:function(){return a.abort()}};return a.onloadend=function(){return o.onCompleteObservable.notifyObservers(o)},r&&(a.onerror=function(){r(new C("Unable to read ".concat(e.name),e))}),a.onload=function(e){t(e.target.result)},n&&(a.onprogress=n),i?a.readAsArrayBuffer(e):a.readAsText(e),o},L=function(e,t,n,i,r,a,o){if(e.name)return O(e,t,n,r,a?function(e){a(void 0,e)}:void 0);var s=e;if(-1!==s.indexOf("file:")){var u=decodeURIComponent(s.substring(5).toLowerCase());0===u.indexOf("./")&&(u=u.substring(2));var l=d.FilesToLoad[u];if(l)return O(l,t,n,r,a?function(e){return a(void 0,new M(e.message,e.file))}:void 0)}var c=B(s),h=c.match,v=c.type;if(h){var _={onCompleteObservable:new f.y$,abort:function(){return function(){}}};try{var g=r?U(s):G(s);t(g,void 0,v)}catch(p){a?a(void 0,p):A.Y.Error(p.message||"Failed to parse the Data URL")}return E.Q.SetImmediate((function(){_.onCompleteObservable.notifyObservers(_)})),_}return F(s,(function(e,n){t(e,null==n?void 0:n.responseURL,null==n?void 0:n.getResponseHeader("content-type"))}),n,i,r,a?function(e){a(e.request,new M(e.message,e.request))}:void 0,o)},F=function(e,t,n,i,r,a,o){e=R(e),e=x.PreprocessUrl(e);var s=x.BaseUrl+e,u=!1,l={onCompleteObservable:new f.y$,abort:function(){return u=!0}},d=function(){var e,i=new c.g,f=null,d=function(){i&&(n&&i.removeEventListener("progress",n),e&&i.removeEventListener("readystatechange",e),i.removeEventListener("loadend",v))},v=function(){d(),l.onCompleteObservable.notifyObservers(l),l.onCompleteObservable.clear(),n=void 0,e=null,v=null,a=void 0,o=void 0,t=void 0};l.abort=function(){u=!0,v&&v(),i&&i.readyState!==(XMLHttpRequest.DONE||4)&&i.abort(),null!==f&&(clearTimeout(f),f=null),i=null};var p=function(e){var t=e.message||"Unknown error";a&&i?a(new I(t,i)):A.Y.Error(t)};!function l(_){if(i){if(i.open("GET",s),o)try{o(i)}catch(g){return void p(g)}r&&(i.responseType="arraybuffer"),n&&i.addEventListener("progress",n),v&&i.addEventListener("loadend",v),e=function(){if(!u&&i&&i.readyState===(XMLHttpRequest.DONE||4)){if(e&&i.removeEventListener("readystatechange",e),i.status>=200&&i.status<300||0===i.status&&(!(0,h.CG)()||N())){try{t&&t(r?i.response:i.responseText,i)}catch(g){p(g)}return}var n=x.DefaultRetryStrategy;if(n){var o=n(s,i,_);if(-1!==o)return d(),i=new c.g,void(f=setTimeout((function(){return l(_+1)}),o))}var v=new I("Error status: "+i.status+" "+i.statusText+" - Unable to load "+s,i);a&&a(v)}},i.addEventListener("readystatechange",e),i.send()}}(0)};if(i&&i.enableSceneOffline){var v=function(e){e&&e.status>400?a&&a(e):d()};i.open((function(){i&&i.loadFile(x.BaseUrl+e,(function(e){!u&&t&&t(e),l.onCompleteObservable.notifyObservers(l)}),n?function(e){!u&&n&&n(e)}:void 0,v,r)}),v)}else d();return l},N=function(){return"undefined"!=typeof location&&"file:"===location.protocol},w=function(e){return P.test(e)},B=function(e){var t=P.exec(e);return null===t||0===t.length?{match:!1,type:""}:{match:!0,type:t[0].replace("data:","").replace("base64,","")}};function U(e){return(0,_.HQ)(e.split(",")[1])}var V,G=function(e){return(0,_.rP)(e.split(",")[1])};m.B._FileToolsLoadImage=k,m.B._FileToolsLoadFile=L,g.L._FileToolsLoadFile=L;!function(e,t,n,i,r,a,o,s,u,l){V={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:t,DefaultRetryStrategy:n.DefaultRetryStrategy,BaseUrl:n.BaseUrl,CorsBehavior:n.CorsBehavior,PreprocessUrl:n.PreprocessUrl,IsBase64DataUrl:i,IsFileURL:r,LoadFile:a,LoadImage:o,ReadFile:s,RequestFile:u,SetCorsBehavior:l},Object.defineProperty(V,"DefaultRetryStrategy",{get:function(){return n.DefaultRetryStrategy},set:function(e){n.DefaultRetryStrategy=e}}),Object.defineProperty(V,"BaseUrl",{get:function(){return n.BaseUrl},set:function(e){n.BaseUrl=e}}),Object.defineProperty(V,"PreprocessUrl",{get:function(){return n.PreprocessUrl},set:function(e){n.PreprocessUrl=e}}),Object.defineProperty(V,"CorsBehavior",{get:function(){return n.CorsBehavior},set:function(e){n.CorsBehavior=e}})}(U,G,x,w,N,L,k,O,F,D)},9950:function(e,t,n){"use strict";function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}n.d(t,{f:function(){return i}})},8797:function(e,t,n){"use strict";n.d(t,{K:function(){return s}});var i=n(5671),r=n(3144),a=n(2328),o=n(1704),s=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"Instantiate",value:function(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];var t=(0,o.q)(e);if(t)return t;a.Y.Warn(e+" not found, you may have missed an import.");for(var n=e.split("."),i=window||this,r=0,s=n.length;r<s;r++)i=i[n[r]];return"function"!=typeof i?null:i}}]),e}();s.RegisteredExternalClasses={}},2328:function(e,t,n){"use strict";n.d(t,{Y:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"_CheckLimit",value:function(t,n){var i=e._LogLimitOutputs[t];return i?i.current++:(i={limit:n,current:1},e._LogLimitOutputs[t]=i),i.current<=i.limit}},{key:"_GenerateLimitMessage",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=e._LogLimitOutputs[t];if(i&&e.MessageLimitReached){var r,a=this._Levels[n];if(i.current===i.limit)e[a.name](e.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,null!==(r=a.name)&&void 0!==r?r:""))}}},{key:"_AddLogEntry",value:function(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)}},{key:"_FormatMessage",value:function(e){var t=function(e){return e<10?"0"+e:""+e},n=new Date;return"["+t(n.getHours())+":"+t(n.getMinutes())+":"+t(n.getSeconds())+"]: "+e}},{key:"_LogDisabled",value:function(e,t){}},{key:"_LogEnabled",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;if(void 0===i||e._CheckLimit(n,i)){var r=e._FormatMessage(n),a=this._Levels[t];a.logFunc&&a.logFunc("BJS - "+r);var o="<div style='color:".concat(a.color,"'>").concat(r,"</div><br>");e._AddLogEntry(o),e._GenerateLimitMessage(n,t)}}},{key:"LogCache",get:function(){return e._LogCache}},{key:"ClearLogCache",value:function(){e._LogCache="",e._LogLimitOutputs={},e.errorsCount=0}},{key:"LogLevels",set:function(t){var n=this;e.Log=e._LogDisabled,e.Warn=e._LogDisabled,e.Error=e._LogDisabled,[e.MessageLogLevel,e.WarningLogLevel,e.ErrorLogLevel].forEach((function(i){(t&i)===i&&(e[n._Levels[i].name]=e._LogEnabled.bind(e,i))}))}}]),e}();a.NoneLogLevel=0,a.MessageLogLevel=1,a.WarningLogLevel=2,a.ErrorLogLevel=4,a.AllLogLevel=7,a.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",a._LogCache="",a._LogLimitOutputs={},a._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],a.errorsCount=0,a.Log=a._LogEnabled.bind(a,a.MessageLogLevel),a.Warn=a._LogEnabled.bind(a,a.WarningLogLevel),a.Error=a._LogEnabled.bind(a,a.ErrorLogLevel)},4174:function(e,t,n){"use strict";n.d(t,{y$:function(){return l}});var i=n(5671),r=n(3144);function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var s=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;(0,i.Z)(this,e),this.initialize(t,n,r,a)}return(0,r.Z)(e,[{key:"initialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return this.mask=e,this.skipNextObservers=t,this.target=n,this.currentTarget=i,this}}]),e}(),u=(0,r.Z)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,i.Z)(this,e),this.callback=t,this.mask=n,this.scope=r,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1})),l=function(){function e(t){(0,i.Z)(this,e),this._observers=new Array,this._eventState=new s(0),t&&(this._onObserverAdded=t)}return(0,r.Z)(e,[{key:"observers",get:function(){return this._observers}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!e)return null;var a=new u(e,t,i);return a.unregisterOnNextCall=r,n?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),a}},{key:"addOnce",value:function(e){return this.add(e,void 0,void 0,void 0,!0)}},{key:"remove",value:function(e){return!!e&&(-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))}},{key:"removeCallback",value:function(e,t){for(var n=0;n<this._observers.length;n++){var i=this._observers[n];if(!i._willBeUnregistered&&(i.callback===e&&(!t||t===i.scope)))return this._deferUnregister(i),!0}return!1}},{key:"_deferUnregister",value:function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((function(){t._remove(e)}),0)}},{key:"_remove",value:function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)}},{key:"makeObserverTopPriority",value:function(e){this._remove(e),this._observers.unshift(e)}},{key:"makeObserverBottomPriority",value:function(e){this._remove(e),this._observers.push(e)}},{key:"notifyObservers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;if(!this._observers.length)return!0;var o=this._eventState;o.mask=t,o.target=n,o.currentTarget=i,o.skipNextObservers=!1,o.lastReturnValue=e,o.userInfo=r;var s,u=a(this._observers);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(!l._willBeUnregistered&&(l.mask&t&&(l.scope?o.lastReturnValue=l.callback.apply(l.scope,[e,o]):o.lastReturnValue=l.callback(e,o),l.unregisterOnNextCall&&this._deferUnregister(l)),o.skipNextObservers))return!1}}catch(c){u.e(c)}finally{u.f()}return!0}},{key:"notifyObserver",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(!e._willBeUnregistered){var i=this._eventState;i.mask=n,i.skipNextObservers=!1,e.callback(t,i),e.unregisterOnNextCall&&this._deferUnregister(e)}}},{key:"hasObservers",value:function(){return this._observers.length>0}},{key:"clear",value:function(){this._observers=new Array,this._onObserverAdded=null}},{key:"clone",value:function(){var t=new e;return t._observers=this._observers.slice(0),t}},{key:"hasSpecificMask",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=a(this._observers);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.mask&t||i.mask===t)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}}],[{key:"FromPromise",value:function(t,n){var i=new e;return t.then((function(e){i.notifyObservers(e)})).catch((function(e){if(!n)throw e;n.notifyObservers(e)})),i}}]),e}()},2864:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var i=n(5671),r=n(3144),a=n(2786),o=function(){function e(){(0,i.Z)(this,e),this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return(0,r.Z)(e,[{key:"min",get:function(){return this._min}},{key:"max",get:function(){return this._max}},{key:"average",get:function(){return this._average}},{key:"lastSecAverage",get:function(){return this._lastSecAverage}},{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this._totalAccumulated}},{key:"count",get:function(){return this._totalValueCount}},{key:"fetchNewFrame",value:function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}},{key:"addCount",value:function(t,n){e.Enabled&&(this._current+=t,n&&this._fetchResult())}},{key:"beginMonitoring",value:function(){e.Enabled&&(this._startMonitoringTime=a.F.Now)}},{key:"endMonitoring",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e.Enabled){t&&this.fetchNewFrame();var n=a.F.Now;this._current=n-this._startMonitoringTime,t&&this._fetchResult()}}},{key:"_fetchResult",value:function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=a.F.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}]),e}();o.Enabled=!0},2786:function(e,t,n){"use strict";n.d(t,{F:function(){return o}});var i=n(5671),r=n(3144),a=n(5092),o=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"Now",get:function(){return a.MZ.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}]),e}()},5934:function(e,t,n){"use strict";n.d(t,{f:function(){return h},t:function(){return c}});var i=n(1752),r=n(136),a=n(6215),o=n(1120),s=n(5671),u=n(3144);function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,o.Z)(e);if(t){var r=(0,o.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,a.Z)(this,n)}}var c=function(){function e(t){(0,s.Z)(this,e),this.length=0,this.data=new Array(t),this._id=e._GlobalId++}return(0,u.Z)(e,[{key:"push",value:function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)}},{key:"forEach",value:function(e){for(var t=0;t<this.length;t++)e(this.data[t])}},{key:"sort",value:function(e){this.data.sort(e)}},{key:"reset",value:function(){this.length=0}},{key:"dispose",value:function(){this.reset(),this.data&&(this.data.length=0)}},{key:"concat",value:function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}}},{key:"indexOf",value:function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t}},{key:"contains",value:function(e){return-1!==this.indexOf(e)}}]),e}();c._GlobalId=0;var h=function(e){(0,r.Z)(n,e);var t=l(n);function n(){var e;return(0,s.Z)(this,n),(e=t.apply(this,arguments))._duplicateId=0,e}return(0,u.Z)(n,[{key:"push",value:function(e){(0,i.Z)((0,o.Z)(n.prototype),"push",this).call(this,e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId}},{key:"pushNoDuplicate",value:function(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)}},{key:"reset",value:function(){(0,i.Z)((0,o.Z)(n.prototype),"reset",this).call(this),this._duplicateId++}},{key:"concatWithNoDuplicate",value:function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var n=(e.data||e)[t];this.pushNoDuplicate(n)}}}}]),n}(c)},128:function(e,t,n){"use strict";n.d(t,{x:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this._count=0,this._data={}}return(0,r.Z)(e,[{key:"copyFrom",value:function(e){var t=this;this.clear(),e.forEach((function(e,n){return t.add(e,n)}))}},{key:"get",value:function(e){var t=this._data[e];if(void 0!==t)return t}},{key:"getOrAddWithFactory",value:function(e,t){var n=this.get(e);return void 0!==n||(n=t(e))&&this.add(e,n),n}},{key:"getOrAdd",value:function(e,t){var n=this.get(e);return void 0!==n?n:(this.add(e,t),t)}},{key:"contains",value:function(e){return void 0!==this._data[e]}},{key:"add",value:function(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)}},{key:"set",value:function(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)}},{key:"getAndRemove",value:function(e){var t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null}},{key:"remove",value:function(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)}},{key:"clear",value:function(){this._data={},this._count=0}},{key:"count",get:function(){return this._count}},{key:"forEach",value:function(e){for(var t in this._data){e(t,this._data[t])}}},{key:"first",value:function(e){for(var t in this._data){var n=e(t,this._data[t]);if(n)return n}return null}}]),e}()},2399:function(e,t,n){"use strict";n.d(t,{Gh:function(){return i},HQ:function(){return a},rP:function(){return r}});var i=function(e){for(var t,n,i,r,a,o,s,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0,h=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);c<h.length;)r=(t=h[c++])>>2,a=(3&t)<<4|(n=c<h.length?h[c++]:Number.NaN)>>4,o=(15&n)<<2|(i=c<h.length?h[c++]:Number.NaN)>>6,s=63&i,isNaN(n)?o=s=64:isNaN(i)&&(s=64),l+=u.charAt(r)+u.charAt(a)+u.charAt(o)+u.charAt(s);return l},r=function(e){return atob(e)},a=function(e){for(var t=r(e),n=t.length,i=new Uint8Array(new ArrayBuffer(n)),a=0;a<n;a++)i[a]=t.charCodeAt(a);return i.buffer}},7032:function(e,t,n){"use strict";n.d(t,{$:function(){return o}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"Eval",value:function(t,n){return"true"===(t=t.match(/\([^()]*\)/g)?t.replace(/\([^()]*\)/g,(function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,n)})):e._HandleParenthesisContent(t,n))||"false"!==t&&e.Eval(t,n)}},{key:"_HandleParenthesisContent",value:function(t,n){var i;n=n||function(e){return"true"===e};var r=t.split("||");for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a)){var o=e._SimplifyNegation(r[a].trim()),s=o.split("&&");if(s.length>1)for(var u=0;u<s.length;++u){var l=e._SimplifyNegation(s[u].trim());if(!(i="true"!==l&&"false"!==l?"!"===l[0]?!n(l.substring(1)):n(l):"true"===l)){o="false";break}}if(i||"true"===o){i=!0;break}i="true"!==o&&"false"!==o?"!"===o[0]?!n(o.substring(1)):n(o):"true"===o}return i?"true":"false"}},{key:"_SimplifyNegation",value:function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,(function(e){return(e=e.replace(/[\s]/g,(function(){return""}))).length%2?"!":""}))).trim())?e="false":"!false"===e&&(e="true"),e}}]),e}(),o=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"EnableFor",value:function(t){t._tags=t._tags||{},t.hasTags=function(){return e.HasTags(t)},t.addTags=function(n){return e.AddTagsTo(t,n)},t.removeTags=function(n){return e.RemoveTagsFrom(t,n)},t.matchesTagsQuery=function(n){return e.MatchesQuery(t,n)}}},{key:"DisableFor",value:function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}},{key:"HasTags",value:function(e){if(!e._tags)return!1;var t=e._tags;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))return!0;return!1}},{key:"GetTags",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e._tags)return null;if(t){var n=[];for(var i in e._tags)Object.prototype.hasOwnProperty.call(e._tags,i)&&!0===e._tags[i]&&n.push(i);return n.join(" ")}return e._tags}},{key:"AddTagsTo",value:function(t,n){n&&("string"==typeof n&&n.split(" ").forEach((function(n){e._AddTagTo(t,n)})))}},{key:"_AddTagTo",value:function(t,n){""!==(n=n.trim())&&"true"!==n&&"false"!==n&&(n.match(/[\s]/)||n.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(t),t._tags[n]=!0))}},{key:"RemoveTagsFrom",value:function(t,n){if(e.HasTags(t)){var i=n.split(" ");for(var r in i)e._RemoveTagFrom(t,i[r])}}},{key:"_RemoveTagFrom",value:function(e,t){delete e._tags[t]}},{key:"MatchesQuery",value:function(t,n){return void 0===n||(""===n?e.HasTags(t):a.Eval(n,(function(n){return e.HasTags(t)&&t._tags[n]})))}}]),e}()},8370:function(e,t,n){"use strict";n.d(t,{Q:function(){return o}});var i=n(5671),r=n(3144),a=n(5092),o=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"SetImmediate",value:function(e){(0,a.CG)()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)}}]),e}()},8517:function(e,t,n){"use strict";n.d(t,{$g:function(){return T},w1:function(){return S}});var i=n(531),r=n(5671),a=n(3144),o=n(4687),s=n.n(o),u=n(4174),l=n(5092),c=n(2328),h=n(3192),f=n(2786),d=n(5230),v=n(8628),p=n(4198),_=n(562),g=n(8370),m=n(8797),y=n(9950);function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var S=function(){function e(){(0,r.Z)(this,e)}var t;return(0,a.Z)(e,null,[{key:"BaseUrl",get:function(){return _.rN.BaseUrl},set:function(e){_.rN.BaseUrl=e}},{key:"DefaultRetryStrategy",get:function(){return _.rN.DefaultRetryStrategy},set:function(e){_.rN.DefaultRetryStrategy=e}},{key:"CorsBehavior",get:function(){return _.rN.CorsBehavior},set:function(e){_.rN.CorsBehavior=e}},{key:"UseFallbackTexture",get:function(){return p.l.UseFallbackTexture},set:function(e){p.l.UseFallbackTexture=e}},{key:"RegisteredExternalClasses",get:function(){return m.K.RegisteredExternalClasses},set:function(e){m.K.RegisteredExternalClasses=e}},{key:"fallbackTexture",get:function(){return p.l.FallbackTexture},set:function(e){p.l.FallbackTexture=e}},{key:"FetchToRef",value:function(e,t,n,i,r,a){var o=4*((Math.abs(e)*n%n|0)+(Math.abs(t)*i%i|0)*n);a.r=r[o]/255,a.g=r[o+1]/255,a.b=r[o+2]/255,a.a=r[o+3]/255}},{key:"Mix",value:function(e,t,n){return e*(1-n)+t*n}},{key:"Instantiate",value:function(e){return m.K.Instantiate(e)}},{key:"SetImmediate",value:function(e){g.Q.SetImmediate(e)}},{key:"IsExponentOfTwo",value:function(e){var t=1;do{t*=2}while(t<e);return t===e}},{key:"FloatRound",value:function(t){return Math.fround?Math.fround(t):(e._TmpFloatArray[0]=t,e._TmpFloatArray[0])}},{key:"GetFilename",value:function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)}},{key:"GetFolderPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.lastIndexOf("/");return n<0?t?e:"":e.substring(0,n+1)}},{key:"ToDegrees",value:function(e){return 180*e/Math.PI}},{key:"ToRadians",value:function(e){return e*Math.PI/180}},{key:"MakeArray",value:function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null}},{key:"GetPointerPrefix",value:function(e){var t="pointer";return(0,l.CG)()&&!window.PointerEvent&&(t="mouse"),!e._badDesktopOS||e._badOS||document&&"ontouchend"in document||(t="mouse"),t}},{key:"SetCorsBehavior",value:function(e,t){(0,_.$M)(e,t)}},{key:"SetReferrerPolicyBehavior",value:function(e,t){t.referrerPolicy=e}},{key:"CleanUrl",value:function(e){return e=e.replace(/#/gm,"%23")}},{key:"PreprocessUrl",get:function(){return _.rN.PreprocessUrl},set:function(e){_.rN.PreprocessUrl=e}},{key:"LoadImage",value:function(e,t,n,i,r,a){return(0,_.r6)(e,t,n,i,r,a)}},{key:"LoadFile",value:function(e,t,n,i,r,a){return(0,_.vP)(e,t,n,i,r,a)}},{key:"LoadFileAsync",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(n,i){(0,_.vP)(e,(function(e){n(e)}),void 0,void 0,t,(function(e,t){i(t)}))}))}},{key:"LoadScript",value:function(e,t,n,i){if("function"!=typeof self.importScripts)if((0,l.CG)()){var r=document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",e),i&&(a.id=i),a.onload=function(){t&&t()},a.onerror=function(t){n&&n("Unable to load script '".concat(e,"'"),t)},r.appendChild(a)}else null==n||n("Cannot load script '".concat(e,"' outside of a window or a worker"));else try{self.importScripts(e),t()}catch(o){null==n||n("Unable to load script '".concat(e,"' in worker"),o)}}},{key:"LoadScriptAsync",value:function(e){var t=this;return new Promise((function(n,i){t.LoadScript(e,(function(){n()}),(function(e,t){i(t)}))}))}},{key:"ReadFileAsDataURL",value:function(e,t,n){var i=new FileReader,r={onCompleteObservable:new u.y$,abort:function(){return i.abort()}};return i.onloadend=function(){r.onCompleteObservable.notifyObservers(r)},i.onload=function(e){t(e.target.result)},i.onprogress=n,i.readAsDataURL(e),r}},{key:"ReadFile",value:function(e,t,n,i,r){return(0,_.Ip)(e,t,n,i,r)}},{key:"FileAsURL",value:function(e){var t=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(t)}},{key:"Format",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toFixed(t)}},{key:"DeepCopy",value:function(e,t,n,i){h.j.DeepCopy(e,t,n,i)}},{key:"IsEmpty",value:function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}},{key:"RegisterTopRootEvents",value:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];e.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(r){}}}},{key:"UnregisterTopRootEvents",value:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];e.removeEventListener(i.name,i.handler);try{e.parent&&e.parent.removeEventListener(i.name,i.handler)}catch(r){}}}},{key:"DumpFramebuffer",value:(t=(0,i.Z)(s().mark((function t(n,i,r,a){var o,u,l,c,h=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=h.length>4&&void 0!==h[4]?h[4]:"image/png",u=h.length>5?h[5]:void 0,t.next=4,r.readPixels(0,0,n,i);case 4:l=t.sent,c=new Uint8Array(l.buffer),e.DumpData(n,i,c,a,o,u,!0);case 7:case"end":return t.stop()}}),t)}))),function(e,n,i,r){return t.apply(this,arguments)})},{key:"DumpData",value:function(t,n,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8?arguments[8]:void 0;e._ScreenshotCanvas||(e._ScreenshotCanvas=document.createElement("canvas")),e._ScreenshotCanvas.width=t,e._ScreenshotCanvas.height=n;var c=e._ScreenshotCanvas.getContext("2d");if(c){if(i instanceof Float32Array){for(var h=new Uint8Array(i.length),f=i.length;f--;){var d=i[f];h[f]=d<0?0:d>1?1:Math.round(255*d)}i=h}var v=c.createImageData(t,n),p=v.data;p.set(i),c.putImageData(v,0,0);var _=e._ScreenshotCanvas;if(s){var g=document.createElement("canvas");g.width=t,g.height=n;var m=g.getContext("2d");if(!m)return;m.translate(0,n),m.scale(1,-1),m.drawImage(e._ScreenshotCanvas,0,0),_=g}u?e.ToBlob(_,(function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;r&&r(t)},t.readAsArrayBuffer(e)}),a,l):e.EncodeScreenshotCanvasData(r,a,o,_,l)}}},{key:"DumpDataAsync",value:function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7?arguments[7]:void 0;return new Promise((function(l){e.DumpData(t,n,i,(function(e){return l(e)}),r,a,o,s,u)}))}},{key:"ToBlob",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",i=arguments.length>3?arguments[3]:void 0;e.toBlob||(e.toBlob=function(e,t,n){var i=this;setTimeout((function(){for(var r=atob(i.toDataURL(t,n).split(",")[1]),a=r.length,o=new Uint8Array(a),s=0;s<a;s++)o[s]=r.charCodeAt(s);e(new Blob([o]))}))}),e.toBlob((function(e){t(e)}),n,i)}},{key:"DownloadBlob",value:function(t,n){if("download"in document.createElement("a")){if(!n){var i=new Date;n="screenshot_"+((i.getFullYear()+"-"+(i.getMonth()+1)).slice(2)+"-"+i.getDate()+"_"+i.getHours()+"-"+("0"+i.getMinutes()).slice(-2))+".png"}e.Download(t,n)}else if(t&&"undefined"!=typeof URL){var r=URL.createObjectURL(t),a=window.open("");if(!a)return;var o=a.document.createElement("img");o.onload=function(){URL.revokeObjectURL(r)},o.src=r,a.document.body.appendChild(o)}}},{key:"EncodeScreenshotCanvasData",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(t){var o=(null!=r?r:e._ScreenshotCanvas).toDataURL(n,a);t(o)}else this.ToBlob(null!=r?r:e._ScreenshotCanvas,(function(t){t&&e.DownloadBlob(t,i)}),n,a)}},{key:"Download",value:function(e,t){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,t);else if("undefined"!=typeof URL){var n=window.URL.createObjectURL(e),i=document.createElement("a");document.body.appendChild(i),i.style.display="none",i.href=n,i.download=t,i.addEventListener("click",(function(){i.parentElement&&i.parentElement.removeChild(i)})),i.click(),window.URL.revokeObjectURL(n)}}},{key:"BackCompatCameraNoPreventDefault",value:function(e){return"boolean"==typeof e[0]?e[0]:"boolean"==typeof e[1]&&e[1]}},{key:"CreateScreenshot",value:function(e,t,n,i){throw(0,d.S)("ScreenshotTools")}},{key:"CreateScreenshotAsync",value:function(e,t,n){throw(0,d.S)("ScreenshotTools")}},{key:"CreateScreenshotUsingRenderTarget",value:function(e,t,n,i){throw(0,d.S)("ScreenshotTools")}},{key:"CreateScreenshotUsingRenderTargetAsync",value:function(e,t,n){throw(0,d.S)("ScreenshotTools")}},{key:"RandomId",value:function(){return(0,y.f)()}},{key:"IsBase64",value:function(e){return(0,_.VL)(e)}},{key:"DecodeBase64",value:function(e){return(0,_.$K)(e)}},{key:"errorsCount",get:function(){return c.Y.errorsCount}},{key:"Log",value:function(e){c.Y.Log(e)}},{key:"Warn",value:function(e){c.Y.Warn(e)}},{key:"Error",value:function(e){c.Y.Error(e)}},{key:"LogCache",get:function(){return c.Y.LogCache}},{key:"ClearLogCache",value:function(){c.Y.ClearLogCache()}},{key:"LogLevels",set:function(e){c.Y.LogLevels=e}},{key:"PerformanceLogLevel",set:function(t){return(t&e.PerformanceUserMarkLogLevel)===e.PerformanceUserMarkLogLevel?(e.StartPerformanceCounter=e._StartUserMark,void(e.EndPerformanceCounter=e._EndUserMark)):(t&e.PerformanceConsoleLogLevel)===e.PerformanceConsoleLogLevel?(e.StartPerformanceCounter=e._StartPerformanceConsole,void(e.EndPerformanceCounter=e._EndPerformanceConsole)):(e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,void(e.EndPerformanceCounter=e._EndPerformanceCounterDisabled))}},{key:"_StartPerformanceCounterDisabled",value:function(e,t){}},{key:"_EndPerformanceCounterDisabled",value:function(e,t){}},{key:"_StartUserMark",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e._Performance){if(!(0,l.CG)())return;e._Performance=window.performance}n&&e._Performance.mark&&e._Performance.mark(t+"-Begin")}},{key:"_EndUserMark",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n&&e._Performance.mark&&(e._Performance.mark(t+"-End"),e._Performance.measure(t,t+"-Begin",t+"-End"))}},{key:"_StartPerformanceConsole",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n&&(e._StartUserMark(t,n),console.time&&console.time(t))}},{key:"_EndPerformanceConsole",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n&&(e._EndUserMark(t,n),console.timeEnd(t))}},{key:"Now",get:function(){return f.F.Now}},{key:"GetClassName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;if(!t&&e.getClassName)n=e.getClassName();else{if(e instanceof Object){var i=t?e:Object.getPrototypeOf(e);n=i.constructor.__bjsclassName__}n||(n=typeof e)}return n}},{key:"First",value:function(e,t){var n,i=A(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(t(r))return r}}catch(a){i.e(a)}finally{i.f()}return null}},{key:"getFullClassName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null,i=null;if(!t&&e.getClassName)n=e.getClassName();else{if(e instanceof Object){var r=t?e:Object.getPrototypeOf(e);n=r.constructor.__bjsclassName__,i=r.constructor.__bjsmoduleName__}n||(n=typeof e)}return n?(null!=i?i+".":"")+n:null}},{key:"DelayAsync",value:function(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))}},{key:"IsSafari",value:function(){return!!(0,l.up)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}]),e}();S.UseCustomRequestHeaders=!1,S.CustomRequestHeaders=v.g.CustomRequestHeaders,S._TmpFloatArray=new Float32Array(1),S.GetDOMTextContent=l.v,S.GetAbsoluteUrl="object"==typeof document?function(e){var t=document.createElement("a");return t.href=e,t.href}:"function"==typeof URL&&"object"==typeof location?function(e){return new URL(e,location.origin).href}:function(){throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},S.NoneLogLevel=c.Y.NoneLogLevel,S.MessageLogLevel=c.Y.MessageLogLevel,S.WarningLogLevel=c.Y.WarningLogLevel,S.ErrorLogLevel=c.Y.ErrorLogLevel,S.AllLogLevel=c.Y.AllLogLevel,S.IsWindowObjectExist=l.CG,S.PerformanceNoneLogLevel=0,S.PerformanceUserMarkLogLevel=1,S.PerformanceConsoleLogLevel=2,S.StartPerformanceCounter=S._StartPerformanceCounterDisabled,S.EndPerformanceCounter=S._EndPerformanceCounterDisabled;var T=function(){function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,r.Z)(this,e),this.iterations=t,this.index=a-1,this._done=!1,this._fn=n,this._successCallback=i}return(0,a.Z)(e,[{key:"executeNext",value:function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}},{key:"breakLoop",value:function(){this._done=!0,this._successCallback()}}],[{key:"Run",value:function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=new e(t,n,i,r);return a.executeNext(),a}},{key:"SyncAsyncForLoop",value:function(t,n,i,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return e.Run(Math.ceil(t/n),(function(e){a&&a()?e.breakLoop():setTimeout((function(){for(var r=0;r<n;++r){var o=e.index*n+r;if(o>=t)break;if(i(o),a&&a()){e.breakLoop();break}}e.executeNext()}),o)}),r)}}]),e}();p.l.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},1704:function(e,t,n){"use strict";n.d(t,{H:function(){return r},q:function(){return a}});var i={};function r(e,t){i[e]=t}function a(e){return i[e]}},874:function(e,t,n){"use strict";n.d(t,{K:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"UniqueId",get:function(){var e=this._UniqueIdCounter;return this._UniqueIdCounter++,e}}]),e}();a._UniqueIdCounter=1},8628:function(e,t,n){"use strict";n.d(t,{g:function(){return s}});var i=n(5671),r=n(3144);function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var s=function(){function e(){(0,i.Z)(this,e),this._xhr="undefined"!=typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}return(0,r.Z)(e,[{key:"_injectCustomRequestHeaders",value:function(){if(!this._shouldSkipRequestModifications(this._requestURL))for(var t in e.CustomRequestHeaders){var n=e.CustomRequestHeaders[t];n&&this._xhr.setRequestHeader(t,n)}}},{key:"_shouldSkipRequestModifications",value:function(t){return e.SkipRequestModificationForBabylonCDN&&(t.includes("preview.babylonjs.com")||t.includes("cdn.babylonjs.com"))}},{key:"onprogress",get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e}},{key:"readyState",get:function(){return this._xhr.readyState}},{key:"status",get:function(){return this._xhr.status}},{key:"statusText",get:function(){return this._xhr.statusText}},{key:"response",get:function(){return this._xhr.response}},{key:"responseURL",get:function(){return this._xhr.responseURL}},{key:"responseText",get:function(){return this._xhr.responseText}},{key:"responseType",get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e}},{key:"timeout",get:function(){return this._xhr.timeout},set:function(e){this._xhr.timeout=e}},{key:"addEventListener",value:function(e,t,n){this._xhr.addEventListener(e,t,n)}},{key:"removeEventListener",value:function(e,t,n){this._xhr.removeEventListener(e,t,n)}},{key:"abort",value:function(){this._xhr.abort()}},{key:"send",value:function(t){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)}},{key:"open",value:function(t,n){var i,r=a(e.CustomRequestModifiers);try{for(r.s();!(i=r.n()).done;){var o=i.value;if(this._shouldSkipRequestModifications(n))return;o(this._xhr,n)}}catch(s){r.e(s)}finally{r.f()}return n=(n=n.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=n,this._xhr.open(t,n,!0)}},{key:"setRequestHeader",value:function(e,t){this._xhr.setRequestHeader(e,t)}},{key:"getResponseHeader",value:function(e){return this._xhr.getResponseHeader(e)}}]),e}();s.CustomRequestHeaders={},s.CustomRequestModifiers=new Array,s.SkipRequestModificationForBabylonCDN=!0},7570:function(e,t,n){"use strict";n.d(t,{O:function(){return o}});var i=n(5671),r=n(3144),a=n(2845),o=function(){function e(t){(0,i.Z)(this,e),this._vertexBuffers={},this._scene=t}return(0,r.Z)(e,[{key:"_prepareBuffers",value:function(){if(!this._vertexBuffers[a.o.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[a.o.PositionKind]=new a.o(this._scene.getEngine(),e,a.o.PositionKind,!1,!1,2),this._buildIndexBuffer()}}},{key:"_buildIndexBuffer",value:function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}},{key:"_rebuild",value:function(){var e=this._vertexBuffers[a.o.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())}},{key:"_prepareFrame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._scene.activeCamera;return!!n&&(!(!(t=t||n._postProcesses.filter((function(e){return null!=e})))||0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(n,e,null!=t),!0))}},{key:"directRender",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=this._scene.getEngine(),s=0;s<e.length;s++){var u;if(s<e.length-1)e[s+1].activate(this._scene.activeCamera,null==t?void 0:t.texture);else t?o.bindFramebuffer(t,i,void 0,void 0,n,r):a||o.restoreDefaultFramebuffer(),null===(u=o._debugInsertMarker)||void 0===u||u.call(o,"post process ".concat(e[s].name," output"));var l=e[s],c=l.apply();c&&(l.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,c),o.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(c))}o.setDepthBuffer(!0),o.setDepthWrite(!0)}},{key:"_finalizeFrame",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=this._scene.activeCamera;if(a&&(i=i||a._postProcesses.filter((function(e){return null!=e})),0!==i.length&&this._scene.postProcessesEnabled)){for(var o=this._scene.getEngine(),s=0,u=i.length;s<u;s++){var l,c=i[s];if(s<u-1)c._outputTexture=i[s+1].activate(a,null==t?void 0:t.texture);else t?(o.bindFramebuffer(t,n,void 0,void 0,r),c._outputTexture=t):(o.restoreDefaultFramebuffer(),c._outputTexture=null),null===(l=o._debugInsertMarker)||void 0===l||l.call(o,"post process ".concat(i[s].name," output"));if(e)break;var h=c.apply();h&&(c.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,h),o.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(h))}o.setDepthBuffer(!0),o.setDepthWrite(!0),o.setAlphaMode(0)}}},{key:"dispose",value:function(){var e=this._vertexBuffers[a.o.PositionKind];e&&(e.dispose(),this._vertexBuffers[a.o.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}]),e}()},3639:function(e,t,n){"use strict";n.d(t,{$:function(){return h}});var i=n(3144),r=n(5671),a=n(5934),o=n(6900),s=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,r.Z)(this,e),this.index=t,this._opaqueSubMeshes=new a.t(256),this._transparentSubMeshes=new a.t(256),this._alphaTestSubMeshes=new a.t(256),this._depthOnlySubMeshes=new a.t(256),this._particleSystems=new a.t(256),this._spriteManagers=new a.t(256),this._empty=!0,this._edgesRenderers=new a.f(16),this._scene=n,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=o,this.transparentSortCompareFn=s}return(0,i.Z)(e,[{key:"opaqueSortCompareFn",set:function(t){this._opaqueSortCompareFn=t||e.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}},{key:"alphaTestSortCompareFn",set:function(t){this._alphaTestSortCompareFn=t||e.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}},{key:"transparentSortCompareFn",set:function(t){this._transparentSortCompareFn=t||e.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}},{key:"render",value:function(e,t,n,i){if(e)e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var r=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(r.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),r.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var a=r.getStencilBuffer();if(r.setStencilBuffer(!1),t&&this._renderSprites(),n&&this._renderParticles(i),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(r.setStencilBuffer(a),this._scene.useOrderIndependentTransparency){var o=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);o.length&&this._renderTransparent(o)}else this._renderTransparent(this._transparentSubMeshes);r.setAlphaMode(0)}if(r.setStencilBuffer(!1),this._edgesRenderers.length){for(var s=0;s<this._edgesRenderers.length;s++)this._edgesRenderers.data[s].render();r.setAlphaMode(0)}r.setStencilBuffer(a)}}},{key:"_renderOpaqueSorted",value:function(t){return e._RenderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}},{key:"_renderAlphaTestSorted",value:function(t){return e._RenderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}},{key:"_renderTransparentSorted",value:function(t){return e._RenderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)}},{key:"prepare",value:function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset(),this._empty=!0}},{key:"dispose",value:function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}},{key:"dispatch",value:function(e,t,n){void 0===t&&(t=e.getMesh()),void 0===n&&(n=e.getMaterial()),null!=n&&(n.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):n.needAlphaTesting()?(n.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(n.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)}},{key:"dispatchSprites",value:function(e){this._spriteManagers.push(e),this._empty=!1}},{key:"dispatchParticles",value:function(e){this._particleSystems.push(e),this._empty=!1}},{key:"_renderParticles",value:function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var n=0;n<this._particleSystems.length;n++){var i=this._particleSystems.data[n];if(0!==(t&&t.layerMask&i.layerMask)){var r=i.emitter;r.position&&e&&-1===e.indexOf(r)||this._scene._activeParticles.addCount(i.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}}},{key:"_renderSprites",value:function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var n=this._spriteManagers.data[t];0!==(e&&e.layerMask&n.layerMask)&&n.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}}],[{key:"_RenderSorted",value:function(t,n,i,r){var a,s=0,u=i?i.globalPosition:e._ZeroVector;if(r)for(;s<t.length;s++)(a=t.data[s])._alphaIndex=a.getMesh().alphaIndex,a._distanceToCamera=o.P.Distance(a.getBoundingInfo().boundingSphere.centerWorld,u);var l=t.length===t.data.length?t.data:t.data.slice(0,t.length);n&&l.sort(n);var c=l[0].getMesh().getScene();for(s=0;s<l.length;s++)if(a=l[s],!c._activeMeshesFrozenButKeepClipping||a.isInFrustum(c._frustumPlanes)){if(r){var h=a.getMaterial();if(h&&h.needDepthPrePass){var f=h.getScene().getEngine();f.setColorWrite(!1),f.setAlphaMode(0),a.render(!1),f.setColorWrite(!0)}}a.render(r)}}},{key:"defaultTransparentSortCompare",value:function(t,n){return t._alphaIndex>n._alphaIndex?1:t._alphaIndex<n._alphaIndex?-1:e.backToFrontSortCompare(t,n)}},{key:"backToFrontSortCompare",value:function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}},{key:"frontToBackSortCompare",value:function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0}},{key:"PainterSortCompare",value:function(e,t){var n=e.getMesh(),i=t.getMesh();return n.material&&i.material?n.material.uniqueId-i.material.uniqueId:n.uniqueId-i.uniqueId}}]),e}();function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}s._ZeroVector=o.P.Zero();var c=(0,i.Z)((function e(){(0,r.Z)(this,e)})),h=function(){function e(t){(0,r.Z)(this,e),this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new c,this._scene=t;for(var n=e.MIN_RENDERINGGROUPS;n<e.MAX_RENDERINGGROUPS;n++)this._autoClearDepthStencil[n]={autoClear:!0,depth:!0,stencil:!0}}return(0,i.Z)(e,[{key:"_clearDepthStencilBuffer",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)}},{key:"render",value:function(t,n,i,r){var a=this._renderingGroupInfo;if(a.scene=this._scene,a.camera=this._scene.activeCamera,this._scene.spriteManagers&&r)for(var o=0;o<this._scene.spriteManagers.length;o++){var s=this._scene.spriteManagers[o];this.dispatchSprites(s)}for(var l=e.MIN_RENDERINGGROUPS;l<e.MAX_RENDERINGGROUPS;l++){this._depthStencilBufferAlreadyCleaned=l===e.MIN_RENDERINGGROUPS;var c=this._renderingGroups[l];if(c&&!c._empty){var h=Math.pow(2,l);if(a.renderingGroupId=l,this._scene.onBeforeRenderingGroupObservable.notifyObservers(a,h),e.AUTOCLEAR){var f=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(l):this._autoClearDepthStencil[l];f&&f.autoClear&&this._clearDepthStencilBuffer(f.depth,f.stencil)}var d,v=u(this._scene._beforeRenderingGroupDrawStage);try{for(v.s();!(d=v.n()).done;){d.value.action(l)}}catch(g){v.e(g)}finally{v.f()}c.render(t,r,i,n);var p,_=u(this._scene._afterRenderingGroupDrawStage);try{for(_.s();!(p=_.n()).done;){p.value.action(l)}}catch(g){_.e(g)}finally{_.f()}this._scene.onAfterRenderingGroupObservable.notifyObservers(a,h)}}}},{key:"reset",value:function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var n=this._renderingGroups[t];n&&n.prepare()}}},{key:"dispose",value:function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}},{key:"freeRenderingGroups",value:function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var n=this._renderingGroups[t];n&&n.dispose()}}},{key:"_prepareRenderingGroup",value:function(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new s(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))}},{key:"dispatchSprites",value:function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)}},{key:"dispatchParticles",value:function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)}},{key:"dispatch",value:function(e,t,n){void 0===t&&(t=e.getMesh());var i=t.renderingGroupId||0;this._prepareRenderingGroup(i),this._renderingGroups[i].dispatch(e,t,n)}},{key:"setRenderingOrder",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=n,this._customTransparentSortCompareFn[e]=i,this._renderingGroups[e]){var r=this._renderingGroups[e];r.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],r.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],r.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}}},{key:"setRenderingAutoClearDepthStencil",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[e]={autoClear:t,depth:n,stencil:i}}},{key:"getAutoClearDepthStencilSetup",value:function(e){return this._autoClearDepthStencil[e]}}]),e}();h.MAX_RENDERINGGROUPS=4,h.MIN_RENDERINGGROUPS=0,h.AUTOCLEAR=!0},768:function(e,t,n){"use strict";n.d(t,{Q:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}return(0,r.Z)(e,[{key:"isDirty",get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}},{key:"alphaBlend",get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)}},{key:"setAlphaBlendConstants",value:function(e,t,n,i){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===n&&this._blendConstants[3]===i||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=n,this._blendConstants[3]=i,this._isBlendConstantsDirty=!0)}},{key:"setAlphaBlendFunctionParameters",value:function(e,t,n,i){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===n&&this._blendFunctionParameters[3]===i||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=n,this._blendFunctionParameters[3]=i,this._isBlendFunctionParametersDirty=!0)}},{key:"setAlphaEquationParameters",value:function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)}},{key:"reset",value:function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}},{key:"apply",value:function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}]),e}()},1379:function(e,t,n){"use strict";n.d(t,{k:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.Z)(this,e),this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,t&&this.reset()}return(0,r.Z)(e,[{key:"isDirty",get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}},{key:"zOffset",get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}},{key:"zOffsetUnits",get:function(){return this._zOffsetUnits},set:function(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}},{key:"cullFace",get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}},{key:"cull",get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}},{key:"depthFunc",get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}},{key:"depthMask",get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}},{key:"depthTest",get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}},{key:"frontFace",get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}},{key:"reset",value:function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}},{key:"apply",value:function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}]),e}()},5852:function(e,t,n){"use strict";n.d(t,{s:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this.reset()}return(0,r.Z)(e,[{key:"reset",value:function(){this.enabled=!1,this.mask=255,this.func=e.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=e.KEEP,this.opDepthFail=e.KEEP,this.opStencilDepthPass=e.REPLACE}},{key:"stencilFunc",get:function(){return this.func},set:function(e){this.func=e}},{key:"stencilFuncRef",get:function(){return this.funcRef},set:function(e){this.funcRef=e}},{key:"stencilFuncMask",get:function(){return this.funcMask},set:function(e){this.funcMask=e}},{key:"stencilOpStencilFail",get:function(){return this.opStencilFail},set:function(e){this.opStencilFail=e}},{key:"stencilOpDepthFail",get:function(){return this.opDepthFail},set:function(e){this.opDepthFail=e}},{key:"stencilOpStencilDepthPass",get:function(){return this.opStencilDepthPass},set:function(e){this.opStencilDepthPass=e}},{key:"stencilMask",get:function(){return this.mask},set:function(e){this.mask=e}},{key:"stencilTest",get:function(){return this.enabled},set:function(e){this.enabled=e}}]),e}();a.ALWAYS=519,a.KEEP=7680,a.REPLACE=7681},8789:function(e,t,n){"use strict";n.d(t,{C:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.Z)(this,e),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,t&&this.reset()}return(0,r.Z)(e,[{key:"isDirty",get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}},{key:"func",get:function(){return this._func},set:function(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}},{key:"funcRef",get:function(){return this._funcRef},set:function(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}},{key:"funcMask",get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}},{key:"opStencilFail",get:function(){return this._opStencilFail},set:function(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}},{key:"opDepthFail",get:function(){return this._opDepthFail},set:function(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}},{key:"opStencilDepthPass",get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}},{key:"mask",get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}},{key:"reset",value:function(){var e;this.stencilMaterial=void 0,null===(e=this.stencilGlobal)||void 0===e||e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}},{key:"apply",value:function(e){var t;if(e){var n=!this.useStencilGlobalOnly&&!(null===(t=this.stencilMaterial)||void 0===t||!t.enabled);this.enabled=n?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=n?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=n?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=n?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=n?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=n?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=n?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=n?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}}]),e}()},9403:function(e,t,n){"use strict";n.d(t,{p:function(){return a}});var i=n(5671),r=n(3144),a=function(){function e(){(0,i.Z)(this,e),this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return(0,r.Z)(e,[{key:"environmentTexture",get:function(){return this._environmentTexture},set:function(e){this._environmentTexture=e}},{key:"getNodes",value:function(){var e=new Array;return e=(e=(e=(e=e.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach((function(t){return e=e.concat(t.bones)})),e}}],[{key:"AddParser",value:function(e,t){this._BabylonFileParsers[e]=t}},{key:"GetParser",value:function(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null}},{key:"AddIndividualParser",value:function(e,t){this._IndividualBabylonFileParsers[e]=t}},{key:"GetIndividualParser",value:function(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null}},{key:"Parse",value:function(e,t,n,i){for(var r in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,r)&&this._BabylonFileParsers[r](e,t,n,i)}}]),e}();a._BabylonFileParsers={},a._IndividualBabylonFileParsers={}},1396:function(e,t,n){"use strict";n.d(t,{N:function(){return v}});var i=n(3144),r=n(5671),a=n(9477),o=n(6900),s=n(9336),u=n(4174),l=n(4198),c=n(5230);function h(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var d=(0,i.Z)((function e(){(0,r.Z)(this,e),this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new u.y$,this._onClonedObservable=new u.y$})),v=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,r.Z)(this,e),this._isDirty=!1,this._nodeDataStorage=new d,this.state="",this.metadata=null,this.reservedDataStore=null,this._parentContainer=null,this.animations=new Array,this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=o.y3.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new u.y$,this._onDisposeObserver=null,this._behaviors=new Array,this.name=t,this.id=t,this._scene=n||l.l.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return(0,i.Z)(e,[{key:"doNotSerialize",get:function(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(e){this._nodeDataStorage._doNotSerialize=e}},{key:"isDisposed",value:function(){return this._nodeDataStorage._isDisposed}},{key:"parent",get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){var t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var n=this._parentNode._children.indexOf(this);-1!==n&&this._parentNode._children.splice(n,1),e||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}}},{key:"_serializeAsParent",value:function(e){e.parentId=this.uniqueId}},{key:"_addToSceneRootNodes",value:function(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}},{key:"_removeFromSceneRootNodes",value:function(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){var e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}},{key:"animationPropertiesOverride",get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e}},{key:"getClassName",value:function(){return"Node"}},{key:"onDispose",set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}},{key:"onEnabledStateChangedObservable",get:function(){return this._nodeDataStorage._onEnabledStateChangedObservable}},{key:"onClonedObservable",get:function(){return this._nodeDataStorage._onClonedObservable}},{key:"getScene",value:function(){return this._scene}},{key:"getEngine",value:function(){return this._scene.getEngine()}},{key:"addBehavior",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._behaviors.indexOf(e);return-1!==i||(e.init(),this._scene.isLoading&&!n?this._scene.onDataLoadedObservable.addOnce((function(){e.attach(t)})):e.attach(this),this._behaviors.push(e)),this}},{key:"removeBehavior",value:function(e){var t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}},{key:"behaviors",get:function(){return this._behaviors}},{key:"getBehaviorByName",value:function(e){var t,n=h(this._behaviors);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.name===e)return i}}catch(r){n.e(r)}finally{n.f()}return null}},{key:"getWorldMatrix",value:function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}},{key:"_getWorldMatrixDeterminant",value:function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}},{key:"worldMatrixFromCache",get:function(){return this._worldMatrix}},{key:"_initCache",value:function(){this._cache={},this._cache.parent=void 0}},{key:"updateCache",value:function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())}},{key:"_getActionManagerForTrigger",value:function(e){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}},{key:"_updateCache",value:function(e){}},{key:"_isSynchronized",value:function(){return!0}},{key:"_markSyncedWithParent",value:function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}},{key:"isSynchronizedWithParent",value:function(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}},{key:"isSynchronized",value:function(){return this._cache.parent!==this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}},{key:"isReady",value:function(){return this._nodeDataStorage._isReady}},{key:"markAsDirty",value:function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}},{key:"isEnabled",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return!1===e?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}},{key:"_syncParentEnabledState",value:function(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((function(e){e._syncParentEnabledState()}))}},{key:"setEnabled",value:function(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e),this._syncParentEnabledState())}},{key:"isDescendantOf",value:function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))}},{key:"_getDescendants",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if(this._children)for(var i=0;i<this._children.length;i++){var r=this._children[i];n&&!n(r)||e.push(r),t||r._getDescendants(e,!1,n)}}},{key:"getDescendants",value:function(e,t){var n=new Array;return this._getDescendants(n,e,t),n}},{key:"getChildMeshes",value:function(e,t){var n=[];return this._getDescendants(n,e,(function(e){return(!t||t(e))&&void 0!==e.cullingStrategy})),n}},{key:"getChildren",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(t,e)}},{key:"_setReady",value:function(e){e!==this._nodeDataStorage._isReady&&(e?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}},{key:"getAnimationByName",value:function(e){for(var t=0;t<this.animations.length;t++){var n=this.animations[t];if(n.name===e)return n}return null}},{key:"createAnimationRange",value:function(t,n,i){if(!this._ranges[t]){this._ranges[t]=e._AnimationRangeFactory(t,n,i);for(var r=0,a=this.animations.length;r<a;r++)this.animations[r]&&this.animations[r].createRange(t,n,i)}}},{key:"deleteAnimationRange",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=0,i=this.animations.length;n<i;n++)this.animations[n]&&this.animations[n].deleteRange(e,t);this._ranges[e]=null}},{key:"getAnimationRange",value:function(e){return this._ranges[e]||null}},{key:"getAnimationRanges",value:function(){var e,t=[];for(e in this._ranges)t.push(this._ranges[e]);return t}},{key:"beginAnimation",value:function(e,t,n,i){var r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,t,n,i):null}},{key:"serializeAnimationRanges",value:function(){var e=[];for(var t in this._ranges){var n=this._ranges[t];if(n){var i={};i.name=t,i.from=n.from,i.to=n.to,e.push(i)}}return e}},{key:"computeWorldMatrix",value:function(e){return this._worldMatrix||(this._worldMatrix=o.y3.Identity()),this._worldMatrix}},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!e){var n,i=this.getDescendants(!0),r=h(i);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.dispose(e,t)}}catch(l){r.e(l)}finally{r.f()}}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();var o,s=h(this._behaviors);try{for(s.s();!(o=s.n()).done;){var u=o.value;u.detach()}}catch(l){s.e(l)}finally{s.f()}this._behaviors.length=0,this.metadata=null}},{key:"getHierarchyBoundingVectors",value:function(){var e,t,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var r=this;if(r.getBoundingInfo&&r.subMeshes){var a=r.getBoundingInfo();e=a.boundingBox.minimumWorld.clone(),t=a.boundingBox.maximumWorld.clone()}else e=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(n){var s,u=this.getDescendants(!1),l=h(u);try{for(l.s();!(s=l.n()).done;){var c=s.value,f=c;if(f.computeWorldMatrix(!0),(!i||i(f))&&f.getBoundingInfo&&0!==f.getTotalVertices()){var d=f.getBoundingInfo(),v=d.boundingBox,p=v.minimumWorld,_=v.maximumWorld;o.P.CheckExtends(p,e,t),o.P.CheckExtends(_,e,t)}}}catch(g){l.e(g)}finally{l.f()}}return{min:e,max:t}}}],[{key:"AddNodeConstructor",value:function(e,t){this._NodeConstructors[e]=t}},{key:"Construct",value:function(e,t,n,i){var r=this._NodeConstructors[e];return r?r(t,n,i):null}},{key:"ParseAnimationRanges",value:function(e,t,n){if(t.ranges)for(var i=0;i<t.ranges.length;i++){var r=t.ranges[i];e.createAnimationRange(r.name,r.from,r.to)}}}]),e}();v._AnimationRangeFactory=function(e,t,n){throw(0,c.S)("AnimationRange")},v._NodeConstructors={},(0,a.gn)([(0,s.qC)()],v.prototype,"name",void 0),(0,a.gn)([(0,s.qC)()],v.prototype,"id",void 0),(0,a.gn)([(0,s.qC)()],v.prototype,"uniqueId",void 0),(0,a.gn)([(0,s.qC)()],v.prototype,"state",void 0),(0,a.gn)([(0,s.qC)()],v.prototype,"metadata",void 0)},3767:function(e,t,n){"use strict";n.d(t,{H:function(){return f},l:function(){return h}});var i=n(2982),r=n(136),a=n(6215),o=n(1120),s=n(2407),u=n(3144),l=n(5671);function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,o.Z)(e);if(t){var r=(0,o.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,a.Z)(this,n)}}var h=(0,u.Z)((function e(){(0,l.Z)(this,e)}));h.NAME_EFFECTLAYER="EffectLayer",h.NAME_LAYER="Layer",h.NAME_LENSFLARESYSTEM="LensFlareSystem",h.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",h.NAME_PARTICLESYSTEM="ParticleSystem",h.NAME_GAMEPAD="Gamepad",h.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",h.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",h.NAME_PREPASSRENDERER="PrePassRenderer",h.NAME_DEPTHRENDERER="DepthRenderer",h.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",h.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",h.NAME_SPRITE="Sprite",h.NAME_SUBSURFACE="SubSurface",h.NAME_OUTLINERENDERER="Outline",h.NAME_PROCEDURALTEXTURE="ProceduralTexture",h.NAME_SHADOWGENERATOR="ShadowGenerator",h.NAME_OCTREE="Octree",h.NAME_PHYSICSENGINE="PhysicsEngine",h.NAME_AUDIO="Audio",h.STEP_ISREADYFORMESH_EFFECTLAYER=0,h.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,h.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,h.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,h.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,h.STEP_BEFORECAMERADRAW_PREPASS=0,h.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,h.STEP_BEFORECAMERADRAW_LAYER=2,h.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,h.STEP_BEFORERENDERTARGETDRAW_LAYER=1,h.STEP_BEFORERENDERINGMESH_PREPASS=0,h.STEP_BEFORERENDERINGMESH_OUTLINE=1,h.STEP_AFTERRENDERINGMESH_PREPASS=0,h.STEP_AFTERRENDERINGMESH_OUTLINE=1,h.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,h.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,h.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,h.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,h.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,h.STEP_BEFORECLEAR_PREPASS=1,h.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,h.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,h.STEP_AFTERRENDERTARGETDRAW_LAYER=1,h.STEP_AFTERCAMERADRAW_PREPASS=0,h.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,h.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,h.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,h.STEP_AFTERCAMERADRAW_LAYER=4,h.STEP_AFTERRENDER_AUDIO=0,h.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,h.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,h.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,h.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,h.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,h.STEP_POINTERMOVE_SPRITE=0,h.STEP_POINTERDOWN_SPRITE=0,h.STEP_POINTERUP_SPRITE=0;var f=function(e){(0,r.Z)(n,e);var t=c(n);function n(e){return(0,l.Z)(this,n),t.call.apply(t,[this].concat((0,i.Z)(e)))}return(0,u.Z)(n,[{key:"registerStep",value:function(e,t,n){var i=0;for(Number.MAX_VALUE;i<this.length;i++){if(e<this[i].index)break}this.splice(i,0,{index:e,component:t,action:n.bind(t)})}},{key:"clear",value:function(){this.length=0}}],[{key:"Create",value:function(){return Object.create(n.prototype)}}]),n}((0,s.Z)(Array))},9477:function(e,t,n){"use strict";n.d(t,{gn:function(){return i}});function i(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}Object.create;Object.create},4944:function(e,t,n){"use strict";var i=n(2109),r=n(6790),a=n(7908),o=n(6244),s=n(9303),u=n(5417);i({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=a(this),n=o(t),i=u(t,0);return i.length=r(i,t,t,n,0,void 0===e?1:s(e)),i}})},3792:function(e,t,n){n(1223)("flat")},8890:function(e,t,n){"use strict";n.d(t,{Z:function(){return Bn}});var i=n(7294),r=n(2977),a=n(8911),o=n(9522),s=n(4527),u=n(6176);function l(e){var t=[],n=[],i=[],r=[],a=e.width||e.size||1,o=e.height||e.size||1,l=0===e.sideOrientation?0:e.sideOrientation||s.x.DEFAULTSIDE,c=a/2,h=o/2;n.push(-c,-h,0),i.push(0,0,-1),r.push(0,u.e.UseOpenGLOrientationForUV?1:0),n.push(c,-h,0),i.push(0,0,-1),r.push(1,u.e.UseOpenGLOrientationForUV?1:0),n.push(c,h,0),i.push(0,0,-1),r.push(1,u.e.UseOpenGLOrientationForUV?0:1),n.push(-c,h,0),i.push(0,0,-1),r.push(0,u.e.UseOpenGLOrientationForUV?0:1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),s.x._ComputeSides(l,n,t,i,r,e.frontUVs,e.backUVs);var f=new s.x;return f.indices=t,f.positions=n,f.normals=i,f.uvs=r,f}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=new o.Kj(e,n);t.sideOrientation=o.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;var r=l(t);return r.applyToMesh(i,t.updatable),t.sourcePlane&&(i.translate(t.sourcePlane.normal,-t.sourcePlane.d),i.setDirection(t.sourcePlane.normal.scale(-1))),i}s.x.CreatePlane=l,o.Kj.CreatePlane=function(e,t,n,i,r){return c(e,{size:t,width:t,height:t,sideOrientation:r,updatable:i},n)};n(4944),n(3792);var h=n(6900),f=n(7046);function d(e){var t,n=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],r=[],a=e.width||e.size||1,o=e.height||e.size||1,l=e.depth||e.size||1,c=e.wrap||!1,d=void 0===e.topBaseAt?1:e.topBaseAt,v=void 0===e.bottomBaseAt?0:e.bottomBaseAt,p=[2,0,3,1][d=(d+4)%4],_=[2,0,1,3][v=(v+4)%4],g=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(c){n=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],g=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var m=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],y=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],A=[17,18,19,16],E=[22,23,20,21];p>0;)m.unshift(m.pop()),A.unshift(A.pop()),p--;for(;_>0;)y.unshift(y.pop()),E.unshift(E.pop()),_--;m=m.flat(),y=y.flat(),g=g.concat(m).concat(y),n.push(A[0],A[2],A[3],A[0],A[1],A[2]),n.push(E[0],E[2],E[3],E[0],E[1],E[2])}var S=[a/2,o/2,l/2];t=g.reduce((function(e,t,n){return e.concat(t*S[n%3])}),[]);for(var T=0===e.sideOrientation?0:e.sideOrientation||s.x.DEFAULTSIDE,b=e.faceUV||new Array(6),P=e.faceColors,M=[],I=0;I<6;I++)void 0===b[I]&&(b[I]=new h.Lt(0,0,1,1)),P&&void 0===P[I]&&(P[I]=new f.HE(1,1,1,1));for(var C=0;C<6;C++)if(r.push(b[C].z,u.e.UseOpenGLOrientationForUV?1-b[C].w:b[C].w),r.push(b[C].x,u.e.UseOpenGLOrientationForUV?1-b[C].w:b[C].w),r.push(b[C].x,u.e.UseOpenGLOrientationForUV?1-b[C].y:b[C].y),r.push(b[C].z,u.e.UseOpenGLOrientationForUV?1-b[C].y:b[C].y),P)for(var x=0;x<4;x++)M.push(P[C].r,P[C].g,P[C].b,P[C].a);s.x._ComputeSides(T,t,n,i,r,e.frontUVs,e.backUVs);var R=new s.x;if(R.indices=n,R.positions=t,R.normals=i,R.uvs=r,P){var D=T===s.x.DOUBLESIDE?M.concat(M):M;R.colors=D}return R}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=new o.Kj(e,n);t.sideOrientation=o.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation;var r=d(t);return r.applyToMesh(i,t.updatable),i}s.x.CreateBox=d,o.Kj.CreateBox=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a={size:t,sideOrientation:r,updatable:i};return v(e,a,n)};var p,_=n(7702),g=n(3681),m=(n(2465),n(5602));!function(e){e[e.CW=0]="CW",e[e.CCW=1]="CCW"}(p||(p={}));var y=n(3683),A=n(5671),E=n(3144),S=function(){function e(t,n){(0,A.Z)(this,e),this.width=t,this.height=n}return(0,E.Z)(e,[{key:"toString",value:function(){return"{W: ".concat(this.width,", H: ").concat(this.height,"}")}},{key:"getClassName",value:function(){return"Size"}},{key:"getHashCode",value:function(){var e=0|this.width;return e=397*e^(0|this.height)}},{key:"copyFrom",value:function(e){this.width=e.width,this.height=e.height}},{key:"copyFromFloats",value:function(e,t){return this.width=e,this.height=t,this}},{key:"set",value:function(e,t){return this.copyFromFloats(e,t)}},{key:"multiplyByFloats",value:function(t,n){return new e(this.width*t,this.height*n)}},{key:"clone",value:function(){return new e(this.width,this.height)}},{key:"equals",value:function(e){return!!e&&(this.width===e.width&&this.height===e.height)}},{key:"surface",get:function(){return this.width*this.height}},{key:"add",value:function(t){return new e(this.width+t.width,this.height+t.height)}},{key:"subtract",value:function(t){return new e(this.width-t.width,this.height-t.height)}}],[{key:"Zero",value:function(){return new e(0,0)}},{key:"Lerp",value:function(t,n,i){return new e(t.width+(n.width-t.width)*i,t.height+(n.height-t.height)*i)}}]),e}(),T=(n(628),n(7326)),b=n(1752),P=n(136),M=n(6215),I=n(1120),C=n(9477),x=n(9336),R=n(4174),D=n(1396),k=n(3365),O=n(2786),L=function(){function e(){(0,A.Z)(this,e),this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return(0,E.Z)(e,[{key:"name",get:function(){return"AutoRotation"}},{key:"zoomStopsAnimation",get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e}},{key:"idleRotationSpeed",get:function(){return this._idleRotationSpeed},set:function(e){this._idleRotationSpeed=e}},{key:"idleRotationWaitTime",get:function(){return this._idleRotationWaitTime},set:function(e){this._idleRotationWaitTime=e}},{key:"idleRotationSpinupTime",get:function(){return this._idleRotationSpinupTime},set:function(e){this._idleRotationSpinupTime=e}},{key:"rotationInProgress",get:function(){return Math.abs(this._cameraRotationSpeed)>0}},{key:"init",value:function(){}},{key:"attach",value:function(e){var t=this;this._attachedCamera=e;var n=this._attachedCamera.getScene();this._onPrePointerObservableObserver=n.onPrePointerObservable.add((function(e){e.type!==k.kD.POINTERDOWN?e.type===k.kD.POINTERUP&&(t._isPointerDown=!1):t._isPointerDown=!0})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((function(){if(!t._reachTargetAlpha()){var e=O.F.Now,n=0;null!=t._lastFrameTime&&(n=e-t._lastFrameTime),t._lastFrameTime=e,t._applyUserInteraction();var i=e-t._lastInteractionTime-t._idleRotationWaitTime,r=Math.max(Math.min(i/t._idleRotationSpinupTime,1),0);t._cameraRotationSpeed=t._idleRotationSpeed*r,t._attachedCamera&&(t._attachedCamera.alpha-=t._cameraRotationSpeed*(n/1e3))}}))}},{key:"detach",value:function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}}},{key:"resetLastInteractionTime",value:function(e){this._lastInteractionTime=null!=e?e:O.F.Now}},{key:"_reachTargetAlpha",value:function(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<g.kn}},{key:"_userIsZooming",value:function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}},{key:"_shouldAnimationStopForInteraction",value:function(){if(!this._attachedCamera)return!1;var e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()}},{key:"_applyUserInteraction",value:function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=O.F.Now)}},{key:"_userIsMoving",value:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}]),e}();function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}var N=function(){function e(){(0,A.Z)(this,e),this._easingMode=e.EASINGMODE_EASEIN}return(0,E.Z)(e,[{key:"setEasingMode",value:function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t}},{key:"getEasingMode",value:function(){return this._easingMode}},{key:"easeInCore",value:function(e){throw new Error("You must implement this method")}},{key:"ease",value:function(t){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(t);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)}}]),e}();N.EASINGMODE_EASEIN=0,N.EASINGMODE_EASEOUT=1,N.EASINGMODE_EASEINOUT=2;var w,B=function(e){(0,P.Z)(n,e);var t=F(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,A.Z)(this,n),(e=t.call(this)).amplitude=i,e}return(0,E.Z)(n,[{key:"easeInCore",value:function(e){var t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)}}]),n}(N),U=function(e){(0,P.Z)(n,e);var t=F(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return(0,A.Z)(this,n),(e=t.call(this)).exponent=i,e}return(0,E.Z)(n,[{key:"easeInCore",value:function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)}}]),n}(N),V=n(1704);!function(e){e[e.NONE=0]="NONE",e[e.STEP=1]="STEP"}(w||(w={}));var G=function(){function e(t,n,i){(0,A.Z)(this,e),this.name=t,this.from=n,this.to=i}return(0,E.Z)(e,[{key:"clone",value:function(){return new e(this.name,this.from,this.to)}}]),e}(),W=n(8628);function X(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var z=function(){function e(t,n,i,r,a,o){(0,A.Z)(this,e),this.name=t,this.targetProperty=n,this.framePerSecond=i,this.dataType=r,this.loopMode=a,this.enableBlending=o,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=n.split("."),this.dataType=r,this.loopMode=void 0===a?e.ANIMATIONLOOPMODE_CYCLE:a,this.uniqueId=e._UniqueIdGenerator++}return(0,E.Z)(e,[{key:"runtimeAnimations",get:function(){return this._runtimeAnimations}},{key:"hasRunningRuntimeAnimations",get:function(){var e,t=X(this._runtimeAnimations);try{for(t.s();!(e=t.n()).done;){if(!e.value.isStopped())return!0}}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"toString",value:function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var n=!0;for(var i in this._ranges)n&&(t+=", ",n=!1),t+=i;t+="}"}return t}},{key:"addEvent",value:function(e){this._events.push(e),this._events.sort((function(e,t){return e.frame-t.frame}))}},{key:"removeEvents",value:function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)}},{key:"getEvents",value:function(){return this._events}},{key:"createRange",value:function(e,t,n){this._ranges[e]||(this._ranges[e]=new G(e,t,n))}},{key:"deleteRange",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._ranges[e];if(n){if(t)for(var i=n.from,r=n.to,a=this._keys.length-1;a>=0;a--)this._keys[a].frame>=i&&this._keys[a].frame<=r&&this._keys.splice(a,1);this._ranges[e]=null}}},{key:"getRange",value:function(e){return this._ranges[e]}},{key:"getKeys",value:function(){return this._keys}},{key:"getHighestFrame",value:function(){for(var e=0,t=0,n=this._keys.length;t<n;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e}},{key:"getEasingFunction",value:function(){return this._easingFunction}},{key:"setEasingFunction",value:function(e){this._easingFunction=e}},{key:"floatInterpolateFunction",value:function(e,t,n){return m.R.Lerp(e,t,n)}},{key:"floatInterpolateFunctionWithTangents",value:function(e,t,n,i,r){return m.R.Hermite(e,t,n,i,r)}},{key:"quaternionInterpolateFunction",value:function(e,t,n){return h._f.Slerp(e,t,n)}},{key:"quaternionInterpolateFunctionWithTangents",value:function(e,t,n,i,r){return h._f.Hermite(e,t,n,i,r).normalize()}},{key:"vector3InterpolateFunction",value:function(e,t,n){return h.P.Lerp(e,t,n)}},{key:"vector3InterpolateFunctionWithTangents",value:function(e,t,n,i,r){return h.P.Hermite(e,t,n,i,r)}},{key:"vector2InterpolateFunction",value:function(e,t,n){return h.FM.Lerp(e,t,n)}},{key:"vector2InterpolateFunctionWithTangents",value:function(e,t,n,i,r){return h.FM.Hermite(e,t,n,i,r)}},{key:"sizeInterpolateFunction",value:function(e,t,n){return S.Lerp(e,t,n)}},{key:"color3InterpolateFunction",value:function(e,t,n){return f.Wo.Lerp(e,t,n)}},{key:"color3InterpolateFunctionWithTangents",value:function(e,t,n,i,r){return f.Wo.Hermite(e,t,n,i,r)}},{key:"color4InterpolateFunction",value:function(e,t,n){return f.HE.Lerp(e,t,n)}},{key:"color4InterpolateFunctionWithTangents",value:function(e,t,n,i,r){return f.HE.Hermite(e,t,n,i,r)}},{key:"_getKeyValue",value:function(e){return"function"==typeof e?e():e}},{key:"evaluate",value:function(t){return this._interpolate(t,{key:0,repeatCount:0,loopMode:e.ANIMATIONLOOPMODE_CONSTANT})}},{key:"_interpolate",value:function(t,n){if(n.loopMode===e.ANIMATIONLOOPMODE_CONSTANT&&n.repeatCount>0)return n.highLimitValue.clone?n.highLimitValue.clone():n.highLimitValue;for(var i=this._keys,r=i.length,a=n.key;a>=0&&t<i[a].frame;)--a;for(;a+1<=r-1&&t>=i[a+1].frame;)++a;if(n.key=a,a<0)return this._getKeyValue(i[0].value);if(a+1>r-1)return this._getKeyValue(i[r-1].value);var o=i[a],s=i[a+1],u=this._getKeyValue(o.value),l=this._getKeyValue(s.value);if(o.interpolation===w.STEP)return s.frame>t?u:l;var c=void 0!==o.outTangent&&void 0!==s.inTangent,h=s.frame-o.frame,f=(t-o.frame)/h,d=this.getEasingFunction();switch(null!==d&&(f=d.ease(f)),this.dataType){case e.ANIMATIONTYPE_FLOAT:var v=c?this.floatInterpolateFunctionWithTangents(u,o.outTangent*h,l,s.inTangent*h,f):this.floatInterpolateFunction(u,l,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return v;case e.ANIMATIONLOOPMODE_RELATIVE:return n.offsetValue*n.repeatCount+v}break;case e.ANIMATIONTYPE_QUATERNION:var p=c?this.quaternionInterpolateFunctionWithTangents(u,o.outTangent.scale(h),l,s.inTangent.scale(h),f):this.quaternionInterpolateFunction(u,l,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return p;case e.ANIMATIONLOOPMODE_RELATIVE:return p.addInPlace(n.offsetValue.scale(n.repeatCount))}return p;case e.ANIMATIONTYPE_VECTOR3:var _=c?this.vector3InterpolateFunctionWithTangents(u,o.outTangent.scale(h),l,s.inTangent.scale(h),f):this.vector3InterpolateFunction(u,l,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return _;case e.ANIMATIONLOOPMODE_RELATIVE:return _.add(n.offsetValue.scale(n.repeatCount))}break;case e.ANIMATIONTYPE_VECTOR2:var g=c?this.vector2InterpolateFunctionWithTangents(u,o.outTangent.scale(h),l,s.inTangent.scale(h),f):this.vector2InterpolateFunction(u,l,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return g;case e.ANIMATIONLOOPMODE_RELATIVE:return g.add(n.offsetValue.scale(n.repeatCount))}break;case e.ANIMATIONTYPE_SIZE:switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(u,l,f);case e.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(u,l,f).add(n.offsetValue.scale(n.repeatCount))}break;case e.ANIMATIONTYPE_COLOR3:var m=c?this.color3InterpolateFunctionWithTangents(u,o.outTangent.scale(h),l,s.inTangent.scale(h),f):this.color3InterpolateFunction(u,l,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return m;case e.ANIMATIONLOOPMODE_RELATIVE:return m.add(n.offsetValue.scale(n.repeatCount))}break;case e.ANIMATIONTYPE_COLOR4:var y=c?this.color4InterpolateFunctionWithTangents(u,o.outTangent.scale(h),l,s.inTangent.scale(h),f):this.color4InterpolateFunction(u,l,f);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return y;case e.ANIMATIONLOOPMODE_RELATIVE:return y.add(n.offsetValue.scale(n.repeatCount))}break;case e.ANIMATIONTYPE_MATRIX:switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return e.AllowMatricesInterpolation?this.matrixInterpolateFunction(u,l,f,n.workValue):u;case e.ANIMATIONLOOPMODE_RELATIVE:return u}}return 0}},{key:"matrixInterpolateFunction",value:function(t,n,i,r){return e.AllowMatrixDecomposeForInterpolation?r?(h.y3.DecomposeLerpToRef(t,n,i,r),r):h.y3.DecomposeLerp(t,n,i):r?(h.y3.LerpToRef(t,n,i,r),r):h.y3.Lerp(t,n,i)}},{key:"clone",value:function(){var t=new e(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges)for(var n in t._ranges={},this._ranges){var i=this._ranges[n];i&&(t._ranges[n]=i.clone())}return t}},{key:"setKeys",value:function(e){this._keys=e.slice(0)}},{key:"serialize",value:function(){var t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;var n=this.dataType;t.keys=[];for(var i=this.getKeys(),r=0;r<i.length;r++){var a=i[r],o={};switch(o.frame=a.frame,n){case e.ANIMATIONTYPE_FLOAT:o.values=[a.value],void 0!==a.inTangent&&o.values.push(a.inTangent),void 0!==a.outTangent&&(void 0===a.inTangent&&o.values.push(void 0),o.values.push(a.outTangent)),void 0!==a.interpolation&&(void 0===a.inTangent&&o.values.push(void 0),void 0===a.outTangent&&o.values.push(void 0),o.values.push(a.interpolation));break;case e.ANIMATIONTYPE_QUATERNION:case e.ANIMATIONTYPE_MATRIX:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:case e.ANIMATIONTYPE_COLOR4:o.values=a.value.asArray(),null!=a.inTangent&&o.values.push(a.inTangent.asArray()),null!=a.outTangent&&(void 0===a.inTangent&&o.values.push(void 0),o.values.push(a.outTangent.asArray())),void 0!==a.interpolation&&(void 0===a.inTangent&&o.values.push(void 0),void 0===a.outTangent&&o.values.push(void 0),o.values.push(a.interpolation))}t.keys.push(o)}for(var s in t.ranges=[],this._ranges){var u=this._ranges[s];if(u){var l={};l.name=s,l.from=u.from,l.to=u.to,t.ranges.push(l)}}return t}}],[{key:"_PrepareAnimation",value:function(t,n,i,r,a,o,s,u){var l=void 0;if(!isNaN(parseFloat(a))&&isFinite(a)?l=e.ANIMATIONTYPE_FLOAT:a instanceof h._f?l=e.ANIMATIONTYPE_QUATERNION:a instanceof h.P?l=e.ANIMATIONTYPE_VECTOR3:a instanceof h.FM?l=e.ANIMATIONTYPE_VECTOR2:a instanceof f.Wo?l=e.ANIMATIONTYPE_COLOR3:a instanceof f.HE?l=e.ANIMATIONTYPE_COLOR4:a instanceof S&&(l=e.ANIMATIONTYPE_SIZE),null==l)return null;var c=new e(t,n,i,l,s),d=[{frame:0,value:a},{frame:r,value:o}];return c.setKeys(d),void 0!==u&&c.setEasingFunction(u),c}},{key:"CreateAnimation",value:function(t,n,i,r){var a=new e(t+"Animation",t,i,n,e.ANIMATIONLOOPMODE_CONSTANT);return a.setEasingFunction(r),a}},{key:"CreateAndStartAnimation",value:function(t,n,i,r,a,o,s,u,l,c,h){var f=e._PrepareAnimation(t,i,r,a,o,s,u,l);return f?(n.getScene&&(h=n.getScene()),h?h.beginDirectAnimation(n,[f],0,a,1===f.loopMode,1,c):null):null}},{key:"CreateAndStartHierarchyAnimation",value:function(t,n,i,r,a,o,s,u,l,c,h){var f=e._PrepareAnimation(t,r,a,o,s,u,l,c);return f?n.getScene().beginDirectHierarchyAnimation(n,i,[f],0,o,1===f.loopMode,1,h):null}},{key:"CreateMergeAndStartAnimation",value:function(t,n,i,r,a,o,s,u,l,c){var h=e._PrepareAnimation(t,i,r,a,o,s,u,l);return h?(n.animations.push(h),n.getScene().beginAnimation(n,0,a,1===h.loopMode,1,c)):null}},{key:"MakeAnimationAdditive",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,o=t;if(r&&((o=t.clone()).name=a||o.name),!o._keys.length)return o;n=n>=0?n:0;var s=0,u=o._keys[0],l=o._keys.length-1,c=o._keys[l],f={referenceValue:u.value,referencePosition:h.jp.Vector3[0],referenceQuaternion:h.jp.Quaternion[0],referenceScaling:h.jp.Vector3[1],keyPosition:h.jp.Vector3[2],keyQuaternion:h.jp.Quaternion[1],keyScaling:h.jp.Vector3[3]},d=!1,v=u.frame,p=c.frame;if(i){var _=o.getRange(i);_&&(v=_.from,p=_.to)}var g=u.frame===v,m=c.frame===p;if(1===o._keys.length){var y=o._getKeyValue(o._keys[0]);f.referenceValue=y.clone?y.clone():y,d=!0}else if(n<=u.frame){var A=o._getKeyValue(u.value);f.referenceValue=A.clone?A.clone():A,d=!0}else if(n>=c.frame){var E=o._getKeyValue(c.value);f.referenceValue=E.clone?E.clone():E,d=!0}for(var S=0;!d||!g||!m&&S<o._keys.length-1;){var T=o._keys[S],b=o._keys[S+1];if(!d&&n>=T.frame&&n<=b.frame){var P=void 0;if(n===T.frame)P=o._getKeyValue(T.value);else if(n===b.frame)P=o._getKeyValue(b.value);else{var M={key:S,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};P=o._interpolate(n,M)}f.referenceValue=P.clone?P.clone():P,d=!0}if(!g&&v>=T.frame&&v<=b.frame){if(v===T.frame)s=S;else if(v===b.frame)s=S+1;else{var I={key:S,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},C=o._interpolate(v,I),x={frame:v,value:C.clone?C.clone():C};o._keys.splice(S+1,0,x),s=S+1}g=!0}if(!m&&p>=T.frame&&p<=b.frame){if(p===T.frame)l=S;else if(p===b.frame)l=S+1;else{var R={key:S,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},D=o._interpolate(p,R),k={frame:p,value:D.clone?D.clone():D};o._keys.splice(S+1,0,k),l=S+1}m=!0}S++}for(o.dataType===e.ANIMATIONTYPE_QUATERNION?f.referenceValue.normalize().conjugateInPlace():o.dataType===e.ANIMATIONTYPE_MATRIX&&(f.referenceValue.decompose(f.referenceScaling,f.referenceQuaternion,f.referencePosition),f.referenceQuaternion.normalize().conjugateInPlace()),S=s;S<=l;S++){var O=o._keys[S];if(!S||o.dataType===e.ANIMATIONTYPE_FLOAT||O.value!==u.value)switch(o.dataType){case e.ANIMATIONTYPE_MATRIX:O.value.decompose(f.keyScaling,f.keyQuaternion,f.keyPosition),f.keyPosition.subtractInPlace(f.referencePosition),f.keyScaling.divideInPlace(f.referenceScaling),f.referenceQuaternion.multiplyToRef(f.keyQuaternion,f.keyQuaternion),h.y3.ComposeToRef(f.keyScaling,f.keyQuaternion,f.keyPosition,O.value);break;case e.ANIMATIONTYPE_QUATERNION:f.referenceValue.multiplyToRef(O.value,O.value);break;case e.ANIMATIONTYPE_VECTOR2:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:case e.ANIMATIONTYPE_COLOR4:O.value.subtractToRef(f.referenceValue,O.value);break;case e.ANIMATIONTYPE_SIZE:O.value.width-=f.referenceValue.width,O.value.height-=f.referenceValue.height;break;default:O.value-=f.referenceValue}}return o}},{key:"TransitionTo",value:function(e,t,n,i,r,a,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(o<=0)return n[e]=t,s&&s(),null;var u=r*(o/1e3);a.setKeys([{frame:0,value:n[e].clone?n[e].clone():n[e]},{frame:u,value:t}]),n.animations||(n.animations=[]),n.animations.push(a);var l=i.beginAnimation(n,0,u,!1);return l.onAnimationEnd=s,l}},{key:"_UniversalLerp",value:function(e,t,n){var i=e.constructor;return i.Lerp?i.Lerp(e,t,n):i.Slerp?i.Slerp(e,t,n):e.toFixed?e*(1-n)+n*t:t}},{key:"Parse",value:function(t){var n,i,r=new e(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),a=t.dataType,o=[];for(t.enableBlending&&(r.enableBlending=t.enableBlending),t.blendingSpeed&&(r.blendingSpeed=t.blendingSpeed),i=0;i<t.keys.length;i++){var s=t.keys[i],u=void 0,l=void 0,c=void 0;switch(a){case e.ANIMATIONTYPE_FLOAT:n=s.values[0],s.values.length>=2&&(u=s.values[1]),s.values.length>=3&&(l=s.values[2]),s.values.length>=4&&(c=s.values[3]);break;case e.ANIMATIONTYPE_QUATERNION:if(n=h._f.FromArray(s.values),s.values.length>=8){var d=h._f.FromArray(s.values.slice(4,8));d.equals(h._f.Zero())||(u=d)}if(s.values.length>=12){var v=h._f.FromArray(s.values.slice(8,12));v.equals(h._f.Zero())||(l=v)}s.values.length>=13&&(c=s.values[12]);break;case e.ANIMATIONTYPE_MATRIX:n=h.y3.FromArray(s.values),s.values.length>=17&&(c=s.values[16]);break;case e.ANIMATIONTYPE_COLOR3:n=f.Wo.FromArray(s.values),s.values[3]&&(u=f.Wo.FromArray(s.values[3])),s.values[4]&&(l=f.Wo.FromArray(s.values[4])),s.values[5]&&(c=s.values[5]);break;case e.ANIMATIONTYPE_COLOR4:n=f.HE.FromArray(s.values),s.values[4]&&(u=f.HE.FromArray(s.values[4])),s.values[5]&&(l=f.HE.FromArray(s.values[5])),s.values[6]&&(c=f.HE.FromArray(s.values[6]));break;case e.ANIMATIONTYPE_VECTOR3:default:n=h.P.FromArray(s.values),s.values[3]&&(u=h.P.FromArray(s.values[3])),s.values[4]&&(l=h.P.FromArray(s.values[4])),s.values[5]&&(c=s.values[5])}var p={};p.frame=s.frame,p.value=n,null!=u&&(p.inTangent=u),null!=l&&(p.outTangent=l),null!=c&&(p.interpolation=c),o.push(p)}if(r.setKeys(o),t.ranges)for(i=0;i<t.ranges.length;i++)n=t.ranges[i],r.createRange(n.name,n.from,n.to);return r}},{key:"AppendSerializedAnimations",value:function(e,t){x.p4.AppendSerializedAnimations(e,t)}},{key:"ParseFromFileAsync",value:function(e,t){var n=this;return new Promise((function(i,r){var a=new W.g;a.addEventListener("readystatechange",(function(){if(4==a.readyState)if(200==a.status){var t=JSON.parse(a.responseText);if(t.animations&&(t=t.animations),t.length){var o,s=new Array,u=X(t);try{for(u.s();!(o=u.n()).done;){var l=o.value;s.push(n.Parse(l))}}catch(h){u.e(h)}finally{u.f()}i(s)}else{var c=n.Parse(t);e&&(c.name=e),i(c)}}else r("Unable to load the animation")})),a.open("GET",t),a.send()}))}},{key:"ParseFromSnippetAsync",value:function(e){var t=this;return new Promise((function(n,i){var r=new W.g;r.addEventListener("readystatechange",(function(){if(4==r.readyState)if(200==r.status){var a=JSON.parse(JSON.parse(r.responseText).jsonPayload);if(a.animations){var o,s=JSON.parse(a.animations),u=new Array,l=X(s.animations);try{for(l.s();!(o=l.n()).done;){var c=o.value,h=t.Parse(c);h.snippetId=e,u.push(h)}}catch(v){l.e(v)}finally{l.f()}n(u)}else{var f=JSON.parse(a.animation),d=t.Parse(f);d.snippetId=e,n(d)}}else i("Unable to load the snippet "+e)})),r.open("GET",t.SnippetUrl+"/"+e.replace(/#/g,"/")),r.send()}))}}]),e}();z._UniqueIdGenerator=0,z.AllowMatricesInterpolation=!1,z.AllowMatrixDecomposeForInterpolation=!0,z.SnippetUrl="https://snippet.babylonjs.com",z.ANIMATIONTYPE_FLOAT=0,z.ANIMATIONTYPE_VECTOR3=1,z.ANIMATIONTYPE_QUATERNION=2,z.ANIMATIONTYPE_MATRIX=3,z.ANIMATIONTYPE_COLOR3=4,z.ANIMATIONTYPE_COLOR4=7,z.ANIMATIONTYPE_VECTOR2=5,z.ANIMATIONTYPE_SIZE=6,z.ANIMATIONLOOPMODE_RELATIVE=0,z.ANIMATIONLOOPMODE_CYCLE=1,z.ANIMATIONLOOPMODE_CONSTANT=2,z.CreateFromSnippetAsync=z.ParseFromSnippetAsync,(0,V.H)("BABYLON.Animation",z),D.N._AnimationRangeFactory=function(e,t,n){return new G(e,t,n)};var Z=function(){function e(){(0,A.Z)(this,e),this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return(0,E.Z)(e,[{key:"name",get:function(){return"Bouncing"}},{key:"autoTransitionRange",get:function(){return this._autoTransitionRange},set:function(e){var t=this;if(this._autoTransitionRange!==e){this._autoTransitionRange=e;var n=this._attachedCamera;n&&(e?this._onMeshTargetChangedObserver=n.onMeshTargetChangedObservable.add((function(e){if(e){e.computeWorldMatrix(!0);var n=e.getBoundingInfo().diagonalLength;t.lowerRadiusTransitionRange=.05*n,t.upperRadiusTransitionRange=.05*n}})):this._onMeshTargetChangedObserver&&n.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}}},{key:"init",value:function(){}},{key:"attach",value:function(e){var t=this;this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((function(){t._attachedCamera&&(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))}))}},{key:"detach",value:function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}},{key:"_isRadiusAtLimit",value:function(e){return!!this._attachedCamera&&(this._attachedCamera.radius===e&&!this._radiusIsAnimating)}},{key:"_applyBoundRadiusAnimation",value:function(t){var n=this;if(this._attachedCamera){this._radiusBounceTransition||(e.EasingFunction.setEasingMode(e.EasingMode),this._radiusBounceTransition=z.CreateAnimation("radius",z.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var i=z.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(function(){return n._clearAnimationLocks()}));i&&this._animatables.push(i)}}},{key:"_clearAnimationLocks",value:function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}},{key:"stopAllAnimations",value:function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}]),e}();Z.EasingFunction=new B(.3),Z.EasingMode=N.EASINGMODE_EASEOUT;var K=function(){function e(){(0,A.Z)(this,e),this.onTargetFramingAnimationEndObservable=new R.y$,this._mode=e.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return(0,E.Z)(e,[{key:"name",get:function(){return"Framing"}},{key:"mode",get:function(){return this._mode},set:function(e){this._mode=e}},{key:"radiusScale",get:function(){return this._radiusScale},set:function(e){this._radiusScale=e}},{key:"positionScale",get:function(){return this._positionScale},set:function(e){this._positionScale=e}},{key:"defaultElevation",get:function(){return this._defaultElevation},set:function(e){this._defaultElevation=e}},{key:"elevationReturnTime",get:function(){return this._elevationReturnTime},set:function(e){this._elevationReturnTime=e}},{key:"elevationReturnWaitTime",get:function(){return this._elevationReturnWaitTime},set:function(e){this._elevationReturnWaitTime=e}},{key:"zoomStopsAnimation",get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e}},{key:"framingTime",get:function(){return this._framingTime},set:function(e){this._framingTime=e}},{key:"init",value:function(){}},{key:"attach",value:function(t){var n=this;this._attachedCamera=t;var i=this._attachedCamera.getScene();e.EasingFunction.setEasingMode(e.EasingMode),this._onPrePointerObservableObserver=i.onPrePointerObservable.add((function(e){e.type!==k.kD.POINTERDOWN?e.type===k.kD.POINTERUP&&(n._isPointerDown=!1):n._isPointerDown=!0})),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((function(e){e&&n.zoomOnMesh(e,void 0,(function(){n.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((function(){n._applyUserInteraction(),n._maintainCameraAboveGround()}))}},{key:"detach",value:function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}}},{key:"zoomOnMesh",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.computeWorldMatrix(!0);var i=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(i.minimumWorld,i.maximumWorld,t,n)}},{key:"zoomOnMeshHierarchy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.computeWorldMatrix(!0);var i=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(i.min,i.max,t,n)}},{key:"zoomOnMeshesHierarchy",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new h.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=0;a<e.length;a++){var o=e[a].getHierarchyBoundingVectors(!0);h.P.CheckExtends(o.min,i,r),h.P.CheckExtends(o.max,i,r)}this.zoomOnBoundingInfo(i,r,t,n)}},{key:"zoomOnBoundingInfo",value:function(t,n){var i,r=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._attachedCamera){var s=t.y,u=n.y,l=s+(u-s)*this._positionScale,c=n.subtract(t).scale(.5);if(a)i=new h.P(0,l,0);else{var f=t.add(c);i=new h.P(f.x,l,f.z)}this._vectorTransition||(this._vectorTransition=z.CreateAnimation("target",z.ANIMATIONTYPE_VECTOR3,60,e.EasingFunction)),this._betaIsAnimating=!0;var d=z.TransitionTo("target",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);d&&this._animatables.push(d);var v=0;if(this._mode===e.FitFrustumSidesMode){var p=this._calculateLowerRadiusFromModelBoundingSphere(t,n);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=c.length()+this._attachedCamera.minZ),v=p}else this._mode===e.IgnoreBoundsSizeMode&&(v=this._calculateLowerRadiusFromModelBoundingSphere(t,n),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var _=n.subtract(t).length();this._attachedCamera.panningSensibility=5e3/_,this._attachedCamera.wheelPrecision=100/v}this._radiusTransition||(this._radiusTransition=z.CreateAnimation("radius",z.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),(d=z.TransitionTo("radius",v,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(function(){r.stopAllAnimations(),o&&o(),r._attachedCamera&&r._attachedCamera.useInputToRestoreState&&r._attachedCamera.storeState()})))&&this._animatables.push(d)}}},{key:"_calculateLowerRadiusFromModelBoundingSphere",value:function(t,n){var i=n.subtract(t).length(),r=this._getFrustumSlope(),a=.5*i*this._radiusScale,o=a*Math.sqrt(1+1/(r.x*r.x)),s=a*Math.sqrt(1+1/(r.y*r.y)),u=Math.max(o,s),l=this._attachedCamera;return l?(l.lowerRadiusLimit&&this._mode===e.IgnoreBoundsSizeMode&&(u=u<l.lowerRadiusLimit?l.lowerRadiusLimit:u),l.upperRadiusLimit&&(u=u>l.upperRadiusLimit?l.upperRadiusLimit:u),u):0}},{key:"_maintainCameraAboveGround",value:function(){var t=this;if(!(this._elevationReturnTime<0)){var n=O.F.Now-this._lastInteractionTime,i=.5*Math.PI-this._defaultElevation,r=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>r&&n>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=z.CreateAnimation("beta",z.ANIMATIONTYPE_FLOAT,60,e.EasingFunction));var a=z.TransitionTo("beta",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(function(){t._clearAnimationLocks(),t.stopAllAnimations()}));a&&this._animatables.push(a)}}}},{key:"_getFrustumSlope",value:function(){var e=this._attachedCamera;if(!e)return h.FM.Zero();var t=e.getScene().getEngine().getAspectRatio(e),n=Math.tan(e.fov/2),i=n*t;return new h.FM(i,n)}},{key:"_clearAnimationLocks",value:function(){this._betaIsAnimating=!1}},{key:"_applyUserInteraction",value:function(){this.isUserIsMoving&&(this._lastInteractionTime=O.F.Now,this.stopAllAnimations(),this._clearAnimationLocks())}},{key:"stopAllAnimations",value:function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}},{key:"isUserIsMoving",get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}]),e}();K.EasingFunction=new U,K.EasingMode=N.EASINGMODE_EASEINOUT,K.IgnoreBoundsSizeMode=0,K.FitFrustumSidesMode=1;var Y=n(7337);function q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}var j=function(e){(0,P.Z)(n,e);var t=q(n);function n(e,i,r){var a,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return(0,A.Z)(this,n),(a=t.call(this,e,i,r,o))._tmpUpVector=h.P.Zero(),a._tmpTargetVector=h.P.Zero(),a.cameraDirection=new h.P(0,0,0),a.cameraRotation=new h.FM(0,0),a.ignoreParentScaling=!1,a.updateUpVectorFromRotation=!1,a._tmpQuaternion=new h._f,a.rotation=new h.P(0,0,0),a.speed=2,a.noRotationConstraint=!1,a.invertRotation=!1,a.inverseRotationSpeed=.2,a.lockedTarget=null,a._currentTarget=h.P.Zero(),a._initialFocalDistance=1,a._viewMatrix=h.y3.Zero(),a._camMatrix=h.y3.Zero(),a._cameraTransformMatrix=h.y3.Zero(),a._cameraRotationMatrix=h.y3.Zero(),a._referencePoint=new h.P(0,0,1),a._transformedReferencePoint=h.P.Zero(),a._defaultUp=h.P.Up(),a._cachedRotationZ=0,a._cachedQuaternionRotationZ=0,a}return(0,E.Z)(n,[{key:"getFrontPosition",value:function(e){this.getWorldMatrix();var t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)}},{key:"_getLockedTargetPosition",value:function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null}},{key:"storeState",value:function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),(0,b.Z)((0,I.Z)(n.prototype),"storeState",this).call(this)}},{key:"_restoreStateValues",value:function(){return!!(0,b.Z)((0,I.Z)(n.prototype),"_restoreStateValues",this).call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}},{key:"_initCache",value:function(){(0,b.Z)((0,I.Z)(n.prototype),"_initCache",this).call(this),this._cache.lockedTarget=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new h._f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}},{key:"_updateCache",value:function(e){e||(0,b.Z)((0,I.Z)(n.prototype),"_updateCache",this).call(this);var t=this._getLockedTargetPosition();t?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(t):this._cache.lockedTarget=t.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}},{key:"_isSynchronizedViewMatrix",value:function(){if(!(0,b.Z)((0,I.Z)(n.prototype),"_isSynchronizedViewMatrix",this).call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}},{key:"_computeLocalCameraSpeed",value:function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))}},{key:"setTarget",value:function(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=g.kn),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),h.y3.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var t=e.subtract(this.position);t.x>=0?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&h._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}},{key:"target",get:function(){return this.getTarget()},set:function(e){this.setTarget(e)}},{key:"getTarget",value:function(){return this._currentTarget}},{key:"_decideIfNeedsToMove",value:function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}},{key:"_updatePosition",value:function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(h.jp.Matrix[0]),h.P.TransformNormalToRef(this.cameraDirection,h.jp.Matrix[0],h.jp.Vector3[0]),void this.position.addInPlace(h.jp.Vector3[0]);this.position.addInPlace(this.cameraDirection)}},{key:"_checkInputs",value:function(){var e=this.invertRotation?-this.inverseRotationSpeed:1,t=this._decideIfNeedsToMove(),i=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(t&&this._updatePosition(),i){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*e,this.rotation.y+=this.cameraRotation.y*e,!this.noRotationConstraint){var r=1.570796;this.rotation.x>r&&(this.rotation.x=r),this.rotation.x<-r&&(this.rotation.x=-r)}if(this.rotationQuaternion)this.rotation.lengthSquared()&&h._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}t&&(Math.abs(this.cameraDirection.x)<this.speed*g.kn&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*g.kn&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*g.kn&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*g.kn&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*g.kn&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),(0,b.Z)((0,I.Z)(n.prototype),"_checkInputs",this).call(this)}},{key:"_updateCameraRotationMatrix",value:function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):h.y3.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}},{key:"_rotateUpVectorWithCameraRotationMatrix",value:function(){return h.P.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}},{key:"_getViewMatrix",value:function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),h.P.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?_.RD.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(h._f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),_.RD.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}},{key:"_computeViewMatrix",value:function(e,t,n){if(this.ignoreParentScaling){if(this.parent){var i=this.parent.getWorldMatrix();h.P.TransformCoordinatesToRef(e,i,this._globalPosition),h.P.TransformCoordinatesToRef(t,i,this._tmpTargetVector),h.P.TransformNormalToRef(n,i,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(t),this._tmpUpVector.copyFrom(n);this.getScene().useRightHandedSystem?h.y3.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):h.y3.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?h.y3.LookAtRHToRef(e,t,n,this._viewMatrix):h.y3.LookAtLHToRef(e,t,n,this._viewMatrix),this.parent){var r=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(r,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e)}},{key:"createRigCamera",value:function(e,t){if(this.cameraRigMode!==Y.V.RIG_MODE_NONE){var i=new n(e,this.position.clone(),this.getScene());return i.isRigCamera=!0,i.rigParent=this,this.cameraRigMode!==Y.V.RIG_MODE_VR&&this.cameraRigMode!==Y.V.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new h._f),i._cameraRigParams={},i.rotationQuaternion=new h._f),i.mode=this.mode,i.orthoLeft=this.orthoLeft,i.orthoRight=this.orthoRight,i.orthoTop=this.orthoTop,i.orthoBottom=this.orthoBottom,i}return null}},{key:"_updateRigCameras",value:function(){var e=this._rigCameras[0],t=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case Y.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Y.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Y.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Y.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Y.V.RIG_MODE_STEREOSCOPIC_INTERLACED:var i=this.cameraRigMode===Y.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,r=this.cameraRigMode===Y.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,t);break;case Y.V.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),t.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),t.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),t.position.copyFrom(this.position)}(0,b.Z)((0,I.Z)(n.prototype),"_updateRigCameras",this).call(this)}},{key:"_getRigCamPositionAndTarget",value:function(e,t){this.getTarget().subtractToRef(this.position,n._TargetFocalPoint),n._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var i=n._TargetFocalPoint.addInPlace(this.position);h.y3.TranslationToRef(-i.x,-i.y,-i.z,n._TargetTransformMatrix),n._TargetTransformMatrix.multiplyToRef(h.y3.RotationAxis(t.upVector,e),n._RigCamTransformMatrix),h.y3.TranslationToRef(i.x,i.y,i.z,n._TargetTransformMatrix),n._RigCamTransformMatrix.multiplyToRef(n._TargetTransformMatrix,n._RigCamTransformMatrix),h.P.TransformCoordinatesToRef(this.position,n._RigCamTransformMatrix,t.position),t.setTarget(i)}},{key:"getClassName",value:function(){return"TargetCamera"}}]),n}(Y.V);j._RigCamTransformMatrix=new h.y3,j._TargetTransformMatrix=new h.y3,j._TargetFocalPoint=new h.P,(0,C.gn)([(0,x.hd)()],j.prototype,"rotation",void 0),(0,C.gn)([(0,x.qC)()],j.prototype,"speed",void 0),(0,C.gn)([(0,x.RR)("lockedTargetId")],j.prototype,"lockedTarget",void 0);var Q=n(2328),$={},J=function(){function e(t){(0,A.Z)(this,e),this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=function(){}}return(0,E.Z)(e,[{key:"add",value:function(e){var t=e.getSimpleName();this.attached[t]?Q.Y.Warn("camera input of type "+t+" already exists on camera"):(this.attached[t]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedToElement&&e.attachControl(this.noPreventDefault))}},{key:"remove",value:function(e){for(var t in this.attached){var n=this.attached[t];n===e&&(n.detachControl(),n.camera=null,delete this.attached[t],this.rebuildInputCheck())}}},{key:"removeByType",value:function(e){for(var t in this.attached){var n=this.attached[t];n.getClassName()===e&&(n.detachControl(),n.camera=null,delete this.attached[t],this.rebuildInputCheck())}}},{key:"_addCheckInputs",value:function(e){var t=this.checkInputs;return function(){t(),e()}}},{key:"attachInput",value:function(e){this.attachedToElement&&e.attachControl(this.noPreventDefault)}},{key:"attachElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement)for(var t in e=!Y.V.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedToElement=!0,this.noPreventDefault=e,this.attached)this.attached[t].attachControl(e)}},{key:"detachElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t in this.attached)this.attached[t].detachControl(),e&&(this.attached[t].camera=null);this.attachedToElement=!1}},{key:"rebuildInputCheck",value:function(){for(var e in this.checkInputs=function(){},this.attached){var t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}}},{key:"clear",value:function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}}},{key:"serialize",value:function(e){var t={};for(var n in this.attached){var i=this.attached[n],r=x.p4.Serialize(i);t[i.getClassName()]=r}e.inputsmgr=t}},{key:"parse",value:function(e){var t=this,n=e.inputsmgr;if(n){this.clear();var i=function(e){var i=$[e];if(i){var r=n[e],a=x.p4.Parse((function(){return new i}),r,null);t.add(a)}};for(var r in n)i(r)}else{var a=function(n){var i=$[t.attached[n].getClassName()];if(i){var r=x.p4.Parse((function(){return new i}),e,null);t.remove(t.attached[n]),t.add(r)}};for(var o in this.attached)a(o)}}}]),e}(),ee=n(8517),te=function(){function e(){(0,A.Z)(this,e),this._currentActiveButton=-1,this.buttons=[0,1,2]}return(0,E.Z)(e,[{key:"attachControl",value:function(e){var t=this;e=ee.w1.BackCompatCameraNoPreventDefault(arguments);var n=this.camera.getEngine(),i=n.getInputElement(),r=0,a=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(o){var s=o.event,u="touch"===s.pointerType;if(!n.isInVRExclusivePointerMode&&(o.type===k.kD.POINTERMOVE||-1!==t.buttons.indexOf(s.button))){var l=s.target;if(t._altKey=s.altKey,t._ctrlKey=s.ctrlKey,t._metaKey=s.metaKey,t._shiftKey=s.shiftKey,t._buttonsPressed=s.buttons,n.isPointerLock){var c=s.movementX,h=s.movementY;t.onTouch(null,c,h),t._pointA=null,t._pointB=null}else if(o.type!==k.kD.POINTERDOWN||-1!==t._currentActiveButton&&!u)if(o.type===k.kD.POINTERDOUBLETAP)t.onDoubleTap(s.pointerType);else if(o.type!==k.kD.POINTERUP||t._currentActiveButton!==s.button&&!u){if(o.type===k.kD.POINTERMOVE)if(e||s.preventDefault(),t._pointA&&null===t._pointB){var f=s.clientX-t._pointA.x,d=s.clientY-t._pointA.y;t.onTouch(t._pointA,f,d),t._pointA.x=s.clientX,t._pointA.y=s.clientY}else if(t._pointA&&t._pointB){var v=t._pointA.pointerId===s.pointerId?t._pointA:t._pointB;v.x=s.clientX,v.y=s.clientY;var p=t._pointA.x-t._pointB.x,_=t._pointA.y-t._pointB.y,g=p*p+_*_,m={x:(t._pointA.x+t._pointB.x)/2,y:(t._pointA.y+t._pointB.y)/2,pointerId:s.pointerId,type:o.type};t.onMultiTouch(t._pointA,t._pointB,r,g,a,m),a=m,r=g}}else{try{null==l||l.releasePointerCapture(s.pointerId)}catch(y){}u||(t._pointB=null),n._badOS?t._pointA=t._pointB=null:t._pointB&&t._pointA&&t._pointA.pointerId==s.pointerId?(t._pointA=t._pointB,t._pointB=null):t._pointA&&t._pointB&&t._pointB.pointerId==s.pointerId?t._pointB=null:t._pointA=t._pointB=null,(0!==r||a)&&(t.onMultiTouch(t._pointA,t._pointB,r,0,a,null),r=0,a=null),t._currentActiveButton=-1,t.onButtonUp(s),e||s.preventDefault()}else{try{null==l||l.setPointerCapture(s.pointerId)}catch(y){}null===t._pointA?t._pointA={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType}:null===t._pointB&&(t._pointB={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType}),-1!==t._currentActiveButton||u||(t._currentActiveButton=s.button),t.onButtonDown(s),e||(s.preventDefault(),i&&i.focus())}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,k.kD.POINTERDOWN|k.kD.POINTERUP|k.kD.POINTERMOVE|k.kD.POINTERDOUBLETAP),this._onLostFocus=function(){t._pointA=t._pointB=null,r=0,a=null,t.onLostFocus()},this._contextMenuBind=this.onContextMenu.bind(this),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);var o=this.camera.getScene().getEngine().getHostWindow();o&&ee.w1.RegisterTopRootEvents(o,[{name:"blur",handler:this._onLostFocus}])}},{key:"detachControl",value:function(){if(this._onLostFocus){var e=this.camera.getScene().getEngine().getHostWindow();e&&ee.w1.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._contextMenuBind){var t=this.camera.getScene().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}},{key:"getClassName",value:function(){return"BaseCameraPointersInput"}},{key:"getSimpleName",value:function(){return"pointers"}},{key:"onDoubleTap",value:function(e){}},{key:"onTouch",value:function(e,t,n){}},{key:"onMultiTouch",value:function(e,t,n,i,r,a){}},{key:"onContextMenu",value:function(e){e.preventDefault()}},{key:"onButtonDown",value:function(e){}},{key:"onButtonUp",value:function(e){}},{key:"onLostFocus",value:function(){}}]),e}();function ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}(0,C.gn)([(0,x.qC)()],te.prototype,"buttons",void 0);var ie=function(e){(0,P.Z)(n,e);var t=ne(n);function n(){var e;return(0,A.Z)(this,n),(e=t.apply(this,arguments)).buttons=[0,1,2],e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.pinchPrecision=12,e.pinchDeltaPercentage=0,e.useNaturalPinchZoom=!1,e.pinchZoom=!0,e.panningSensibility=1e3,e.multiTouchPanning=!0,e.multiTouchPanAndZoom=!0,e.pinchInwards=!0,e._isPanClick=!1,e._twoFingerActivityCount=0,e._isPinching=!1,e}return(0,E.Z)(n,[{key:"getClassName",value:function(){return"ArcRotateCameraPointersInput"}},{key:"_computeMultiTouchPanning",value:function(e,t){if(0!==this.panningSensibility&&e&&t){var n=t.x-e.x,i=t.y-e.y;this.camera.inertialPanningX+=-n/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility}}},{key:"_computePinchZoom",value:function(e,t){var i=this.camera.radius||n.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(e)/Math.sqrt(t):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(t-e)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(t-e)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}},{key:"onTouch",value:function(e,t,n){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=n/this.angularSensibilityY)}},{key:"onDoubleTap",value:function(){this.camera.useInputToRestoreState&&this.camera.restoreState()}},{key:"onMultiTouch",value:function(e,t,n,i,r,a){0===n&&null===r||0===i&&null===a||(this.multiTouchPanAndZoom?(this._computePinchZoom(n,i),this._computeMultiTouchPanning(r,a)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(i)-Math.sqrt(n))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(n,i),this._isPinching=!0):this._computeMultiTouchPanning(r,a)):this.multiTouchPanning?this._computeMultiTouchPanning(r,a):this.pinchZoom&&this._computePinchZoom(n,i))}},{key:"onButtonDown",value:function(e){this._isPanClick=e.button===this.camera._panningMouseButton}},{key:"onButtonUp",value:function(){this._twoFingerActivityCount=0,this._isPinching=!1}},{key:"onLostFocus",value:function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}]),n}(te);ie.MinimumRadiusForPinch=.001,(0,C.gn)([(0,x.qC)()],ie.prototype,"buttons",void 0),(0,C.gn)([(0,x.qC)()],ie.prototype,"angularSensibilityX",void 0),(0,C.gn)([(0,x.qC)()],ie.prototype,"angularSensibilityY",void 0),(0,C.gn)([(0,x.qC)()],ie.prototype,"pinchPrecision",void 0),(0,C.gn)([(0,x.qC)()],ie.prototype,"pinchDeltaPercentage",void 0),(0,C.gn)([(0,x.qC)()],ie.prototype,"useNaturalPinchZoom",void 0),(0,C.gn)([(0,x.qC)()],ie.prototype,"pinchZoom",void 0),(0,C.gn)([(0,x.qC)()],ie.prototype,"panningSensibility",void 0),(0,C.gn)([(0,x.qC)()],ie.prototype,"multiTouchPanning",void 0),(0,C.gn)([(0,x.qC)()],ie.prototype,"multiTouchPanAndZoom",void 0),$.ArcRotateCameraPointersInput=ie;var re=n(3531),ae=function(){function e(){(0,A.Z)(this,e),this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return(0,E.Z)(e,[{key:"attachControl",value:function(e){var t=this;e=ee.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){t._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(n){var i=n.event;if(!i.metaKey)if(n.type===re.OG.KEYDOWN)t._ctrlPressed=i.ctrlKey,t._altPressed=i.altKey,(-1!==t.keysUp.indexOf(i.keyCode)||-1!==t.keysDown.indexOf(i.keyCode)||-1!==t.keysLeft.indexOf(i.keyCode)||-1!==t.keysRight.indexOf(i.keyCode)||-1!==t.keysReset.indexOf(i.keyCode))&&(-1===t._keys.indexOf(i.keyCode)&&t._keys.push(i.keyCode),i.preventDefault&&(e||i.preventDefault()));else if(-1!==t.keysUp.indexOf(i.keyCode)||-1!==t.keysDown.indexOf(i.keyCode)||-1!==t.keysLeft.indexOf(i.keyCode)||-1!==t.keysRight.indexOf(i.keyCode)||-1!==t.keysReset.indexOf(i.keyCode)){var r=t._keys.indexOf(i.keyCode);r>=0&&t._keys.splice(r,1),i.preventDefault&&(e||i.preventDefault())}})))}},{key:"detachControl",value:function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}},{key:"checkInputs",value:function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var n=this._keys[t];-1!==this.keysLeft.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(n)&&e.useInputToRestoreState&&e.restoreState()}}},{key:"getClassName",value:function(){return"ArcRotateCameraKeyboardMoveInput"}},{key:"getSimpleName",value:function(){return"keyboard"}}]),e}();(0,C.gn)([(0,x.qC)()],ae.prototype,"keysUp",void 0),(0,C.gn)([(0,x.qC)()],ae.prototype,"keysDown",void 0),(0,C.gn)([(0,x.qC)()],ae.prototype,"keysLeft",void 0),(0,C.gn)([(0,x.qC)()],ae.prototype,"keysRight",void 0),(0,C.gn)([(0,x.qC)()],ae.prototype,"keysReset",void 0),(0,C.gn)([(0,x.qC)()],ae.prototype,"panningSensibility",void 0),(0,C.gn)([(0,x.qC)()],ae.prototype,"zoomingSensibility",void 0),(0,C.gn)([(0,x.qC)()],ae.prototype,"useAltToZoom",void 0),(0,C.gn)([(0,x.qC)()],ae.prototype,"angularSpeed",void 0),$.ArcRotateCameraKeyboardMoveInput=ae;var oe=n(1187),se=function(){function e(){(0,A.Z)(this,e),this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._inertialPanning=h.P.Zero()}return(0,E.Z)(e,[{key:"_computeDeltaFromMouseWheelLegacyEvent",value:function(e,t){var n=.01*e*this.wheelDeltaPercentage*t;return e>0?n/(1+this.wheelDeltaPercentage):n*(1+this.wheelDeltaPercentage)}},{key:"attachControl",value:function(e){var t=this;e=ee.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(n){if(n.type===k.kD.POINTERWHEEL){var i=n.event,r=0,a=i.deltaMode===oe.G.DOM_DELTA_LINE?40:1,o=-i.deltaY*a;if(t.customComputeDeltaFromMouseWheel)r=t.customComputeDeltaFromMouseWheel(o,t,i);else if(t.wheelDeltaPercentage){if((r=t._computeDeltaFromMouseWheelLegacyEvent(o,t.camera.radius))>0){for(var s=t.camera.radius,u=t.camera.inertialRadiusOffset+r,l=0;l<20&&Math.abs(u)>.001;l++)s-=u,u*=t.camera.inertia;s=m.R.Clamp(s,0,Number.MAX_VALUE),r=t._computeDeltaFromMouseWheelLegacyEvent(o,s)}}else r=o/(40*t.wheelPrecision);r&&(t.zoomToMouseLocation&&t._hitPlane?t._zoomToMouse(r):t.camera.inertialRadiusOffset+=r),i.preventDefault&&(e||i.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,k.kD.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}},{key:"detachControl",value:function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)}},{key:"checkInputs",value:function(){if(this.zoomToMouseLocation){var e=this.camera;0+e.inertialAlphaOffset+e.inertialBetaOffset+e.inertialRadiusOffset&&(this._updateHitPlane(),e.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(e.inertia),this._zeroIfClose(this._inertialPanning))}}},{key:"getClassName",value:function(){return"ArcRotateCameraMouseWheelInput"}},{key:"getSimpleName",value:function(){return"mousewheel"}},{key:"_updateHitPlane",value:function(){var e=this.camera,t=e.target.subtract(e.position);this._hitPlane=y.J.FromPositionAndNormal(e.target,t)}},{key:"_getPosition",value:function(){var e,t=this.camera,n=t.getScene(),i=n.createPickingRay(n.pointerX,n.pointerY,h.y3.Identity(),t,!1),r=0;this._hitPlane&&(r=null!==(e=i.intersectsPlane(this._hitPlane))&&void 0!==e?e:0);return i.origin.addInPlace(i.direction.scaleInPlace(r))}},{key:"_zoomToMouse",value:function(e){var t=this.camera,n=1-t.inertia;if(t.lowerRadiusLimit){var i,r=null!==(i=t.lowerRadiusLimit)&&void 0!==i?i:0;t.radius-(t.inertialRadiusOffset+e)/n<r&&(e=(t.radius-r)*n-t.inertialRadiusOffset)}if(t.upperRadiusLimit){var a,o=null!==(a=t.upperRadiusLimit)&&void 0!==a?a:0;t.radius-(t.inertialRadiusOffset+e)/n>o&&(e=(t.radius-o)*n-t.inertialRadiusOffset)}var s=e/n/t.radius,u=this._getPosition(),l=h.jp.Vector3[6];u.subtractToRef(t.target,l),l.scaleInPlace(s),l.scaleInPlace(n),this._inertialPanning.addInPlace(l),t.inertialRadiusOffset+=e}},{key:"_zeroIfClose",value:function(e){Math.abs(e.x)<g.kn&&(e.x=0),Math.abs(e.y)<g.kn&&(e.y=0),Math.abs(e.z)<g.kn&&(e.z=0)}}]),e}();function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}(0,C.gn)([(0,x.qC)()],se.prototype,"wheelPrecision",void 0),(0,C.gn)([(0,x.qC)()],se.prototype,"zoomToMouseLocation",void 0),(0,C.gn)([(0,x.qC)()],se.prototype,"wheelDeltaPercentage",void 0),$.ArcRotateCameraMouseWheelInput=se;var le=function(e){(0,P.Z)(n,e);var t=ue(n);function n(e){return(0,A.Z)(this,n),t.call(this,e)}return(0,E.Z)(n,[{key:"addMouseWheel",value:function(){return this.add(new se),this}},{key:"addPointers",value:function(){return this.add(new ie),this}},{key:"addKeyboard",value:function(){return this.add(new ae),this}}]),n}(J);function ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}D.N.AddNodeConstructor("ArcRotateCamera",(function(e,t){return function(){return new he(e,0,0,1,h.P.Zero(),t)}}));var he=function(e){(0,P.Z)(n,e);var t=ce(n);function n(e,i,r,a,o,s){var u,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return(0,A.Z)(this,n),(u=t.call(this,e,h.P.Zero(),s,l)).inertialAlphaOffset=0,u.inertialBetaOffset=0,u.inertialRadiusOffset=0,u.lowerAlphaLimit=null,u.upperAlphaLimit=null,u.lowerBetaLimit=.01,u.upperBetaLimit=Math.PI-.01,u.lowerRadiusLimit=null,u.upperRadiusLimit=null,u.inertialPanningX=0,u.inertialPanningY=0,u.pinchToPanMaxDistance=20,u.panningDistanceLimit=null,u.panningOriginTarget=h.P.Zero(),u.panningInertia=.9,u.zoomOnFactor=1,u.targetScreenOffset=h.FM.Zero(),u.allowUpsideDown=!0,u.useInputToRestoreState=!0,u._viewMatrix=new h.y3,u.panningAxis=new h.P(1,1,0),u._transformedDirection=new h.P,u.mapPanning=!1,u.onMeshTargetChangedObservable=new R.y$,u.checkCollisions=!1,u.collisionRadius=new h.P(.5,.5,.5),u._previousPosition=h.P.Zero(),u._collisionVelocity=h.P.Zero(),u._newPosition=h.P.Zero(),u._computationVector=h.P.Zero(),u._onCollisionPositionChange=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n?(u.setPosition(t),u.onCollide&&u.onCollide(n)):u._previousPosition.copyFrom(u._position);var i=Math.cos(u.alpha),r=Math.sin(u.alpha),a=Math.cos(u.beta),o=Math.sin(u.beta);0===o&&(o=1e-4);var s=u._getTargetPosition();u._computationVector.copyFromFloats(u.radius*i*o,u.radius*a,u.radius*r*o),s.addToRef(u._computationVector,u._newPosition),u._position.copyFrom(u._newPosition);var l=u.upVector;u.allowUpsideDown&&u.beta<0&&(l=(l=l.clone()).negate()),u._computeViewMatrix(u._position,s,l),u._viewMatrix.addAtIndex(12,u.targetScreenOffset.x),u._viewMatrix.addAtIndex(13,u.targetScreenOffset.y),u._collisionTriggered=!1},u._target=h.P.Zero(),o&&u.setTarget(o),u.alpha=i,u.beta=r,u.radius=a,u.getViewMatrix(),u.inputs=new le((0,T.Z)(u)),u.inputs.addKeyboard().addMouseWheel().addPointers(),u}return(0,E.Z)(n,[{key:"target",get:function(){return this._target},set:function(e){this.setTarget(e)}},{key:"targetHost",get:function(){return this._targetHost},set:function(e){e&&this.setTarget(e)}},{key:"getTarget",value:function(){return this.target}},{key:"position",get:function(){return this._position},set:function(e){this.setPosition(e)}},{key:"upVector",get:function(){return this._upVector},set:function(e){this._upToYMatrix||(this._yToUpMatrix=new h.y3,this._upToYMatrix=new h.y3,this._upVector=h.P.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()}},{key:"setMatUp",value:function(){h.y3.RotationAlignToRef(h.P.UpReadOnly,this._upVector,this._yToUpMatrix),h.y3.RotationAlignToRef(this._upVector,h.P.UpReadOnly,this._upToYMatrix)}},{key:"angularSensibilityX",get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)}},{key:"angularSensibilityY",get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)}},{key:"pinchPrecision",get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)}},{key:"pinchDeltaPercentage",get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)}},{key:"useNaturalPinchZoom",get:function(){var e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom},set:function(e){var t=this.inputs.attached.pointers;t&&(t.useNaturalPinchZoom=e)}},{key:"panningSensibility",get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)}},{key:"keysUp",get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}},{key:"keysDown",get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}},{key:"keysLeft",get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}},{key:"keysRight",get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}},{key:"wheelPrecision",get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)}},{key:"zoomToMouseLocation",get:function(){var e=this.inputs.attached.mousewheel;return!!e&&e.zoomToMouseLocation},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.zoomToMouseLocation=e)}},{key:"wheelDeltaPercentage",get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)}},{key:"bouncingBehavior",get:function(){return this._bouncingBehavior}},{key:"useBouncingBehavior",get:function(){return null!=this._bouncingBehavior},set:function(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new Z,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}},{key:"framingBehavior",get:function(){return this._framingBehavior}},{key:"useFramingBehavior",get:function(){return null!=this._framingBehavior},set:function(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new K,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}},{key:"autoRotationBehavior",get:function(){return this._autoRotationBehavior}},{key:"useAutoRotationBehavior",get:function(){return null!=this._autoRotationBehavior},set:function(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new L,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}},{key:"_initCache",value:function(){(0,b.Z)((0,I.Z)(n.prototype),"_initCache",this).call(this),this._cache._target=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=h.FM.Zero()}},{key:"_updateCache",value:function(e){e||(0,b.Z)((0,I.Z)(n.prototype),"_updateCache",this).call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}},{key:"_getTargetPosition",value:function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}var t=this._getLockedTargetPosition();return t||this._target}},{key:"storeState",value:function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),(0,b.Z)((0,I.Z)(n.prototype),"storeState",this).call(this)}},{key:"_restoreStateValues",value:function(){return!!(0,b.Z)((0,I.Z)(n.prototype),"_restoreStateValues",this).call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}},{key:"_isSynchronizedViewMatrix",value:function(){return!!(0,b.Z)((0,I.Z)(n.prototype),"_isSynchronizedViewMatrix",this).call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}},{key:"attachControl",value:function(e,t){var n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments;t=ee.w1.BackCompatCameraNoPreventDefault(a),this._useCtrlForPanning=i,this._panningMouseButton=r,"boolean"==typeof a[0]&&(a.length>1&&(this._useCtrlForPanning=a[1]),a.length>2&&(this._panningMouseButton=a[2])),this.inputs.attachElement(t),this._reset=function(){n.inertialAlphaOffset=0,n.inertialBetaOffset=0,n.inertialRadiusOffset=0,n.inertialPanningX=0,n.inertialPanningY=0}}},{key:"detachControl",value:function(){this.inputs.detachElement(),this._reset&&this._reset()}},{key:"_checkInputs",value:function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var e=this.invertRotation?-1:1,t=this.inertialAlphaOffset;this.beta<=0&&(t*=-1),this.getScene().useRightHandedSystem&&(t*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(t*=-1),this.alpha+=t*e,this.beta+=this.inertialBetaOffset*e,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<g.kn&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<g.kn&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*g.kn&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){var i=new h.P(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),i.multiplyInPlace(this.panningAxis),h.P.TransformNormalToRef(i,this._cameraTransformMatrix,this._transformedDirection),!this.mapPanning&&this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),h.P.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*g.kn&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*g.kn&&(this.inertialPanningY=0)}this._checkLimits(),(0,b.Z)((0,I.Z)(n.prototype),"_checkInputs",this).call(this)}}},{key:"_checkLimits",value:function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}},{key:"rebuildAnglesAndRadius",value:function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||h.P.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);var e=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var t=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=2*t*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}},{key:"setPosition",value:function(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())}},{key:"setTarget",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(r=null!==(t=this.overrideCloneAlphaBetaRadius)&&void 0!==t?t:r,e.getBoundingInfo)this._targetBoundingCenter=n?e.getBoundingInfo().boundingBox.centerWorld.clone():null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var a=e,o=this._getTargetPosition();if(o&&!i&&o.equals(a))return;this._targetHost=null,this._target=a,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}r||this.rebuildAnglesAndRadius()}},{key:"_getViewMatrix",value:function(){var e=Math.cos(this.alpha),t=Math.sin(this.alpha),n=Math.cos(this.beta),i=Math.sin(this.beta);0===i&&(i=1e-4),0===this.radius&&(this.radius=1e-4);var r=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*i,this.radius*n,this.radius*t*i),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||h.P.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),r.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var a=this.getScene().collisionCoordinator;this._collider||(this._collider=a.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,a.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var o=this.upVector;this.allowUpsideDown&&i<0&&(o=o.negate()),this._computeViewMatrix(this._position,r,o),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=r,this._viewMatrix}},{key:"zoomOn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e||this.getScene().meshes;var n=o.Kj.MinMax(e),i=h.P.Distance(n.min,n.max);this.radius=i*this.zoomOnFactor,this.focusOn({min:n.min,max:n.max,distance:i},t)}},{key:"focusOn",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===e.min){var r=e||this.getScene().meshes;t=o.Kj.MinMax(r),n=h.P.Distance(t.min,t.max)}else{var a=e;t=a,n=a.distance}this._target=o.Kj.Center(t),i||(this.maxZ=2*n)}},{key:"createRigCamera",value:function(e,t){var i=0;switch(this.cameraRigMode){case Y.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Y.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Y.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Y.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case Y.V.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===t?1:-1);break;case Y.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===t?-1:1)}var r=new n(e,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return r._cameraRigParams={},r.isRigCamera=!0,r.rigParent=this,r.upVector=this.upVector,r.mode=this.mode,r.orthoLeft=this.orthoLeft,r.orthoRight=this.orthoRight,r.orthoBottom=this.orthoBottom,r.orthoTop=this.orthoTop,r}},{key:"_updateRigCameras",value:function(){var e=this._rigCameras[0],t=this._rigCameras[1];switch(e.beta=t.beta=this.beta,this.cameraRigMode){case Y.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Y.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Y.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Y.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case Y.V.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Y.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}(0,b.Z)((0,I.Z)(n.prototype),"_updateRigCameras",this).call(this)}},{key:"dispose",value:function(){this.inputs.clear(),(0,b.Z)((0,I.Z)(n.prototype),"dispose",this).call(this)}},{key:"getClassName",value:function(){return"ArcRotateCamera"}}]),n}(j);(0,C.gn)([(0,x.qC)()],he.prototype,"alpha",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"beta",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"radius",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,C.gn)([(0,x.hd)("target")],he.prototype,"_target",void 0),(0,C.gn)([(0,x.RR)("targetHost")],he.prototype,"_targetHost",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"inertialAlphaOffset",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"inertialBetaOffset",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"inertialRadiusOffset",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"lowerAlphaLimit",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"upperAlphaLimit",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"lowerBetaLimit",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"upperBetaLimit",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"lowerRadiusLimit",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"upperRadiusLimit",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"inertialPanningX",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"inertialPanningY",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"pinchToPanMaxDistance",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"panningDistanceLimit",void 0),(0,C.gn)([(0,x.hd)()],he.prototype,"panningOriginTarget",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"panningInertia",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"zoomToMouseLocation",null),(0,C.gn)([(0,x.qC)()],he.prototype,"zoomOnFactor",void 0),(0,C.gn)([(0,x.QC)()],he.prototype,"targetScreenOffset",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"allowUpsideDown",void 0),(0,C.gn)([(0,x.qC)()],he.prototype,"useInputToRestoreState",void 0);var fe=n(5934),de=n(2845),ve=function(){function e(){(0,A.Z)(this,e),this.previousWorldMatrices={},this.previousBones={}}return(0,E.Z)(e,[{key:"bindForSubMesh",value:function(e,t,n,i,r){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&-1!==t.prePassRenderer.getIndex(2)){this.previousWorldMatrices[n.uniqueId]||(this.previousWorldMatrices[n.uniqueId]=i.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());var a=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=a.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==a.frameId&&(this._lastUpdateFrameId=a.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[n.uniqueId]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[n.uniqueId]=i.clone()}}}],[{key:"AddUniforms",value:function(e){e.push("previousWorld","previousViewProjection","mPreviousBones")}},{key:"AddSamplers",value:function(e){}}]),e}(),pe=n(7823),_e=n(6556),ge=n(4071),me=n(4771);function ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}var Ae=function(e){(0,P.Z)(n,e);var t=ye(n);function n(e,i){var r,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,A.Z)(this,n),(r=t.call(this,e,i))._normalMatrix=new h.y3,r._storeEffectOnSubMeshes=a,r}return(0,E.Z)(n,[{key:"getEffect",value:function(){return this._storeEffectOnSubMeshes?this._activeEffect:(0,b.Z)((0,I.Z)(n.prototype),"getEffect",this).call(this)}},{key:"isReady",value:function(e,t){return!!e&&(!this._storeEffectOnSubMeshes||(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t)))}},{key:"_isReadyForSubMesh",value:function(e){var t=e.materialDefines;return!(this.checkReadyOnEveryCall||!e.effect||!t||t._renderId!==this.getScene().getRenderId())}},{key:"bindOnlyWorldMatrix",value:function(e){this._activeEffect.setMatrix("world",e)}},{key:"bindOnlyNormalMatrix",value:function(e){this._activeEffect.setMatrix("normalMatrix",e)}},{key:"bind",value:function(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])}},{key:"_afterBind",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,b.Z)((0,I.Z)(n.prototype),"_afterBind",this).call(this,e,t),this.getScene()._cachedEffect=t}},{key:"_mustRebind",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e.isCachedMaterialInvalid(this,t,n)}}]),n}(_e.F),Ee=n(114),Se=n(4198),Te=n(9950);n(562);function be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}var Pe=function(e){(0,P.Z)(n,e);var t=be(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,A.Z)(this,n),(i=t.call(this,null)).metadata=null,i.reservedDataStore=null,i._hasAlpha=!1,i._getAlphaFromRGB=!1,i.level=1,i._coordinatesIndex=0,i.optimizeUVAllocation=!0,i._coordinatesMode=0,i.wrapR=1,i.anisotropicFilteringLevel=n.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,i._isCube=!1,i._gammaSpace=!0,i.invertZ=!1,i.lodLevelInAlpha=!1,i.isRenderTarget=!1,i._prefiltered=!1,i._forceSerialize=!1,i.animations=new Array,i.onDisposeObservable=new R.y$,i._onDisposeObserver=null,i._scene=null,i._uid=null,i._parentContainer=null,i._loadingError=!1,e?n._IsScene(e)?i._scene=e:i._engine=e:i._scene=Se.l.LastCreatedScene,i._scene&&(i.uniqueId=i._scene.getUniqueId(),i._scene.addTexture((0,T.Z)(i)),i._engine=i._scene.getEngine()),i._texture=r,i._uid=null,i}return(0,E.Z)(n,[{key:"hasAlpha",get:function(){return this._hasAlpha},set:function(e){var t=this;this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))}},{key:"getAlphaFromRGB",get:function(){return this._getAlphaFromRGB},set:function(e){var t=this;this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))}},{key:"coordinatesIndex",get:function(){return this._coordinatesIndex},set:function(e){var t=this;this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))}},{key:"coordinatesMode",get:function(){return this._coordinatesMode},set:function(e){var t=this;this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))}},{key:"wrapU",get:function(){return this._wrapU},set:function(e){this._wrapU=e}},{key:"wrapV",get:function(){return this._wrapV},set:function(e){this._wrapV=e}},{key:"isCube",get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(e){this._texture?this._texture.isCube=e:this._isCube=e}},{key:"is3D",get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)}},{key:"is2DArray",get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)}},{key:"gammaSpace",get:function(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace},set:function(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this._markAllSubMeshesAsTexturesDirty()}},{key:"isRGBD",get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(e){this._texture&&(this._texture._isRGBD=e)}},{key:"noMipmap",get:function(){return!1}},{key:"lodGenerationOffset",get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)}},{key:"lodGenerationScale",get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)}},{key:"linearSpecularLOD",get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(e){this._texture&&(this._texture._linearSpecularLOD=e)}},{key:"irradianceTexture",get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(e){this._texture&&(this._texture._irradianceTexture=e)}},{key:"uid",get:function(){return this._uid||(this._uid=(0,Te.f)()),this._uid}},{key:"toString",value:function(){return this.name}},{key:"getClassName",value:function(){return"BaseTexture"}},{key:"onDispose",set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}},{key:"isBlocking",get:function(){return!0}},{key:"loadingError",get:function(){return this._loadingError}},{key:"errorObject",get:function(){return this._errorObject}},{key:"getScene",value:function(){return this._scene}},{key:"_getEngine",value:function(){return this._engine}},{key:"checkTransformsAreIdentical",value:function(e){return null!==e}},{key:"getTextureMatrix",value:function(){return h.y3.IdentityReadOnly}},{key:"getReflectionTextureMatrix",value:function(){return h.y3.IdentityReadOnly}},{key:"isReadyOrNotBlocking",value:function(){return!this.isBlocking||this.isReady()||this.loadingError}},{key:"scale",value:function(e){}},{key:"canRescale",get:function(){return!1}},{key:"_getFromCache",value:function(e,t,n,i,r,a){var o=this._getEngine();if(!o)return null;for(var s=o._getUseSRGBBuffer(!!r,t),u=o.getLoadedTexturesCache(),l=0;l<u.length;l++){var c=u[l];if(!(void 0!==r&&s!==c._useSRGBBuffer||void 0!==i&&i!==c.invertY||c.url!==e||c.generateMipMaps!==!t||n&&n!==c.samplingMode||void 0!==a&&a!==c.isCube))return c.incrementReferences(),c}return null}},{key:"_rebuild",value:function(){}},{key:"clone",value:function(){return null}},{key:"textureType",get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}},{key:"textureFormat",get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}},{key:"_markAllSubMeshesAsTexturesDirty",value:function(){var e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}},{key:"readPixels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;var l=this._getEngine();if(!l)return null;var c=this.getSize(),h=c.width,f=c.height;0!==t&&(h/=Math.pow(2,t),f/=Math.pow(2,t),h=Math.round(h),f=Math.round(f)),s=Math.min(h,s),u=Math.min(f,u);try{return this._texture.isCube?l._readTexturePixels(this._texture,s,u,e,t,n,i,r,a,o):l._readTexturePixels(this._texture,s,u,-1,t,n,i,r,a,o)}catch(d){return null}}},{key:"_readPixelsSync",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;var a=this.getSize(),o=a.width,s=a.height,u=this._getEngine();if(!u)return null;0!=t&&(o/=Math.pow(2,t),s/=Math.pow(2,t),o=Math.round(o),s=Math.round(s));try{return this._texture.isCube?u._readTexturePixelsSync(this._texture,o,s,e,t,n,i,r):u._readTexturePixelsSync(this._texture,o,s,-1,t,n,i,r)}catch(l){return null}}},{key:"_lodTextureHigh",get:function(){return this._texture?this._texture._lodTextureHigh:null}},{key:"_lodTextureMid",get:function(){return this._texture?this._texture._lodTextureMid:null}},{key:"_lodTextureLow",get:function(){return this._texture?this._texture._lodTextureLow:null}},{key:"dispose",value:function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);var e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){var t=this._parentContainer.textures.indexOf(this);t>-1&&this._parentContainer.textures.splice(t,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,(0,b.Z)((0,I.Z)(n.prototype),"dispose",this).call(this)}},{key:"serialize",value:function(){if(!this.name)return null;var e=x.p4.Serialize(this);return x.p4.AppendSerializedAnimations(this,e),e}}],[{key:"WhenAllReady",value:function(e,t){var n=e.length;if(0!==n)for(var i=0;i<e.length;i++){var r=e[i];if(r.isReady())0==--n&&t();else{var a=r.onLoadObservable;a?a.addOnce((function(){0==--n&&t()})):0==--n&&t()}}else t()}},{key:"_IsScene",value:function(e){return"Scene"===e.getClassName()}}]),n}(function(){function e(t){(0,A.Z)(this,e),this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=S.Zero(),this._cachedBaseSize=S.Zero(),this._initialSamplingMode=2,this._texture=t,this._texture&&(this._engine=this._texture.getEngine())}return(0,E.Z)(e,[{key:"wrapU",get:function(){return this._wrapU},set:function(e){this._wrapU=e}},{key:"wrapV",get:function(){return this._wrapV},set:function(e){this._wrapV=e}},{key:"coordinatesMode",get:function(){return 0}},{key:"isCube",get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)}},{key:"is3D",get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)}},{key:"is2DArray",get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)}},{key:"getClassName",value:function(){return"ThinTexture"}},{key:"isReady",value:function(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}},{key:"delayLoad",value:function(){}},{key:"getInternalTexture",value:function(){return this._texture}},{key:"getSize",value:function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}},{key:"getBaseSize",value:function(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}},{key:"samplingMode",get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}},{key:"updateSamplingMode",value:function(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)}},{key:"releaseInternalTexture",value:function(){this._texture&&(this._texture.dispose(),this._texture=null)}},{key:"dispose",value:function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}]),e}());Pe.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,C.gn)([(0,x.qC)()],Pe.prototype,"uniqueId",void 0),(0,C.gn)([(0,x.qC)()],Pe.prototype,"name",void 0),(0,C.gn)([(0,x.qC)()],Pe.prototype,"metadata",void 0),(0,C.gn)([(0,x.qC)("hasAlpha")],Pe.prototype,"_hasAlpha",void 0),(0,C.gn)([(0,x.qC)("getAlphaFromRGB")],Pe.prototype,"_getAlphaFromRGB",void 0),(0,C.gn)([(0,x.qC)()],Pe.prototype,"level",void 0),(0,C.gn)([(0,x.qC)("coordinatesIndex")],Pe.prototype,"_coordinatesIndex",void 0),(0,C.gn)([(0,x.qC)()],Pe.prototype,"optimizeUVAllocation",void 0),(0,C.gn)([(0,x.qC)("coordinatesMode")],Pe.prototype,"_coordinatesMode",void 0),(0,C.gn)([(0,x.qC)()],Pe.prototype,"wrapU",null),(0,C.gn)([(0,x.qC)()],Pe.prototype,"wrapV",null),(0,C.gn)([(0,x.qC)()],Pe.prototype,"wrapR",void 0),(0,C.gn)([(0,x.qC)()],Pe.prototype,"anisotropicFilteringLevel",void 0),(0,C.gn)([(0,x.qC)()],Pe.prototype,"isCube",null),(0,C.gn)([(0,x.qC)()],Pe.prototype,"is3D",null),(0,C.gn)([(0,x.qC)()],Pe.prototype,"is2DArray",null),(0,C.gn)([(0,x.qC)()],Pe.prototype,"gammaSpace",null),(0,C.gn)([(0,x.qC)()],Pe.prototype,"invertZ",void 0),(0,C.gn)([(0,x.qC)()],Pe.prototype,"lodLevelInAlpha",void 0),(0,C.gn)([(0,x.qC)()],Pe.prototype,"lodGenerationOffset",null),(0,C.gn)([(0,x.qC)()],Pe.prototype,"lodGenerationScale",null),(0,C.gn)([(0,x.qC)()],Pe.prototype,"linearSpecularLOD",null),(0,C.gn)([(0,x.oU)()],Pe.prototype,"irradianceTexture",null),(0,C.gn)([(0,x.qC)()],Pe.prototype,"isRenderTarget",void 0);var Me=n(5230),Ie=n(8370),Ce=n(8797),xe=n(2399),Re=n(531),De=n(4687),ke=n.n(De);function Oe(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.width,r=t.height;if(e instanceof Float32Array){for(var a=e.byteLength/e.BYTES_PER_ELEMENT,o=new Uint8Array(a);--a>=0;){var s=e[a];s<0?s=0:s>1&&(s=1),o[a]=255*s}e=o}var u=document.createElement("canvas");u.width=i,u.height=r;var l=u.getContext("2d");if(!l)return null;var c=l.createImageData(i,r),h=c.data;if(h.set(e),l.putImageData(c,0,0),n){var f=document.createElement("canvas");f.width=i,f.height=r;var d=f.getContext("2d");return d?(d.translate(0,r),d.scale(1,-1),d.drawImage(u,0,0),f.toDataURL("image/png")):null}return u.toDataURL("image/png")}function Le(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=e.getInternalTexture();if(!i)return null;var r=e._readPixelsSync(t,n);return r?Oe(r,e.getSize(),i.invertY):null}function Fe(e){return Ne.apply(this,arguments)}function Ne(){return Ne=(0,Re.Z)(ke().mark((function e(t){var n,i,r,a,o=arguments;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:0,i=o.length>2&&void 0!==o[2]?o[2]:0,r=t.getInternalTexture()){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,t.readPixels(n,i);case 7:if(a=e.sent){e.next=10;break}return e.abrupt("return",null);case 10:return e.abrupt("return",Oe(a,t.getSize(),r.invertY));case 11:case"end":return e.stop()}}),e)}))),Ne.apply(this,arguments)}function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}var Be=function(e){(0,P.Z)(n,e);var t=we(n);function n(e,i,r,a){var o,s,l,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.TRILINEAR_SAMPLINGMODE,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]&&arguments[8],p=arguments.length>9?arguments[9]:void 0,_=arguments.length>10?arguments[10]:void 0,g=arguments.length>11?arguments[11]:void 0,m=arguments.length>12?arguments[12]:void 0,y=arguments.length>13?arguments[13]:void 0;(0,A.Z)(this,n),(s=t.call(this,i)).url=null,s.uOffset=0,s.vOffset=0,s.uScale=1,s.vScale=1,s.uAng=0,s.vAng=0,s.wAng=0,s.uRotationCenter=.5,s.vRotationCenter=.5,s.wRotationCenter=.5,s.homogeneousRotationInUVTransform=!1,s.inspectableCustomProperties=null,s._noMipmap=!1,s._invertY=!1,s._rowGenerationMatrix=null,s._cachedTextureMatrix=null,s._projectionModeMatrix=null,s._t0=null,s._t1=null,s._t2=null,s._cachedUOffset=-1,s._cachedVOffset=-1,s._cachedUScale=0,s._cachedVScale=0,s._cachedUAng=-1,s._cachedVAng=-1,s._cachedWAng=-1,s._cachedProjectionMatrixId=-1,s._cachedURotationCenter=-1,s._cachedVRotationCenter=-1,s._cachedWRotationCenter=-1,s._cachedHomogeneousRotationInUVTransform=!1,s._cachedCoordinatesMode=-1,s._buffer=null,s._deleteBuffer=!1,s._format=null,s._delayedOnLoad=null,s._delayedOnError=null,s.onLoadObservable=new R.y$,s._isBlocking=!0,s.name=e||"",s.url=e;var E,S,b,P,I,C,x,D,k,O=!1,L=null;"object"==typeof r&&null!==r?(l=null!==(E=r.noMipmap)&&void 0!==E&&E,a=null!==(S=r.invertY)&&void 0!==S?S:!u.e.UseOpenGLOrientationForUV,c=null!==(b=r.samplingMode)&&void 0!==b?b:n.TRILINEAR_SAMPLINGMODE,h=null!==(P=r.onLoad)&&void 0!==P?P:null,f=null!==(I=r.onError)&&void 0!==I?I:null,d=null!==(C=r.buffer)&&void 0!==C?C:null,v=null!==(x=r.deleteBuffer)&&void 0!==x&&x,p=r.format,_=r.mimeType,g=r.loaderOptions,m=r.creationFlags,O=null!==(D=r.useSRGBBuffer)&&void 0!==D&&D,L=null!==(k=r.internalTexture)&&void 0!==k?k:null):l=!!r;s._noMipmap=l,s._invertY=void 0===a?!u.e.UseOpenGLOrientationForUV:a,s._initialSamplingMode=c,s._buffer=d,s._deleteBuffer=v,s._mimeType=_,s._loaderOptions=g,s._creationFlags=m,s._useSRGBBuffer=O,s._forcedExtension=y,p&&(s._format=p);var F=s.getScene(),N=s._getEngine();if(!N)return(0,M.Z)(s);N.onBeforeTextureInitObservable.notifyObservers((0,T.Z)(s));var w=function(){s._texture&&(s._texture._invertVScale&&(s.vScale*=-1,s.vOffset+=1),null!==s._texture._cachedWrapU&&(s.wrapU=s._texture._cachedWrapU,s._texture._cachedWrapU=null),null!==s._texture._cachedWrapV&&(s.wrapV=s._texture._cachedWrapV,s._texture._cachedWrapV=null),null!==s._texture._cachedWrapR&&(s.wrapR=s._texture._cachedWrapR,s._texture._cachedWrapR=null)),s.onLoadObservable.hasObservers()&&s.onLoadObservable.notifyObservers((0,T.Z)(s)),h&&h(),!s.isBlocking&&F&&F.resetCachedMaterial()},B=function(e,t){s._loadingError=!0,s._errorObject={message:e,exception:t},f&&f(e,t),n.OnTextureLoadErrorObservable.notifyObservers((0,T.Z)(s))};if(!s.url)return s._delayedOnLoad=w,s._delayedOnError=B,(0,M.Z)(s);if(s._texture=null!==(o=L)&&void 0!==o?o:s._getFromCache(s.url,l,c,s._invertY,O),s._texture)if(s._texture.isReady)Ie.Q.SetImmediate((function(){return w()}));else{var U=s._texture.onLoadedObservable.add(w);s._texture.onErrorObservable.add((function(e){var t;B(e.message,e.exception),null===(t=s._texture)||void 0===t||t.onLoadedObservable.remove(U)}))}else if(F&&F.useDelayedTextureLoading)s.delayLoadState=4,s._delayedOnLoad=w,s._delayedOnError=B;else{try{s._texture=N.createTexture(s.url,l,s._invertY,F,c,w,B,s._buffer,void 0,s._format,s._forcedExtension,_,g,m,O)}catch(V){throw B("error loading",V),V}v&&(s._buffer=null)}return s}return(0,E.Z)(n,[{key:"noMipmap",get:function(){return this._noMipmap}},{key:"mimeType",get:function(){return this._mimeType}},{key:"isBlocking",get:function(){return this._isBlocking},set:function(e){this._isBlocking=e}},{key:"invertY",get:function(){return this._invertY}},{key:"updateURL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=i,this.delayLoadState=4,n&&(this._delayedOnLoad=n),this.delayLoad()}},{key:"delayLoad",value:function(){if(4===this.delayLoadState){var e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer),this._texture?this._delayedOnLoad&&(this._texture.isReady?Ie.Q.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}}},{key:"_prepareRowForTextureGeneration",value:function(e,t,n,i){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,n-=this.wRotationCenter,h.P.TransformCoordinatesFromFloatsToRef(e,t,n,this._rowGenerationMatrix,i),i.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,i.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,i.z+=this.wRotationCenter}},{key:"checkTransformsAreIdentical",value:function(e){return null!==e&&this.uOffset===e.uOffset&&this.vOffset===e.vOffset&&this.uScale===e.uScale&&this.vScale===e.vScale&&this.uAng===e.uAng&&this.vAng===e.vAng&&this.wAng===e.wAng}},{key:"getTextureMatrix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*t===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*t,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=h.y3.Zero(),this._rowGenerationMatrix=new h.y3,this._t0=h.P.Zero(),this._t1=h.P.Zero(),this._t2=h.P.Zero()),h.y3.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(h.y3.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,h.jp.Matrix[0]),h.y3.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,h.jp.Matrix[1]),h.y3.ScalingToRef(this._cachedUScale,this._cachedVScale,0,h.jp.Matrix[2]),h.y3.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,h.jp.Matrix[3]),h.jp.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(h.jp.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(h.jp.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(h.jp.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),h.y3.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var n=this.getScene();return n?(this.optimizeUVAllocation&&n.markAllMaterialsAsDirty(1,(function(t){return t.hasTexture(e)})),this._cachedTextureMatrix):this._cachedTextureMatrix}},{key:"getReflectionTextureMatrix",value:function(){var e=this,t=this.getScene();if(!t)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==n.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===t.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}this._cachedTextureMatrix||(this._cachedTextureMatrix=h.y3.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=h.y3.Zero());var i=this._cachedCoordinatesMode!==this.coordinatesMode;switch(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case n.PLANAR_MODE:h.y3.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case n.PROJECTION_MODE:h.y3.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var r=t.getProjectionMatrix();this._cachedProjectionMatrixId=r.updateFlag,r.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:h.y3.IdentityToRef(this._cachedTextureMatrix)}return i&&t.markAllMaterialsAsDirty(1,(function(t){return-1!==t.getActiveTextures().indexOf(e)})),this._cachedTextureMatrix}},{key:"clone",value:function(){var e=this,t={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return x.p4.Clone((function(){return new n(e._texture?e._texture.url:null,e.getScene(),t)}),this)}},{key:"serialize",value:function(){var e=this.name;n.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");var t=(0,b.Z)((0,I.Z)(n.prototype),"serialize",this).call(this);return t?((n.SerializeBuffers||n.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(t.base64String=this._buffer,t.name=t.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?t.base64String="data:image/png;base64,"+(0,xe.Gh)(this._buffer):(n.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(t.base64String=!this._engine||this._engine._features.supportSyncTextureRead?Le(this):Fe(this))),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t._creationFlags=this._creationFlags,t._useSRGBBuffer=this._useSRGBBuffer,this.name=e,t):null}},{key:"getClassName",value:function(){return"Texture"}},{key:"dispose",value:function(){(0,b.Z)((0,I.Z)(n.prototype),"dispose",this).call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null}}],[{key:"Parse",value:function(e,t,i){if(e.customType){var r=Ce.K.Instantiate(e.customType).Parse(e,t,i);return e.samplingMode&&r.updateSamplingMode&&r._samplingMode&&r._samplingMode!==e.samplingMode&&r.updateSamplingMode(e.samplingMode),r}if(e.isCube&&!e.isRenderTarget)return n._CubeTextureParser(e,t,i);if(!e.name&&!e.isRenderTarget)return null;var a=function(t){if(t&&t._texture&&(t._texture._cachedWrapU=null,t._texture._cachedWrapV=null,t._texture._cachedWrapR=null),e.samplingMode){var n=e.samplingMode;t&&t.samplingMode!==n&&t.updateSamplingMode(n)}if(t&&e.animations)for(var i=0;i<e.animations.length;i++){var r=e.animations[i],a=(0,V.q)("BABYLON.Animation");a&&t.animations.push(a.Parse(r))}};return x.p4.Parse((function(){var r,o,s,u,l=!0;if(e.noMipmap&&(l=!1),e.mirrorPlane){var c=n._CreateMirror(e.name,e.renderTargetSize,t,l);return c._waitingRenderList=e.renderList,c.mirrorPlane=y.J.FromArray(e.mirrorPlane),a(c),c}if(e.isRenderTarget){var h,f=null;if(e.isCube){if(t.reflectionProbes)for(var d=0;d<t.reflectionProbes.length;d++){var v=t.reflectionProbes[d];if(v.name===e.name)return v.cubeTexture}}else(f=n._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,l,null!==(h=e._creationFlags)&&void 0!==h?h:0))._waitingRenderList=e.renderList;return a(f),f}return e.base64String?(r=n.CreateFromBase64String(e.base64String,e.base64String,t,!l,e.invertY,e.samplingMode,(function(){a(r)}),null!==(o=e._creationFlags)&&void 0!==o?o:0,null!==(s=e._useSRGBBuffer)&&void 0!==s&&s)).name=e.name:(u=e.name&&e.name.indexOf("://")>0?e.name:i+e.name,e.url&&(e.url.startsWith("data:")||n.UseSerializedUrlIfAny)&&(u=e.url),r=new n(u,t,!l,e.invertY,e.samplingMode,(function(){a(r)}))),r}),e,t)}},{key:"CreateFromBase64String",value:function(e,t,i,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n.TRILINEAR_SAMPLINGMODE,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,c=arguments.length>9?arguments[9]:void 0;return new n("data:"+t,i,r,a,o,s,u,e,!1,l,void 0,void 0,c)}},{key:"LoadFromDataString",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n.TRILINEAR_SAMPLINGMODE,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,h=arguments.length>10?arguments[10]:void 0;return"data:"!==e.substr(0,5)&&(e="data:"+e),new n(e,i,a,o,s,u,l,t,r,c,void 0,void 0,h)}}]),n}(Pe);Be.SerializeBuffers=!0,Be.ForceSerializeBuffers=!1,Be.OnTextureLoadErrorObservable=new R.y$,Be._CubeTextureParser=function(e,t,n){throw(0,Me.S)("CubeTexture")},Be._CreateMirror=function(e,t,n,i){throw(0,Me.S)("MirrorTexture")},Be._CreateRenderTargetTexture=function(e,t,n,i,r){throw(0,Me.S)("RenderTargetTexture")},Be.NEAREST_SAMPLINGMODE=1,Be.NEAREST_NEAREST_MIPLINEAR=8,Be.BILINEAR_SAMPLINGMODE=2,Be.LINEAR_LINEAR_MIPNEAREST=11,Be.TRILINEAR_SAMPLINGMODE=3,Be.LINEAR_LINEAR_MIPLINEAR=3,Be.NEAREST_NEAREST_MIPNEAREST=4,Be.NEAREST_LINEAR_MIPNEAREST=5,Be.NEAREST_LINEAR_MIPLINEAR=6,Be.NEAREST_LINEAR=7,Be.NEAREST_NEAREST=1,Be.LINEAR_NEAREST_MIPNEAREST=9,Be.LINEAR_NEAREST_MIPLINEAR=10,Be.LINEAR_LINEAR=2,Be.LINEAR_NEAREST=12,Be.EXPLICIT_MODE=0,Be.SPHERICAL_MODE=1,Be.PLANAR_MODE=2,Be.CUBIC_MODE=3,Be.PROJECTION_MODE=4,Be.SKYBOX_MODE=5,Be.INVCUBIC_MODE=6,Be.EQUIRECTANGULAR_MODE=7,Be.FIXED_EQUIRECTANGULAR_MODE=8,Be.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Be.CLAMP_ADDRESSMODE=0,Be.WRAP_ADDRESSMODE=1,Be.MIRROR_ADDRESSMODE=2,Be.UseSerializedUrlIfAny=!1,(0,C.gn)([(0,x.qC)()],Be.prototype,"url",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"uOffset",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"vOffset",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"uScale",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"vScale",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"uAng",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"vAng",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"wAng",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"uRotationCenter",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"vRotationCenter",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"wRotationCenter",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"homogeneousRotationInUVTransform",void 0),(0,C.gn)([(0,x.qC)()],Be.prototype,"isBlocking",null),(0,V.H)("BABYLON.Texture",Be),x.p4._TextureParser=Be.Parse;var Ue=function(){function e(){(0,A.Z)(this,e)}return(0,E.Z)(e,null,[{key:"DiffuseTextureEnabled",get:function(){return this._DiffuseTextureEnabled},set:function(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"DetailTextureEnabled",get:function(){return this._DetailTextureEnabled},set:function(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"AmbientTextureEnabled",get:function(){return this._AmbientTextureEnabled},set:function(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"OpacityTextureEnabled",get:function(){return this._OpacityTextureEnabled},set:function(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"ReflectionTextureEnabled",get:function(){return this._ReflectionTextureEnabled},set:function(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"EmissiveTextureEnabled",get:function(){return this._EmissiveTextureEnabled},set:function(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"SpecularTextureEnabled",get:function(){return this._SpecularTextureEnabled},set:function(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"BumpTextureEnabled",get:function(){return this._BumpTextureEnabled},set:function(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"LightmapTextureEnabled",get:function(){return this._LightmapTextureEnabled},set:function(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"RefractionTextureEnabled",get:function(){return this._RefractionTextureEnabled},set:function(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"ColorGradingTextureEnabled",get:function(){return this._ColorGradingTextureEnabled},set:function(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"FresnelEnabled",get:function(){return this._FresnelEnabled},set:function(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,r.D.MarkAllMaterialsAsDirty(4))}},{key:"ClearCoatTextureEnabled",get:function(){return this._ClearCoatTextureEnabled},set:function(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"ClearCoatBumpTextureEnabled",get:function(){return this._ClearCoatBumpTextureEnabled},set:function(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"ClearCoatTintTextureEnabled",get:function(){return this._ClearCoatTintTextureEnabled},set:function(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"SheenTextureEnabled",get:function(){return this._SheenTextureEnabled},set:function(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"AnisotropicTextureEnabled",get:function(){return this._AnisotropicTextureEnabled},set:function(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"ThicknessTextureEnabled",get:function(){return this._ThicknessTextureEnabled},set:function(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"RefractionIntensityTextureEnabled",get:function(){return this._ThicknessTextureEnabled},set:function(e){this._RefractionIntensityTextureEnabled!==e&&(this._RefractionIntensityTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"TranslucencyIntensityTextureEnabled",get:function(){return this._ThicknessTextureEnabled},set:function(e){this._TranslucencyIntensityTextureEnabled!==e&&(this._TranslucencyIntensityTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}},{key:"IridescenceTextureEnabled",get:function(){return this._IridescenceTextureEnabled},set:function(e){this._IridescenceTextureEnabled!==e&&(this._IridescenceTextureEnabled=e,r.D.MarkAllMaterialsAsDirty(1))}}]),e}();Ue._DiffuseTextureEnabled=!0,Ue._DetailTextureEnabled=!0,Ue._AmbientTextureEnabled=!0,Ue._OpacityTextureEnabled=!0,Ue._ReflectionTextureEnabled=!0,Ue._EmissiveTextureEnabled=!0,Ue._SpecularTextureEnabled=!0,Ue._BumpTextureEnabled=!0,Ue._LightmapTextureEnabled=!0,Ue._RefractionTextureEnabled=!0,Ue._ColorGradingTextureEnabled=!0,Ue._FresnelEnabled=!0,Ue._ClearCoatTextureEnabled=!0,Ue._ClearCoatBumpTextureEnabled=!0,Ue._ClearCoatTintTextureEnabled=!0,Ue._SheenTextureEnabled=!0,Ue._AnisotropicTextureEnabled=!0,Ue._ThicknessTextureEnabled=!0,Ue._RefractionIntensityTextureEnabled=!0,Ue._TranslucencyIntensityTextureEnabled=!0,Ue._IridescenceTextureEnabled=!0;var Ve=n(8084),Ge="uniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform vec3 vAmbientColor;\nuniform float visibility;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#if defined(USE_LOCAL_REFRACTIONMAP_CUBIC) && defined(REFRACTIONMAP_3D)\nuniform vec3 vRefractionPosition;\nuniform vec3 vRefractionSize; \n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n";Ve.v.IncludesShadersStore.defaultFragmentDeclaration=Ge;var We="layout(std140,column_major) uniform;\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif \nmat4 view;\nmat4 projection;\nvec4 vEyePosition;\n};\n";Ve.v.IncludesShadersStore.sceneUboDeclaration=We;var Xe="#ifdef WEBGL2\nuniform mat4 world;\nuniform float visibility;\n#else\nlayout(std140,column_major) uniform;\nuniform Mesh\n{\nmat4 world;\nfloat visibility;\n};\n#endif\n#define WORLD_UBO\n";Ve.v.IncludesShadersStore.meshUboDeclaration=Xe;var He="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nfloat alphaCutOff;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec3 vRefractionPosition;\nvec3 vRefractionSize;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nvec4 vDiffuseColor;\nvec3 vAmbientColor;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n";Ve.v.IncludesShadersStore.defaultUboDeclaration=He;var ze="#ifdef PREPASS\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out highp vec4 glFragData[{X}];highp vec4 gl_FragColor;\n#ifdef PREPASS_DEPTH\nvarying highp vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nvarying highp vec4 vCurrentPosition;varying highp vec4 vPreviousPosition;\n#endif\n#endif\n";Ve.v.IncludesShadersStore.prePassDeclaration=ze;var Ze="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out vec2 depth; \nlayout(location=1) out vec4 frontColor;\nlayout(location=2) out vec4 backColor;\n#define MAX_DEPTH 99999.0\nhighp vec4 gl_FragColor;\nuniform sampler2D oitDepthSampler;\nuniform sampler2D oitFrontColorSampler;\n#endif\n";Ve.v.IncludesShadersStore.oitDeclaration=Ze;var Ke="#ifdef MAINUV{X}\nvarying vec2 vMainUV{X};\n#endif\n";Ve.v.IncludesShadersStore.mainUVVaryingDeclaration=Ke;var Ye="const float PI=3.1415926535897932384626433832795;\nconst float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{\nvec3 nearZeroSection=0.0773993808*color;\nvec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{\nvec3 nearZeroSection=12.92*color;\nvec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;\nfloat remainingSection=pow(0.947867299*(color+0.055),2.4);\nreturn color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;\nfloat remainingSection=1.055*pow(color,0.41666)-0.055;\nreturn color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nvec3 square(vec3 value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat normVariance=varianceAmount/255.0;\nfloat dither=mix(-normVariance,normVariance,rand);\nreturn dither;\n}\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D =max(rgbdMaxRange/maxRGB,1.);\nD =clamp(floor(D)/255.0,0.,1.);\nvec3 rgb=color.rgb*D;\nrgb=toGammaSpace(rgb);\nreturn vec4(clamp(rgb,0.,1.),D); \n}\nvec3 fromRGBD(vec4 rgbd) {\nrgbd.rgb=toLinearSpace(rgbd.rgb);\nreturn rgbd.rgb/rgbd.a;\n}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\nvec3 intersectPositionWS=vertexPos+origVec*distance;\nreturn intersectPositionWS-cubePos;\n}\n";Ve.v.IncludesShadersStore.helperFunctions=Ye;var qe="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif\n";Ve.v.IncludesShadersStore.lightFragmentDeclaration=qe;var je="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X}; \n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n";Ve.v.IncludesShadersStore.lightUboDeclaration=je;var Qe="struct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w==0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}";Ve.v.IncludesShadersStore.lightsFragmentFunctions=Qe;var $e="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\n#define inline\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nreturn depth>shadow ? darkness : 1.0;\n}\n#define inline\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\n#define inline\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness); \nreturn esm;\n}\n#define inline\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\n#if defined(WEBGL2) || defined(WEBGPU)\n#define inline\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nvec3 uvLayer=vec3(uv.x,uv.y,layer);\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;\n}\n#endif\n#define inline\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;\n}\n}\n#define inline\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#ifdef IS_NDC_HALF_ZRANGE\n#define ZINCLIP clipSpace.z\n#else\n#define ZINCLIP uvDepth.z\n#endif\n#if defined(WEBGL2) || defined(WEBGPU)\n#define GREATEST_LESS_THAN_ONE 0.99999994\n#define inline\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat shadow=texture2D(shadowSampler,uvDepthLayer);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n#define inline\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture2D(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nelse\n{\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\nfloat AAOffset=shadowMapSizeInverse*10.;\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);\nvec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec4 offset=vec4(poissonSamplers[i],0.);\noffset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);\nshadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\nshadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture2D(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nelse\n{\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\nfloat AAOffset=shadowMapSizeInverse*10.;\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n}\n#define inline\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\n#define inline\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\n#define inline\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\n#define inline\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#define inline\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#define inline\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#endif\n#endif\n";Ve.v.IncludesShadersStore.shadowsFragmentFunctions=$e;var Je="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\nuniform sampler2D _SAMPLERNAME_Sampler;\n#endif\n";Ve.v.IncludesShadersStore.samplerFragmentDeclaration=Je;var et="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif\n";Ve.v.IncludesShadersStore.fresnelFunction=et;var tt="vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0); \n}\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(1.0-s,t,0); \n}\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=worldPos.xyz-eyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*(view*worldPos));\n}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*vec4(positionW,1.));\n}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\n";Ve.v.IncludesShadersStore.reflectionFunction=tt;var nt="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";Ve.v.IncludesShadersStore.imageProcessingDeclaration=nt;var it="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\ncolor=saturate(color);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);\nfloat dither=mix(-ditherIntensity,ditherIntensity,rand);\nresult.rgb=saturate(result.rgb+vec3(dither));\n#endif\nreturn result;\n}";Ve.v.IncludesShadersStore.imageProcessingFunctions=it;var rt="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\nvec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)\n{\n#ifdef NORMALXYSCALE\nnormal=normalize(normal*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*normal);\n}\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{\nreturn perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);\n}\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n";Ve.v.IncludesShadersStore.bumpFragmentMainFunctions=rt;var at="#if defined(BUMP)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)\n#endif\n#if defined(DETAIL)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,texCoord+vCurrOffset).w;\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n";Ve.v.IncludesShadersStore.bumpFragmentFunctions=at;var ot="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";Ve.v.IncludesShadersStore.clipPlaneFragmentDeclaration=ot;var st="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif\n";Ve.v.IncludesShadersStore.logDepthDeclaration=st;var ut="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR==vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif\n";Ve.v.IncludesShadersStore.fogFragmentDeclaration=ut;var lt="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{\ndiscard;\n}\n#endif\n";Ve.v.IncludesShadersStore.clipPlaneFragment=lt;var ct="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#elif defined(BUMP)\nfloat normalScale=vBumpInfos.y;\n#else\nfloat normalScale=1.0;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#elif defined(BUMP)\nvec2 TBNUV=gl_FrontFacing ? vBumpUV : -vBumpUV;\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vTangentSpaceParams);\n#else\nvec2 TBNUV=gl_FrontFacing ? vDetailUV : -vDetailUV;\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nvec2 TBNUV=gl_FrontFacing ? vMainUV1 : -vMainUV1;\nmat3 TBN=cotangent_frame(normalW,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef DETAIL\nvec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);\nvec2 detailNormalRG=detailColor.wy*2.0-1.0;\nfloat detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));\nvec3 detailNormal=vec3(detailNormalRG,detailNormalB);\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz *2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#elif !defined(DETAIL)\nnormalW=perturbNormal(TBN,texture2D(bumpSampler,vBumpUV+uvOffset).xyz,vBumpInfos.y);\n#else\nvec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;\n#if DETAIL_NORMALBLENDMETHOD==0 \ndetailNormal.xy*=vDetailInfos.z;\nvec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));\n#elif DETAIL_NORMALBLENDMETHOD==1 \ndetailNormal.xy*=vDetailInfos.z;\nbumpNormal+=vec3(0.0,0.0,1.0);\ndetailNormal*=vec3(-1.0,-1.0,1.0);\nvec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;\n#endif\nnormalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);\n#endif\n#elif defined(DETAIL)\ndetailNormal.xy*=vDetailInfos.z;\nnormalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);\n#endif\n";Ve.v.IncludesShadersStore.bumpFragment=ct;var ht="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif\n";Ve.v.IncludesShadersStore.depthPrePass=ht;var ft="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#ifdef IRIDESCENCE\npreInfo.iridescenceIntensity=iridescenceIntensity;\n#endif\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\npreInfo.roughness=sheenOut.sheenIntensity;\n#else\n#ifdef HEMILIGHT{X}\npreInfo.roughness=sheenOut.sheenRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef CLEARCOAT\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearcoatOut.clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\nabsorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) \n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {\nindex{X}=i;\nbreak;\n}\n}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];\nfloat diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};\nif (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{\nindex{X}+=1;\nfloat nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else \ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif\n";Ve.v.IncludesShadersStore.lightFragment=ft;var dt="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";Ve.v.IncludesShadersStore.logDepthFragment=dt;var vt="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";Ve.v.IncludesShadersStore.fogFragment=vt;var pt="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\nfloat fragDepth=gl_FragCoord.z; \n#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS\nuint halfFloat=packHalf2x16(vec2(fragDepth));\nvec2 full=unpackHalf2x16(halfFloat);\nfragDepth=full.x;\n#endif\nivec2 fragCoord=ivec2(gl_FragCoord.xy);\nvec2 lastDepth=texelFetch(oitDepthSampler,fragCoord,0).rg;\nvec4 lastFrontColor=texelFetch(oitFrontColorSampler,fragCoord,0);\ndepth.rg=vec2(-MAX_DEPTH);\nfrontColor=lastFrontColor;\nbackColor=vec4(0.0);\n#ifdef USE_REVERSE_DEPTHBUFFER\nfloat furthestDepth=-lastDepth.x;\nfloat nearestDepth=lastDepth.y;\n#else\nfloat nearestDepth=-lastDepth.x;\nfloat furthestDepth=lastDepth.y;\n#endif\nfloat alphaMultiplier=1.0-lastFrontColor.a;\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth>nearestDepth || fragDepth<furthestDepth) {\n#else\nif (fragDepth<nearestDepth || fragDepth>furthestDepth) {\n#endif\nreturn;\n}\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth<nearestDepth && fragDepth>furthestDepth) {\n#else\nif (fragDepth>nearestDepth && fragDepth<furthestDepth) {\n#endif\ndepth.rg=vec2(-fragDepth,fragDepth);\nreturn;\n}\n#endif\n";Ve.v.IncludesShadersStore.oitFragment=pt;var _t="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\n#include<oitDeclaration>\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#define RECIPROCAL_PI2 0.15915494\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_SAMPLERNAME_,diffuse)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULARTERM)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_SAMPLERNAME_,specular)\n#endif\n#include<fresnelFunction>\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\nfloat alpha=vDiffuseColor.a;\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef DETAIL\nbaseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec4 refractionColor=vec4(0.,0.,0.,1.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\n#ifdef USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,vRefractionSize,vRefractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector);\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords);\n#endif\n#ifdef RGBDREFRACTION\nrefractionColor.rgb=fromRGBD(refractionColor);\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor.rgb=toGammaSpace(refractionColor.rgb);\n#endif\nrefractionColor.rgb*=vRefractionInfos.x;\n#endif\nvec4 reflectionColor=vec4(0.,0.,0.,1.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nvReflectionUVW.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords);\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor.rgb=toGammaSpace(reflectionColor.rgb);\n#endif\nreflectionColor.rgb*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n#ifdef ALPHATEST\n#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS\nif (alpha<alphaCutOff)\ndiscard;\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);\n#endif\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor.rgb;\n#else\ncolor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=color.a>0.4 ? 1.0 : 0.0;\ngl_FragData[0]=color; \n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_IRRADIANCE\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4((view*vec4(normalW,0.0)).rgb,writeGeometryInfo); \n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#if defined(SPECULARTERM)\n#if defined(SPECULAR)\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularMapColor)*writeGeometryInfo; \n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularColor,1.0)*writeGeometryInfo;\n#endif\n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0)*writeGeometryInfo;\n#endif\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=color;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {\nfrontColor.rgb+=color.rgb*color.a*alphaMultiplier;\nfrontColor.a=1.0-alphaMultiplier*(1.0-color.a);\n} else {\nbackColor+=color;\n}\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";Ve.v.ShadersStore.defaultPixelShader=_t;var gt="uniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\nuniform mat4 detailMatrix;\n#endif\n#define ADDITIONAL_VERTEX_DECLARATION\n";Ve.v.IncludesShadersStore.defaultVertexDeclaration=gt;var mt="#ifdef UV{X}\nattribute vec2 uv{X};\n#endif\n";Ve.v.IncludesShadersStore.uvAttributeDeclaration=mt;var yt="#if NUM_BONE_INFLUENCERS>0\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#ifdef BONES_VELOCITY_ENABLED\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#endif\n#ifdef BONETEXTURE\n#define inline\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index *4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif\n#endif\n";Ve.v.IncludesShadersStore.bonesDeclaration=yt;var At="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform float bakedVertexAnimationTime;\nuniform vec2 bakedVertexAnimationTextureSizeInverted;\nuniform vec4 bakedVertexAnimationSettings;\nuniform sampler2D bakedVertexAnimationTexture;\n#ifdef INSTANCES\nattribute vec4 bakedVertexAnimationSettingsInstanced;\n#endif\n#define inline\nmat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)\n{\nfloat offset=index*4.0;\nfloat frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;\nfloat dx=bakedVertexAnimationTextureSizeInverted.x;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n";Ve.v.IncludesShadersStore.bakedVertexAnimationDeclaration=At;var Et="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#ifdef INSTANCESCOLOR\nattribute vec4 instanceColor;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute vec4 previousWorld0;\nattribute vec4 previousWorld1;\nattribute vec4 previousWorld2;\nattribute vec4 previousWorld3;\n#ifdef THIN_INSTANCES\nuniform mat4 previousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform mat4 previousWorld;\n#endif\n#endif\n";Ve.v.IncludesShadersStore.instancesDeclaration=Et;var St="#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nuniform mat4 previousViewProjection;\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\n#endif\n";Ve.v.IncludesShadersStore.prePassVertexDeclaration=St;var Tt="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n";Ve.v.IncludesShadersStore.samplerVertexDeclaration=Tt;var bt="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n";Ve.v.IncludesShadersStore.bumpVertexDeclaration=bt;var Pt="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nvarying float fClipDistance6;\n#endif\n";Ve.v.IncludesShadersStore.clipPlaneVertexDeclaration=Pt;var Mt="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";Ve.v.IncludesShadersStore.fogVertexDeclaration=Mt;var It="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#endif\n";Ve.v.IncludesShadersStore.lightVxFragmentDeclaration=It;var Ct="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n";Ve.v.IncludesShadersStore.lightVxUboDeclaration=Ct;var xt="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#ifdef MORPHTARGETS_TEXTURE \nprecision mediump sampler2DArray; \nuniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];\nuniform vec3 morphTargetTextureInfo;\nuniform sampler2DArray morphTargets;\nvec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)\n{ \nfloat y=floor(vertexIndex/morphTargetTextureInfo.y);\nfloat x=vertexIndex-y*morphTargetTextureInfo.y;\nvec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);\nreturn texture(morphTargets,textureUV).xyz;\n}\n#endif\n#endif\n";Ve.v.IncludesShadersStore.morphTargetsVertexGlobalDeclaration=xt;var Rt="#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#endif\n#endif\n";Ve.v.IncludesShadersStore.morphTargetsVertexDeclaration=Rt;var Dt="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nfloat vertexID;\n#endif\n#endif\n";Ve.v.IncludesShadersStore.morphTargetsVertexGlobal=Dt;var kt="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE \nvertexID=float(gl_VertexID)*morphTargetTextureInfo.x;\npositionUpdated+=(readVector3FromRawSampler({X},vertexID)-position)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(readVector3FromRawSampler({X},vertexID) -normal)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(readVector3FromRawSampler({X},vertexID).xy-uv)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(readVector3FromRawSampler({X},vertexID) -tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#else\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n";Ve.v.IncludesShadersStore.morphTargetsVertex=kt;var Ot="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,previousWorld2,previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\nfinalWorld=world*finalWorld;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\nmat4 finalWorld=world;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=previousWorld;\n#endif\n#endif\n";Ve.v.IncludesShadersStore.instancesVertex=Ot;var Lt="#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n";Ve.v.IncludesShadersStore.bonesVertex=Lt;var Ft="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\n#define BVASNAME bakedVertexAnimationSettingsInstanced\n#else\n#define BVASNAME bakedVertexAnimationSettings\n#endif\nfloat VATStartFrame=BVASNAME.x;\nfloat VATEndFrame=BVASNAME.y;\nfloat VATOffsetFrame=BVASNAME.z;\nfloat VATSpeed=BVASNAME.w;\nfloat totalFrames=VATEndFrame-VATStartFrame+1.0;\nfloat time=bakedVertexAnimationTime*VATSpeed/totalFrames;\nfloat frameCorrection=time<1.0 ? 0.0 : 1.0;\nfloat numOfFrames=totalFrames-frameCorrection;\nfloat VATFrameNum=fract(time)*numOfFrames;\nVATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);\nVATFrameNum=floor(VATFrameNum);\nVATFrameNum+=VATStartFrame+frameCorrection;\nmat4 VATInfluence;\nVATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;\n}\n#endif\n";Ve.v.IncludesShadersStore.bakedVertexAnimation=Ft;var Nt="#ifdef PREPASS_DEPTH\nvViewPos=(view*worldPos).rgb;\n#endif\n#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*worldPos;\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;\npreviousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*finalPreviousWorld*previousInfluence*vec4(positionUpdated,1.0);\n#else\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#endif\n";Ve.v.IncludesShadersStore.prePassVertex=Nt;var wt="#if !defined(UV{X}) && defined(MAINUV{X})\nvec2 uv{X}=vec2(0.,0.);\n#endif\n#ifdef MAINUV{X}\nvMainUV{X}=uv{X};\n#endif\n";Ve.v.IncludesShadersStore.uvVariableDeclaration=wt;var Bt="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nif (v_INFONAME_==0.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uvUpdated,1.0,0.0));\n}\n#ifdef UV2\nelse if (v_INFONAME_==1.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef UV3\nelse if (v_INFONAME_==2.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv3,1.0,0.0));\n}\n#endif\n#ifdef UV4\nelse if (v_INFONAME_==3.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv4,1.0,0.0));\n}\n#endif\n#ifdef UV5\nelse if (v_INFONAME_==4.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv5,1.0,0.0));\n}\n#endif\n#ifdef UV6\nelse if (v_INFONAME_==5.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv6,1.0,0.0));\n}\n#endif\n#endif\n";Ve.v.IncludesShadersStore.samplerVertexImplementation=Bt;var Ut="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif\n";Ve.v.IncludesShadersStore.bumpVertex=Ut;var Vt="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";Ve.v.IncludesShadersStore.clipPlaneVertex=Vt;var Gt="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";Ve.v.IncludesShadersStore.fogVertex=Gt;var Wt="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {\nvPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}[i]=(-vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}[i]=(vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}=(-vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}=(vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#endif\n";Ve.v.IncludesShadersStore.shadowsVertex=Wt;var Xt="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvColor=vec4(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvColor*=color;\n#else\nvColor.rgb*=color.rgb;\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvColor*=instanceColor;\n#endif\n#endif\n";Ve.v.IncludesShadersStore.vertexColorMixing=Xt;var Ht="#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n";Ve.v.IncludesShadersStore.pointCloudVertex=Ht;var zt="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";Ve.v.IncludesShadersStore.logDepthVertex=zt;var Zt="#include<__decl__defaultVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<mainUVVaryingDeclaration>[1..7]\n#include<samplerVertexDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#if defined(SPECULARTERM)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular)\n#endif\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));\nvNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_MATRIXNAME_,diffuse,_INFONAME_,DiffuseInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#if defined(SPECULARTERM)\n#include<samplerVertexImplementation>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_MATRIXNAME_,specular,_INFONAME_,SpecularInfos.x)\n#endif\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";Ve.v.ShadersStore.defaultVertexShader=Zt;function Kt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Yt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var qt=function(){function e(){(0,A.Z)(this,e),this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return(0,E.Z)(e,[{key:"unBindMesh",value:function(){this._mesh=null}},{key:"addFallback",value:function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)}},{key:"addCPUSkinningFallback",value:function(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)}},{key:"hasMoreFallbacks",get:function(){return this._currentRank<=this._maxRank}},{key:"reduce",value:function(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;for(var n=this._mesh.getScene(),i=0;i<n.meshes.length;i++){var r=n.meshes[i];if(r.material){if(r.computeBonesUsingShaders&&0!==r.numBoneInfluencers)if(r.material.getEffect()===t)r.computeBonesUsingShaders=!1;else if(r.subMeshes){var a,o=Kt(r.subMeshes);try{for(o.s();!(a=o.n()).done;){if(a.value.effect===t){r.computeBonesUsingShaders=!1;break}}}catch(l){o.e(l)}finally{o.f()}}}else!this._mesh.material&&r.computeBonesUsingShaders&&r.numBoneInfluencers>0&&(r.computeBonesUsingShaders=!1)}}else{var s=this._defines[this._currentRank];if(s)for(var u=0;u<s.length;u++)e=e.replace("#define "+s[u],"");this._currentRank++}return e}}]),e}(),jt=n(2982);function Qt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return $t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $t(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function $t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var Jt=function(){function e(t){(0,A.Z)(this,e),this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=t,this._scene=t.getScene(),this._engine=this._scene.getEngine()}return(0,E.Z)(e,[{key:"_addPlugin",value:function(t){for(var n=0;n<this._plugins.length;++n)if(this._plugins[n].name===t.name)throw'Plugin "'.concat(t.name,'" already added to the material "').concat(this._material.name,'"!');if(this._material._uniformBufferLayoutBuilt)throw'The plugin "'.concat(t.name,'" can\'t be added to the material "').concat(this._material.name,'" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.');var i=t.getClassName();e._MaterialPluginClassToMainDefine[i]||(e._MaterialPluginClassToMainDefine[i]="MATERIALPLUGIN_"+ ++e._MaterialPluginCounter),this._material._callbackPluginEventGeneric=this._handlePluginEvent.bind(this),this._plugins.push(t),this._plugins.sort((function(e,t){return e.priority-t.priority})),this._codeInjectionPoints={};var r={};r[e._MaterialPluginClassToMainDefine[i]]={type:"boolean",default:!0};var a,o=Qt(this._plugins);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.collectDefines(r),this._collectPointNames("vertex",s.getCustomCode("vertex")),this._collectPointNames("fragment",s.getCustomCode("fragment"))}}catch(u){o.e(u)}finally{o.f()}this._defineNamesFromPlugins=r}},{key:"_activatePlugin",value:function(e){-1===this._activePlugins.indexOf(e)&&(this._activePlugins.push(e),this._activePlugins.sort((function(e,t){return e.priority-t.priority})),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),e.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(e),this._activePluginsForExtraEvents.sort((function(e,t){return e.priority-t.priority})),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}},{key:"getPlugin",value:function(e){for(var t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e)return this._plugins[t];return null}},{key:"_handlePluginEventIsReadyForSubMesh",value:function(e){var t,n=!0,i=Qt(this._activePlugins);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=n&&r.isReadyForSubMesh(e.defines,this._scene,this._engine,e.subMesh)}}catch(a){i.e(a)}finally{i.f()}e.isReadyForSubMesh=n}},{key:"_handlePluginEventPrepareDefinesBeforeAttributes",value:function(e){var t,n=Qt(this._activePlugins);try{for(n.s();!(t=n.n()).done;){t.value.prepareDefinesBeforeAttributes(e.defines,this._scene,e.mesh)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_handlePluginEventPrepareDefines",value:function(e){var t,n=Qt(this._activePlugins);try{for(n.s();!(t=n.n()).done;){t.value.prepareDefines(e.defines,this._scene,e.mesh)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_handlePluginEventHardBindForSubMesh",value:function(e){var t,n=Qt(this._activePluginsForExtraEvents);try{for(n.s();!(t=n.n()).done;){t.value.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_handlePluginEventBindForSubMesh",value:function(e){var t,n=Qt(this._activePlugins);try{for(n.s();!(t=n.n()).done;){t.value.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_handlePluginEventHasRenderTargetTextures",value:function(e){var t,n=!1,i=Qt(this._activePluginsForExtraEvents);try{for(i.s();!(t=i.n()).done;){if(n=t.value.hasRenderTargetTextures())break}}catch(r){i.e(r)}finally{i.f()}e.hasRenderTargetTextures=n}},{key:"_handlePluginEventFillRenderTargetTextures",value:function(e){var t,n=Qt(this._activePluginsForExtraEvents);try{for(n.s();!(t=n.n()).done;){t.value.fillRenderTargetTextures(e.renderTargets)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_handlePluginEvent",value:function(e,t){switch(e){case ge.S.GetActiveTextures:var n,i=t,r=Qt(this._activePlugins);try{for(r.s();!(n=r.n()).done;){n.value.getActiveTextures(i.activeTextures)}}catch(R){r.e(R)}finally{r.f()}break;case ge.S.GetAnimatables:var a,o=t,s=Qt(this._activePlugins);try{for(s.s();!(a=s.n()).done;){a.value.getAnimatables(o.animatables)}}catch(R){s.e(R)}finally{s.f()}break;case ge.S.HasTexture:var u,l=t,c=!1,h=Qt(this._activePlugins);try{for(h.s();!(u=h.n()).done;){if(c=u.value.hasTexture(l.texture))break}}catch(R){h.e(R)}finally{h.f()}l.hasTexture=c;break;case ge.S.Disposed:var f,d=t,v=Qt(this._plugins);try{for(v.s();!(f=v.n()).done;){f.value.dispose(d.forceDisposeTextures)}}catch(R){v.e(R)}finally{v.f()}break;case ge.S.GetDefineNames:t.defineNames=this._defineNamesFromPlugins;break;case ge.S.PrepareEffect:var p,_,g,m,y=t,A=Qt(this._activePlugins);try{for(A.s();!(p=A.n()).done;){var E=p.value;y.fallbackRank=E.addFallbacks(y.defines,y.fallbacks,y.fallbackRank),E.getAttributes(y.attributes,this._scene,y.mesh)}}catch(R){A.e(R)}finally{A.f()}if(this._uniformList.length>0)(_=y.uniforms).push.apply(_,(0,jt.Z)(this._uniformList));if(this._samplerList.length>0)(g=y.samplers).push.apply(g,(0,jt.Z)(this._samplerList));if(this._uboList.length>0)(m=y.uniformBuffersNames).push.apply(m,(0,jt.Z)(this._uboList));y.customCode=this._injectCustomCode(y.customCode);break;case ge.S.PrepareUniformBuffer:var S=t;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];var T,b=Qt(this._plugins);try{for(b.s();!(T=b.n()).done;){var P=T.value,M=P.getUniforms();if(M){if(M.ubo){var I,C=Qt(M.ubo);try{for(C.s();!(I=C.n()).done;){var x=I.value;S.ubo.addUniform(x.name,x.size),this._uboDeclaration+="".concat(x.type," ").concat(x.name,";\r\n"),this._uniformList.push(x.name)}}catch(R){C.e(R)}finally{C.f()}}M.vertex&&(this._vertexDeclaration+=M.vertex+"\r\n"),M.fragment&&(this._fragmentDeclaration+=M.fragment+"\r\n")}P.getSamplers(this._samplerList),P.getUniformBuffersNames(this._uboList)}}catch(R){b.e(R)}finally{b.f()}}}},{key:"_collectPointNames",value:function(e,t){if(t)for(var n in t)this._codeInjectionPoints[e]||(this._codeInjectionPoints[e]={}),this._codeInjectionPoints[e][n]=!0}},{key:"_injectCustomCode",value:function(e){var t=this;return function(n,i){var r;e&&(i=e(n,i)),t._uboDeclaration&&(i=i.replace("#define ADDITIONAL_UBO_DECLARATION",t._uboDeclaration)),t._vertexDeclaration&&(i=i.replace("#define ADDITIONAL_VERTEX_DECLARATION",t._vertexDeclaration)),t._fragmentDeclaration&&(i=i.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",t._fragmentDeclaration));var a=null===(r=t._codeInjectionPoints)||void 0===r?void 0:r[n];if(!a)return i;for(var o in a){var s,u="",l=Qt(t._activePlugins);try{for(l.s();!(s=l.n()).done;){var c=s.value.getCustomCode(n);null!=c&&c[o]&&(u+=c[o]+"\r\n")}}catch(_){l.e(_)}finally{l.f()}if(u.length>0)if("!"===o.charAt(0))for(var h=new RegExp(o.substring(1),"g"),f=h.exec(i);null!==f;){for(var d=u,v=0;v<f.length;++v)d=d.replace("$"+v,f[v]);i=i.replace(f[0],d),f=h.exec(i)}else{var p="#define "+o;i=i.replace(p,"\r\n"+u+"\r\n"+p)}}return i}}}]),e}();Jt._MaterialPluginClassToMainDefine={},Jt._MaterialPluginCounter=0;var en=function(){function e(t,n,i,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];(0,A.Z)(this,e),this.priority=500,this.registerForExtraEvents=!1,this._material=t,this.name=n,this.priority=i,t.pluginManager||(t.pluginManager=new Jt(t)),this._pluginDefineNames=r,this._pluginManager=t.pluginManager,a&&this._pluginManager._addPlugin(this),o&&this._enable(!0),this.markAllDefinesAsDirty=t._dirtyCallbacks[63]}return(0,E.Z)(e,[{key:"_enable",value:function(e){e&&this._pluginManager._activatePlugin(this)}},{key:"getClassName",value:function(){return"MaterialPluginBase"}},{key:"isReadyForSubMesh",value:function(e,t,n,i){return!0}},{key:"hardBindForSubMesh",value:function(e,t,n,i){}},{key:"bindForSubMesh",value:function(e,t,n,i){}},{key:"dispose",value:function(e){}},{key:"getCustomCode",value:function(e){return null}},{key:"collectDefines",value:function(e){if(this._pluginDefineNames)for(var t=0,n=Object.keys(this._pluginDefineNames);t<n.length;t++){var i=n[t];if("_"!==i[0]){var r=typeof this._pluginDefineNames[i];e[i]={type:"number"===r?"number":"string"===r?"string":"boolean"===r?"boolean":"object",default:this._pluginDefineNames[i]}}}}},{key:"prepareDefinesBeforeAttributes",value:function(e,t,n){}},{key:"prepareDefines",value:function(e,t,n){}},{key:"hasTexture",value:function(e){return!1}},{key:"hasRenderTargetTextures",value:function(){return!1}},{key:"fillRenderTargetTextures",value:function(e){}},{key:"getActiveTextures",value:function(e){}},{key:"getAnimatables",value:function(e){}},{key:"addFallbacks",value:function(e,t,n){return n}},{key:"getSamplers",value:function(e){}},{key:"getAttributes",value:function(e,t,n){}},{key:"getUniformBuffersNames",value:function(e){}},{key:"getUniforms",value:function(){return{}}},{key:"copyTo",value:function(e){x.p4.Clone((function(){return e}),this)}},{key:"serialize",value:function(){return x.p4.Serialize(this)}},{key:"parse",value:function(e,t,n){var i=this;x.p4.Parse((function(){return i}),e,t,n)}}]),e}();function tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}(0,C.gn)([(0,x.qC)()],en.prototype,"name",void 0),(0,C.gn)([(0,x.qC)()],en.prototype,"priority",void 0),(0,C.gn)([(0,x.qC)()],en.prototype,"registerForExtraEvents",void 0);var nn=function(e){(0,P.Z)(n,e);var t=tn(n);function n(){var e;return(0,A.Z)(this,n),(e=t.apply(this,arguments)).DETAIL=!1,e.DETAILDIRECTUV=0,e.DETAIL_NORMALBLENDMETHOD=0,e}return(0,E.Z)(n)}(me.H),rn=function(e){(0,P.Z)(n,e);var t=tn(n);function n(e){var i,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,A.Z)(this,n),(i=t.call(this,e,"DetailMap",140,new nn,r))._texture=null,i.diffuseBlendLevel=1,i.roughnessBlendLevel=1,i.bumpLevel=1,i._normalBlendMethod=_e.F.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,i._isEnabled=!1,i.isEnabled=!1,i._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],i}return(0,E.Z)(n,[{key:"_markAllSubMeshesAsTexturesDirty",value:function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}},{key:"isReadyForSubMesh",value:function(e,t,n){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&n.getCaps().standardDerivatives&&this._texture&&Ue.DetailTextureEnabled&&!this._texture.isReady())}},{key:"prepareDefines",value:function(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var n=t.getEngine();e._areTexturesDirty&&(n.getCaps().standardDerivatives&&this._texture&&Ue.DetailTextureEnabled&&this._isEnabled?(Ee.G.PrepareDefinesForMergedUV(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1}},{key:"bindForSubMesh",value:function(e,t){if(this._isEnabled){var n=this._material.isFrozen;e.useUbo&&n&&e.isSync||this._texture&&Ue.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),Ee.G.BindTextureMatrix(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&Ue.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture)}}},{key:"hasTexture",value:function(e){return this._texture===e}},{key:"getActiveTextures",value:function(e){this._texture&&e.push(this._texture)}},{key:"getAnimatables",value:function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}},{key:"dispose",value:function(e){var t;e&&(null===(t=this._texture)||void 0===t||t.dispose())}},{key:"getClassName",value:function(){return"DetailMapConfiguration"}},{key:"getSamplers",value:function(e){e.push("detailSampler")}},{key:"getUniforms",value:function(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}]),n}(en);function an(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}(0,C.gn)([(0,x.oU)("detailTexture"),(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],rn.prototype,"texture",void 0),(0,C.gn)([(0,x.qC)()],rn.prototype,"diffuseBlendLevel",void 0),(0,C.gn)([(0,x.qC)()],rn.prototype,"roughnessBlendLevel",void 0),(0,C.gn)([(0,x.qC)()],rn.prototype,"bumpLevel",void 0),(0,C.gn)([(0,x.qC)(),(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],rn.prototype,"normalBlendMethod",void 0),(0,C.gn)([(0,x.qC)(),(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],rn.prototype,"isEnabled",void 0);var on={effect:null,subMesh:null},sn=function(e){(0,P.Z)(n,e);var t=an(n);function n(e){var i;return(0,A.Z)(this,n),(i=t.call(this,e)).MAINUV1=!1,i.MAINUV2=!1,i.MAINUV3=!1,i.MAINUV4=!1,i.MAINUV5=!1,i.MAINUV6=!1,i.DIFFUSE=!1,i.DIFFUSEDIRECTUV=0,i.BAKED_VERTEX_ANIMATION_TEXTURE=!1,i.AMBIENT=!1,i.AMBIENTDIRECTUV=0,i.OPACITY=!1,i.OPACITYDIRECTUV=0,i.OPACITYRGB=!1,i.REFLECTION=!1,i.EMISSIVE=!1,i.EMISSIVEDIRECTUV=0,i.SPECULAR=!1,i.SPECULARDIRECTUV=0,i.BUMP=!1,i.BUMPDIRECTUV=0,i.PARALLAX=!1,i.PARALLAXOCCLUSION=!1,i.SPECULAROVERALPHA=!1,i.CLIPPLANE=!1,i.CLIPPLANE2=!1,i.CLIPPLANE3=!1,i.CLIPPLANE4=!1,i.CLIPPLANE5=!1,i.CLIPPLANE6=!1,i.ALPHATEST=!1,i.DEPTHPREPASS=!1,i.ALPHAFROMDIFFUSE=!1,i.POINTSIZE=!1,i.FOG=!1,i.SPECULARTERM=!1,i.DIFFUSEFRESNEL=!1,i.OPACITYFRESNEL=!1,i.REFLECTIONFRESNEL=!1,i.REFRACTIONFRESNEL=!1,i.EMISSIVEFRESNEL=!1,i.FRESNEL=!1,i.NORMAL=!1,i.TANGENT=!1,i.UV1=!1,i.UV2=!1,i.UV3=!1,i.UV4=!1,i.UV5=!1,i.UV6=!1,i.VERTEXCOLOR=!1,i.VERTEXALPHA=!1,i.NUM_BONE_INFLUENCERS=0,i.BonesPerMesh=0,i.BONETEXTURE=!1,i.BONES_VELOCITY_ENABLED=!1,i.INSTANCES=!1,i.THIN_INSTANCES=!1,i.INSTANCESCOLOR=!1,i.GLOSSINESS=!1,i.ROUGHNESS=!1,i.EMISSIVEASILLUMINATION=!1,i.LINKEMISSIVEWITHDIFFUSE=!1,i.REFLECTIONFRESNELFROMSPECULAR=!1,i.LIGHTMAP=!1,i.LIGHTMAPDIRECTUV=0,i.OBJECTSPACE_NORMALMAP=!1,i.USELIGHTMAPASSHADOWMAP=!1,i.REFLECTIONMAP_3D=!1,i.REFLECTIONMAP_SPHERICAL=!1,i.REFLECTIONMAP_PLANAR=!1,i.REFLECTIONMAP_CUBIC=!1,i.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,i.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,i.REFLECTIONMAP_PROJECTION=!1,i.REFLECTIONMAP_SKYBOX=!1,i.REFLECTIONMAP_EXPLICIT=!1,i.REFLECTIONMAP_EQUIRECTANGULAR=!1,i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,i.REFLECTIONMAP_OPPOSITEZ=!1,i.INVERTCUBICMAP=!1,i.LOGARITHMICDEPTH=!1,i.REFRACTION=!1,i.REFRACTIONMAP_3D=!1,i.REFLECTIONOVERALPHA=!1,i.TWOSIDEDLIGHTING=!1,i.SHADOWFLOAT=!1,i.MORPHTARGETS=!1,i.MORPHTARGETS_NORMAL=!1,i.MORPHTARGETS_TANGENT=!1,i.MORPHTARGETS_UV=!1,i.NUM_MORPH_INFLUENCERS=0,i.MORPHTARGETS_TEXTURE=!1,i.NONUNIFORMSCALING=!1,i.PREMULTIPLYALPHA=!1,i.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,i.ALPHABLEND=!0,i.PREPASS=!1,i.PREPASS_IRRADIANCE=!1,i.PREPASS_IRRADIANCE_INDEX=-1,i.PREPASS_ALBEDO_SQRT=!1,i.PREPASS_ALBEDO_SQRT_INDEX=-1,i.PREPASS_DEPTH=!1,i.PREPASS_DEPTH_INDEX=-1,i.PREPASS_NORMAL=!1,i.PREPASS_NORMAL_INDEX=-1,i.PREPASS_POSITION=!1,i.PREPASS_POSITION_INDEX=-1,i.PREPASS_VELOCITY=!1,i.PREPASS_VELOCITY_INDEX=-1,i.PREPASS_REFLECTIVITY=!1,i.PREPASS_REFLECTIVITY_INDEX=-1,i.SCENE_MRT_COUNT=0,i.RGBDLIGHTMAP=!1,i.RGBDREFLECTION=!1,i.RGBDREFRACTION=!1,i.IMAGEPROCESSING=!1,i.VIGNETTE=!1,i.VIGNETTEBLENDMODEMULTIPLY=!1,i.VIGNETTEBLENDMODEOPAQUE=!1,i.TONEMAPPING=!1,i.TONEMAPPING_ACES=!1,i.CONTRAST=!1,i.COLORCURVES=!1,i.COLORGRADING=!1,i.COLORGRADING3D=!1,i.SAMPLER3DGREENDEPTH=!1,i.SAMPLER3DBGRMAP=!1,i.DITHER=!1,i.IMAGEPROCESSINGPOSTPROCESS=!1,i.SKIPFINALCOLORCLAMP=!1,i.MULTIVIEW=!1,i.ORDER_INDEPENDENT_TRANSPARENCY=!1,i.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,i.IS_REFLECTION_LINEAR=!1,i.IS_REFRACTION_LINEAR=!1,i.EXPOSURE=!1,i.rebuild(),i}return(0,E.Z)(n,[{key:"setReflectionMode",value:function(e){for(var t=0,n=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];t<n.length;t++){var i=n[t];this[i]=i===e}}}]),n}(me.H),un=function(e){(0,P.Z)(n,e);var t=an(n);function n(e,i){var r;return(0,A.Z)(this,n),(r=t.call(this,e,i))._diffuseTexture=null,r._ambientTexture=null,r._opacityTexture=null,r._reflectionTexture=null,r._emissiveTexture=null,r._specularTexture=null,r._bumpTexture=null,r._lightmapTexture=null,r._refractionTexture=null,r.ambientColor=new f.Wo(0,0,0),r.diffuseColor=new f.Wo(1,1,1),r.specularColor=new f.Wo(1,1,1),r.emissiveColor=new f.Wo(0,0,0),r.specularPower=64,r._useAlphaFromDiffuseTexture=!1,r._useEmissiveAsIllumination=!1,r._linkEmissiveWithDiffuse=!1,r._useSpecularOverAlpha=!1,r._useReflectionOverAlpha=!1,r._disableLighting=!1,r._useObjectSpaceNormalMap=!1,r._useParallax=!1,r._useParallaxOcclusion=!1,r.parallaxScaleBias=.05,r._roughness=0,r.indexOfRefraction=.98,r.invertRefractionY=!0,r.alphaCutOff=.4,r._useLightmapAsShadowmap=!1,r._useReflectionFresnelFromSpecular=!1,r._useGlossinessFromSpecularMapAlpha=!1,r._maxSimultaneousLights=4,r._invertNormalMapX=!1,r._invertNormalMapY=!1,r._twoSidedLighting=!1,r._renderTargets=new fe.t(16),r._worldViewProjectionMatrix=h.y3.Zero(),r._globalAmbientColor=new f.Wo(0,0,0),r._cacheHasRenderTargetTextures=!1,r.detailMap=new rn((0,T.Z)(r)),r._attachImageProcessingConfiguration(null),r.prePassConfiguration=new ve,r.getRenderTargetTextures=function(){return r._renderTargets.reset(),n.ReflectionTextureEnabled&&r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),n.RefractionTextureEnabled&&r._refractionTexture&&r._refractionTexture.isRenderTarget&&r._renderTargets.push(r._refractionTexture),r._eventInfo.renderTargets=r._renderTargets,r._callbackPluginEventFillRenderTargetTextures(r._eventInfo),r._renderTargets},r}return(0,E.Z)(n,[{key:"imageProcessingConfiguration",get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}},{key:"_attachImageProcessingConfiguration",value:function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){t._markAllSubMeshesAsImageProcessingDirty()}))))}},{key:"isPrePassCapable",get:function(){return!this.disableDepthWrite}},{key:"cameraColorCurvesEnabled",get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}},{key:"cameraColorGradingEnabled",get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e}},{key:"cameraToneMappingEnabled",get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e}},{key:"cameraExposure",get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e}},{key:"cameraContrast",get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e}},{key:"cameraColorGradingTexture",get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e}},{key:"cameraColorCurves",get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e}},{key:"canRenderToMRT",get:function(){return!0}},{key:"hasRenderTargetTextures",get:function(){return!!(n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}},{key:"getClassName",value:function(){return"StandardMaterial"}},{key:"useLogarithmicDepth",get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()}},{key:"needAlphaBlending",value:function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}},{key:"needAlphaTesting",value:function(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===_e.F.MATERIAL_ALPHATEST)}},{key:"_shouldUseAlphaFromDiffuseTexture",value:function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==_e.F.MATERIAL_OPAQUE}},{key:"_hasAlphaChannel",value:function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture}},{key:"getAlphaTestTexture",value:function(){return this._diffuseTexture}},{key:"isReadyForSubMesh",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._uniformBufferLayoutBuilt||this.buildUniformLayout(),t.effect&&this.isFrozen&&t.effect._wasPreviouslyReady&&t.effect._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(this._callbackPluginEventGeneric(ge.S.GetDefineNames,this._eventInfo),t.materialDefines=new sn(this._eventInfo.defineNames));var r=this.getScene(),o=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;var s=r.getEngine();o._needNormals=Ee.G.PrepareDefinesForLights(r,e,o,!0,this._maxSimultaneousLights,this._disableLighting),Ee.G.PrepareDefinesForMultiview(r,o);var u=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if(Ee.G.PrepareDefinesForPrePass(r,o,this.canRenderToMRT&&!u),Ee.G.PrepareDefinesForOIT(r,o,u),o._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,o._needUVs=!1;for(var l=1;l<=6;++l)o["MAINUV"+l]=!1;if(r.texturesEnabled){if(o.DIFFUSEDIRECTUV=0,o.BUMPDIRECTUV=0,o.AMBIENTDIRECTUV=0,o.OPACITYDIRECTUV=0,o.EMISSIVEDIRECTUV=0,o.SPECULARDIRECTUV=0,o.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&n.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;Ee.G.PrepareDefinesForMergedUV(this._diffuseTexture,o,"DIFFUSE")}else o.DIFFUSE=!1;if(this._ambientTexture&&n.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;Ee.G.PrepareDefinesForMergedUV(this._ambientTexture,o,"AMBIENT")}else o.AMBIENT=!1;if(this._opacityTexture&&n.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;Ee.G.PrepareDefinesForMergedUV(this._opacityTexture,o,"OPACITY"),o.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else o.OPACITY=!1;if(this._reflectionTexture&&n.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(o._needNormals=!0,o.REFLECTION=!0,o.ROUGHNESS=this._roughness>0,o.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,o.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===Be.INVCUBIC_MODE,o.REFLECTIONMAP_3D=this._reflectionTexture.isCube,o.REFLECTIONMAP_OPPOSITEZ=o.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,o.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case Be.EXPLICIT_MODE:o.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case Be.PLANAR_MODE:o.setReflectionMode("REFLECTIONMAP_PLANAR");break;case Be.PROJECTION_MODE:o.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case Be.SKYBOX_MODE:o.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case Be.SPHERICAL_MODE:o.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case Be.EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case Be.FIXED_EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case Be.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:o.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case Be.CUBIC_MODE:case Be.INVCUBIC_MODE:default:o.setReflectionMode("REFLECTIONMAP_CUBIC")}o.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else o.REFLECTION=!1,o.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&n.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;Ee.G.PrepareDefinesForMergedUV(this._emissiveTexture,o,"EMISSIVE")}else o.EMISSIVE=!1;if(this._lightmapTexture&&n.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;Ee.G.PrepareDefinesForMergedUV(this._lightmapTexture,o,"LIGHTMAP"),o.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,o.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else o.LIGHTMAP=!1;if(this._specularTexture&&n.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;Ee.G.PrepareDefinesForMergedUV(this._specularTexture,o,"SPECULAR"),o.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else o.SPECULAR=!1;if(r.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&n.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;Ee.G.PrepareDefinesForMergedUV(this._bumpTexture,o,"BUMP"),o.PARALLAX=this._useParallax,o.PARALLAXOCCLUSION=this._useParallaxOcclusion,o.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else o.BUMP=!1,o.PARALLAX=!1,o.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&n.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;o._needUVs=!0,o.REFRACTION=!0,o.REFRACTIONMAP_3D=this._refractionTexture.isCube,o.RGBDREFRACTION=this._refractionTexture.isRGBD,o.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else o.REFRACTION=!1;o.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else o.DIFFUSE=!1,o.AMBIENT=!1,o.OPACITY=!1,o.REFLECTION=!1,o.EMISSIVE=!1,o.LIGHTMAP=!1,o.BUMP=!1,o.REFRACTION=!1;o.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),o.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,o.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,o.SPECULAROVERALPHA=this._useSpecularOverAlpha,o.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,o.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,o.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(e)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=o,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(o._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(o),o.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,o.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(o._areFresnelDirty&&(n.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(o.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,o.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,o.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,o.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,o.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,o.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,o._needNormals=!0,o.FRESNEL=!0):o.FRESNEL=!1),Ee.G.PrepareDefinesForMisc(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,o),Ee.G.PrepareDefinesForFrameBoundValues(r,s,o,i,null,t.getRenderingMesh().hasThinInstances),this._eventInfo.defines=o,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),Ee.G.PrepareDefinesForAttributes(e,o,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo),o.isDirty){var c=o._areLightsDisposed;o.markAsProcessed();var h=new qt;o.REFLECTION&&h.addFallback(0,"REFLECTION"),o.SPECULAR&&h.addFallback(0,"SPECULAR"),o.BUMP&&h.addFallback(0,"BUMP"),o.PARALLAX&&h.addFallback(1,"PARALLAX"),o.PARALLAXOCCLUSION&&h.addFallback(0,"PARALLAXOCCLUSION"),o.SPECULAROVERALPHA&&h.addFallback(0,"SPECULAROVERALPHA"),o.FOG&&h.addFallback(1,"FOG"),o.POINTSIZE&&h.addFallback(0,"POINTSIZE"),o.LOGARITHMICDEPTH&&h.addFallback(0,"LOGARITHMICDEPTH"),Ee.G.HandleFallbacksForShadows(o,h,this._maxSimultaneousLights),o.SPECULARTERM&&h.addFallback(0,"SPECULARTERM"),o.DIFFUSEFRESNEL&&h.addFallback(1,"DIFFUSEFRESNEL"),o.OPACITYFRESNEL&&h.addFallback(2,"OPACITYFRESNEL"),o.REFLECTIONFRESNEL&&h.addFallback(3,"REFLECTIONFRESNEL"),o.EMISSIVEFRESNEL&&h.addFallback(4,"EMISSIVEFRESNEL"),o.FRESNEL&&h.addFallback(4,"FRESNEL"),o.MULTIVIEW&&h.addFallback(0,"MULTIVIEW");var f=[de.o.PositionKind];o.NORMAL&&f.push(de.o.NormalKind),o.TANGENT&&f.push(de.o.TangentKind);for(var d=1;d<=6;++d)o["UV"+d]&&f.push("uv".concat(1===d?"":d));o.VERTEXCOLOR&&f.push(de.o.ColorKind),Ee.G.PrepareAttributesForBones(f,e,o,h),Ee.G.PrepareAttributesForInstances(f,o),Ee.G.PrepareAttributesForMorphTargets(f,e,o),Ee.G.PrepareAttributesForBakedVertexAnimation(f,e,o);var v="default",p=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],_=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],g=["Material","Scene","Mesh"];this._eventInfo.fallbacks=h,this._eventInfo.fallbackRank=0,this._eventInfo.defines=o,this._eventInfo.uniforms=p,this._eventInfo.attributes=f,this._eventInfo.samplers=_,this._eventInfo.uniformBuffersNames=g,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._callbackPluginEventGeneric(ge.S.PrepareEffect,this._eventInfo),ve.AddUniforms(p),ve.AddSamplers(_),pe.$&&(pe.$.PrepareUniforms(p,o),pe.$.PrepareSamplers(_,o)),Ee.G.PrepareUniformsAndSamplersList({uniformsNames:p,uniformBuffersNames:g,samplers:_,defines:o,maxSimultaneousLights:this._maxSimultaneousLights});var m={};this.customShaderNameResolve&&(v=this.customShaderNameResolve(v,p,g,_,o,f,m));var y=o.toString(),A=t.effect,E=r.getEngine().createEffect(v,{attributes:f,uniformsNames:p,uniformBuffersNames:g,samplers:_,defines:y,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:o.NUM_MORPH_INFLUENCERS},processFinalCode:m.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:o.PREPASS},s);if(E)if(this._onEffectCreatedObservable&&(on.effect=E,on.subMesh=t,this._onEffectCreatedObservable.notifyObservers(on)),this.allowShaderHotSwapping&&A&&!E.isReady()){if(E=A,o.markAsUnprocessed(),c)return o._areLightsDisposed=!0,!1}else r.resetCachedMaterial(),t.setEffect(E,o,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(o._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,t.effect._wasPreviouslyUsingInstances=i,r.performancePriority!==a.a.BackwardCompatible&&(this.checkReadyOnlyOnce=!0),!0)}},{key:"buildUniformLayout",value:function(){var e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("alphaCutOff",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vRefractionPosition",3),e.addUniform("vRefractionSize",3),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vDiffuseColor",4),e.addUniform("vAmbientColor",3),(0,b.Z)((0,I.Z)(n.prototype),"buildUniformLayout",this).call(this)}},{key:"bindForSubMesh",value:function(e,t,i){var r=this.getScene(),o=i.materialDefines;if(o){var s=i.effect;if(s){this._activeEffect=s,t.getMeshUniformBuffer().bindToEffect(s,"Mesh"),t.transferToEffect(e),this._uniformBuffer.bindToEffect(s,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,r,t,e,this.isFrozen),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),o.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var u=this._mustRebind(r,s,t.visibility);Ee.G.BindBonesParameters(t,s);var l=this._uniformBuffer;if(u){if(this.bindViewProjection(s),!l.useUbo||!this.isFrozen||!l.isSync){if(n.FresnelEnabled&&o.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(l.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),l.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&l.updateColor4("opacityParts",new f.Wo(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(l.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),l.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(l.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),l.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(l.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),l.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),r.texturesEnabled){if(this._diffuseTexture&&n.DiffuseTextureEnabled&&(l.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),Ee.G.BindTextureMatrix(this._diffuseTexture,l,"diffuse")),this._ambientTexture&&n.AmbientTextureEnabled&&(l.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),Ee.G.BindTextureMatrix(this._ambientTexture,l,"ambient")),this._opacityTexture&&n.OpacityTextureEnabled&&(l.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),Ee.G.BindTextureMatrix(this._opacityTexture,l,"opacity")),this._hasAlphaChannel()&&l.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&n.ReflectionTextureEnabled&&(l.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),l.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var c=this._reflectionTexture;l.updateVector3("vReflectionPosition",c.boundingBoxPosition),l.updateVector3("vReflectionSize",c.boundingBoxSize)}if(this._emissiveTexture&&n.EmissiveTextureEnabled&&(l.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),Ee.G.BindTextureMatrix(this._emissiveTexture,l,"emissive")),this._lightmapTexture&&n.LightmapTextureEnabled&&(l.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),Ee.G.BindTextureMatrix(this._lightmapTexture,l,"lightmap")),this._specularTexture&&n.SpecularTextureEnabled&&(l.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),Ee.G.BindTextureMatrix(this._specularTexture,l,"specular")),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&(l.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),Ee.G.BindTextureMatrix(this._bumpTexture,l,"bump"),r._mirroredCameraPosition?l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&n.RefractionTextureEnabled){var h=1;if(this._refractionTexture.isCube||(l.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(h=this._refractionTexture.depth)),l.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,h,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){var d=this._refractionTexture;l.updateVector3("vRefractionPosition",d.boundingBoxPosition),l.updateVector3("vRefractionSize",d.boundingBoxSize)}}}this.pointsCloud&&l.updateFloat("pointSize",this.pointSize),o.SPECULARTERM&&l.updateColor4("vSpecularColor",this.specularColor,this.specularPower),l.updateColor3("vEmissiveColor",n.EmissiveTextureEnabled?this.emissiveColor:f.Wo.BlackReadOnly),l.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),r.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),l.updateColor3("vAmbientColor",this._globalAmbientColor)}r.texturesEnabled&&(this._diffuseTexture&&n.DiffuseTextureEnabled&&s.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&n.AmbientTextureEnabled&&s.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&n.OpacityTextureEnabled&&s.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&n.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?s.setTexture("reflectionCubeSampler",this._reflectionTexture):s.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&n.EmissiveTextureEnabled&&s.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&n.LightmapTextureEnabled&&s.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&n.SpecularTextureEnabled&&s.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&s.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&n.RefractionTextureEnabled&&(this._refractionTexture.isCube?s.setTexture("refractionCubeSampler",this._refractionTexture):s.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(s),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),Ee.G.BindClipPlane(s,r),this.bindEyePosition(s)}else r.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(u||!this.isFrozen){var v;if(r.lightsEnabled&&!this._disableLighting&&Ee.G.BindLights(r,t,s,o,this._maxSimultaneousLights),(r.fogEnabled&&t.applyFog&&r.fogMode!==a.x.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||t.receiveShadows||o.PREPASS)&&this.bindView(s),Ee.G.BindFogParameters(r,t,s),o.NUM_MORPH_INFLUENCERS&&Ee.G.BindMorphTargetParameters(t,s),o.BAKED_VERTEX_ANIMATION_TEXTURE)null===(v=t.bakedVertexAnimationManager)||void 0===v||v.bind(s,o.INSTANCES);this.useLogarithmicDepth&&Ee.G.BindLogDepth(o,s,r),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(t,this._activeEffect),l.update()}}}},{key:"getAnimatables",value:function(){var e=(0,b.Z)((0,I.Z)(n.prototype),"getAnimatables",this).call(this);return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e}},{key:"getActiveTextures",value:function(){var e=(0,b.Z)((0,I.Z)(n.prototype),"getActiveTextures",this).call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e}},{key:"hasTexture",value:function(e){return!!(0,b.Z)((0,I.Z)(n.prototype),"hasTexture",this).call(this,e)||(this._diffuseTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._specularTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e))))))))}},{key:"dispose",value:function(e,t){var i,r,a,o,s,u,l,c,h;t&&(null===(i=this._diffuseTexture)||void 0===i||i.dispose(),null===(r=this._ambientTexture)||void 0===r||r.dispose(),null===(a=this._opacityTexture)||void 0===a||a.dispose(),null===(o=this._reflectionTexture)||void 0===o||o.dispose(),null===(s=this._emissiveTexture)||void 0===s||s.dispose(),null===(u=this._specularTexture)||void 0===u||u.dispose(),null===(l=this._bumpTexture)||void 0===l||l.dispose(),null===(c=this._lightmapTexture)||void 0===c||c.dispose(),null===(h=this._refractionTexture)||void 0===h||h.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),(0,b.Z)((0,I.Z)(n.prototype),"dispose",this).call(this,e,t)}},{key:"clone",value:function(e){var t=this,i=x.p4.Clone((function(){return new n(e,t.getScene())}),this);return i.name=e,i.id=e,this.stencil.copyTo(i.stencil),i}}],[{key:"Parse",value:function(e,t,i){var r=x.p4.Parse((function(){return new n(e.name,t)}),e,t,i);return e.stencil&&r.stencil.parse(e.stencil,t,i),r}},{key:"DiffuseTextureEnabled",get:function(){return Ue.DiffuseTextureEnabled},set:function(e){Ue.DiffuseTextureEnabled=e}},{key:"DetailTextureEnabled",get:function(){return Ue.DetailTextureEnabled},set:function(e){Ue.DetailTextureEnabled=e}},{key:"AmbientTextureEnabled",get:function(){return Ue.AmbientTextureEnabled},set:function(e){Ue.AmbientTextureEnabled=e}},{key:"OpacityTextureEnabled",get:function(){return Ue.OpacityTextureEnabled},set:function(e){Ue.OpacityTextureEnabled=e}},{key:"ReflectionTextureEnabled",get:function(){return Ue.ReflectionTextureEnabled},set:function(e){Ue.ReflectionTextureEnabled=e}},{key:"EmissiveTextureEnabled",get:function(){return Ue.EmissiveTextureEnabled},set:function(e){Ue.EmissiveTextureEnabled=e}},{key:"SpecularTextureEnabled",get:function(){return Ue.SpecularTextureEnabled},set:function(e){Ue.SpecularTextureEnabled=e}},{key:"BumpTextureEnabled",get:function(){return Ue.BumpTextureEnabled},set:function(e){Ue.BumpTextureEnabled=e}},{key:"LightmapTextureEnabled",get:function(){return Ue.LightmapTextureEnabled},set:function(e){Ue.LightmapTextureEnabled=e}},{key:"RefractionTextureEnabled",get:function(){return Ue.RefractionTextureEnabled},set:function(e){Ue.RefractionTextureEnabled=e}},{key:"ColorGradingTextureEnabled",get:function(){return Ue.ColorGradingTextureEnabled},set:function(e){Ue.ColorGradingTextureEnabled=e}},{key:"FresnelEnabled",get:function(){return Ue.FresnelEnabled},set:function(e){Ue.FresnelEnabled=e}}]),n}(Ae);(0,C.gn)([(0,x.oU)("diffuseTexture")],un.prototype,"_diffuseTexture",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],un.prototype,"diffuseTexture",void 0),(0,C.gn)([(0,x.oU)("ambientTexture")],un.prototype,"_ambientTexture",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"ambientTexture",void 0),(0,C.gn)([(0,x.oU)("opacityTexture")],un.prototype,"_opacityTexture",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],un.prototype,"opacityTexture",void 0),(0,C.gn)([(0,x.oU)("reflectionTexture")],un.prototype,"_reflectionTexture",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"reflectionTexture",void 0),(0,C.gn)([(0,x.oU)("emissiveTexture")],un.prototype,"_emissiveTexture",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"emissiveTexture",void 0),(0,C.gn)([(0,x.oU)("specularTexture")],un.prototype,"_specularTexture",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"specularTexture",void 0),(0,C.gn)([(0,x.oU)("bumpTexture")],un.prototype,"_bumpTexture",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"bumpTexture",void 0),(0,C.gn)([(0,x.oU)("lightmapTexture")],un.prototype,"_lightmapTexture",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"lightmapTexture",void 0),(0,C.gn)([(0,x.oU)("refractionTexture")],un.prototype,"_refractionTexture",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"refractionTexture",void 0),(0,C.gn)([(0,x.n9)("ambient")],un.prototype,"ambientColor",void 0),(0,C.gn)([(0,x.n9)("diffuse")],un.prototype,"diffuseColor",void 0),(0,C.gn)([(0,x.n9)("specular")],un.prototype,"specularColor",void 0),(0,C.gn)([(0,x.n9)("emissive")],un.prototype,"emissiveColor",void 0),(0,C.gn)([(0,x.qC)()],un.prototype,"specularPower",void 0),(0,C.gn)([(0,x.qC)("useAlphaFromDiffuseTexture")],un.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],un.prototype,"useAlphaFromDiffuseTexture",void 0),(0,C.gn)([(0,x.qC)("useEmissiveAsIllumination")],un.prototype,"_useEmissiveAsIllumination",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"useEmissiveAsIllumination",void 0),(0,C.gn)([(0,x.qC)("linkEmissiveWithDiffuse")],un.prototype,"_linkEmissiveWithDiffuse",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"linkEmissiveWithDiffuse",void 0),(0,C.gn)([(0,x.qC)("useSpecularOverAlpha")],un.prototype,"_useSpecularOverAlpha",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"useSpecularOverAlpha",void 0),(0,C.gn)([(0,x.qC)("useReflectionOverAlpha")],un.prototype,"_useReflectionOverAlpha",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"useReflectionOverAlpha",void 0),(0,C.gn)([(0,x.qC)("disableLighting")],un.prototype,"_disableLighting",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsLightsDirty")],un.prototype,"disableLighting",void 0),(0,C.gn)([(0,x.qC)("useObjectSpaceNormalMap")],un.prototype,"_useObjectSpaceNormalMap",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"useObjectSpaceNormalMap",void 0),(0,C.gn)([(0,x.qC)("useParallax")],un.prototype,"_useParallax",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"useParallax",void 0),(0,C.gn)([(0,x.qC)("useParallaxOcclusion")],un.prototype,"_useParallaxOcclusion",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"useParallaxOcclusion",void 0),(0,C.gn)([(0,x.qC)()],un.prototype,"parallaxScaleBias",void 0),(0,C.gn)([(0,x.qC)("roughness")],un.prototype,"_roughness",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"roughness",void 0),(0,C.gn)([(0,x.qC)()],un.prototype,"indexOfRefraction",void 0),(0,C.gn)([(0,x.qC)()],un.prototype,"invertRefractionY",void 0),(0,C.gn)([(0,x.qC)()],un.prototype,"alphaCutOff",void 0),(0,C.gn)([(0,x.qC)("useLightmapAsShadowmap")],un.prototype,"_useLightmapAsShadowmap",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"useLightmapAsShadowmap",void 0),(0,C.gn)([(0,x.qQ)("diffuseFresnelParameters")],un.prototype,"_diffuseFresnelParameters",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsFresnelDirty")],un.prototype,"diffuseFresnelParameters",void 0),(0,C.gn)([(0,x.qQ)("opacityFresnelParameters")],un.prototype,"_opacityFresnelParameters",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsFresnelAndMiscDirty")],un.prototype,"opacityFresnelParameters",void 0),(0,C.gn)([(0,x.qQ)("reflectionFresnelParameters")],un.prototype,"_reflectionFresnelParameters",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsFresnelDirty")],un.prototype,"reflectionFresnelParameters",void 0),(0,C.gn)([(0,x.qQ)("refractionFresnelParameters")],un.prototype,"_refractionFresnelParameters",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsFresnelDirty")],un.prototype,"refractionFresnelParameters",void 0),(0,C.gn)([(0,x.qQ)("emissiveFresnelParameters")],un.prototype,"_emissiveFresnelParameters",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsFresnelDirty")],un.prototype,"emissiveFresnelParameters",void 0),(0,C.gn)([(0,x.qC)("useReflectionFresnelFromSpecular")],un.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsFresnelDirty")],un.prototype,"useReflectionFresnelFromSpecular",void 0),(0,C.gn)([(0,x.qC)("useGlossinessFromSpecularMapAlpha")],un.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,C.gn)([(0,x.qC)("maxSimultaneousLights")],un.prototype,"_maxSimultaneousLights",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsLightsDirty")],un.prototype,"maxSimultaneousLights",void 0),(0,C.gn)([(0,x.qC)("invertNormalMapX")],un.prototype,"_invertNormalMapX",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"invertNormalMapX",void 0),(0,C.gn)([(0,x.qC)("invertNormalMapY")],un.prototype,"_invertNormalMapY",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"invertNormalMapY",void 0),(0,C.gn)([(0,x.qC)("twoSidedLighting")],un.prototype,"_twoSidedLighting",void 0),(0,C.gn)([(0,x.wz)("_markAllSubMeshesAsTexturesDirty")],un.prototype,"twoSidedLighting",void 0),(0,C.gn)([(0,x.qC)()],un.prototype,"useLogarithmicDepth",null),(0,V.H)("BABYLON.StandardMaterial",un),a.x.DefaultMaterialFactory=function(e){return new un("default material",e)};var ln=n(2668),cn=n(9370),hn=n(3192);function fn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return dn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dn(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function dn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function vn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}o.Kj._instancedMeshFactory=function(e,t){var n=new pn(e,t);if(t.instancedBuffers)for(var i in n.instancedBuffers={},t.instancedBuffers)n.instancedBuffers[i]=t.instancedBuffers[i];return n};var pn=function(e){(0,P.Z)(n,e);var t=vn(n);function n(e,i){var r;(0,A.Z)(this,n),(r=t.call(this,e,i.getScene()))._indexInSourceMeshInstanceArray=-1,r._distanceToCamera=0,i.addInstance((0,T.Z)(r)),r._sourceMesh=i,r._unIndexed=i._unIndexed,r.position.copyFrom(i.position),r.rotation.copyFrom(i.rotation),r.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(r.rotationQuaternion=i.rotationQuaternion.clone()),r.animations=i.animations.slice();var a,o=fn(i.getAnimationRanges());try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&r.createAnimationRange(s.name,s.from,s.to)}}catch(u){o.e(u)}finally{o.f()}return r.infiniteDistance=i.infiniteDistance,r.setPivotMatrix(i.getPivotMatrix()),r.refreshBoundingInfo(!0,!0),r._syncSubMeshes(),r}return(0,E.Z)(n,[{key:"getClassName",value:function(){return"InstancedMesh"}},{key:"lightSources",get:function(){return this._sourceMesh._lightSources}},{key:"_resyncLightSources",value:function(){}},{key:"_resyncLightSource",value:function(){}},{key:"_removeLightSource",value:function(){}},{key:"receiveShadows",get:function(){return this._sourceMesh.receiveShadows}},{key:"material",get:function(){return this._sourceMesh.material}},{key:"visibility",get:function(){return this._sourceMesh.visibility}},{key:"skeleton",get:function(){return this._sourceMesh.skeleton}},{key:"renderingGroupId",get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&Q.Y.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}},{key:"getTotalVertices",value:function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}},{key:"getTotalIndices",value:function(){return this._sourceMesh.getTotalIndices()}},{key:"sourceMesh",get:function(){return this._sourceMesh}},{key:"createInstance",value:function(e){return this._sourceMesh.createInstance(e)}},{key:"isReady",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(e,!0)}},{key:"getVerticesData",value:function(e,t){return this._sourceMesh.getVerticesData(e,t)}},{key:"setVerticesData",value:function(e,t,n,i){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,n,i),this.sourceMesh}},{key:"updateVerticesData",value:function(e,t,n,i){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,n,i),this.sourceMesh}},{key:"setIndices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh}},{key:"isVerticesDataPresent",value:function(e){return this._sourceMesh.isVerticesDataPresent(e)}},{key:"getIndices",value:function(){return this._sourceMesh.getIndices()}},{key:"_positions",get:function(){return this._sourceMesh._positions}},{key:"refreshBoundingInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;var n=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e,t),n),this}},{key:"_preActivate",value:function(){return this._currentLOD&&this._currentLOD._preActivate(),this}},{key:"_activate",value:function(e,t){if((0,b.Z)((0,I.Z)(n.prototype),"_activate",this).call(this,e,t),this._sourceMesh.subMeshes||Q.Y.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}},{key:"_postActivate",value:function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}},{key:"getWorldMatrix",value:function(){if(this._currentLOD&&this._currentLOD.billboardMode!==ln.Y.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new h.y3);var e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,h.jp.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(h.jp.Vector3[7]),this._currentLOD._masterMesh=e,this._billboardWorldMatrix}return(0,b.Z)((0,I.Z)(n.prototype),"getWorldMatrix",this).call(this)}},{key:"isAnInstance",get:function(){return!0}},{key:"getLOD",value:function(e){if(!e)return this;var t=this.sourceMesh.getLODLevels();if(t&&0!==t.length){var n=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(e,n.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}},{key:"_preActivateForIntermediateRendering",value:function(e){return this.sourceMesh._preActivateForIntermediateRendering(e)}},{key:"_syncSubMeshes",value:function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this}},{key:"_generatePointsArray",value:function(){return this._sourceMesh._generatePointsArray()}},{key:"_updateBoundingInfo",value:function(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}},{key:"clone",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=(i||this._sourceMesh).createInstance(e);if(hn.j.DeepCopy(this,r,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!n)for(var a=0;a<this.getScene().meshes.length;a++){var o=this.getScene().meshes[a];o.parent===this&&o.clone(o.name,r)}return r.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(r),r}},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.removeInstance(this),(0,b.Z)((0,I.Z)(n.prototype),"dispose",this).call(this,e,t)}},{key:"_serializeAsParent",value:function(e){(0,b.Z)((0,I.Z)(n.prototype),"_serializeAsParent",this).call(this,e),e.parentId=this._sourceMesh.uniqueId,e.parentInstanceIndex=this._indexInSourceMeshInstanceArray}},{key:"instantiateHierarchy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0,t&&t.newSourcedMesh);i&&n&&n(this,i);var r,a=fn(this.getChildTransformNodes(!0));try{for(a.s();!(r=a.n()).done;){var o=r.value;o.instantiateHierarchy(i,t,n)}}catch(s){a.e(s)}finally{a.f()}return i}}]),n}(cn.x);o.Kj.prototype.registerInstancedBuffer=function(e,t){var n,i;if(null===(n=this._userInstancedBuffersStorage)||void 0===n||null===(i=n.vertexBuffers[e])||void 0===i||i.dispose(),!this.instancedBuffers){this.instancedBuffers={};var r,a=fn(this.instances);try{for(a.s();!(r=a.n()).done;){r.value.instancedBuffers={}}}catch(u){a.e(u)}finally{a.f()}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0})}this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new de.o(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0);var o,s=fn(this.instances);try{for(s.s();!(o=s.n()).done;){o.value.instancedBuffers[e]=null}}catch(u){s.e(u)}finally{s.f()}this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},o.Kj.prototype._processInstancedBuffers=function(e,t){var n=e.length;for(var i in this.instancedBuffers){for(var r=this._userInstancedBuffersStorage.sizes[i],a=this._userInstancedBuffersStorage.strides[i],o=(n+1)*a;r<o;)r*=2;this._userInstancedBuffersStorage.data[i].length!=r&&(this._userInstancedBuffersStorage.data[i]=new Float32Array(r),this._userInstancedBuffersStorage.sizes[i]=r,this._userInstancedBuffersStorage.vertexBuffers[i]&&(this._userInstancedBuffersStorage.vertexBuffers[i].dispose(),this._userInstancedBuffersStorage.vertexBuffers[i]=null));var s=this._userInstancedBuffersStorage.data[i],u=0;if(t){var l=this.instancedBuffers[i];l.toArray?l.toArray(s,u):l.copyToArray?l.copyToArray(s,u):s[u]=l,u+=a}for(var c=0;c<n;c++){var h=e[c].instancedBuffers[i];h.toArray?h.toArray(s,u):h.copyToArray?h.copyToArray(s,u):s[u]=h,u+=a}this._userInstancedBuffersStorage.vertexBuffers[i]?this._userInstancedBuffersStorage.vertexBuffers[i].updateDirectly(s,0):(this._userInstancedBuffersStorage.vertexBuffers[i]=new de.o(this.getEngine(),this._userInstancedBuffersStorage.data[i],i,!0,!1,a,!0),this._invalidateInstanceVertexArrayObject())}},o.Kj.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(var e in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[e]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},o.Kj.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}};var _n=n(1952),gn=n(1221);function mn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return yn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yn(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function yn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function An(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}var En=function(e){(0,P.Z)(n,e);var t=An(n);function n(e,i){var r;return(0,A.Z)(this,n),(r=t.call(this,e,i)).diffuse=new f.Wo(1,1,1),r.specular=new f.Wo(1,1,1),r.falloffType=n.FALLOFF_DEFAULT,r.intensity=1,r._range=Number.MAX_VALUE,r._inverseSquaredRange=0,r._photometricScale=1,r._intensityMode=n.INTENSITYMODE_AUTOMATIC,r._radius=1e-5,r.renderPriority=0,r._shadowEnabled=!0,r._excludeWithLayerMask=0,r._includeOnlyWithLayerMask=0,r._lightmapMode=0,r._excludedMeshesIds=new Array,r._includedOnlyMeshesIds=new Array,r._isLight=!0,r.getScene().addLight((0,T.Z)(r)),r._uniformBuffer=new _n.M(r.getScene().getEngine(),void 0,void 0,e),r._buildUniformLayout(),r.includedOnlyMeshes=new Array,r.excludedMeshes=new Array,r._resyncMeshes(),r}return(0,E.Z)(n,[{key:"range",get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)}},{key:"intensityMode",get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())}},{key:"includedOnlyMeshes",get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)}},{key:"excludedMeshes",get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)}},{key:"excludeWithLayerMask",get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()}},{key:"includeOnlyWithLayerMask",get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()}},{key:"lightmapMode",get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())}},{key:"transferTexturesToEffect",value:function(e,t){return this}},{key:"_bindLight",value:function(e,t,n,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=e.toString(),o=!1;if(this._uniformBuffer.bindToEffect(n,"Light"+a),this._renderId!==t.getRenderId()||this._lastUseSpecular!==i||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=i;var s=this.getScaledIntensity();this.transferToEffect(n,a),this.diffuse.scaleToRef(s,f.zZ.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",f.zZ.Color3[0],this.range,a),i&&(this.specular.scaleToRef(s,f.zZ.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",f.zZ.Color3[1],this.radius,a)),o=!0}if(this.transferTexturesToEffect(n,a),t.shadowsEnabled&&this.shadowEnabled&&r){var u=this.getShadowGenerator();u&&(u.bindShadowLight(a,n),o=!0)}o?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}},{key:"getClassName",value:function(){return"Light"}},{key:"toString",value:function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var n=0;n<this.animations.length;n++)t+=", animation[0]: "+this.animations[n].toString(e);return t}},{key:"_syncParentEnabledState",value:function(){(0,b.Z)((0,I.Z)(n.prototype),"_syncParentEnabledState",this).call(this),this.isDisposed()||this._resyncMeshes()}},{key:"setEnabled",value:function(e){(0,b.Z)((0,I.Z)(n.prototype),"setEnabled",this).call(this,e),this._resyncMeshes()}},{key:"getShadowGenerator",value:function(){return this._shadowGenerator}},{key:"getAbsolutePosition",value:function(){return h.P.Zero()}},{key:"canAffectMesh",value:function(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))}},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this),this._parentContainer){var i=this._parentContainer.lights.indexOf(this);i>-1&&this._parentContainer.lights.splice(i,1),this._parentContainer=null}var r,a=mn(this.getScene().meshes);try{for(a.s();!(r=a.n()).done;){var o=r.value;o._removeLightSource(this,!0)}}catch(s){a.e(s)}finally{a.f()}this._uniformBuffer.dispose(),this.getScene().removeLight(this),(0,b.Z)((0,I.Z)(n.prototype),"dispose",this).call(this,e,t)}},{key:"getTypeID",value:function(){return 0}},{key:"getScaledIntensity",value:function(){return this._photometricScale*this.intensity}},{key:"clone",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=n.GetConstructorFromName(this.getTypeID(),e,this.getScene());if(!i)return null;var r=x.p4.Clone(i,this);return e&&(r.name=e),t&&(r.parent=t),r.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(r),r}},{key:"serialize",value:function(){var e=x.p4.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(e),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach((function(t){e.excludedMeshesIds.push(t.id)}))),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((function(t){e.includedOnlyMeshesIds.push(t.id)}))),x.p4.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}},{key:"_hookArrayForExcluded",value:function(e){var t=this,n=e.push;e.push=function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];for(var o=n.apply(e,r),s=0,u=r;s<u.length;s++){var l=u[s];l._resyncLightSource(t)}return o};var i=e.splice;e.splice=function(n,r){var a,o=i.apply(e,[n,r]),s=mn(o);try{for(s.s();!(a=s.n()).done;){a.value._resyncLightSource(t)}}catch(u){s.e(u)}finally{s.f()}return o};var r,a=mn(e);try{for(a.s();!(r=a.n()).done;){r.value._resyncLightSource(this)}}catch(o){a.e(o)}finally{a.f()}}},{key:"_hookArrayForIncludedOnly",value:function(e){var t=this,n=e.push;e.push=function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];var o=n.apply(e,r);return t._resyncMeshes(),o};var i=e.splice;e.splice=function(n,r){var a=i.apply(e,[n,r]);return t._resyncMeshes(),a},this._resyncMeshes()}},{key:"_resyncMeshes",value:function(){var e,t=mn(this.getScene().meshes);try{for(t.s();!(e=t.n()).done;){e.value._resyncLightSource(this)}}catch(n){t.e(n)}finally{t.f()}}},{key:"_markMeshesAsLightDirty",value:function(){var e,t=mn(this.getScene().meshes);try{for(t.s();!(e=t.n()).done;){var n=e.value;-1!==n.lightSources.indexOf(this)&&n._markSubMeshesAsLightDirty()}}catch(i){t.e(i)}finally{t.f()}}},{key:"_computePhotometricScale",value:function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}},{key:"_getPhotometricScale",value:function(){var e=0,t=this.getTypeID(),i=this.intensityMode;switch(i===n.INTENSITYMODE_AUTOMATIC&&(i=t===n.LIGHTTYPEID_DIRECTIONALLIGHT?n.INTENSITYMODE_ILLUMINANCE:n.INTENSITYMODE_LUMINOUSINTENSITY),t){case n.LIGHTTYPEID_POINTLIGHT:case n.LIGHTTYPEID_SPOTLIGHT:switch(i){case n.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case n.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case n.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case n.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case n.INTENSITYMODE_ILLUMINANCE:e=1;break;case n.INTENSITYMODE_LUMINANCE:var r=this.radius;r=Math.max(r,.001),e=2*Math.PI*(1-Math.cos(r))}break;case n.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e}},{key:"_reorderLightsInScene",value:function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()}}],[{key:"GetConstructorFromName",value:function(e,t,n){var i=D.N.Construct("Light_Type_"+e,t,n);return i||null}},{key:"Parse",value:function(e,t){var i=n.GetConstructorFromName(e.type,e.name,t);if(!i)return null;var r=x.p4.Parse(i,e,t);if(e.excludedMeshesIds&&(r._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(r._includedOnlyMeshesIds=e.includedOnlyMeshesIds),void 0!==e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.falloffType&&(r.falloffType=e.falloffType),void 0!==e.lightmapMode&&(r.lightmapMode=e.lightmapMode),e.animations){for(var a=0;a<e.animations.length;a++){var o=e.animations[a],s=(0,V.q)("BABYLON.Animation");s&&r.animations.push(s.Parse(o))}D.N.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&r.setEnabled(e.isEnabled),r}}]),n}(D.N);function Sn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}En.FALLOFF_DEFAULT=gn.m.FALLOFF_DEFAULT,En.FALLOFF_PHYSICAL=gn.m.FALLOFF_PHYSICAL,En.FALLOFF_GLTF=gn.m.FALLOFF_GLTF,En.FALLOFF_STANDARD=gn.m.FALLOFF_STANDARD,En.LIGHTMAP_DEFAULT=gn.m.LIGHTMAP_DEFAULT,En.LIGHTMAP_SPECULAR=gn.m.LIGHTMAP_SPECULAR,En.LIGHTMAP_SHADOWSONLY=gn.m.LIGHTMAP_SHADOWSONLY,En.INTENSITYMODE_AUTOMATIC=gn.m.INTENSITYMODE_AUTOMATIC,En.INTENSITYMODE_LUMINOUSPOWER=gn.m.INTENSITYMODE_LUMINOUSPOWER,En.INTENSITYMODE_LUMINOUSINTENSITY=gn.m.INTENSITYMODE_LUMINOUSINTENSITY,En.INTENSITYMODE_ILLUMINANCE=gn.m.INTENSITYMODE_ILLUMINANCE,En.INTENSITYMODE_LUMINANCE=gn.m.INTENSITYMODE_LUMINANCE,En.LIGHTTYPEID_POINTLIGHT=gn.m.LIGHTTYPEID_POINTLIGHT,En.LIGHTTYPEID_DIRECTIONALLIGHT=gn.m.LIGHTTYPEID_DIRECTIONALLIGHT,En.LIGHTTYPEID_SPOTLIGHT=gn.m.LIGHTTYPEID_SPOTLIGHT,En.LIGHTTYPEID_HEMISPHERICLIGHT=gn.m.LIGHTTYPEID_HEMISPHERICLIGHT,(0,C.gn)([(0,x.n9)()],En.prototype,"diffuse",void 0),(0,C.gn)([(0,x.n9)()],En.prototype,"specular",void 0),(0,C.gn)([(0,x.qC)()],En.prototype,"falloffType",void 0),(0,C.gn)([(0,x.qC)()],En.prototype,"intensity",void 0),(0,C.gn)([(0,x.qC)()],En.prototype,"range",null),(0,C.gn)([(0,x.qC)()],En.prototype,"intensityMode",null),(0,C.gn)([(0,x.qC)()],En.prototype,"radius",null),(0,C.gn)([(0,x.qC)()],En.prototype,"_renderPriority",void 0),(0,C.gn)([(0,x.wz)("_reorderLightsInScene")],En.prototype,"renderPriority",void 0),(0,C.gn)([(0,x.qC)("shadowEnabled")],En.prototype,"_shadowEnabled",void 0),(0,C.gn)([(0,x.qC)("excludeWithLayerMask")],En.prototype,"_excludeWithLayerMask",void 0),(0,C.gn)([(0,x.qC)("includeOnlyWithLayerMask")],En.prototype,"_includeOnlyWithLayerMask",void 0),(0,C.gn)([(0,x.qC)("lightmapMode")],En.prototype,"_lightmapMode",void 0),D.N.AddNodeConstructor("Light_Type_3",(function(e,t){return function(){return new Tn(e,h.P.Zero(),t)}}));var Tn=function(e){(0,P.Z)(n,e);var t=Sn(n);function n(e,i,r){var a;return(0,A.Z)(this,n),(a=t.call(this,e,r)).groundColor=new f.Wo(0,0,0),a.direction=i||h.P.Up(),a}return(0,E.Z)(n,[{key:"_buildUniformLayout",value:function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}},{key:"getClassName",value:function(){return"HemisphericLight"}},{key:"setDirectionToTarget",value:function(e){return this.direction=h.P.Normalize(e.subtract(h.P.Zero())),this.direction}},{key:"getShadowGenerator",value:function(){return null}},{key:"transferToEffect",value:function(e,t){var n=h.P.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",n.x,n.y,n.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this}},{key:"transferToNodeMaterialEffect",value:function(e,t){var n=h.P.Normalize(this.direction);return e.setFloat3(t,n.x,n.y,n.z),this}},{key:"computeWorldMatrix",value:function(){return this._worldMatrix||(this._worldMatrix=h.y3.Identity()),this._worldMatrix}},{key:"getTypeID",value:function(){return En.LIGHTTYPEID_HEMISPHERICLIGHT}},{key:"prepareLightSpecificDefines",value:function(e,t){e["HEMILIGHT"+t]=!0}}]),n}(En);function bn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}(0,C.gn)([(0,x.n9)()],Tn.prototype,"groundColor",void 0),(0,C.gn)([(0,x.hd)()],Tn.prototype,"direction",void 0);var Pn=function(e){(0,P.Z)(n,e);var t=bn(n);function n(){var e;return(0,A.Z)(this,n),(e=t.apply(this,arguments))._needProjectionMatrixCompute=!0,e}return(0,E.Z)(n,[{key:"_setPosition",value:function(e){this._position=e}},{key:"position",get:function(){return this._position},set:function(e){this._setPosition(e)}},{key:"_setDirection",value:function(e){this._direction=e}},{key:"direction",get:function(){return this._direction},set:function(e){this._setDirection(e)}},{key:"shadowMinZ",get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()}},{key:"shadowMaxZ",get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()}},{key:"computeTransformedInformation",value:function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=h.P.Zero()),h.P.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=h.P.Zero()),h.P.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}},{key:"getDepthScale",value:function(){return 50}},{key:"getShadowDirection",value:function(e){return this.transformedDirection?this.transformedDirection:this.direction}},{key:"getAbsolutePosition",value:function(){return this.transformedPosition?this.transformedPosition:this.position}},{key:"setDirectionToTarget",value:function(e){return this.direction=h.P.Normalize(e.subtract(this.position)),this.direction}},{key:"getRotation",value:function(){this.direction.normalize();var e=h.P.Cross(this.direction,_.RD.Y),t=h.P.Cross(e,this.direction);return h.P.RotationFromAxis(e,t,this.direction)}},{key:"needCube",value:function(){return!1}},{key:"needProjectionMatrixCompute",value:function(){return this._needProjectionMatrixCompute}},{key:"forceProjectionMatrixCompute",value:function(){this._needProjectionMatrixCompute=!0}},{key:"_initCache",value:function(){(0,b.Z)((0,I.Z)(n.prototype),"_initCache",this).call(this),this._cache.position=h.P.Zero()}},{key:"_isSynchronized",value:function(){return!!this._cache.position.equals(this.position)}},{key:"computeWorldMatrix",value:function(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=h.y3.Identity()),h.y3.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}},{key:"getDepthMinZ",value:function(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ}},{key:"getDepthMaxZ",value:function(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ}},{key:"setShadowProjectionMatrix",value:function(e,t,n){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,n,e):this._setDefaultShadowProjectionMatrix(e,t,n),this}},{key:"_syncParentEnabledState",value:function(){(0,b.Z)((0,I.Z)(n.prototype),"_syncParentEnabledState",this).call(this),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}}]),n}(En);function Mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,I.Z)(e);if(t){var r=(0,I.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,M.Z)(this,n)}}(0,C.gn)([(0,x.hd)()],Pn.prototype,"position",null),(0,C.gn)([(0,x.hd)()],Pn.prototype,"direction",null),(0,C.gn)([(0,x.qC)()],Pn.prototype,"shadowMinZ",null),(0,C.gn)([(0,x.qC)()],Pn.prototype,"shadowMaxZ",null),D.N.AddNodeConstructor("Light_Type_0",(function(e,t){return function(){return new In(e,h.P.Zero(),t)}}));var In=function(e){(0,P.Z)(n,e);var t=Mn(n);function n(e,i,r){var a;return(0,A.Z)(this,n),(a=t.call(this,e,r))._shadowAngle=Math.PI/2,a.position=i,a}return(0,E.Z)(n,[{key:"shadowAngle",get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()}},{key:"direction",get:function(){return this._direction},set:function(e){var t=this.needCube();this._direction=e,this.needCube()!==t&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()}},{key:"getClassName",value:function(){return"PointLight"}},{key:"getTypeID",value:function(){return En.LIGHTTYPEID_POINTLIGHT}},{key:"needCube",value:function(){return!this.direction}},{key:"getShadowDirection",value:function(e){if(this.direction)return(0,b.Z)((0,I.Z)(n.prototype),"getShadowDirection",this).call(this,e);switch(e){case 0:return new h.P(1,0,0);case 1:return new h.P(-1,0,0);case 2:return new h.P(0,-1,0);case 3:return new h.P(0,1,0);case 4:return new h.P(0,0,1);case 5:return new h.P(0,0,-1)}return h.P.Zero()}},{key:"_setDefaultShadowProjectionMatrix",value:function(e,t,n){var i=this.getScene().activeCamera;if(i){var r=void 0!==this.shadowMinZ?this.shadowMinZ:i.minZ,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:i.maxZ,o=this.getScene().getEngine().useReverseDepthBuffer;h.y3.PerspectiveFovLHToRef(this.shadowAngle,1,o?a:r,o?r:a,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}}},{key:"_buildUniformLayout",value:function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}},{key:"transferToEffect",value:function(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this}},{key:"transferToNodeMaterialEffect",value:function(e,t){return this.computeTransformedInformation()?e.setFloat3(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(t,this.position.x,this.position.y,this.position.z),this}},{key:"prepareLightSpecificDefines",value:function(e,t){e["POINTLIGHT"+t]=!0}}]),n}(Pn);(0,C.gn)([(0,x.qC)()],In.prototype,"shadowAngle",null);var Cn=1.5,xn=1.5,Rn=.5,Dn=6,kn=-4,On=-6,Ln=1.2,Fn=[[0,0,0,0,0,0,1,1,1],[0,0,0,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1]],Nn=function(e){return e+"-"+Math.random().toString(36).slice(2)},wn=function(){function e(e){var t=this;this.engine=null,this.scene=null,this.camera=null,this.viewportRatio=Ln,this.nodes=[],this.frameCount=0,this.onFrame=function(){for(var e=t.frameCount,n=0;n<t.nodes.length;n++)for(var i=t.nodes[n],r=0;r<i.length;r++){var a=i[r];a&&(a.position.y=Cn*(Math.sin(e*xn*.01-.2*r+(e*xn*.006+.3*n))/10+Math.sin(e*xn*.01-r*n*.2)/10+Math.cos(e*xn*.02-.2*r)/8-.25))}t.frameCount=e+1,t.scene.render()},this.canvas=e,this.engine=new r.D(e,!0,{stencil:!0}),this.createScene(),this.populateScene(),this.engine.runRenderLoop(this.onFrame)}var t=e.prototype;return t.createScene=function(){this.scene=new a.x(this.engine),this.camera=new he("cam",0,0,0,h.P.Zero(),this.scene,!0),this.camera.minZ=.1,this.camera.setPosition(new h.P(5,5,-5)),this.camera.mode=1,this.camera.orthoTop=Dn,this.camera.orthoBottom=-Dn,this.camera.orthoLeft=-Dn*this.viewportRatio,this.camera.orthoRight=Dn*this.viewportRatio},t.createBlock=function(e){var t={faceUV:[new h.Lt(0,0,1,1),new h.Lt(0,0,.9,.9),new h.Lt(0,0,1,.9),new h.Lt(0,0,1,1),new h.Lt(0,0,1,1),new h.Lt(0,0,1,0)],wrap:!0},n=new un(Nn("mat"));n.emissiveColor=f.Wo.Red(),n.diffuseColor=f.Wo.White(),n.emissiveColor=f.Wo.White(),n.diffuseTexture=e;var i=v(Nn("box"),Object.assign({size:1,height:2},t),this.scene);return i.material=n,i},t.populateScene=function(){var e=c("foor",{size:150},this.scene);e.material=new un(Nn("mat")),e.material.emissiveColor=f.Wo.White(),e.rotation.x=Math.PI/2,e.position.y=0;var t=new ln.Y("root");t.position.x=kn,t.position.z=On;var n=new Be("data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAQDAwQDAwQEAwQFBAQFBgoHBgYGBg0JCggKDw0QEA8NDw4RExgUERIXEg4PFRwVFxkZGxsbEBQdHx0aHxgaGxr/2wBDAQQFBQYFBgwHBwwaEQ8RGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhr/wAARCAEAAQADASIAAhEBAxEB/8QAGQABAQEBAQEAAAAAAAAAAAAAAAYCBAEI/8QAIxABAAAFBAMBAQEAAAAAAAAAAAEDBAUVAjRTcoKSshJCMv/EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD7NlStc3Xp0S4frVq/zpdOLrOGPtpYte9kdlWCXxdZwx9tJi6zhj7aVQAl8XWcMfbSYus4Y+2lUAJfF1nDH20mLrOGPtpVACXxdZwx9tJi6zhj7aVQAl8XWcMfbSYus4Y+2lUAJfF1nDH20mLrOGPtpVACXxdZwx9tJi6zhj7aVQAl8XWcMfbSYus4Y+2lUAJfF1nDH20mLrOGPtpVACXxdZwx9tJi6zhj7aVQAl8XWcMfbSYus4Y+2lUAJfF1nDH20mLrOGPtpVACXxdZwx9tJi6zhj7aVQAl8XWcMfbSYus4Y+2lUAJfF1nDH20uabK1yZmrRMh+dUP5WKXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0pa97I7KsAAAAAAAAAAAAAAAAAAAAAAAAAAAABL3Tfz/H5VCXum/n+PyDFr3sjsq0dK165WvTrl6vzqh/ToyVXzRBUiWyVXzRMlV80QVIlslV80TJVfNEFSJbJVfNEyVXzRBUiWyVXzRMlV80QVIlslV80TJVfNEFSJbJVfNEyVXzRBUiWyVXzRMlV80QVIlslV80TJVfNEFSJbJVfNEyVXzRBUiWyVXzRMlV80QVIlslV80TJVfNEFSJbJVfNEyVXzRBUiWyVXzRMlV80QVIlslV80TJVfNEFSl7pv5/j8vMlV80XPNm65uvVrmav1q1f0D//2Q=="),i=this.createBlock(n);i.parent=t,i.setEnabled(!1),window.floor=e,window.root=t;for(var r=0;r<9;r++){var a=[];this.nodes[r]=a;for(var o=0;o<9;o++)if(Fn[r][o]){var s=i.createInstance();s.position.x=(1+Rn)*r,s.position.z=(1+Rn)*o,s.parent=t,s.setEnabled(!0),a[o]=s}else a[o]=!1}},t.onResize=function(){this.engine.resize()},t.dispose=function(){this.camera.dispose(),this.scene.dispose(),this.engine.dispose()},e}(),Bn=function(){var e=(0,i.useRef)(null);return(0,i.useEffect)((function(){if(e.current){var t=new wn(e.current);e.current.classList.add("visible");var n=function(){return t.onResize()};return window.addEventListener("resize",n),function(){t.dispose(),window.removeEventListener("resize",n)}}}),[e]),i.createElement("div",{className:"animated-grid"},i.createElement("canvas",{className:"viewport",ref:e}))}},6448:function(e,t,n){"use strict";var i=n(7294),r=n(5900),a=n.n(r),o=n(3698);t.Z=function(e){var t=e.label,n=e.disabled,r=e.clear,s=void 0!==r&&r,u=e.children,l=e.icon,c=(0,o.Z)(),h=a()("button",{"is-clear":s,"is-disabled":n}),f=i.createElement("div",{className:"button-content"},l?i.createElement("span",{className:"icon"},l):null,t?i.createElement("span",{className:"button-text"},c(t)):null,i.createElement("span",{className:"button-shadow"}));return i.createElement(i.Fragment,null,u({buttonClasses:h,buttonContent:f}))}},1728:function(e,t,n){"use strict";var i=n(3366),r=n(7294),a=n(6448),o=["href","external"];t.Z=function(e){var t=e.href,n=e.external,s=(0,i.Z)(e,o);return r.createElement(a.Z,s,(function(e){var i=e.buttonClasses,a=e.buttonContent;return r.createElement("a",{className:i,href:t,target:n?"_blank":"",rel:n?"noopener noreferrer":""},a)}))}},531:function(e,t,n){"use strict";function i(e,t,n,i,r,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(i,r)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,u,"next",e)}function u(e){i(o,r,a,s,u,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return r}})},4942:function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{Z:function(){return i}})},1752:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(1120);function r(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,i.Z)(e)););return e}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=r(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},a.apply(this,arguments)}},3366:function(e,t,n){"use strict";function i(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}n.d(t,{Z:function(){return i}})}}]);
//# sourceMappingURL=63059ea4aaf8f12820a431e7c69fccd0ab797964-de4174c3042f48eb65a1.js.map